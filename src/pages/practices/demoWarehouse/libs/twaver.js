!(function(a, b) {
  function c(a, b, c) { a != null && (typeof a === 'number' ? this.fromNumber(a, b, c) : b == null && typeof a !== 'string' ? this.fromString(a, 256) : this.fromString(a, b)) } function d() { return new c(null) } function e(a, b, c, d, e, f) { for (;--f >= 0;) { var g = b * this[a++] + c[d] + e; e = Math.floor(g / 67108864), c[d++] = 67108863 & g } return e } function f(a, b, c, d, e, f) { for (var g = 32767 & b, h = b >> 15; --f >= 0;) { var i = 32767 & this[a], j = this[a++] >> 15, k = h * i + j * g; i = g * i + ((32767 & k) << 15) + c[d] + (1073741823 & e), e = (i >>> 30) + (k >>> 15) + h * j + (e >>> 30), c[d++] = 1073741823 & i } return e } function g(a, b, c, d, e, f) { for (var g = 16383 & b, h = b >> 14; --f >= 0;) { var i = 16383 & this[a], j = this[a++] >> 14, k = h * i + j * g; i = g * i + ((16383 & k) << 14) + c[d] + e, e = (i >> 28) + (k >> 14) + h * j, c[d++] = 268435455 & i } return e } function h(a) { return dc.charAt(a) } function j(a, b) { var c = ec[a.charCodeAt(b)]; return c == null ? -1 : c } function k(a) { for (var b = this.t - 1; b >= 0; --b)a[b] = this[b]; a.t = this.t, a.s = this.s } function l(a) { this.t = 1, this.s = a < 0 ? -1 : 0, a > 0 ? this[0] = a : a < -1 ? this[0] = a + DV : this.t = 0 } function m(a) { var b = d(); return b.fromInt(a), b } function n(a, b) { var d; if (b == 16)d = 4; else if (b == 8)d = 3; else if (b == 256)d = 8; else if (b == 2)d = 1; else if (b == 32)d = 5; else { if (b != 4) return void this.fromRadix(a, b); d = 2 } this.t = 0, this.s = 0; for (var e = a.length, f = !1, g = 0; --e >= 0;) { var h = d == 8 ? 255 & a[e] : j(a, e); h < 0 ? a.charAt(e) == '-' && (f = !0) : (f = !1, g == 0 ? this[this.t++] = h : g + d > this.DB ? (this[this.t - 1] |= (h & (1 << this.DB - g) - 1) << g, this[this.t++] = h >> this.DB - g) : this[this.t - 1] |= h << g, g += d, g >= this.DB && (g -= this.DB)) }d == 8 && (128 & a[0]) != 0 && (this.s = -1, g > 0 && (this[this.t - 1] |= (1 << this.DB - g) - 1 << g)), this.clamp(), f && c.ZERO.subTo(this, this) } function o() { for (var a = this.s & this.DM; this.t > 0 && this[this.t - 1] == a;)--this.t } function p(a) { if (this.s < 0) return '-' + this.negate().toString(a); var b; if (a == 16)b = 4; else if (a == 8)b = 3; else if (a == 2)b = 1; else if (a == 32)b = 5; else { if (a != 4) return this.toRadix(a); b = 2 } var c, d = (1 << b) - 1, e = !1, f = '', g = this.t, i = this.DB - g * this.DB % b; if (g-- > 0) for (i < this.DB && (c = this[g] >> i) > 0 && (e = !0, f = h(c)); g >= 0;)b > i ? (c = (this[g] & (1 << i) - 1) << b - i, c |= this[--g] >> (i += this.DB - b)) : (c = this[g] >> (i -= b) & d, i <= 0 && (i += this.DB, --g)), c > 0 && (e = !0), e && (f += h(c)); return e ? f : '0' } function q() { var a = d(); return c.ZERO.subTo(this, a), a } function r() { return this.s < 0 ? this.negate() : this } function s(a) { var b = this.s - a.s; if (b != 0) return b; var c = this.t; if (b = c - a.t, b != 0) return b; for (;--c >= 0;) if ((b = this[c] - a[c]) != 0) return b; return 0 } function t(a) { var b, c = 1; return (b = a >>> 16) != 0 && (a = b, c += 16), (b = a >> 8) != 0 && (a = b, c += 8), (b = a >> 4) != 0 && (a = b, c += 4), (b = a >> 2) != 0 && (a = b, c += 2), (b = a >> 1) != 0 && (a = b, c += 1), c } function u() { return this.t <= 0 ? 0 : this.DB * (this.t - 1) + t(this[this.t - 1] ^ this.s & this.DM) } function v(a, b) { var c; for (c = this.t - 1; c >= 0; --c)b[c + a] = this[c]; for (c = a - 1; c >= 0; --c)b[c] = 0; b.t = this.t + a, b.s = this.s } function w(a, b) { for (var c = a; c < this.t; ++c)b[c - a] = this[c]; b.t = Math.max(this.t - a, 0), b.s = this.s } function x(a, b) { var c, d = a % this.DB, e = this.DB - d, f = (1 << e) - 1, g = Math.floor(a / this.DB), h = this.s << d & this.DM; for (c = this.t - 1; c >= 0; --c)b[c + g + 1] = this[c] >> e | h, h = (this[c] & f) << d; for (c = g - 1; c >= 0; --c)b[c] = 0; b[g] = h, b.t = this.t + g + 1, b.s = this.s, b.clamp() } function y(a, b) { b.s = this.s; var c = Math.floor(a / this.DB); if (c >= this.t) return void (b.t = 0); var d = a % this.DB, e = this.DB - d, f = (1 << d) - 1; b[0] = this[c] >> d; for (var g = c + 1; g < this.t; ++g)b[g - c - 1] |= (this[g] & f) << e, b[g - c] = this[g] >> d; d > 0 && (b[this.t - c - 1] |= (this.s & f) << e), b.t = this.t - c, b.clamp() } function z(a, b) { for (var c = 0, d = 0, e = Math.min(a.t, this.t); e > c;)d += this[c] - a[c], b[c++] = d & this.DM, d >>= this.DB; if (a.t < this.t) { for (d -= a.s; c < this.t;)d += this[c], b[c++] = d & this.DM, d >>= this.DB; d += this.s } else { for (d += this.s; c < a.t;)d -= a[c], b[c++] = d & this.DM, d >>= this.DB; d -= a.s }b.s = d < 0 ? -1 : 0, d < -1 ? b[c++] = this.DV + d : d > 0 && (b[c++] = d), b.t = c, b.clamp() } function A(a, b) { var d = this.abs(), e = a.abs(), f = d.t; for (b.t = f + e.t; --f >= 0;)b[f] = 0; for (f = 0; f < e.t; ++f)b[f + d.t] = d.am(0, e[f], b, f, 0, d.t); b.s = 0, b.clamp(), this.s != a.s && c.ZERO.subTo(b, b) } function B(a) { for (var b = this.abs(), c = a.t = 2 * b.t; --c >= 0;)a[c] = 0; for (c = 0; c < b.t - 1; ++c) { var d = b.am(c, b[c], a, 2 * c, 0, 1); (a[c + b.t] += b.am(c + 1, 2 * b[c], a, 2 * c + 1, d, b.t - c - 1)) >= b.DV && (a[c + b.t] -= b.DV, a[c + b.t + 1] = 1) }a.t > 0 && (a[a.t - 1] += b.am(c, b[c], a, 2 * c, 0, 1)), a.s = 0, a.clamp() } function C(a, b, e) { var f = a.abs(); if (!(f.t <= 0)) { var g = this.abs(); if (g.t < f.t) return b != null && b.fromInt(0), void (e != null && this.copyTo(e)); e == null && (e = d()); var h = d(), i = this.s, j = a.s, k = this.DB - t(f[f.t - 1]); k > 0 ? (f.lShiftTo(k, h), g.lShiftTo(k, e)) : (f.copyTo(h), g.copyTo(e)); var l = h.t, m = h[l - 1]; if (m != 0) { var n = m * (1 << this.F1) + (l > 1 ? h[l - 2] >> this.F2 : 0), o = this.FV / n, p = (1 << this.F1) / n, q = 1 << this.F2, r = e.t, s = r - l, u = b == null ? d() : b; for (h.dlShiftTo(s, u), e.compareTo(u) >= 0 && (e[e.t++] = 1, e.subTo(u, e)), c.ONE.dlShiftTo(l, u), u.subTo(h, h); h.t < l;)h[h.t++] = 0; for (;--s >= 0;) { var v = e[--r] == m ? this.DM : Math.floor(e[r] * o + (e[r - 1] + q) * p); if ((e[r] += h.am(0, v, e, s, 0, l)) < v) for (h.dlShiftTo(s, u), e.subTo(u, e); e[r] < --v;)e.subTo(u, e) }b != null && (e.drShiftTo(l, b), i != j && c.ZERO.subTo(b, b)), e.t = l, e.clamp(), k > 0 && e.rShiftTo(k, e), i < 0 && c.ZERO.subTo(e, e) } } } function D(a) { var b = d(); return this.abs().divRemTo(a, null, b), this.s < 0 && b.compareTo(c.ZERO) > 0 && a.subTo(b, b), b } function E(a) { this.m = a } function F(a) { return a.s < 0 || a.compareTo(this.m) >= 0 ? a.mod(this.m) : a } function G(a) { return a } function H(a) { a.divRemTo(this.m, null, a) } function I(a, b, c) { a.multiplyTo(b, c), this.reduce(c) } function J(a, b) { a.squareTo(b), this.reduce(b) } function K() { if (this.t < 1) return 0; var a = this[0]; if ((1 & a) == 0) return 0; var b = 3 & a; return b = b * (2 - (15 & a) * b) & 15, b = b * (2 - (255 & a) * b) & 255, b = b * (2 - ((65535 & a) * b & 65535)) & 65535, b = b * (2 - a * b % this.DV) % this.DV, b > 0 ? this.DV - b : -b } function L(a) { this.m = a, this.mp = a.invDigit(), this.mpl = 32767 & this.mp, this.mph = this.mp >> 15, this.um = (1 << a.DB - 15) - 1, this.mt2 = 2 * a.t } function M(a) { var b = d(); return a.abs().dlShiftTo(this.m.t, b), b.divRemTo(this.m, null, b), a.s < 0 && b.compareTo(c.ZERO) > 0 && this.m.subTo(b, b), b } function N(a) { var b = d(); return a.copyTo(b), this.reduce(b), b } function O(a) { for (;a.t <= this.mt2;)a[a.t++] = 0; for (var b = 0; b < this.m.t; ++b) { var c = 32767 & a[b], d = c * this.mpl + ((c * this.mph + (a[b] >> 15) * this.mpl & this.um) << 15) & a.DM; for (c = b + this.m.t, a[c] += this.m.am(0, d, a, b, 0, this.m.t); a[c] >= a.DV;)a[c] -= a.DV, a[++c]++ }a.clamp(), a.drShiftTo(this.m.t, a), a.compareTo(this.m) >= 0 && a.subTo(this.m, a) } function P(a, b) { a.squareTo(b), this.reduce(b) } function Q(a, b, c) { a.multiplyTo(b, c), this.reduce(c) } function R() { return (this.t > 0 ? 1 & this[0] : this.s) == 0 } function S(a, b) { if (a > 4294967295 || a < 1) return c.ONE; var e = d(), f = d(), g = b.convert(this), h = t(a) - 1; for (g.copyTo(e); --h >= 0;) if (b.sqrTo(e, f), (a & 1 << h) > 0)b.mulTo(f, g, e); else { var i = e; e = f, f = i } return b.revert(e) } function T(a, b) { var c; return c = a < 256 || b.isEven() ? new E(b) : new L(b), this.exp(a, c) } function U() { var a = d(); return this.copyTo(a), a } function V() { if (this.s < 0) { if (this.t == 1) return this[0] - this.DV; if (this.t == 0) return -1 } else { if (this.t == 1) return this[0]; if (this.t == 0) return 0 } return (this[1] & (1 << 32 - this.DB) - 1) << this.DB | this[0] } function W() { return this.t == 0 ? this.s : this[0] << 24 >> 24 } function X() { return this.t == 0 ? this.s : this[0] << 16 >> 16 } function Y(a) { return Math.floor(Math.LN2 * this.DB / Math.log(a)) } function Z() { return this.s < 0 ? -1 : this.t <= 0 || this.t == 1 && this[0] <= 0 ? 0 : 1 } function $(a) { if (a == null && (a = 10), this.signum() == 0 || a < 2 || a > 36) return '0'; var b = this.chunkSize(a), c = Math.pow(a, b), e = m(c), f = d(), g = d(), h = ''; for (this.divRemTo(e, f, g); f.signum() > 0;)h = (c + g.intValue()).toString(a).substr(1) + h, f.divRemTo(e, f, g); return g.intValue().toString(a) + h } function _(a, b) { this.fromInt(0), b == null && (b = 10); for (var d = this.chunkSize(b), e = Math.pow(b, d), f = !1, g = 0, h = 0, i = 0; i < a.length; ++i) { var k = j(a, i); k < 0 ? a.charAt(i) == '-' && this.signum() == 0 && (f = !0) : (h = b * h + k, ++g >= d && (this.dMultiply(e), this.dAddOffset(h, 0), g = 0, h = 0)) }g > 0 && (this.dMultiply(Math.pow(b, g)), this.dAddOffset(h, 0)), f && c.ZERO.subTo(this, this) } function aa(a, b, d) { if (typeof b === 'number') if (a < 2) this.fromInt(1); else for (this.fromNumber(a, d), this.testBit(a - 1) || this.bitwiseTo(c.ONE.shiftLeft(a - 1), ia, this), this.isEven() && this.dAddOffset(1, 0); !this.isProbablePrime(b);) this.dAddOffset(2, 0), this.bitLength() > a && this.subTo(c.ONE.shiftLeft(a - 1), this); else { var e = new Array(), f = 7 & a; e.length = (a >> 3) + 1, b.nextBytes(e), f > 0 ? e[0] &= (1 << f) - 1 : e[0] = 0, this.fromString(e, 256) } } function ba() { var a = this.t, b = new Array(); b[0] = this.s; var c, d = this.DB - a * this.DB % 8, e = 0; if (a-- > 0) for (d < this.DB && (c = this[a] >> d) != (this.s & this.DM) >> d && (b[e++] = c | this.s << this.DB - d); a >= 0;)d < 8 ? (c = (this[a] & (1 << d) - 1) << 8 - d, c |= this[--a] >> (d += this.DB - 8)) : (c = this[a] >> (d -= 8) & 255, d <= 0 && (d += this.DB, --a)), (128 & c) != 0 && (c |= -256), e == 0 && (128 & this.s) != (128 & c) && ++e, (e > 0 || c != this.s) && (b[e++] = c); return b } function ca(a) { return this.compareTo(a) == 0 } function da(a) { return this.compareTo(a) < 0 ? this : a } function ea(a) { return this.compareTo(a) > 0 ? this : a } function fa(a, b, c) { var d, e, f = Math.min(a.t, this.t); for (d = 0; f > d; ++d)c[d] = b(this[d], a[d]); if (a.t < this.t) { for (e = a.s & this.DM, d = f; d < this.t; ++d)c[d] = b(this[d], e); c.t = this.t } else { for (e = this.s & this.DM, d = f; d < a.t; ++d)c[d] = b(e, a[d]); c.t = a.t }c.s = b(this.s, a.s), c.clamp() } function ga(a, b) { return a & b } function ha(a) { var b = d(); return this.bitwiseTo(a, ga, b), b } function ia(a, b) { return a | b } function ja(a) { var b = d(); return this.bitwiseTo(a, ia, b), b } function ka(a, b) { return a ^ b } function la(a) { var b = d(); return this.bitwiseTo(a, ka, b), b } function ma(a, b) { return a & ~b } function na(a) { var b = d(); return this.bitwiseTo(a, ma, b), b } function oa() { for (var a = d(), b = 0; b < this.t; ++b)a[b] = this.DM & ~this[b]; return a.t = this.t, a.s = ~this.s, a } function pa(a) { var b = d(); return a < 0 ? this.rShiftTo(-a, b) : this.lShiftTo(a, b), b } function qa(a) { var b = d(); return a < 0 ? this.lShiftTo(-a, b) : this.rShiftTo(a, b), b } function ra(a) { if (a == 0) return -1; var b = 0; return (65535 & a) == 0 && (a >>= 16, b += 16), (255 & a) == 0 && (a >>= 8, b += 8), (15 & a) == 0 && (a >>= 4, b += 4), (3 & a) == 0 && (a >>= 2, b += 2), (1 & a) == 0 && ++b, b } function sa() { for (var a = 0; a < this.t; ++a) if (this[a] != 0) return a * this.DB + ra(this[a]); return this.s < 0 ? this.t * this.DB : -1 } function ta(a) { for (var b = 0; a != 0;)a &= a - 1, ++b; return b } function ua() { for (var a = 0, b = this.s & this.DM, c = 0; c < this.t; ++c)a += ta(this[c] ^ b); return a } function va(a) { var b = Math.floor(a / this.DB); return b >= this.t ? this.s != 0 : (this[b] & 1 << a % this.DB) != 0 } function wa(a, b) { var d = c.ONE.shiftLeft(a); return this.bitwiseTo(d, b, d), d } function xa(a) { return this.changeBit(a, ia) } function ya(a) { return this.changeBit(a, ma) } function za(a) { return this.changeBit(a, ka) } function Aa(a, b) { for (var c = 0, d = 0, e = Math.min(a.t, this.t); e > c;)d += this[c] + a[c], b[c++] = d & this.DM, d >>= this.DB; if (a.t < this.t) { for (d += a.s; c < this.t;)d += this[c], b[c++] = d & this.DM, d >>= this.DB; d += this.s } else { for (d += this.s; c < a.t;)d += a[c], b[c++] = d & this.DM, d >>= this.DB; d += a.s }b.s = d < 0 ? -1 : 0, d > 0 ? b[c++] = d : d < -1 && (b[c++] = this.DV + d), b.t = c, b.clamp() } function Ba(a) { var b = d(); return this.addTo(a, b), b } function Ca(a) { var b = d(); return this.subTo(a, b), b } function Da(a) { var b = d(); return this.multiplyTo(a, b), b } function Ea() { var a = d(); return this.squareTo(a), a } function Fa(a) { var b = d(); return this.divRemTo(a, b, null), b } function Ga(a) { var b = d(); return this.divRemTo(a, null, b), b } function Ha(a) { var b = d(), c = d(); return this.divRemTo(a, b, c), new Array(b, c) } function Ia(a) { this[this.t] = this.am(0, a - 1, this, 0, 0, this.t), ++this.t, this.clamp() } function Ja(a, b) { if (a != 0) { for (;this.t <= b;) this[this.t++] = 0; for (this[b] += a; this[b] >= this.DV;) this[b] -= this.DV, ++b >= this.t && (this[this.t++] = 0), ++this[b] } } function Ka() {} function La(a) { return a } function Ma(a, b, c) { a.multiplyTo(b, c) } function Na(a, b) { a.squareTo(b) } function Oa(a) { return this.exp(a, new Ka()) } function Pa(a, b, c) { var d = Math.min(this.t + a.t, b); for (c.s = 0, c.t = d; d > 0;)c[--d] = 0; var e; for (e = c.t - this.t; e > d; ++d)c[d + this.t] = this.am(0, a[d], c, d, 0, this.t); for (e = Math.min(a.t, b); e > d; ++d) this.am(0, a[d], c, d, 0, b - d); c.clamp() } function Qa(a, b, c) { --b; var d = c.t = this.t + a.t - b; for (c.s = 0; --d >= 0;)c[d] = 0; for (d = Math.max(b - this.t, 0); d < a.t; ++d)c[this.t + d - b] = this.am(b - d, a[d], c, 0, 0, this.t + d - b); c.clamp(), c.drShiftTo(1, c) } function Ra(a) { this.r2 = d(), this.q3 = d(), c.ONE.dlShiftTo(2 * a.t, this.r2), this.mu = this.r2.divide(a), this.m = a } function Sa(a) { if (a.s < 0 || a.t > 2 * this.m.t) return a.mod(this.m); if (a.compareTo(this.m) < 0) return a; var b = d(); return a.copyTo(b), this.reduce(b), b } function Ta(a) { return a } function Ua(a) { for (a.drShiftTo(this.m.t - 1, this.r2), a.t > this.m.t + 1 && (a.t = this.m.t + 1, a.clamp()), this.mu.multiplyUpperTo(this.r2, this.m.t + 1, this.q3), this.m.multiplyLowerTo(this.q3, this.m.t + 1, this.r2); a.compareTo(this.r2) < 0;)a.dAddOffset(1, this.m.t + 1); for (a.subTo(this.r2, a); a.compareTo(this.m) >= 0;)a.subTo(this.m, a) } function Va(a, b) { a.squareTo(b), this.reduce(b) } function Wa(a, b, c) { a.multiplyTo(b, c), this.reduce(c) } function Xa(a, b) { var c, e, f = a.bitLength(), g = m(1); if (f <= 0) return g; c = f < 18 ? 1 : f < 48 ? 3 : f < 144 ? 4 : f < 768 ? 5 : 6, e = f < 8 ? new E(b) : b.isEven() ? new Ra(b) : new L(b); var h = new Array(), i = 3, j = c - 1, k = (1 << c) - 1; if (h[1] = e.convert(this), c > 1) { var l = d(); for (e.sqrTo(h[1], l); k >= i;)h[i] = d(), e.mulTo(l, h[i - 2], h[i]), i += 2 } var n, o, p = a.t - 1, q = !0, r = d(); for (f = t(a[p]) - 1; p >= 0;) { for (f >= j ? n = a[p] >> f - j & k : (n = (a[p] & (1 << f + 1) - 1) << j - f, p > 0 && (n |= a[p - 1] >> this.DB + f - j)), i = c; (1 & n) == 0;)n >>= 1, --i; if ((f -= i) < 0 && (f += this.DB, --p), q)h[n].copyTo(g), q = !1; else { for (;i > 1;)e.sqrTo(g, r), e.sqrTo(r, g), i -= 2; i > 0 ? e.sqrTo(g, r) : (o = g, g = r, r = o), e.mulTo(r, h[n], g) } for (;p >= 0 && (a[p] & 1 << f) == 0;)e.sqrTo(g, r), o = g, g = r, r = o, --f < 0 && (f = this.DB - 1, --p) } return e.revert(g) } function Ya(a) { var b = this.s < 0 ? this.negate() : this.clone(), c = a.s < 0 ? a.negate() : a.clone(); if (b.compareTo(c) < 0) { var d = b; b = c, c = d } var e = b.getLowestSetBit(), f = c.getLowestSetBit(); if (f < 0) return b; for (f > e && (f = e), f > 0 && (b.rShiftTo(f, b), c.rShiftTo(f, c)); b.signum() > 0;)(e = b.getLowestSetBit()) > 0 && b.rShiftTo(e, b), (e = c.getLowestSetBit()) > 0 && c.rShiftTo(e, c), b.compareTo(c) >= 0 ? (b.subTo(c, b), b.rShiftTo(1, b)) : (c.subTo(b, c), c.rShiftTo(1, c)); return f > 0 && c.lShiftTo(f, c), c } function Za(a) { if (a <= 0) return 0; var b = this.DV % a, c = this.s < 0 ? a - 1 : 0; if (this.t > 0) if (b == 0)c = this[0] % a; else for (var d = this.t - 1; d >= 0; --d)c = (b * c + this[d]) % a; return c } function $a(a) { var b = a.isEven(); if (this.isEven() && b || a.signum() == 0) return c.ZERO; for (var d = a.clone(), e = this.clone(), f = m(1), g = m(0), h = m(0), i = m(1); d.signum() != 0;) { for (;d.isEven();)d.rShiftTo(1, d), b ? (f.isEven() && g.isEven() || (f.addTo(this, f), g.subTo(a, g)), f.rShiftTo(1, f)) : g.isEven() || g.subTo(a, g), g.rShiftTo(1, g); for (;e.isEven();)e.rShiftTo(1, e), b ? (h.isEven() && i.isEven() || (h.addTo(this, h), i.subTo(a, i)), h.rShiftTo(1, h)) : i.isEven() || i.subTo(a, i), i.rShiftTo(1, i); d.compareTo(e) >= 0 ? (d.subTo(e, d), b && f.subTo(h, f), g.subTo(i, g)) : (e.subTo(d, e), b && h.subTo(f, h), i.subTo(g, i)) } return e.compareTo(c.ONE) != 0 ? c.ZERO : i.compareTo(a) >= 0 ? i.subtract(a) : i.signum() < 0 ? (i.addTo(a, i), i.signum() < 0 ? i.add(a) : i) : i } function _a(a) { var b, c = this.abs(); if (c.t == 1 && c[0] <= fc[fc.length - 1]) { for (b = 0; b < fc.length; ++b) if (c[0] == fc[b]) return !0; return !1 } if (c.isEven()) return !1; for (b = 1; b < fc.length;) { for (var d = fc[b], e = b + 1; e < fc.length && gc > d;)d *= fc[e++]; for (d = c.modInt(d); e > b;) if (d % fc[b++] == 0) return !1 } return c.millerRabin(a) } function ab(a) { var b = this.subtract(c.ONE), e = b.getLowestSetBit(); if (e <= 0) return !1; var f = b.shiftRight(e); a = a + 1 >> 1, a > fc.length && (a = fc.length); for (var g = d(), h = 0; a > h; ++h) { g.fromInt(fc[Math.floor(Ib.Util.random() * fc.length)]); var i = g.modPow(f, this); if (i.compareTo(c.ONE) != 0 && i.compareTo(b) != 0) { for (var j = 1; j++ < e && i.compareTo(b) != 0;) if (i = i.modPowInt(2, this), i.compareTo(c.ONE) == 0) return !1; if (i.compareTo(b) != 0) return !1 } } return !0 } function bb() { this.i = 0, this.j = 0, this.S = new Array() } function cb(a) { var b, c, d; for (b = 0; b < 256; ++b) this.S[b] = b; for (c = 0, b = 0; b < 256; ++b)c = c + this.S[b] + a[b % a.length] & 255, d = this.S[b], this.S[b] = this.S[c], this.S[c] = d; this.i = 0, this.j = 0 } function db() { var a; return this.i = this.i + 1 & 255, this.j = this.j + this.S[this.i] & 255, a = this.S[this.i], this.S[this.i] = this.S[this.j], this.S[this.j] = a, this.S[a + this.S[this.i] & 255] } function eb() { return new bb() } function fb(a) { ic[jc++] ^= 255 & a, ic[jc++] ^= a >> 8 & 255, ic[jc++] ^= a >> 16 & 255, ic[jc++] ^= a >> 24 & 255, jc >= kc && (jc -= kc) } function gb() { fb((new Date()).getTime()) } function hb() { if (hc == null) { for (gb(), hc = eb(), hc.init(ic), jc = 0; jc < ic.length; ++jc)ic[jc] = 0; jc = 0 } return hc.next() } function ib(a) { var b; for (b = 0; b < a.length; ++b)a[b] = hb() } function jb() {} function kb(a, b) { return new c(a, b) } function lb(a, b) { if (b < a.length + 11) return null; for (var d = new Array(), e = a.length - 1; e >= 0 && b > 0;) { var f = a.charCodeAt(e--); f < 128 ? d[--b] = f : f > 127 && f < 2048 ? (d[--b] = 63 & f | 128, d[--b] = f >> 6 | 192) : (d[--b] = 63 & f | 128, d[--b] = f >> 6 & 63 | 128, d[--b] = f >> 12 | 224) }d[--b] = 0; for (var g = new jb(), h = new Array(); b > 2;) { for (h[0] = 0; h[0] == 0;)g.nextBytes(h); d[--b] = h[0] } return d[--b] = 2, d[--b] = 0, new c(d) } function mb() { this.n = null, this.e = 0, this.d = null, this.p = null, this.q = null, this.dmp1 = null, this.dmq1 = null, this.coeff = null } function nb(a, b) { this.n = kb(a, 16), this.e = parseInt(b, 16) } function ob(a) { return a.modPowInt(this.e, this.n) } function pb(a) { var b = lb(a, this.n.bitLength() + 7 >> 3); if (b == null) return null; var c = this.doPrivate(b); if (c == null) return null; var d = c.toString(16); return (1 & d.length) == 0 ? d : '0' + d } function qb(a, b) { for (var c = a.toByteArray(), d = 0; d < c.length && c[d] == 0;)++d; if (c.length - d != b - 1 || c[d] != 2) return null; for (++d; c[d] != 0;) if (++d >= c.length) return null; for (var e = ''; ++d < c.length;) { var f = 255 & c[d]; f < 128 ? e += String.fromCharCode(f) : f > 191 && f < 224 ? (e += String.fromCharCode((31 & f) << 6 | 63 & c[d + 1]), ++d) : (e += String.fromCharCode((15 & f) << 12 | (63 & c[d + 1]) << 6 | 63 & c[d + 2]), d += 2) } return e } function rb(a, b, c) { this.n = kb(a, 16), this.e = parseInt(b, 16), this.d = kb(c, 16) } function sb(a, b, c, d, e, f, g, h) { this.n = kb(a, 16), this.e = parseInt(b, 16), this.d = kb(c, 16), this.p = kb(d, 16), this.q = kb(e, 16), this.dmp1 = kb(f, 16), this.dmq1 = kb(g, 16), this.coeff = kb(h, 16) } function tb(a) { if (this.p == null || this.q == null) return a.modPow(this.d, this.n); for (var b = a.mod(this.p).modPow(this.dmp1, this.p), c = a.mod(this.q).modPow(this.dmq1, this.q); b.compareTo(c) < 0;)b = b.add(this.p); return b.subtract(c).multiply(this.coeff).mod(this.p).multiply(this.q).add(c) } function ub(a) { var b = kb(a, 16), c = this.doPublic(b); return c == null ? null : qb(c, this.n.bitLength() + 7 >> 3) } function vb(a, b, c) { var d = 0, e = 0, f = b.split('\n'), g = 2 * a.measureText('e').width; return f.forEach(function(b) { if (c) { var f, h, i, j, k, l = b.split(' '), m = l.length, n = ''; for (i = 0; m > i; i++) if (f = l[i] + (i === m - 1 ? '' : ' '), h = n + f, j = a.measureText(h).width, c > j)n = h; else if (j == c)n = '', e += g; else { for (k = 0; k < f.length; k++) if (h = n + f.substr(0, k + 1), a.measureText(h).width > c) { n = f.substring(k, f.length), e += g; break } for (;n.length > 0 && a.measureText(n).width > c;) for (k = 0; k < n.length; k++) if (h = n.substr(0, k + 1), a.measureText(h).width > c) { n = n.substring(k, n.length), e += g; break } } } else j = a.measureText(b).width, d = j > d ? j : d; e += g }), d = c || d, { w: d, h: e } } function wb(a, b, c, d) { var e, f = a.animate, g = d._now, h = d._shapeDataIndex, i = c._animates; if (i || (i = c._animates = {}), h.length) for (var j = 0; j < h.length; j++) { e = h[j]; var k = i[e]; k || (k = i[e] = {}), i = k } else e = h; var l = i[e]; l || (l = i[e] = {}, f.forEach(function(e) { var f, h = e.attr, i = l[h]; e = { attr: h, to: e.to, type: e.type || 'number', delay: e.delay || 0, dur: e.dur || 1e3, interval: e.interval || 0, finish: e.finish, repeat: e.repeat || 1, reverse: e.reverse == null ? !0 : e.reverse, onDone: e.onDone, easing: e.easing, trigger: e.to == null, start: g, time: 0, total: 0, count: 0, started: !1, stopped: !1, current: null }, Array.isArray(e.dur) && (e.groupDur = e.dur.slice(0, e.dur.length - 1), e.dur = e.dur[e.dur.length - 1], e.groupDurTotal = e.groupDur.reduce(function(a, b, c) { return e.groupDur[c] = a + b }, 0), e.groupIndex = 0, e.groupTime = 0, e.groupStart = g), e.finish == null && (e.finish = e.delay + e.dur + e.interval), i ? Array.isArray(i) ? (i.push(e), i = i[i.length - 2]) : l[h] = [i, e] : (f = Yc(c, b, a, h, d), l[h] = e), i && (f = i.to, i.type === 'group_set' && (f = f[f.length - 1])), e.from = f, e.trigger || (e.started = !0, Fb(e), Gb(e)) })), f = l, Object.keys(f).forEach(function(e) { var h = f[e]; if (Array.isArray(h)) { var i = h[h.length - 1]; i.count + 1 === i.repeat ? h.forEach(function(e) { xb(e, a, b, c, d, !0) }) : i.count + 1 < i.repeat && (i.total >= i.finish && h.forEach(function(a) { a.trigger || (a.started = !0), a.stopped = !1, a.time = 0, a.start = g, a.total = 0, a.type === 'group_set' && (a.groupIndex = 0, a.groupTime = 0, a.groupStart = g) }), h.forEach(function(e) { xb(e, a, b, c, d, !1) })) } else xb(h, a, b, c, d, !0) }) } function xb(a, b, c, d, e, f) { if (a.trigger) { var g = Yc(d, c, b, a.attr, e, null, !1); if (!a.started) { if (g === a.from) return; a.started = !0, a.start = e._now, a.to = g, Fb(a), Gb(a) }a.started && g !== a.to && (a.start = e._now, a.from = a.current, a.to = g, a.time = 0, a.total = 0, a.count = 0, Fb(a), Gb(a)) } if (a.started && !a.stopped) { var h = e._now, i = h - a.start; if (i >= a.delay && (a.total = i, i -= a.delay, a.time = i > a.dur ? a.dur : i, a.type === 'group_set' && (a.groupTime = h - a.groupStart, a.groupStart === a.start && (a.groupTime -= a.delay), a.groupTime >= a.groupDur[a.groupIndex] && a.groupIndex++, a.groupTime >= a.groupDurTotal && (a.groupIndex = 0, a.groupTime = a.groupTime - a.groupDurTotal, a.groupStart = h)), a.total >= a.finish)) if (a.count++, a.type === 'group_set', a.count >= a.repeat)a.time = a.dur, a.stopped = !0, a.trigger && (a.from = a.to, a.to = null, a.start = null, a.time = 0, a.total = 0, a.count = 0, a.started = !1, a.stopped = !1), a.onDone && a.onDone.call(c, d, e); else if (f && (a.time = 0, a.start = h, a.total = 0, a.reverse)) { var j = a.from; a.from = a.to, a.to = j, Gb(a) }e && !e._invalidate && (e._invalidate = !0) } } function yb(a) { if (!hd[a.id]) { if (jd = !0, hd[a.id] = a, a.from == null && a.attr && a.source) { var b; a.from = (b = a.attr.match(/^S[:@](.*)/i)) ? a.source.getStyle(b[1]) : (b = a.attr.match(/^C[:@](.*)/i)) ? a.source.getClient(b[1]) : Ib.Util.getValue(a.source, a.attr) }Fb(a), Gb(a) } return a.resume(), a } function zb(a, b) { return hd[a.id] && (b == null && (b = !0), b && Eb(a, a.to), a.onStop && a.onStop(), a.time = 0, a.total = 0, a.start = null, a.count = 0, a.started = !1, a.stopped = !1, a.paused = !1, a.pausedTime = null, a.pausedTotal = 0, a._oldSpeed = null, a._speedTotal = 0, a._speedTime = null, a._percent = 0, a._percentSet = null, a._percentDiff = 0, delete hd[a.id]), a } function Ab(a) { a == null && (a = !0), Object.keys(hd).forEach(function(b) { var c = hd[b]; c && (a && Eb(c, c.to), c.onStop && c.onStop()) }), hd = {} } function Bb() { Object.keys(hd).forEach(function(a) { var b = hd[a]; b && b.pause() }) } function Cb() { Object.keys(hd).forEach(function(a) { var b = hd[a]; b && b.resume() }) } function Db(a) { Object.keys(hd).forEach(function(b) { var c = hd[b]; if (c && (c.start == null && (c._speedTime = c.start = a), c._percentSet != null && (c._percentDiff += (c._percentSet - c._percent) * c.finish), !c.paused || (c.pausedTime || (c.pausedTime = a), c._percentSet != null))) { if (c._percentSet == null && c.pausedTime && (c.pausedTotal += (a - c.pausedTime) * (c._oldSpeed || c._speed), c.pausedTime = null), c._oldSpeed && !c.pausedTime && (c._speedTotal = (a - c._speedTime) * c._oldSpeed - c.pausedTotal + c._percentDiff + c._speedTotal, c._percentDiff = 0, c.pausedTotal = 0, c._speedTime = a, c._oldSpeed = null), c.total = (a - c._speedTime) * c._speed - c.pausedTotal + c._percentDiff + c._speedTotal, c._percentSet != null && c.pausedTime && (c.total -= (a - c.pausedTime) * (c._oldSpeed || c._speed)), c._percent = c.total >= c.finish ? 1 : c.total / c.finish, c.total > c.delay) { c.time = c.total - c.delay; var d = !1; if (c.time >= c.dur && (c.time = c.dur, d = !0), !c.stopped && Eb(c, Hb(c)), c.stopped = d, c.total >= c.finish) if (c.count++, c.count >= c.repeat)zb(c, !1), c.onDone && c.onDone(); else if (c.time = 0, c.total = 0, c.start = null, c.stopped = !1, c.reverse) { var e = c.from; c.from = c.to, c.to = e, Gb(c) } }c.paused || !jd && (jd = !0), c._percentSet != null && (c._percentSet = null) } }) } function Eb(a, b) { if (a.started || (a.started = !0, a.onPlay && a.onPlay()), a.filter && (b = a.filter(b)), a.attr && a.source) { var c; (c = a.attr.match(/^S[:@](.*)/i)) ? a.source.setStyle(c[1], b) : (c = a.attr.match(/^C[:@](.*)/i)) ? a.source.setClient(c[1], b) : Ib.Util.setValue(a.source, a.attr, b) }a.onUpdate && a.onUpdate(b) } function Fb(a) { var b = a.type, c = a.from, d = a.to; b === 'number' ? (a.from = c || 0, a.to = d || 0) : b === 'point' ? (c ? c.length && (a.from = { x: c[0], y: c[1] }) : a.from = a.attr === 'scale' ? { x: 1, y: 1 } : { x: 0, y: 0 }, d ? d.length && (a.to = { x: d[0], y: d[1] }) : a.to = a.attr === 'scale' ? { x: 1, y: 1 } : { x: 0, y: 0 }) : b === 'rect' ? (c ? c.length && (a.from = { x: c[0], y: c[1], w: c[2], h: c[3] }) : a.from = { x: 0, y: 0, w: 0, h: 0 }, d ? d.length && (a.to = { x: d[0], y: d[1], w: d[2], h: d[3] }) : a.to = { x: 0, y: 0, w: 0, h: 0 }) : b === 'color' && (a.from = sd(c), a.to = sd(d)), a.current = a.from } function Gb(a) { var b = a.type, c = a.from, d = a.to; b === 'number' ? a.delta = d - c : b === 'point' ? a.delta = { x: d.x - c.x, y: d.y - c.y } : b === 'rect' ? a.delta = { x: d.x - c.x, y: d.y - c.y, w: d.w - c.w, h: d.h - c.h } : b === 'color' && (a.delta = { r: d.r - c.r, g: d.g - c.g, b: d.b - c.b, a: d.a - c.a }) } function Hb(a, b) { var c = a.type, d = a.delta, e = a.from, f = a.time, g = a.dur, h = kd[a.easing || 'easeNone']; return h || (h = kd.easeNone), c === 'number' ? b = h(f, e, d, g) : c === 'point' ? b = { x: h(f, e.x, d.x, g), y: h(f, e.y, d.y, g) } : c === 'rect' ? b = { x: h(f, e.x, d.x, g), y: h(f, e.y, d.y, g), w: h(f, e.w, d.w, g), h: h(f, e.h, d.h, g) } : c === 'color' ? b = 'rgba(' + Math.floor(h(f, e.r, d.r, g)) + ',' + Math.floor(h(f, e.g, d.g, g)) + ',' + Math.floor(h(f, e.b, d.b, g)) + ',' + Math.floor(h(f, e.a, d.a, g)) + ')' : c === 'set' ? a.time && (b = a.to) : c === 'group_set' && (b = a.to[a.groupIndex]), a.current = b, b } var Ib = {}; Ib._isInitializing = !1; var Jb = { isDeserializing: !1, isCalculatingBus: !1, images: {}, registerImage: function(a, b, c, d, e) { Jb.images[a] = new Ib.ImageAsset(a, b, c, d, e), yd(a) }, getRegisteredImageNames: function() { return Object.keys(Jb.images) }, unregisterImage: function(a) { delete Jb.images[a] }, getImageAsset: function(a) { if (typeof a === 'string') { var b = Jb.images[a]; return b } }, showVersion: function(a) { Jb.isCtrlDown(a) && a.shiftKey && a.keyCode == 76 && alert('TWaver HTML5 ' + Ib.Util.getVersion() + '\n' + Kb) }, callLater: function(a, b, c, d) { return setTimeout(function() { a.apply(b, c) }, d || Ed.CALL_LATER_DELAY) }, isEmptyObject: function(a) { for (var b in a) return !1; return !0 }, xml: function(b) { if (a.DOMParser) return (new DOMParser()).parseFromString(b, 'text/xml'); var c = new ActiveXObject('Microsoft.XmlDOM'); return c.async = !1, c.loadXml(b), c }, num: function(a) { return typeof a === 'number' && !isNaN(a) && isFinite(a) }, getter: function(a) { var b = a.charAt(0).toUpperCase() + a.slice(1), c = /ble$/.test(a) || /ed$/.test(a) ? 'is' : 'get'; return c + b }, setter: function(a) { var b = a.charAt(0).toUpperCase() + a.slice(1); return 'set' + b }, _id: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'], id: function() { for (var a = [], b = 0; b < 32; b++)a[b] = this._id[Math.floor(16 * Ib.Util.random())]; return a[12] = '4', a[16] = this._id[3 & a[16] | 8], a.join('') }, keys: function(a) { var b = new nd(); for (var c in a)b.add(c); return b }, es: ['toString', 'toLocaleString', 'valueOf'], ip: function(a, b) { var c = '_' + b; a[Jb.getter(b)] = function() { return this[c] }, a[Jb.setter(b)] = function(a) { var d = this[c]; this[c] = a, this.firePropertyChange(b, d, a) } }, validateLicense: function(a) { Kb = a, nc() }, ibool: function(a, b) { var c = '_' + b, d = b.charAt(0).toUpperCase() + b.slice(1); a['is' + d] = function() { return this[c] }, a[Jb.setter(b)] = function(a) { var d = this[c]; this[c] = a, this.firePropertyChange(b, d, a) } }, getValue: function(a, b, c) { var d = b.charAt(0).toUpperCase() + b.slice(1), e = 'get' + d, f = 'is' + d; return c ? c === 'boolean' ? a[f]() : a[e]() : a[e] ? a[e]() : a[f] ? a[f]() : a[b] }, setValue: function(a, b, c) { a['set' + b.charAt(0).toUpperCase() + b.slice(1)](c) }, clone: function(a) { if (!a) return null; var b = {}; for (var c in a)b[c] = a[c]; return b }, cloneRect: function(a) { return a ? { x: a.x, y: a.y, width: a.width, height: a.height } : null }, classCache: {}, getClass: function(b) { var c = Jb.classCache[b]; if (!c) { var d = b.split('.'), e = d.length; c = a; for (var f = 0; e > f; f++)c = c[d[f]], c || d[f] === 'twaver' && (c = Ib); Jb.classCache[b] = c } return c }, newInstance: function(b) { var c = Jb.getClass(b) || a[b]; if (!c) return null; var d = arguments.length, e = arguments; if (d === 1) return new c(); if (d === 2) return new c(e[1]); if (d === 3) return new c(e[1], e[2]); if (d === 4) return new c(e[1], e[2], e[3]); if (d === 5) return new c(e[1], e[2], e[3], e[4]); if (d === 6) return new c(e[1], e[2], e[3], e[4], e[5]); if (d === 7) return new c(e[1], e[2], e[3], e[4], e[5], e[6]); if (d === 8) return new c(e[1], e[2], e[3], e[4], e[5], e[6], e[7]); throw "don't support args more than 7" }, addMethod: function(a, b) { var c = a.prototype; for (var d in b)c[d] = b[d] }, ext: function(a, b, c) { var d; if (typeof a === 'string' && (d = a, a = Jb.getClass(a)), b) { var e = function() {}; e.prototype = b.prototype, a.prototype = new e(), a.prototype.constructor = a, a.superClass = b.prototype, b.prototype.constructor == Object.prototype.constructor && (b.prototype.constructor = b) } if (d && (a.prototype.getClassName = function() { return d }), c) { var f = a.prototype; for (var g in c)Rb.ext(g, f, c); for (var h = Jb.es.length, i = 0; h > i; i++)g = Jb.es[i], c.hasOwnProperty(g) && !c.propertyIsEnumerable(g) && (f[g] = c[g]) } }, setViewBounds: function(a, b) { if (a) if (a.adjustBounds)a.adjustBounds(b); else { var c = a.style; !c && a.getView() && (c = a.getView().style), c && (c.position = 'absolute', c.left = b.x + 'px', c.top = b.y + 'px', c.width = b.width + 'px', c.height = b.height + 'px') } }, getImageSrc: function(a) { var b = Jb.getImageAsset(a); return b ? b.getSrc() ? b.getSrc() : b.getImage().getAttribute('src') : a }, nextColorCount: 0, nextColor: function() { return Jb.nextColorCount >= Ed.COLORS.length && (Jb.nextColorCount = 0), Ed.COLORS[Jb.nextColorCount++] }, isCtrlDown: function(a) { return a.ctrlKey || a.metaKey }, isShiftDown: function(a) { return a.shiftKey }, isAltDown: function(a) { return a.altKey }, setText: function(a, b, c) { c ? Qb.isFirefox ? a.textContent = b : a.innerText = b : a.innerHTML = b }, fillDescendant: function(a, b) { b.add(a), a.hasChildren() && a.getChildren().forEach(function(a) { Jb.fillDescendant(a, b) }) } }, Kb = (Date, 'l=1.0\ntype=1\ngis=1\n3d=0\nstart=2015-10-21\nend=2016-10-31\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=2e5ea3fc421c82faefdd5adb7f4cc1292bb315bf7a6ae5f14eaf81bf518344eb30899e3f2e8d1905d281d303ccf9f944ed98ee268cb7052503c879d9bc2479b2285d51fca10e872a7971c3f17b8494b31ef2e7b0988f6ff5c57d5a869f3af37d994321a3dcad3eba0adc0d83c84f50e9d71022bafaffb04a645aa1de657bb8ba49ae0ecb2f9838aaa9d601cdcc49e3ed7770fa84e0cd341dfdad6895ed1535c920f96075a6df4b045500f7d9ea7dfd85ad6c7ef697818090543728102de1c1151a8def3f01b092df43ec585d98f98f26731caf61b294b80e8fb5723b52fbd1301b34036a1a6e2b42bb5a30fe4fc51f569f4544443dd6cbe6ee5983f96cc71038688b4e38630ea6b93e45f6316560da5f6cd77c425eb90b3efb31b2f2ff23856da7d44b52b24c91de9a45064acba360cb3eeb6174a9b1fc4482cf77985e49a336029c2ed2b70d4336b71afca09cb3a086859c708f42680d5431f8ad1230b93b6b343c6237337c62af3242da3cc635a0ca623f822f2a2044e9e6c4598b2761ecc44348e47ec8d989e74526cf7fc34fb229621d761f708a32387c8a4e3f4a1b049be86dd7546559b7bfaa4da0fcd7b6f414bbdbcf8a80b8ef0f7947ae150a0a5027fd33b79ab5f85bfb7760ea6fb79da60d1f12386826f363a6e8b63d0fb3f6319c2f74314fc75a2de2156052418c8581a3565f645ccdf2e0429a9f7e413cd917c1250483f72408d6ccfff0e418bd280696d34358d30236319fda6e1802ad00f015978f4a2db435feb68b8875f962fe9518de30fd841b9dd5f5c394cd5705268e7748f1874880ea25f05b667b3e390b251cd7a1ae9a2ed33963b6088cd771d7be3d1daacf4b6c2a1ba5f822d4319c652e9f29c01a9ef9f76f9811fe258daf3feb5e'); a.twaver = Ib, a._twaver = Jb, Ib.animate = {}, Ib.network = {}, Ib.network.interaction = {}, Ib.controls = {}, Ib.charts = {}, Ib.layout = {}; var Lb, Mb, Nb = a.navigator, Ob = a.document, Pb = a.Image; a.document || (Mb = !0, Lb = require('canvas'), Pb = Lb.Image, Nb = { userAgent: '' }, Ob = {}); var Qb = (function() { var a = {}, b = Nb.userAgent.toLowerCase(); return a.isOpera = /opera/.test(b), a.isIE = /msie/.test(b) || /trident/.test(b) || /edge/.test(b), a.isFirefox = /firefox/i.test(b), a.isChrome = /chrome/i.test(b), a.isSafari = !a.isChrome && /safari/i.test(b), a.isIPhone = /iphone/.test(b), a.isIPod = /ipod/.test(b), a.isIPad = /ipad/.test(b), a.isAndroid = /android/i.test(b), a.isWebOS = /webos/i.test(b), a.isMSTouchable = a.isIE && (Nb.msMaxTouchPoints && Nb.msMaxTouchPoints > 1 || Nb.maxTouchPoints && Nb.maxTouchPoints > 1), a.isTouchable = 'ontouchend' in Ob || a.isMSTouchable, a }()); Jb.ua = Qb; var Rb = { __accessor: function(a, b) { for (var c = b.__accessor, d = c.length, e = 0; d > e; e++)Jb.ip(a, c[e]) }, __bool: function(a, b) { for (var c = b.__bool, d = c.length, e = 0; d > e; e++)Jb.ibool(a, c[e]) }, __client: function(a, b) { a.getClient = function(a) { return this._clientMap[a] }, a.setClient = function(a, b) { var c = this._clientMap[a]; return b == null ? delete this._clientMap[a] : this._clientMap[a] = b, this.firePropertyChange('C:' + a, c, b) && this.onClientChanged(a, c, b), this }, a.getClientProperties = function() { return Jb.keys(this._clientMap) }, a.getClientMap = function() { return this._clientMap }, a.onClientChanged = function(a, b, c) {} }, __style: function(a, c) { a.getStyle = function(a, c) { var d = this._styleMap[a]; return c === b && (c = !0), d == null && c ? Ib.Styles.getStyle(a) : d }, a.setStyle = function(a, b) { var c = this._styleMap[a]; return b == null ? delete this._styleMap[a] : this._styleMap[a] = b, this.firePropertyChange('S:' + a, c, b) && this.onStyleChanged(a, c, b), this }, a.getStyleProperties = function() { return Jb.keys(this._styleMap) }, a.onStyleChanged = function(a, b, c) {} }, __new: function(a, b) {
    a.newInstance = function() {
      var a = Jb.getClass(this.getClassName()); if (!a) return null; var b = arguments.length, c = arguments; if (b === 0) return new a(); if (b === 1) return new a(c[0]); if (b === 2) return new a(c[0], c[1]); if (b === 3) return new a(c[0], c[1], c[2]); if (b === 4) return new a(c[0], c[1], c[2], c[3]); if (b === 5) return new a(c[0], c[1], c[2], c[3], c[4])

      if (b === 6) return new a(c[0], c[1], c[2], c[3], c[4], c[5]); if (b === 7) return new a(c[0], c[1], c[2], c[3], c[4], c[5], c[6]); throw "don't support args more than 7"
    }
  }, __property: function(a, b) { a.getValue = function(a, b) { return this._propertyType === 'accessor' ? Jb.getValue(a, this._propertyName) : this._propertyType === 'style' && a.getStyle ? a.getStyle(this._propertyName) : this._propertyType === 'client' && a.getClient ? a.getClient(this._propertyName) : this._propertyType === 'field' ? a[this._propertyName] : null }, a.setValue = function(a, b, c) { if (this._propertyType === 'accessor')a[Jb.setter(this._propertyName)](b); else { if (this._propertyType === 'style' && a.setStyle) return a.setStyle(this._propertyName, b); if (this._propertyType === 'client' && a.setClient) return a.setClient(this._propertyName, b); this._propertyType === 'field' && (a[this._propertyName] = b) } } }, map: { __accessor: 1, __bool: 1, __client: 1, __style: 1, __new: 1, __tree: 1, __property: 1 }, ext: function(a, b, c) { Rb.map[a] === 1 ? Rb[a](b, c) : b[a] = c[a] } }; Jb.extend = Rb; var Sb = Jb.Matrix = function(a, b, c, d, e, f) { this.setMatrix(a, b, c, d, e, f) }; Sb.identity = function() { return new Sb(1, 0, 0, 1, 0, 0) }, Sb.prototype.setMatrix = function(a, b, c, d, e, f) { this._m11 = a, this._m12 = b, this._m21 = c, this._m22 = d, this._offsetX = e, this._offsetY = f, this._type = 0, this._m21 != 0 || this._m12 != 0 ? this._type = 4 : ((this._m11 != 1 || this._m22 != 1) && (this._type = 2), (this._offsetX != 0 || this._offsetY != 0) && (this._type |= 1), (3 & this._type) == 0 && (this._type = 0)) }, Sb.prototype.transform = function() { var a; if (a = arguments.length === 2 ? { x: arguments[0], y: arguments[1] } : arguments[0], !a || !Jb.num(a.x) || !Jb.num(a.y)) throw 'arguments should contain x, y'; switch (this._type) { case 0:return { x: a.x, y: a.y }; case 1:return { x: this._offsetX + a.x, y: this._offsetY + a.y }; case 2:return { x: a.x * this._m11, y: a.y * this._m22 }; case 3:return { x: a.x * this._m11 + this._offsetX, y: a.y * this._m22 + this._offsetY } } return { x: this._m11 * a.x + a.y * this._m21 + this._offsetX, y: this._m22 * a.y + a.x * this._m12 + this._offsetY } }, Sb.prototype.translate = function(a, b) { this.multiply(new Sb(1, 0, 0, 1, a, b)) }, Sb.prototype.scale = function(a, b) { this.multiply(new Sb(a, 0, 0, b, 0, 0)) }, Sb.prototype.rotate = function(a, b, c) { a = a * Math.PI / 180; var d = Math.sin(a), e = Math.cos(a), f = b * (1 - e) + c * d, g = c * (1 - e) - b * d; this.multiply(new Sb(e, d, -d, e, f, g)) }, Sb.prototype.skew = function(a, b) { this.multiply(new Sb(1, Math.tan(b * Math.PI / 180), Math.tan(a * Math.PI / 180), 1, 0, 0)) }, Sb.prototype.multiply = function(a) { var b = this, c = a, d = b._type, e = c._type; if (e != 0) if (d == 0)b.setMatrix(c._m11, c._m12, c._m21, c._m22, c._offsetX, c._offsetY); else if (e == 1)b._offsetX += c._offsetX, b._offsetY += c._offsetY, d != 4 && (b._type |= 1); else if (d == 1) { var f = b._offsetX, g = b._offsetY; b.setMatrix(c._m11, c._m12, c._m21, c._m22, c._offsetX, c._offsetY), b._offsetX = f * c._m11 + g * c._m21 + c._offsetX, b._offsetY = f * c._m12 + g * c._m22 + c._offsetY, b._type = e == 4 ? 4 : 3 } else switch (d << 4 | e) { case 34:return b._m11 *= c._m11, void (b._m22 *= c._m22); case 35:return b._m11 *= c._m11, b._m22 *= c._m22, b._offsetX = c._offsetX, b._offsetY = c._offsetY, void (b._type = 3); case 36:case 52:case 66:case 67:case 68:return void b.setMatrix(b._m11 * c._m11 + b._m12 * c._m21, b._m11 * c._m12 + b._m12 * c._m22, b._m21 * c._m11 + b._m22 * c._m21, b._m21 * c._m12 + b._m22 * c._m22, b._offsetX * c._m11 + b._offsetY * c._m21 + c._offsetX, b._offsetX * c._m12 + b._offsetY * c._m22 + c._offsetY); case 50:return b._m11 *= c._m11, b._m22 *= c._m22, b._offsetX *= c._m11, void (b._offsetY *= c._m22); case 51:return b._m11 *= c._m11, b._m22 *= c._m22, b._offsetX = c._m11 * b._offsetX + c._offsetX, void (b._offsetY = c._m22 * b._offsetY + c._offsetY); default:console.log('Matrix multiply hit an invalid case: ' + combinedType) } }; var Tb = { getDistance: function(a, b) { var c = b.x - a.x, d = b.y - a.y; return Math.sqrt(c * c + d * d) }, getCenterPoint: function(a, b) { return a && b ? { x: (a.x + b.x) / 2, y: (a.y + b.y) / 2 } : b == null && a.width ? { x: a.x + a.width / 2, y: a.y + a.height / 2 } : void 0 }, isPointInPolygon: function(a, b) { a = a._as ? a._as : a; var c = 0, d = 0, e = !1, f = a.length; for (c = 0, d = f - 1; f > c; d = c++) { var g = a[c], h = a[d]; g.y > b.y != h.y > b.y && b.x < (h.x - g.x) * (b.y - g.y) / (h.y - g.y) + g.x && (e = !e) } return e }, unionRect: function(a, b) { if (a && !b) return Jb.cloneRect(a); if (!a && b) return Jb.cloneRect(b); if (a && b) { var c = {}; return c.x = Math.min(a.x, b.x), c.y = Math.min(a.y, b.y), c.width = Math.max(a.x + a.width, b.x + b.width) - c.x, c.height = Math.max(a.y + a.height, b.y + b.height) - c.y, c } return null }, intersects: function(a, b) { if (!a || !b) return !1; var c = b.width, d = b.height, e = a.width, f = a.height; if (e <= 0 || f <= 0 || c <= 0 || d <= 0) return !1; var g = b.x, h = b.y, i = a.x, j = a.y; return e += i, f += j, c += g, d += h, (i > e || e > g) && (j > f || f > h) && (g > c || c > i) && (h > d || d > j) }, intersection: function(a, b) { if (!a || !b) return !1; var c = b.x, d = b.y, e = a.x, f = a.y, g = c; g += b.width; var h = d; h += b.height; var i = e; i += a.width; var j = f; return j += a.height, e > c && (c = e), f > d && (d = f), g > i && (g = i), h > j && (h = j), g -= c, h -= d, g === 0 || h === 0 ? null : { x: c, y: d, width: g, height: h } }, contains: function(a, b) { var c = b.x, d = b.y, e = b.width, f = b.height, g = a.width, h = a.height; if ((g | h | e | f) < 0) return !1; var i = a.x, j = a.y; if (i > c || j > d) return !1; if (g += i, e += c, c >= e) { if (g >= i || e > g) return !1 } else if (g >= i && e > g) return !1; if (h += j, f += d, d >= f) { if (h >= j || f > h) return !1 } else if (h >= j && f > h) return !1; return !0 }, getLinePoints: function(a) { if (!a) return null; var b = new nd(); return a.forEach(function(a) { b.addAll(a) }), b }, getLineRect: function(a) { var b = Tb.getLinePoints(a); return Tb.getRect(b) }, getRect: function(a, b) { if (!a) return null; a._as && (a = a._as); var c = a.length; if (c <= 0) return null; var d = a[0]; b = b || { x: null, y: null, width: 0, height: 0 }; for (var e = 0; c > e; e++) if (d = a[e], d instanceof nd)Tb.getRect(d, b); else { b.x == null && (b.x = d.x, b.y = d.y); var f = Math.min(b.x, d.x), g = Math.min(b.y, d.y), h = Math.max(b.x + b.width, d.x), i = Math.max(b.y + b.height, d.y); b.x = f, b.y = g, b.width = h - f, b.height = i - g } return b }, addPadding: function(a, b, c, d) { d = d || -1; var e = b.getStyle(c) * d; e != 0 && Tb.grow(a, e, e), e = b.getStyle(c + '.left') * d, e != 0 && (a.x -= e, a.width += e), e = b.getStyle(c + '.right') * d, e != 0 && (a.width += e), e = b.getStyle(c + '.top') * d, e != 0 && (a.y -= e, a.height += e), e = b.getStyle(c + '.bottom') * d, e != 0 && (a.height += e), a.width < 0 && (a.width = -a.width, a.x -= a.width), a.height < 0 && (a.height = -a.height, a.y -= a.height) }, grow: function(a, b, c) { if (a == null) return null; c == null && (c = b); var d = a.width + b + b; if (!(d < 0)) { var e = a.height + c + c; if (!(e < 0)) return a.x -= b, a.y -= c, a.width = d, a.height = e, a } }, containsPoint: function(a, b, c) { return arguments.length < 3 && (c = b.y, b = b.x), !a || b < a.x || c < a.y || b > a.x + a.width || c > a.y + a.height ? !1 : !0 }, getHotSpot: function(a, b, c, d, e) { if (e === 'oval') { var f = 0.35; return { x: a + 0.5 * c + c * f, y: b + d / 2 - Math.sqrt(0.25 - f * f) * d } } if (e === 'circle') { var g = a + c / 2, h = b + d / 2, i = Math.min(c, d) / 2; a = g - i, b = h - i, c = 2 * i, d = 2 * i; var j = c / 2, k = d / 2, l = j * k / Math.sqrt(j * j + k * k); return { x: a + c / 2 + l, y: b + d / 2 - l } } var m = { x: a + c, y: b }; return c > 3 && (m.x -= 3), d > 3 && (m.y += 3), m }, getCircleRect: function(a) { var b = Math.min(a.width, a.height) / 2; return { x: a.x + a.width / 2 - b, y: a.y + a.height / 2 - b, width: 2 * b, height: 2 * b } }, getEllipsePoint: function(a, b) { if (!a || !b) return null; var c = a.x + a.width / 2, d = a.y + a.height / 2, e = b.x - c, f = b.y - d, g = a.width / 2, h = a.height / 2, i = Math.sqrt(1 / (1 / g / g + f * f / e / e / h / h)); e < 0 && (i = -i); var j; return j = e == 0 ? f > 0 ? h : -h : i * f / e, { x: c + i, y: d + j } }, createMatrix: function(a, b, c) { var d = Math.sin(a), e = Math.cos(a), f = b * (1 - e) + c * d, g = c * (1 - e) - b * d; return new Sb(e, d, -d, e, f, g) }, calculatePointInfoAlongLineBySegments: function(a, b, c, d, e) { return Tb.calculatePointInfoAlongLine(Tb.getPointObject(a, b), c, d, e) }, calculatePointInfoAlongLine: function(a, c, d, e) { if (c = c === b ? !0 : c, d = d || 0, e = e || 0, !a || a.size() < 2) throw 'must more than two points'; if (!c) { var f = Tb.reversePath(a); return Tb.calculatePointInfoAlongLine(f, !0, d, e) }a._as && (a = a._as); var g, h, i, j, k, l = 0, m = 0, n = a.length; for (j = 0; n > j; j++) if (k = a[j], j != 0) { if (d <= 0) { i = Tb.calculatePointInfoOnStraightLine(Tb._getPoint(h), Tb._getControlPoint(k), d, e), g = i; break } if (m = Tb._getLength(k, h), l + m > d) { i = Tb.getPathInfo(k, h, d - l, e, m), g = i; break }l += m, h = k } else h = k; if (g == null) { var o, p; h = a[n - 1], p = Tb._getPoint(h), h instanceof nd && (h = h._as), o = h instanceof Array ? Tb._getControlPoint(h) : Tb._getPoint(a[n - 2]); var q = Math.atan2(p.y - o.y, p.x - o.x); i = Tb.transformPoint(p, q, d - l, e), i.angle = q, g = i } return g }, reversePath: function(a) { var b, c = new nd(), d = null; a._as && (a = a._as); for (var e = a.length - 1; e >= 0; e--)b = a[e], c.add(Tb._getReversePath(b, d)), d = b; return c }, _getPoint: function(a) { return a._as && (a = a._as), a instanceof Array ? a[a.length - 1] : a }, _getControlPoint: function(a) { return a._as && (a = a._as), a instanceof Array ? a[a.length - 2] : a }, _getReversePath: function(a, b) { var c = Tb._getPoint(a); return b && b._as && (b = b._as), b != null && b instanceof Array ? new nd(b.length == 2 ? [b[0], c] : [b[1], b[0], c]) : c }, _getLength: function(a, b) { var c = Tb._getPoint(b), d = Tb._getPoint(a); if (a instanceof nd && (a = a._as), a instanceof Array) return Tb.calculateCurveLength(c, a, 1); var e = d.y - c.y, f = d.x - c.x; return Math.sqrt(f * f + e * e) }, getPathInfo: function(a, b, c, d, e) { var f, g = Tb._getPoint(b), h = Tb._getPoint(a); if (a instanceof nd && (a = a._as), a instanceof Array) { e < 0 && (e = Tb._getLength(a, b)); var i = c / e, j = Tb.calculatePointInfoOnCurveLine(g, a, i); g = j.point, f = j.angle, c = 0 } else f = Math.atan2(h.y - g.y, h.x - g.x); return Tb.transformPoint(g, f, c, d) }, transformPoint: function(a, b, c, d) { var e = { x: c, y: d }, f = Tb.createMatrix(b, 0, 0); return e = f.transform(e), e.x += a.x, e.y += a.y, { point: e, angle: b } }, calculatePointInfoOnStraightLine: function(a, b, c, d) { var e = Math.atan2(b.y - a.y, b.x - a.x); return Tb.transformPoint(a, e, c, d) }, calculatePointInfoOnCurveLine: function(a, b, c) { if (c < 0 || c > 1) throw 'Illegal arguments'; return b._as && (b = b._as), b.length == 2 ? Tb._calculatePointInfoOnCurveLine2(a, b[0], b[1], c) : Tb._calculatePointInfoOnCurveLine3(a, b[0], b[1], b[2], c) }, _calculatePointInfoOnCurveLine2: function(a, b, c, d) { var e = 2 * (a.x + c.x - 2 * b.x) * d + 2 * b.x - 2 * a.x, f = 2 * (a.y + c.y - 2 * b.y) * d + 2 * b.y - 2 * a.y, g = Math.atan2(f, e), h = (a.x + c.x - 2 * b.x) * d * d + (2 * b.x - 2 * a.x) * d + a.x, i = (a.y + c.y - 2 * b.y) * d * d + (2 * b.y - 2 * a.y) * d + a.y; return { point: { x: h, y: i }, angle: g } }, _calculatePointInfoOnCurveLine3: function(a, b, c, d, e) { var f, g, h; f = 1 - e, g = f * f * f, h = e * e * e; var i = g * a.x + 3 * e * f * f * b.x + 3 * e * e * f * c.x + h * d.x, j = g * a.y + 3 * e * f * f * b.y + 3 * e * e * f * c.y + h * d.y; return { point: { x: i, y: j }, angle: Math.atan2(Tb._bezeSpeedY(a, b, c, d, e), Tb._bezeSpeedX(a, b, c, d, e)) } }, calculateCurveLength: function(a, b, c) { return b._as && (b = b._as), b.length == 2 ? Tb._calculateCurveLength(a, b[0], b[1], c) : Tb._calculateBezierCurveLength(a, b[0], b[1], b[2], c) }, _calculateCurveLength: function(a, b, c, d) { if (d <= 0 || d > 1) return 0; var e = Math.floor(d * (Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y)) + Math.sqrt((c.x - b.x) * (c.x - b.x) + (c.y - b.y) * (c.y - b.y))) / 2), f = 0; e <= 0 && (e = 1); for (var g, h, i = d / e, j = 0, k = 0; e > k; k++)j = i * k, g = 2 * (a.x + c.x - 2 * b.x) * j + 2 * b.x - 2 * a.x, h = 2 * (a.y + c.y - 2 * b.y) * j + 2 * b.y - 2 * a.y, g *= i, h *= i, f += Math.sqrt(g * g + h * h); return f }, _calculateBezierCurveLength: function(a, b, c, d, e) { if (e <= 0 || e > 1) return 0; var f = 1e4, g = Math.floor(f * e); if ((1 & g) == 1 && g++, g == 0) return 0; var h, i = Math.floor(g / 2), j = 0, k = 0, l = e / g; for (h = 0; i > h; h++)j += Tb._bezeSpeed(a, b, c, d, (2 * h + 1) * l); for (h = 1; i > h; h++)k += Tb._bezeSpeed(a, b, c, d, 2 * h * l); return (Tb._bezeSpeed(a, b, c, d, 0) + Tb._bezeSpeed(a, b, c, d, 1) + 2 * k + 4 * j) * l / 3 }, _bezeSpeedX: function(a, b, c, d, e) { var f = 1 - e; return -3 * a.x * f * f + 3 * b.x * f * f - 6 * b.x * f * e + 6 * c.x * f * e - 3 * c.x * e * e + 3 * d.x * e * e }, _bezeSpeedY: function(a, b, c, d, e) { var f = 1 - e; return -3 * a.y * f * f + 3 * b.y * f * f - 6 * b.y * f * e + 6 * c.y * f * e - 3 * c.y * e * e + 3 * d.y * e * e }, _bezeSpeed: function(a, b, c, d, e) { var f = Tb._bezeSpeedX(a, b, c, d, e), g = Tb._bezeSpeedY(a, b, c, d, e); return Math.sqrt(f * f + g * g) }, getPointObject: function(a, b) { if (b && b.size() != 0) { var c = new nd(); b = b._as, a = a._as; var d, e, f = 0, g = b.length, h = a.length; for (d = 0; g > d && (e = b[d], f != h); d++)e === 'cubicto' ? h - 2 > f && c.add([a[f++], a[f++], a[f++]]) : e === 'quadto' ? h - 1 > f && c.add([a[f++], a[f++]]) : h > f && c.add(a[f++]); for (;h > f; f++)c.add(a[f]); return c } return a }, calculateLineLength: function(a, b) { if (!a || a.size() < 2) return 0; if (b) return Tb.calculateLineLength(Tb.getPointObject(a, b)); a = a._as; var c, d, e, f, g, h, i, j = a.length, k = 0; for (c = 0; j > c; c++)f = a[c], c != 0 ? (e = f, e instanceof nd && (e = e._as), e instanceof Array ? (g = Tb.calculateCurveLength(d, e, 1), d = e[e.length - 1]) : (i = f.y - d.y, h = f.x - d.x, g = Math.sqrt(h * h + i * i), d = e), k += g) : d = f; return k }, toDegrees: function(a) { return 180 * a / Math.PI }, toRadians: function(a) { return a / 180 * Math.PI }, getRadiansBetweenLines: function(a, b) { return Math.atan2(b.y - a.y, b.x - a.x) }, getAngle: function(a, b) { return a.x === b.x ? b.y === a.y ? 0 : b.y > a.y ? Math.PI / 2 : -Math.PI / 2 : Math.atan((b.y - a.y) / (b.x - a.x)) } }; Jb.math = Tb; var Ub = { getPoints: function(a) { var b = new nd(); return a.forEach(function(a) { b.add({ x: a.x, y: a.y }), b.add({ x: a.x + a.width, y: a.y + a.height }), b.add({ x: a.x + a.width, y: a.y }), b.add({ x: a.x, y: a.y + a.height }) }), b }, rectangle: function(a) { var b; return a.forEach(function(a) { b = Tb.unionRect(b, a) }), b }, oval: function(a) { var b = Ub.rectangle(a), c = 0, d = b.height / b.width, e = d * d, f = b.x + b.width / 2, g = b.y + b.height / 2, h = Ub.getPoints(a); h.forEach(function(a) { var b = a.x - f, d = a.y - g, h = b * b + d * d / e; h > c && (c = h) }), c = Math.sqrt(c); var i = d * c; return { x: f - c, y: g - i, width: 2 * c, height: 2 * i } }, circle: function(a) { var b = Ub.rectangle(a), c = 0, d = b.x + b.width / 2, e = b.y + b.height / 2, f = Ub.getPoints(a); return f.forEach(function(a) { var b = a.x - d, f = a.y - e, g = b * b + f * f; g > c && (c = g) }), c = Math.sqrt(c), { x: d - c, y: e - c, width: 2 * c, height: 2 * c } }, roundrect: function(a) { var b = Ub.rectangle(a), c = Math.min(b.width, b.height) / 16; return Tb.grow(b, c, c), b }, star: function(a) { var b = Ub.rectangle(a); return Tb.grow(b, b.width, b.height), b }, triangle: function(a) { var b = Ub.rectangle(a); return b.x -= b.width / 2, b.width *= 2, b.y -= b.height, b.height *= 2, b }, hexagon: function(a) { var b = Ub.rectangle(a); return b.x -= b.width / 2, b.width *= 2, b }, pentagon: function(a) { var b = Ub.rectangle(a); return b.x -= b.width / 6, b.width += b.width / 3, b.y -= b.height / 4, b.height += b.height / 4, b }, diamond: function(a) { var b = Ub.rectangle(a); return b.x -= b.width / 2, b.width += b.width, b.y -= b.height / 2, b.height += b.height, b }, trapezoidal: function(a) { var b = Ub.rectangle(a); return b.x -= b.width / 2, b.width += b.width, b.y -= b.height / 2, b.height += b.height, b } }; Jb.group = Ub; var Vb = { 'topleft.topleft': function(a, b) { return { x: a.x - b.width, y: a.y - b.height } }, 'topleft.topright': function(a, b) { return { x: a.x, y: a.y - b.height } }, 'top.top': function(a, b) { return { x: a.x + a.width / 2 - b.width / 2, y: a.y - b.height } }, 'topright.topleft': function(a, b) { return { x: a.x + a.width - b.width, y: a.y - b.height } }, 'topright.topright': function(a, b) { return { x: a.x + a.width, y: a.y - b.height } }, topleft: function(a, b) { return { x: a.x - b.width / 2, y: a.y - b.height / 2 } }, top: function(a, b) { return { x: a.x - b.width / 2 + a.width / 2, y: a.y - b.height / 2 } }, topright: function(a, b) { return { x: a.x - b.width / 2 + a.width, y: a.y - b.height / 2 } }, 'topleft.bottomleft': function(a, b) { return { x: a.x - b.width, y: a.y } }, 'topleft.bottomright': function(a, b) { return { x: a.x, y: a.y } }, 'top.bottom': function(a, b) { return { x: a.x + a.width / 2 - b.width / 2, y: a.y } }, 'topright.bottomleft': function(a, b) { return { x: a.x - b.width + a.width, y: a.y } }, 'topright.bottomright': function(a, b) { return { x: a.x + a.width, y: a.y } }, 'left.left': function(a, b) { return { x: a.x - b.width, y: a.y + a.height / 2 - b.height / 2 } }, left: function(a, b) { return { x: a.x - b.width / 2, y: a.y + a.height / 2 - b.height / 2 } }, 'left.right': function(a, b) { return { x: a.x, y: a.y + a.height / 2 - b.height / 2 } }, center: function(a, b) { return { x: a.x + a.width / 2 - b.width / 2, y: a.y + a.height / 2 - b.height / 2 } }, 'right.left': function(a, b) { return { x: a.x + a.width - b.width, y: a.y + a.height / 2 - b.height / 2 } }, right: function(a, b) { return { x: a.x + a.width - b.width / 2, y: a.y + a.height / 2 - b.height / 2 } }, 'right.right': function(a, b) { return { x: a.x + a.width, y: a.y + a.height / 2 - b.height / 2 } }, 'bottomleft.topleft': function(a, b) { return { x: a.x - b.width, y: a.y + a.height - b.height } }, 'bottomleft.topright': function(a, b) { return { x: a.x, y: a.y + a.height - b.height } }, 'bottom.top': function(a, b) { return { x: a.x + a.width / 2 - b.width / 2, y: a.y + a.height - b.height } }, 'bottomright.topleft': function(a, b) { return { x: a.x + a.width - b.width, y: a.y + a.height - b.height } }, 'bottomright.topright': function(a, b) { return { x: a.x + a.width, y: a.y + a.height - b.height } }, bottomleft: function(a, b) { return { x: a.x - b.width / 2, y: a.y + a.height - b.height / 2 } }, bottom: function(a, b) { return { x: a.x + a.width / 2 - b.width / 2, y: a.y + a.height - b.height / 2 } }, bottomright: function(a, b) { return { x: a.x + a.width - b.width / 2, y: a.y + a.height - b.height / 2 } }, 'bottomleft.bottomleft': function(a, b) { return { x: a.x - b.width, y: a.y + a.height } }, 'bottomleft.bottomright': function(a, b) { return { x: a.x, y: a.y + a.height } }, 'bottom.bottom': function(a, b) { return { x: a.x + a.width / 2 - b.width / 2, y: a.y + a.height } }, 'bottomright.bottomleft': function(a, b) { return { x: a.x + a.width - b.width, y: a.y + a.height } }, 'bottomright.bottomright': function(a, b) { return { x: a.x + a.width, y: a.y + a.height } }, get: function(a, b, c) { if (!b) throw 'refRect can not be null'; c || (c = { width: 0, height: 0 }); var d = Vb[a]; if (d) return d(b, c); throw "Can not resolve '" + a + "' position" } }; Jb.position = Vb; var Wb = { preventDefault: function(a) { Ed.KEEP_DEFAULT_FUNCTION(a) || (a.preventDefault ? a.preventDefault() : a.preventManipulation ? a.preventManipulation() : a.returnValue = !1) }, insertAfter: function(a, b) { return b ? b.parentNode.insertBefore(a, b.nextSibling) : a.parentNode.insertBefore(a, a.parentNode.firstChild), a }, forEach: function(a, b, c) { if (Wb.isVisible(a)) { for (var d = a.childNodes.length, e = 0; d > e; e++)Wb.forEach(a.childNodes[e], b, c); c ? b.call(c, a) : b(a) } }, setVisible: function(a, b) { a.style.display = b ? 'block' : 'none' }, isVisible: function(a) { return 'style' in a && a.style.display !== 'none' }, release: function(a) { for (var b = a.childNodes.length, c = 0; b > c; c++)Wb.release(a.childNodes[c]); b > 0 && Wb.clear(a), a._pool && a._pool.release(a) }, clear: function(a) { for (;a.firstChild;)a.removeChild(a.firstChild) }, setZoom: function(a, b) { var c = a.style; if (c.setProperty) if (Qb.isFirefox)c.setProperty('-moz-transform', 'scale(' + b + ')', null), c.setProperty('-moz-transform-origin', '0 0', null); else if (Qb.isOpera)c.setProperty('-o-transform', 'scale(' + b + ')', null), c.setProperty('-o-transform-origin', '0 0', null); else if (Qb.isChrome || Qb.isSafari) { c.setProperty('-webkit-transform', 'scale(' + b + ')', null), c.setProperty('-webkit-transform-origin', '0 0', null); var d = null; a._webkitInvaildateDiv ? d = a._webkitInvaildateDiv : (d = Ob.createElement('div'), a._webkitInvaildateDiv = d), d.parentNode && d.parentNode == a ? a.removeChild(d) : a.appendChild(d) } else Qb.isIE ? (c.setProperty('-ms-transform', 'scale(' + b + ')', null), c.setProperty('-ms-transform-origin', '0 0', null)) : (c.setProperty('transform', 'scale(' + b + ')', null), c.setProperty('transform-origin', '0 0', null)) }, setRotate: function(a, b) { var c = a.style; if (c.setProperty) if (Qb.isFirefox)c.setProperty('-moz-transform', 'scale(' + b + ')', null), c.setProperty('-moz-transform-origin', '0 0', null); else if (Qb.isOpera)c.setProperty('-o-transform', 'scale(' + b + ')', null), c.setProperty('-o-transform-origin', '0 0', null); else if (Qb.isChrome || Qb.isSafari) { c.setProperty('-webkit-transform', 'scale(' + b + ')', null), c.setProperty('-webkit-transform-origin', '0 0', null); var d = null; a._webkitInvaildateDiv ? d = a._webkitInvaildateDiv : (d = Ob.createElement('div'), a._webkitInvaildateDiv = d), d.parentNode && d.parentNode == a ? a.removeChild(d) : a.appendChild(d) } else Qb.isIE ? (c.setProperty('-ms-transform', 'scale(' + b + ')', null), c.setProperty('-ms-transform-origin', '0 0', null)) : (c.setProperty('transform', 'scale(' + b + ')', null), c.setProperty('transform-origin', '0 0', null)) }, setCSSStyle: function(a, b, c) { a.style.setProperty(b, c, null) }, removeCSSStyle: function(a, b) { a.style.removeProperty(b) }, getCSSStyle: function(a, b) { return a.style.getPropertyValue(b) }, setBorderRaidus: function(a, b) { Qb.isFirefox ? a.style.MozBorderRadius = b : a.style.borderRadius = b }, createSelect: function(a, b) { var c, d, e, f = Ob.createElement('select'); if (Array.isArray(a)) for (c = 0; c < a.length; c++)d = a[c], e = Ob.createElement('option'), e.innerHTML = d, e.setAttribute('value', d), d === b && e.setAttribute('selected', 'true'), f.appendChild(e); else for (c = 0; c < a.values.length; c++)d = a.values[c], e = Ob.createElement('option'), e.innerHTML = a.map[d], e.setAttribute('value', d), d === b && e.setAttribute('selected', 'true'), f.appendChild(e); return f }, createImg: function(a) { var b = Ob.createElement('img'); return b.style.position = 'absolute', typeof a === 'string' && b.setAttribute('src', a), b }, createView: function(a, b) { var c = Ob.createElement('div'); return c.style.position = Ed.VIEW_POSITION, c.style.fontSize = Ed.VIEW_FONT_SIZE, c.style.fontFamily = Ed.VIEW_FONT_FAMILY, c.style.cursor = 'default', c.style.outline = 'none', c.style.textAlign = 'left', c.style.msTouchAction = 'none', c.style.touchAction = 'none', c.tabIndex = 0, b || (c.onmousedown = Wb.preventDefault), c.style.setProperty && (c.style.setProperty('-khtml-user-select', 'none', null), c.style.setProperty('-webkit-user-select', 'none', null), c.style.setProperty('-moz-user-select', 'none', null), c.style.setProperty('-webkit-tap-highlight-color', 'rgba(0, 0, 0, 0)', null)), a && (c.style.overflow = a), c }, createDiv: function() { var a = Ob.createElement('div'); return a.style.position = 'absolute', a.style.msTouchAction = 'none', a.style.touchAction = 'none', a }, createCanvas: function(a, b) { if (a = a || 0, b = b || 0, Mb) { var c = require('canvas'); return new c(a, b) } var d = Ob.createElement('canvas'); return d.style.position = 'absolute', d.style.msTouchAction = 'none', d.style.touchAction = 'none', d.width = a, d.height = b, d }, setCanvas: function(a, b, c, d, e) { arguments.length === 2 && (c = b.y, d = b.width, e = b.height, b = b.x), a.style.left = b + 'px', a.style.top = c + 'px', a.setAttribute('width', d), a.setAttribute('height', e), a._viewRect = { x: b, y: c, width: d, height: e }; var f = a.getContext('2d'); return f.shadowBlur !== 0 && (f.shadowOffsetX = 0, f.shadowOffsetY = 0, f.shadowBlur = 0, f.shadowColor = 'rgba(0,0,0,0.0)'), f.clearRect(0, 0, d, e), f.translate(-b, -c), f }, setImg: function(a, b, c) { a.setAttribute('src', b), a.style.left = c.x + 'px', a.style.top = c.y + 'px', a.style.width = c.width + 'px', a.style.height = c.height + 'px', a._viewRect = Jb.clone(c) }, setDiv: function(a, b, c, d, e) { d = Jb.num(d) ? d : 0, a.style.left = b.x - d + 'px', a.style.top = b.y - d + 'px', a.style.width = b.width + 'px', a.style.height = b.height + 'px', a._viewRect = Jb.clone(b), a.style.backgroundColor = c || '', a.style.border = d > 0 ? d + 'px ' + e + ' solid' : '' }, changeTypeForMS: function(b) { var c = b; if (b.indexOf('MSPointer') === 0 || b.indexOf('pointer') === 0) { var d; b.indexOf('MSPointer') === 0 ? (d = b.substring(9, 10).toLowerCase(), d += b.substring(10)) : d = b.substring(7, 8), a.MSPointerEvent ? c = 'MSPointer' + d.substring(0, 1).toUpperCase() + d.substring(1) : a.PointerEvent && (c = 'pointer' + d) } return c }, addEventListener: function(a, b, c, d) { a = this.changeTypeForMS(a); var e = '_' + a + '_'; if (!d[e]) { var f = function(a) { f.instance[f.method](a) }; f.method = b, f.instance = d, d[e] = f, c.addEventListener(a, f, !1) } }, removeEventListener: function(a, b, c) { a = this.changeTypeForMS(a); var d = '_' + a + '_', e = c[d]; e && (b.removeEventListener(a, e, !1), delete c[d]) }, isValidEvent: function(a, b) { if (!b) return !1; if (b.target === a) if (Qb.isFirefox) { if (a.clientHeight < a.scrollHeight && b.layerX < 25) return !1; if (a.clientWidth < a.scrollWidth && b.layerY < 25) return !1 } else if (b.offsetX > a.clientWidth || b.offsetY > a.clientHeight) return !1; return !0 }, getLogicalPoint: function(a, b, c, d) { c = c || 1; var e, f = a.getBoundingClientRect(); if (Qb.isTouchable && b.changedTouches && b.changedTouches.length > 0) { var g = b.changedTouches[0], h = Qb.isAndroid ? 0 : zc.scrollLeft(), i = Qb.isAndroid ? 0 : zc.scrollTop(); e = { x: (g.clientX + a.scrollLeft - f.left - h) / c, y: (g.clientY + a.scrollTop - f.top - i) / c } } else { if (!Wb.isValidEvent(a, b)) return null; e = { x: (b.clientX - f.left + a.scrollLeft) / c, y: (b.clientY - f.top + a.scrollTop) / c } } return e }, handle_mousedown: function(b, c) { Wb.target && Wb.handle_mouseup(c), a.addEventListener('mousemove', Wb.handle_mousemove, !1), a.addEventListener('mouseup', Wb.handle_mouseup, !1), Wb.target = b }, handle_mousemove: function(a) { Wb.target.handle_mousemove && Wb.target.handle_mousemove(a), Wb.target.handleMouseMove && Wb.target.handleMouseMove(a) }, handle_mouseup: function(b) { Wb.target.handle_mouseup && Wb.target.handle_mouseup(b), Wb.target.handleMouseUp && Wb.target.handleMouseUp(b), a.removeEventListener('mousemove', Wb.handle_mousemove, !1), a.removeEventListener('mouseup', Wb.handle_mouseup, !1), delete Wb.target }, getClientPoint: function(a) { return { x: a.clientX, y: a.clientY } }, windowWidth: function() { return typeof a.innerWidth === 'number' ? a.innerWidth : Ob.documentElement && Ob.documentElement.clientWidth ? Ob.documentElement.clientWidth : Ob.body && Ob.body.clientWidth ? Ob.body.clientWidth : 0 }, windowHeight: function() { return typeof a.innerHeight === 'number' ? a.innerHeight : Ob.documentElement && Ob.documentElement.clientHeight ? Ob.documentElement.clientHeight : Ob.body && Ob.body.clientHeight ? Ob.body.clientHeight : 0 } }; Jb.html = Wb; var Xb = { cache: {}, g: Wb.createCanvas().getContext('2d'), getTextSize: function(a, b) { Xb.g.font = a || Ed.FONT; var c = Xb.cache[Xb.g.font]; c || (c = 2 * Xb.g.measureText('e').width + 4, Xb.cache[Xb.g.font] = c), b = b || '', b = String(b); for (var d, e = b.split('\n'), f = e.length, g = 0, h = f - 1; h >= 0; h--)d = Xb.g.measureText(e[h]).width, d > g && (g = d); return { width: g + 4, height: c * f } }, getSubStringInLength: function(a, b, c) { var d = this, e = function(a, b, c, f, g) { if (a >= b) return f.substring(0, a + 1); var h = Math.floor((a + b) / 2), i = f.substring(0, h + 1), j = d.getTextSize(c, i).width; if (j > g) return e(a, h - 1, c, f, g); var k = h + 1, l = f.substring(0, k + 1), m = d.getTextSize(c, l).width; return m > g ? i : e(k, b, c, f, g) }, f = this.getTextSize(a, b).width; return f > c ? e(0, b.length - 1, a, b, c) : b }, getCollapseTextInLength: function(a, b, c) { var d = this.getTextSize(a, b).width; if (d > c) { for (var e = 0, f = '', g = b, h = d; h > c;) { var i = this.getSubStringInLength(a, g, c); f = f + i + '\n', e += i.length, g = b.substring(e), h = this.getTextSize(a, g).width } return f + g } return b }, drawText: function(a, c, d, e, f, g) { c = c || '', c = String(c), e || (e = Ed.FONT); var h = 'center'; g && (h = g), a.font = e, a.fillStyle = f, a.textAlign = h, a.textBaseline = 'middle'; var i, j, k = c.split('\n'), l = k.length, m = 0; d ? d.width === b ? (i = d.x, j = d.y) : (m = d.height / l, h == 'left' ? i = d.x : h == 'center' && (i = d.x + d.width / 2), j = d.y + m / 2) : (i = 0, j = 0), Qb.isOpera && (j -= 2); for (var n = 0; l > n; n++)h == 'right' && (a.textAlign = 'left', i = d.x + d.width - Xb.getTextSize(e, k[n]).width), a.fillText(k[n], i, j), j += m }, drawArc: function(a, b, c, d, e, f, g, h) { var i, j, k, l, m, n, o, p, q, r, s; if (Math.abs(e) > 2 * Math.PI && (e = 2 * Math.PI), m = Math.ceil(Math.abs(e) / (Math.PI / 4)), i = e / m, j = -i, k = -d, m > 0) { n = b + Math.cos(d) * f, o = c + Math.sin(-d) * g, h ? a.lineTo(n, o) : a.moveTo(n, o); for (var t = 0; m > t; t++)k += j, l = k - j / 2, p = b + Math.cos(k) * f, q = c + Math.sin(k) * g, r = b + Math.cos(l) * (f / Math.cos(j / 2)), s = c + Math.sin(l) * (g / Math.cos(j / 2)), a.quadraticCurveTo(r, s, p, q) } }, dashedLine: function(a, b, c, d, e, f, g) { var h = f - d, i = g - e, j = Math.sqrt(h * h + i * i); if (j != 0) { h /= j, i /= j; for (var k = j, l = -c.offset, m = c.drawing, n = c.patternIndex; k > l;)l += b[n], l >= k && (c.offset = b[n] - (l - k), c.patternIndex = n, c.drawing = m, l = k), m ? a.lineTo(d + l * h, e + l * i) : a.moveTo(d + l * h, e + l * i), m = !m, n = (n + 1) % b.length } }, drawLinePoints: function(a, b, c, d, e) { var f, g, h, i, j, k, l = 0, m = 0, n = b.size(); if (k = c && c.length > 0 ? new uc(a, c[0], c.length > 1 ? c[1] : c[0]) : a, d) for (m = 0, j = d.size(); j > m; m++) if (f = d.get(m), f === 'moveto' && n > l)g = b.get(l++), k.moveTo(g.x, g.y); else if (f === 'lineto' && n > l)g = b.get(l++), k.lineTo(g.x, g.y); else if (f === 'cubicto' && n - 2 > l)g = b.get(l++), h = b.get(l++), i = b.get(l++), k.bezierCurveTo(g.x, g.y, h.x, h.y, i.x, i.y); else { if (!(f === 'quadto' && n - 1 > l)) throw "Can not resolve segment '" + f + "'"; g = b.get(l++), h = b.get(l++), k.quadraticCurveTo(g.x, g.y, h.x, h.y) } else this._drawLine(b, k); e && k.closePath() }, _drawLine: function(a, b) { var c, d, e, f, g, h = 0, i = a.size(); for (c = a.get(0), b.moveTo(c.x, c.y), h = 1; i > h; h++)g = a.get(h), g.size ? (f = g.size(), f === 2 ? (c = g.get(0), d = g.get(1), b.quadraticCurveTo(c.x, c.y, d.x, d.y)) : f === 3 && (c = g.get(0), d = g.get(1), e = g.get(2), b.bezierCurveTo(c.x, c.y, d.x, d.y, e.x, e.y))) : b.lineTo(g.x, g.y) }, drawRoundRect: function(a, b, c, d, e, f, g, h, i) { arguments.length === 6 && (g = f, h = f, i = f); var j = b + d, k = c + e, l = e > d ? 2 * d : 2 * e; f = l > f ? f : l, g = l > g ? g : l, h = l > h ? h : l, i = l > i ? i : l; var m = 0.292893218813453 * i, n = 0.585786437626905 * i; a.moveTo(j, k - i), a.quadraticCurveTo(j, k - n, j - m, k - m), a.quadraticCurveTo(j - n, k, j - i, k), m = 0.292893218813453 * h, n = 0.585786437626905 * h, a.lineTo(b + h, k), a.quadraticCurveTo(b + n, k, b + m, k - m), a.quadraticCurveTo(b, k - n, b, k - h), m = 0.292893218813453 * f, n = 0.585786437626905 * f, a.lineTo(b, c + f), a.quadraticCurveTo(b, c + n, b + m, c + m), a.quadraticCurveTo(b + n, c, b + f, c), m = 0.292893218813453 * g, n = 0.585786437626905 * g, a.lineTo(j - g, c), a.quadraticCurveTo(j - n, c, j - m, c + m), a.quadraticCurveTo(j, c + n, j, c + g), a.lineTo(j, k - i) }, drawVector: function(a, b, c, d, e, f, g) { var h; arguments.length === 4 ? (e = d.y, f = d.width, g = d.height, d = d.x) : arguments.length === 5 && b === 'roundrect' && (h = {}, h.topLeft = e, h.topRight = e, h.bottomLeft = e, h.bottomRight = e, e = d.y, f = d.width, g = d.height, d = d.x); var i = Xb['_' + b]; i && (a.beginPath(), c && c.length > 0 && (a = new uc(a, c[0], c.length > 1 ? c[1] : c[0])), arguments.length === 5 && b === 'roundrect' ? i(a, { x: d, y: e, width: f, height: g }, h) : i(a, d, e, f, g)) }, _rectangle: function(a, b, c, d, e) { a.rect(b, c, d, e) }, _circle: function(a, b, c, d, e) { var f = b + d / 2, g = c + e / 2, h = Math.min(d, e) / 2; a instanceof uc ? Xb.drawArc(a, f, g, 0, 2 * Math.PI, h, h, !1) : a.arc(f, g, h, 0, 2 * Math.PI, !0) }, _oval: function(a, b, c, d, e) { if (a instanceof uc)Xb.drawArc(a, b + d / 2, c + e / 2, 0, 2 * Math.PI, d / 2, e / 2, !1); else { var f = 0.5522848, g = d / 2 * f, h = e / 2 * f, i = b + d, j = c + e, k = b + d / 2, l = c + e / 2; a.moveTo(b, l), a.bezierCurveTo(b, l - h, k - g, c, k, c), a.bezierCurveTo(k + g, c, i, l - h, i, l), a.bezierCurveTo(i, l + h, k + g, j, k, j), a.bezierCurveTo(k - g, j, b, l + h, b, l) } }, _roundrect: function(a, b, c, d, e) { if (arguments.length === 3) { var f = c; c = b.y, d = b.width, e = b.height, b = b.x, f.topLeft ? Xb.drawRoundRect(a, b, c, d, e, f.topLeft) : Xb.drawRoundRect(a, b, c, d, e, Math.min(Math.min(d, e) / 4, 10)) } else Xb.drawRoundRect(a, b, c, d, e, Math.min(Math.min(d, e) / 4, 10)) }, _star: function(a, b, c, d, e) { var f = 2 * d, g = 2 * e, h = b + d / 2, i = c + e / 2; a.moveTo(h - f / 4, i - g / 12), a.lineTo(b + 0.306 * d, c + 0.579 * e), a.lineTo(h - f / 6, i + g / 4), a.lineTo(b + d / 2, c + 0.733 * e), a.lineTo(h + f / 6, i + g / 4), a.lineTo(b + 0.693 * d, c + 0.579 * e), a.lineTo(h + f / 4, i - g / 12), a.lineTo(b + 0.611 * d, c + 0.332 * e), a.lineTo(h + 0, i - g / 4), a.lineTo(b + 0.388 * d, c + 0.332 * e), a.closePath() }, _triangle: function(a, b, c, d, e) { a.moveTo(b + d / 2, c), a.lineTo(b + d, c + e), a.lineTo(b, c + e), a.closePath() }, _hexagon: function(a, b, c, d, e) { a.moveTo(b, c + e / 2), a.lineTo(b + d / 4, c + e), a.lineTo(b + 3 * d / 4, +c + e), a.lineTo(b + d, c + e / 2), a.lineTo(b + 3 * d / 4, c), a.lineTo(b + d / 4, c), a.closePath() }, _pentagon: function(a, b, c, d, e) { var f = 2 * d, g = 2 * e, h = b + d / 2, i = c + e / 2; a.moveTo(h - f / 4, i - g / 12), a.lineTo(h - f / 6, i + g / 4), a.lineTo(h + f / 6, i + g / 4), a.lineTo(h + f / 4, i - g / 12), a.lineTo(h + 0, i - g / 4), a.closePath() }, _trapezoidal: function(a, b, c, d, e) { a.moveTo(b + d / 4, c), a.lineTo(b, c + e), a.lineTo(b + d, c + e), a.lineTo(b + 3 * d / 4, c), a.closePath() }, _diamond: function(a, b, c, d, e) { a.moveTo(b + d / 2, c), a.lineTo(b, c + e / 2), a.lineTo(b + d / 2, c + e), a.lineTo(b + d, c + e / 2), a.closePath() }, fill: function(a, b, c, d, e, f, g, h) { var i = Yb[c]; a.fillStyle = i ? arguments.length === 5 ? i(a, b, d, e.x, e.y, e.width, e.height) : i(a, b, d, e, f, g, h) : b }, createRadialGradient: function(a, b, c, d, e, f, g, h, i) { var j = a.createRadialGradient(d + f * h, e + g * i, Math.min(f, g) / 24, d + f / 2, e + g / 2, Math.max(f, g) / 2); return j.addColorStop(0, c), j.addColorStop(1, b), j }, drawPath: function(a, b, c, d, e, f, g, h) { var i = a._element, j = a.getBodyRect(); d && Tb.addPadding(j, i, c + '.padding', 1); var k = Jb.clone(j), l = i.getStyle(c + '.outline.width'); l > 0 && Tb.grow(k, l / 2, l / 2); var m = a.setShadow(a, b, k); i.getAngle() != 0 && (i instanceof Nd || (j = i.getOriginalRect()), Ib.Util.rotateCanvas(m, j, i.getAngle())); var n, o = i.getStyle(c + '.fill'); if (o) { n = a._innerColor && !vc.hasDefault(a._element) ? a._innerColor : i.getStyle(c + '.fill.color'); var p = i.getStyle(c + '.gradient'); p ? Xb.fill(m, n, p, i.getStyle(c + '.gradient.color'), j) : m.fillStyle = n } var q = i.getStyle(c + '.shape'), r = i.getStyle('group.shape.roundrect.radius'); return o && (m.beginPath(), f ? Xb.drawLinePoints(m, f, null, g, h) : q === 'roundrect' && c === 'group' ? Xb.drawVector(m, q, null, j, r) : Xb.drawVector(m, q, null, j), m.fill()), l > 0 && (m.lineWidth = l, m.lineCap = i.getStyle(c + '.cap'), m.lineJoin = i.getStyle(c + '.join'), m.strokeStyle = i.getStyle(c + '.outline.color'), m.beginPath(), f ? Xb.drawLinePoints(m, f, e, g, h) : q === 'roundrect' && c === 'group' ? Xb.drawVector(m, q, e, j, r) : Xb.drawVector(m, q, e, j), m.stroke()), k }, draw3DRect: function(a, b, c, d, e, f, g) { if (c !== 0) { arguments.length <= 4 && (g = d.height, f = d.width, e = d.y, d = d.x); var h = c > 0; c = Math.abs(c); var i, j; if (a.lineWidth = 1, a.lineCap = 'square', c === 1)i = Xb.brighter(b), j = Xb.darker(b), a.strokeStyle = h ? i : j, a.beginPath(), a.moveTo(d, e), a.lineTo(d, e + g), a.moveTo(d, e), a.lineTo(d + f, e), a.closePath(), a.stroke(), a.strokeStyle = h ? j : i, a.beginPath(), a.moveTo(d, e + g), a.lineTo(d + f, e + g), a.moveTo(d + f, e), a.lineTo(d + f, e + g), a.closePath(), a.stroke(); else for (var k = 2 * c, l = 50 / k, m = 0; k > m; m++)i = Xb.brighter(b, 50 - m * l), j = Xb.darker(b, 50 - m * l), d += 0.5, e += 0.5, f -= 1, g -= 1, a.strokeStyle = h ? i : j, a.beginPath(), a.moveTo(d, e), a.lineTo(d, e + g), a.moveTo(d, e), a.lineTo(d + f, e), a.closePath(), a.stroke(), a.strokeStyle = h ? j : i, a.beginPath(), a.moveTo(d, e + g), a.lineTo(d + f, e + g), a.moveTo(d + f, e), a.lineTo(d + f, e + g), a.closePath(), a.stroke() } }, brighter: function(a, b) { return b || (b = 50), Xb.adjustBrightness2(a, b) }, darker: function(a, b) { return b || (b = 50), Xb.adjustBrightness2(a, -b) }, adjustBrightness2: function(a, b) { var c, d, e; if (b === 0) return a; var f = sd(a); return b < 0 ? (b = (100 + b) / 100, c = Math.ceil(f.r * b), d = Math.ceil(f.g * b), e = Math.ceil(f.b * b)) : (b /= 100, c = f.r, d = f.g, e = f.b, c += (255 - c) * b, d += (255 - d) * b, e += (255 - e) * b, c = Math.min(Math.ceil(c), 255), d = Math.min(Math.ceil(d), 255), e = Math.min(Math.ceil(e), 255)), 'rgba(' + c + ',' + d + ',' + e + ',1)' }, getColorArray: function(a) { return rd.clearRect(0, 0, 1, 1), rd.fillStyle = a, rd.fillRect(0, 0, 1, 1), rd.getImageData(0, 0, 1, 1).data }, hit: function(a, b, c, d) {
    if (!a) return !1; var e = a._viewRect; if (!e) return !1; if (b -= e.x, c -= e.y, b < 0 || c < 0 || b >= e.width || c >= e.height) return !1; try { for (var f = a.getContext('2d').getImageData(b, c, 1, 1), g = f.data, h = 0, i = g.length; i > h; h += 4) if (g[h + 3] !== 0) return !0 } catch (j) { return !0 } return !1
  }, intersects: function(a, b) { if (!a) return !1; if (b = Tb.intersection(b, a._viewRect), !b) return !1; b.x -= a._viewRect.x, b.y -= a._viewRect.y; try { for (var c = a.getContext('2d').getImageData(b.x, b.y, b.width, b.height), d = c.data, e = 0, f = d.length; f > e; e += 4) if (d[e + 3] !== 0) return !0 } catch (g) {} return !1 }, strokeRect: function(a, b, c, d) { b && (a.beginPath(), a.strokeStyle = c || Ib.Util.randomColor(), a.lineWidth = d || 2, a.strokeRect(b.x, b.y, b.width, b.height), a.stroke()) } }; Jb.g = Xb; var Yb = { 'linear.southwest': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e + g, d + f, e); return h.addColorStop(0, c), h.addColorStop(1, b), h }, 'linear.southeast': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d + f, e + g, d, e); return h.addColorStop(0, c), h.addColorStop(1, b), h }, 'linear.northwest': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d + f, e + g, d, e); return h.addColorStop(0, b), h.addColorStop(1, c), h }, 'linear.northeast': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d + f, e, d, e + g); return h.addColorStop(0, c), h.addColorStop(1, b), h }, 'linear.north': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e, d, e + g); return h.addColorStop(0, c), h.addColorStop(1, b), h }, 'linear.south': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e, d, e + g); return h.addColorStop(0, b), h.addColorStop(1, c), h }, 'linear.west': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e, d + f, e); return h.addColorStop(0, c), h.addColorStop(1, b), h }, 'linear.east': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e, d + f, e); return h.addColorStop(0, b), h.addColorStop(1, c), h }, 'radial.center': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.5, 0.5) }, 'radial.southwest': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.25, 0.75) }, 'radial.southeast': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.75, 0.75) }, 'radial.northwest': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.25, 0.25) }, 'radial.northeast': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.75, 0.25) }, 'radial.north': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.5, 0.25) }, 'radial.south': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.5, 0.75) }, 'radial.west': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.25, 0.5) }, 'radial.east': function(a, b, c, d, e, f, g) { return Xb.createRadialGradient(a, b, c, d, e, f, g, 0.75, 0.5) }, 'spread.horizontal': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e, d + f, e); return h.addColorStop(0, b), h.addColorStop(0.5, c), h.addColorStop(1, b), h }, 'spread.vertical': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e, d, e + g); return h.addColorStop(0, b), h.addColorStop(0.5, c), h.addColorStop(1, b), h }, 'spread.diagonal': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d + f, e, d, e + g); return h.addColorStop(0, b), h.addColorStop(0.5, c), h.addColorStop(1, b), h }, 'spread.antidiagonal': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e, d + f, e + g); return h.addColorStop(0, b), h.addColorStop(0.5, c), h.addColorStop(1, b), h }, 'spread.north': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e - g / 4, d, e + g + g / 4); return h.addColorStop(0, b), h.addColorStop(1 / 3, c), h.addColorStop(2 / 3, b), h.addColorStop(1, c), h }, 'spread.south': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d, e - g / 4, d, e + g + g / 4); return h.addColorStop(0, c), h.addColorStop(1 / 3, b), h.addColorStop(2 / 3, c), h.addColorStop(1, b), h }, 'spread.west': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d - f / 4, e, d + f + f / 4, e); return h.addColorStop(0, b), h.addColorStop(1 / 3, c), h.addColorStop(2 / 3, b), h.addColorStop(1, c), h }, 'spread.east': function(a, b, c, d, e, f, g) { var h = a.createLinearGradient(d - f / 4, e, d + f + f / 4, e); return h.addColorStop(0, c), h.addColorStop(1 / 3, b), h.addColorStop(2 / 3, c), h.addColorStop(1, b), h } }; Ib.Util = { getVersion: function() { return '5.4.6' }, registerImage: function(a, b, c, d, e) { Jb.registerImage(a, b, c, d, e) }, registerImageByUrl: function(a, b, c, d) { var e = new Pb(); e.src = a, e.onload = function() { Ib.Util.registerImage(b, e, e.width, e.height), e.onload = null, c && c.invalidateElementUIs(), d && d() } }, getRegisteredImageNames: function() { return Jb.getRegisteredImageNames() }, unregisterImage: function(a) { Jb.unregisterImage(a) }, getImageAsset: function(a) { return Jb.getImageAsset(a) }, validateLicense: function(a) { Jb.validateLicense(a) }, getLicense: function() { return Kb }, isPermissionGIS: function() { return tc() }, moveElements: function(a, b, c, d, e) { if ((b !== 0 || c !== 0) && a && !a.isEmpty()) { var f, g, h = Ib.animate.AnimateManager; h.endAnimate(), a = vc.filterMovingElements(a), d && (f = new nd(), g = new nd()), a.forEach(function(a) { a instanceof Ld && (d ? (f.add(a), g.add({ x: a.getX() + b, y: a.getY() + c })) : a.translate(b, c)) }), d ? h.start(new Ib.animate.AnimateLocation(f, g, e)) : e && e() } }, isTypeOf: function(a, b) { if (a === b) return !0; for (var c = a.superClass; c;) { if (c === b.prototype) return !0; c = c.constructor.superClass } return !1 }, setFocus: function(a) { if (Ob.activeElement !== a) { var b, c, d, e = Ob.documentElement, f = Ob.body; e && (Qb.isIE || Qb.isOpera || e.scrollLeft || e.scrollTop) ? (b = e.scrollLeft, c = e.scrollTop, d = e) : f && (b = f.scrollLeft, c = f.scrollTop, d = f), a.focus(), d && (d.scrollLeft = b, d.scrollTop = c) } }, isOpera: Qb.isOpera, isIE: Qb.isIE, isFirefox: Qb.isFirefox, isChrome: Qb.isChrome, isSafari: Qb.isSafari, isIPhone: Qb.isIPhone, isIPod: Qb.isIPod, isIPad: Qb.isIPad, isAndroid: Qb.isAndroid, isWebOS: Qb.isWebOS, isTouchable: Qb.isTouchable, ext: function(a, b, c) { Jb.ext(a, b, c) }, getValue: function(a, b, c) { return Jb.getValue(a, b, c) }, setValue: function(a, b, c) { Jb.setValue(a, b, c) }, grow: function(a, b, c) { Tb.grow(a, b, c) }, containsPoint: function(a, b, c) { return Tb.containsPoint.apply(null, arguments) }, intersects: function(a, b) { return Tb.intersects(a, b) }, getRect: function(a) { return Tb.getRect(a) }, unionRect: function(a, b) { return Tb.unionRect(a, b) }, createDiv: function() { return Wb.createDiv() }, createCanvas: function() { return Wb.createCanvas() }, setCanvas: function(a, b, c, d, e) { return Wb.setCanvas.apply(null, arguments) }, drawVector: function(a, b, c, d, e, f, g) { Xb.drawVector.apply(null, arguments) }, fill: function(a, b, c, d, e, f, g, h) { Xb.fill.apply(null, arguments) }, getClass: function(a) { return Jb.getClass(a) }, getAllClassNames: function() { var a, b = []; for (a in Jb.classCache)b.push(a); return b }, newInstance: function(a) { return Jb.newInstance.apply(null, arguments) }, isDeserializing: function() { return Jb.isDeserializing }, addEventListener: function(a, b, c, d) { Wb.addEventListener(a, b, c, d) }, removeEventListener: function(a, b, c) { Wb.removeEventListener(a, b, c) }, drawArrow: function(a, b, c, d, e, f, g, h, i, j, k, l) { od.drawArrow.apply(null, arguments) }, calculatePointAngleAlongLine: function(a, b, c, d, e) { return Tb.calculatePointInfoAlongLineBySegments(a, b, c, d, e) }, getSubNetwork: function(a) { return vc.getSubNetwork(a) }, transformPoint: function(a, b, c, d) { return Tb.transformPoint(a, b, c, d) }, getToolTipDiv: function() { return Bc.getToolTipDiv() }, showToolTip: function(a, b) { Bc.showToolTip(a, b) }, hideToolTip: function() { Bc.hideToolTip() }, resetToolTip: function() { Bc.resetToolTip() }, setCSSStyle: function(a, b, c) { Wb.setCSSStyle(a, b, c) }, removeCSSStyle: function(a, b) { Wb.removeCSSStyle(a, b) }, getCSSStyle: function(a, b) { return Wb.getCSSStyle(a, b) }, toDegrees: function(a) { return Tb.toDegrees(a) }, toRadians: function(a) { return Tb.toDegrees(a) }, getRadiansBetweenLines: function(a, b) { return Tb.getRadiansBetweenLines(a, b) }, getElementsBounds: function(a, b) { var c = null; return a.forEach(function(a) { if (a.getRect) { var d, e; b && (e = b.getElementUI(a), e && (d = e.getViewRect())), d || (d = a.getRect()), c = c ? Ib.Util.unionRect(c, d) : d } }), c }, getPointIndex: function(a, b, c) { if (c || (c = 10), a) for (var d = a.size(); d--; d >= 0) if (Tb.getDistance(a.get(d), b) <= c) return d; return -1 }, registerVectorShape: function(a, b) { Jb.g['_' + a] = b }, rotateCanvas: function(a, b, c) { a.translate(b.x + b.width / 2, b.y + b.height / 2), a.rotate(c * Math.PI / 180), a.translate(-(b.x + b.width / 2), -(b.y + b.height / 2)) }, registerShape: function(a, b) { fd(a, b) }, registerDraw: function(a, b) { ed(a, b) }, getFilterColor: function(a, b) { return td(a, b) }, registerGifImage: function(a, b) {}, parseVectorData: function(a) { return Ec(a) }, getSharedLinks: function(a, b) { var c = a.getLinks(), d = b.getLinks(); if (c && c.size() != 0 && d && d.size() != 0) { var e = c.size() > d.size() ? c : d; return e.toList(function(c) { return c.getFromNode() == a && c.getToNode() == b || c.getFromNode() == b && c.getToNode() == a }) } return null }, isSharedLinks: function(a, b) { var c = !1, d = a.getLinks(), e = b.getLinks(); if (d && d.size() != 0 && e && e.size() != 0) { var f = d.size() > e.size() ? d : e; f.forEach(function(d) { return d.getFromNode() == a && d.getToNode() == b || d.getFromNode() == b && d.getToNode() == a ? (c = !0, !1) : !0 }) } return c }, playAnimate: function(a) { return yb(a) }, pauseAnimate: function(a) { a.pause() }, resumeAnimate: function(a) { a.resume() }, stopAnimate: function(a, b) { zb(a, b) }, pauseAllAnimates: function() { Bb() }, resumeAllAnimates: function() { Cb() }, stopAllAnimates: function(a) { Ab(a) }, randomColor: function() { return '#' + ('00000' + (16777216 * this.random() << 0).toString(16)).substr(-6) }, random: function() { return Math.random() }, getHSVColor: function(a, c, d) { var e, f, g, h, i, j, k, l; switch (a && c === b && d === b && (c = a.s, d = a.v, a = a.h), h = Math.floor(6 * a), i = 6 * a - h, j = d * (1 - c), k = d * (1 - i * c), l = d * (1 - (1 - i) * c), h % 6) { case 0:e = d, f = l, g = j; break; case 1:e = k, f = d, g = j; break; case 2:e = j, f = d, g = l; break; case 3:e = j, f = k, g = d; break; case 4:e = l, f = j, g = d; break; case 5:e = d, f = j, g = k } var m = '#' + toHex(255 * e) + toHex(255 * f) + toHex(255 * g); return m }, toHex: function(a) { var b = parseInt(a).toString(16); return b.length == 1 && (b = '0' + b), b }, makeHighRes: function(b) { var c = b.getContext('2d'), d = a.devicePixelRatio || 1, e = c.webkitBackingStorePixelRatio || c.mozBackingStorePixelRatio || c.msBackingStorePixelRatio || c.oBackingStorePixelRatio || c.backingStorePixelRatio || 1, f = d / e; if (d !== e) { var g = b.width, h = b.height; b.width = Math.round(g * f), b.height = Math.round(h * f), b.style.width = g + 'px', b.style.height = h + 'px', c.scale(f, f) } }, newFunction: function() { var a = arguments, b = a.length; return b === 1 ? Jb.newInstance('Function', a[0]) : b === 2 ? Jb.newInstance('Function', a[0], a[1]) : b === 3 ? Jb.newInstance('Function', a[0], a[1], a[2]) : b === 4 ? Jb.newInstance('Function', a[0], a[1], a[2], a[3]) : b === 5 ? Jb.newInstance('Function', a[0], a[1], a[2], a[3], a[4]) : b === 6 ? Jb.newInstance('Function', a[0], a[1], a[2], a[3], a[4], a[5]) : b === 7 ? Jb.newInstance('Function', a[0], a[1], a[2], a[3], a[4], a[5], a[6]) : b === 8 ? Jb.newInstance('Function', a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7]) : null } }, Jb.ext('twaver.Util', Object, {}); var Zb, $b = 0xdeadbeefcafe, _b = (16777215 & $b) == 15715070; _b && Nb.appName == 'Microsoft Internet Explorer' ? (c.prototype.am = f, Zb = 30) : _b && Nb.appName != 'Netscape' ? (c.prototype.am = e, Zb = 26) : (c.prototype.am = g, Zb = 28), c.prototype.DB = Zb, c.prototype.DM = (1 << Zb) - 1, c.prototype.DV = 1 << Zb; var ac = 52; c.prototype.FV = Math.pow(2, ac), c.prototype.F1 = ac - Zb, c.prototype.F2 = 2 * Zb - ac; var bc, cc, dc = '0123456789abcdefghijklmnopqrstuvwxyz', ec = new Array(); for (bc = '0'.charCodeAt(0), cc = 0; cc <= 9; ++cc)ec[bc++] = cc; for (bc = 'a'.charCodeAt(0), cc = 10; cc < 36; ++cc)ec[bc++] = cc; for (bc = 'A'.charCodeAt(0), cc = 10; cc < 36; ++cc)ec[bc++] = cc; E.prototype.convert = F, E.prototype.revert = G, E.prototype.reduce = H, E.prototype.mulTo = I, E.prototype.sqrTo = J, L.prototype.convert = M, L.prototype.revert = N, L.prototype.reduce = O, L.prototype.mulTo = Q, L.prototype.sqrTo = P, c.prototype.copyTo = k, c.prototype.fromInt = l, c.prototype.fromString = n, c.prototype.clamp = o, c.prototype.dlShiftTo = v, c.prototype.drShiftTo = w, c.prototype.lShiftTo = x, c.prototype.rShiftTo = y, c.prototype.subTo = z, c.prototype.multiplyTo = A, c.prototype.squareTo = B, c.prototype.divRemTo = C, c.prototype.invDigit = K, c.prototype.isEven = R, c.prototype.exp = S, c.prototype.toString = p, c.prototype.negate = q, c.prototype.abs = r, c.prototype.compareTo = s, c.prototype.bitLength = u, c.prototype.mod = D, c.prototype.modPowInt = T, c.ZERO = m(0), c.ONE = m(1), Ka.prototype.convert = La, Ka.prototype.revert = La, Ka.prototype.mulTo = Ma, Ka.prototype.sqrTo = Na, Ra.prototype.convert = Sa, Ra.prototype.revert = Ta, Ra.prototype.reduce = Ua, Ra.prototype.mulTo = Wa, Ra.prototype.sqrTo = Va; var fc = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 541, 547, 557, 563, 569, 571, 577, 587, 593, 599, 601, 607, 613, 617, 619, 631, 641, 643, 647, 653, 659, 661, 673, 677, 683, 691, 701, 709, 719, 727, 733, 739, 743, 751, 757, 761, 769, 773, 787, 797, 809, 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 877, 881, 883, 887, 907, 911, 919, 929, 937, 941, 947, 953, 967, 971, 977, 983, 991, 997], gc = (1 << 26) / fc[fc.length - 1]; c.prototype.chunkSize = Y, c.prototype.toRadix = $, c.prototype.fromRadix = _, c.prototype.fromNumber = aa, c.prototype.bitwiseTo = fa, c.prototype.changeBit = wa, c.prototype.addTo = Aa, c.prototype.dMultiply = Ia, c.prototype.dAddOffset = Ja, c.prototype.multiplyLowerTo = Pa, c.prototype.multiplyUpperTo = Qa, c.prototype.modInt = Za, c.prototype.millerRabin = ab, c.prototype.clone = U, c.prototype.intValue = V, c.prototype.byteValue = W, c.prototype.shortValue = X, c.prototype.signum = Z, c.prototype.toByteArray = ba, c.prototype.equals = ca, c.prototype.min = da, c.prototype.max = ea, c.prototype.and = ha, c.prototype.or = ja, c.prototype.xor = la, c.prototype.andNot = na, c.prototype.not = oa, c.prototype.shiftLeft = pa, c.prototype.shiftRight = qa, c.prototype.getLowestSetBit = sa, c.prototype.bitCount = ua, c.prototype.testBit = va, c.prototype.setBit = xa, c.prototype.clearBit = ya, c.prototype.flipBit = za, c.prototype.add = Ba, c.prototype.subtract = Ca, c.prototype.multiply = Da, c.prototype.divide = Fa, c.prototype.remainder = Ga, c.prototype.divideAndRemainder = Ha, c.prototype.modPow = Xa, c.prototype.modInverse = $a, c.prototype.pow = Oa, c.prototype.gcd = Ya, c.prototype.isProbablePrime = _a, c.prototype.square = Ea, bb.prototype.init = cb, bb.prototype.next = db; var hc, ic, jc, kc = 256; if (ic == null) { ic = new Array(), jc = 0; var lc; if (Nb.appName == 'Netscape' && Nb.appVersion < '5' && a.crypto) { var mc = a.crypto.random(32); for (lc = 0; lc < mc.length; ++lc)ic[jc++] = 255 & mc.charCodeAt(lc) } for (;kc > jc;)lc = Math.floor(65536 * Ib.Util.random()), ic[jc++] = lc >>> 8, ic[jc++] = 255 & lc; jc = 0, gb() }jb.prototype.nextBytes = ib; mb.prototype.doPublic = ob, mb.prototype.setPublic = nb, mb.prototype.encrypt = pb, mb.prototype.doPrivate = tb, mb.prototype.setPrivate = rb, mb.prototype.setPrivateEx = sb, mb.prototype.decrypt = ub; var nc = function() { oc.v(Kb) }, oc = {}, pc = '6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319', qc = '10001'; oc.cross = function(a) { if (a) { for (var b = '', c = 0; c < a.length;)c + 1 < a.length ? (b += a[c + 1], b += a[c]) : b += a[c], c += 2; return b } return null }, oc.reverse = function(a) { if (a) { for (var b = '', c = a.length; c > 0; c--)b += a[c - 1]; return b } return null }, oc.v = function(a) { if (a) { var b = oc; if (b.start = null, b.beginDate = null, b.end = null, b.endDate = null, b.gis = null, b['3D'] = null, b['3d'] = null, b.l = null, b.__li__ = null, a.indexOf('signature=') > 0) { var c = a.split('signature='), d = c[0], e = c[1], f = new mb(); f.setPublic(pc, qc); for (var g = e, h = g.length, i = 256, j = 0, k = '', l = ''; h > j;)k = g.substr(j, i), l += f.decrypt(k), j += i; if (l === d) return b.i(a), !0 } } return !1 }, oc.i = function(a) { var c = oc; c.__li__ = a; var d, e, f, g, h, i = a.split('\n'); for (d = i.length - 1; d >= 0; d--)e = i[d], h = e.split('='), f = h[0], g = h[1], c[f] = g; c.start != b && (c.beginDate = new Date(Date.parse(c.start.replace(/-/g, '/')))), c.end != b && (c.endDate = new Date(Date.parse(c.end.replace(/-/g, '/')))); var j = c.gis; j != b && (j = parseInt(j)), j && (c._isPermissionGIS = !0); var k = c['3D'] || c['3d']; k != b && (k = parseInt(k)), k && (c._isPermission3D = !0), c['3D'] && (c._isPermission3D = !0), c.l != b && (c.version = c.l) }; var rc = function(a) { return a.__li__ !== b && !a._isPermission3D }, sc = function(a) { if (!rc(a)) return !0; var b = new Date(); return a.beginDate != null && a.beginDate.getTime() - b.getTime() >= 0 || a.endDate != null && a.endDate.getTime() - b.getTime() <= 0 }, tc = function() { return sc(oc) ? !1 : oc._isPermissionGIS }; oc.$z = function(a) { var b = new mb(); b.setPublic(pc, qc); for (var c = a, d = c.length, e = 256, f = 0, g = '', h = ''; d > f;)g = c.substr(f, e), h += b.decrypt(g), f += e; return h }, oc.twm = function(a) { var c = oc, d = c.$z('4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e'), e = this.type, f = this.markText, g = c.$z('648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341'); if (a[g] = c.__li__, e !== '3' || sc(oc) || f !== b) { a.__liLabel == b && (a.__liLabel = Ob.createElement('div')), c.startDate === b && (c.startDate = new Date()); var h = (new Date()).getTime() - c.startDate.getTime(); if (!(h < 3e5)) { var i = sc(c) && h > 3e5, j = f; if (i ? j = c.$z('0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73') : e != '2' || j !== b && j != '' ? e != '1' || f || (j = d) : j = c.$z('644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc'), j !== b) { var k = a, l = k.__liLabel; if (l.innerHTML = j, k._rootCanvas)l.type = e, l.mark = f, l.expired = i, k._xyz = l; else { var m = 0, n = 0; l.style.position = 'absolute'; var o = k.getView().style; f != b && f != null && f != '' || e == '2' ? (m = 10 - k.getView().scrollLeft, n = 10 - k.getView().scrollTop) : (m = o.width.replace('px', '') / 2 - 50 - k.getView().scrollLeft, n = o.height.replace('px', '') / 2 - k.getView().scrollTop), l.style.right = m + 'px', l.style.bottom = n + 'px', l.style.fontSize = '120%', i && (k.getView().style.opacity = 0.1, l.style.color = 'red', l.style.fontSize = '150%'), k.getView().appendChild(l) } } } } }, Jb.validateLicense(Kb); var uc = function(a, b, c) { this.g = a, this.onLength = b, this.offLength = c, this.isLine = !0, this.overflow = 0, this.dashLength = b + c, this.pen = { x: 0, y: 0 } }; Jb.ext(uc, Object, { _curveaccuracy: 6, moveTo: function(a, b) { this.pen = { x: a, y: b }, this.g.moveTo(a, b), this.start || (this.start = { x: a, y: b }) }, lineTo: function(a, b) { var c = a - this.pen.x, d = b - this.pen.y, e = Math.atan2(d, c), f = Math.cos(e), g = Math.sin(e), h = this.lineLength(this.pen.x, this.pen.y, a, b); if (this.overflow) { if (this.overflow > h) return this.isLine ? this._lineTo(a, b) : this.moveTo(a, b), void (this.overflow -= h); if (this.isLine ? this._lineTo(this.pen.x + f * this.overflow, this.pen.y + g * this.overflow) : this.moveTo(this.pen.x + f * this.overflow, this.pen.y + g * this.overflow), h -= this.overflow, this.overflow = 0, this.isLine = !this.isLine, !h) return } var i = Math.floor(h / this.dashLength); if (i) { for (var j = f * this.onLength, k = g * this.onLength, l = f * this.offLength, m = g * this.offLength, n = 0; i > n; n++) this.isLine ? (this._lineTo(this.pen.x + j, this.pen.y + k), this.moveTo(this.pen.x + l, this.pen.y + m)) : (this.moveTo(this.pen.x + l, this.pen.y + m), this._lineTo(this.pen.x + j, this.pen.y + k)); h -= this.dashLength * i } this.isLine ? h > this.onLength ? (this._lineTo(this.pen.x + f * this.onLength, this.pen.y + g * this.onLength), this.moveTo(a, b), this.overflow = this.offLength - (h - this.onLength), this.isLine = !1) : (this._lineTo(a, b), h == this.onLength ? (this.overflow = 0, this.isLine = !this.isLine) : (this.overflow = this.onLength - h, this.moveTo(a, b))) : h > this.offLength ? (this.moveTo(this.pen.x + f * this.offLength, this.pen.y + g * this.offLength), this._lineTo(a, b), this.overflow = this.onLength - (h - this.offLength), this.isLine = !0) : (this.moveTo(a, b), h == this.offLength ? (this.overflow = 0, this.isLine = !this.isLine) : this.overflow = this.offLength - h) }, quadraticCurveTo: function(a, b, c, d) { var e, f = this.pen.x, g = this.pen.y, h = this.curveLength(f, g, a, b, c, d), i = 0, j = 0; if (this.overflow) { if (this.overflow > h) return this.isLine ? this._curveTo(a, b, c, d) : this.moveTo(c, d), void (this.overflow -= h); if (i = this.overflow / h, e = this.curveSliceUpTo(f, g, a, b, c, d, i), this.isLine ? this._curveTo(e[2], e[3], e[4], e[5]) : this.moveTo(e[4], e[5]), this.overflow = 0, this.isLine = !this.isLine, !h) return } var k = h - h * i, l = Math.floor(k / this.dashLength), m = this.onLength / h, n = this.offLength / h; if (l) for (var o = 0; l > o; o++) this.isLine ? (j = i + m, e = this.curveSlice(f, g, a, b, c, d, i, j), this._curveTo(e[2], e[3], e[4], e[5]), i = j, j = i + n, e = this.curveSlice(f, g, a, b, c, d, i, j), this.moveTo(e[4], e[5])) : (j = i + n, e = this.curveSlice(f, g, a, b, c, d, i, j), this.moveTo(e[4], e[5]), i = j, j = i + m, e = this.curveSlice(f, g, a, b, c, d, i, j), this._curveTo(e[2], e[3], e[4], e[5])), i = j; k = h - h * i, this.isLine ? k > this.onLength ? (j = i + m, e = this.curveSlice(f, g, a, b, c, d, i, j), this._curveTo(e[2], e[3], e[4], e[5]), this.moveTo(c, d), this.overflow = this.offLength - (k - this.onLength), this.isLine = !1) : (e = this.curveSliceFrom(f, g, a, b, c, d, i), this._curveTo(e[2], e[3], e[4], e[5]), h == this.onLength ? (this.overflow = 0, this.isLine = !this.isLine) : (this.overflow = this.onLength - k, this.moveTo(c, d))) : k > this.offLength ? (j = i + n, e = this.curveSlice(f, g, a, b, c, d, i, j), this.moveTo(e[4], e[5]), e = this.curveSliceFrom(f, g, a, b, c, d, j), this._curveTo(e[2], e[3], e[4], e[5]), this.overflow = this.onLength - (k - this.offLength), this.isLine = !0) : (this.moveTo(c, d), k == this.offLength ? (this.overflow = 0, this.isLine = !this.isLine) : this.overflow = this.offLength - k) }, bezierCurveTo: function(a, b, c, d, e, f) { this.pen = { x: e, y: f }; var g = [this.onLength, this.offLength]; this.g.setLineDash && this.g.setLineDash(g), this.g.lineDash = g, this.g.bezierCurveTo(a, b, c, d, e, f) }, rect: function(a, b, c, d) { this.pen = { x: a, y: b }, this.moveTo(a, b), this.lineTo(a, b + d), this.lineTo(a + c, b + d), this.lineTo(a + c, b), this.lineTo(a, b) }, closePath: function() { this.lineTo(this.start.x, this.start.y) }, lineLength: function(a, b, c, d) { var e = c - a, f = d - b; return Math.sqrt(e * e + f * f) }, curveLength: function(a, b, c, d, e, f, g) { for (var h, i, j, k, l, m, n, o = 0, p = a, q = b, r = g > 0 ? g : this._curveaccuracy, s = 1; r >= s; s++)j = s / r, k = 1 - j, l = k * k, m = 2 * j * k, n = j * j, h = l * a + m * c + n * e, i = l * b + m * d + n * f, o += this.lineLength(p, q, h, i), p = h, q = i; return o }, curveSlice: function(a, b, c, d, e, f, g, h) { if (g == 0) return this.curveSliceUpTo(a, b, c, d, e, f, h); if (h == 1) return this.curveSliceFrom(a, b, c, d, e, f, g); var i = this.curveSliceUpTo(a, b, c, d, e, f, h); return i.push(g / h), this.curveSliceFrom.apply(this, i) }, curveSliceUpTo: function(a, b, c, d, e, f, g) { if (g != 1) { var h = c + (e - c) * g, i = d + (f - d) * g; c = a + (c - a) * g, d = b + (d - b) * g, e = c + (h - c) * g, f = d + (i - d) * g } return [a, b, c, d, e, f] }, curveSliceFrom: function(a, b, c, d, e, f, g) { if (g != 1) { var h = a + (c - a) * g, i = b + (d - b) * g; c += (e - c) * g, d += (f - d) * g, a = h + (c - h) * g, b = i + (d - i) * g } return [a, b, c, d, e, f] }, _lineTo: function(a, b) { (a != this.pen.x || b != this.pen.y) && (this.pen = { x: a, y: b }, this.g.lineTo(a, b)) }, _curveTo: function(a, b, c, d) { (a != c || b != d || c != this.pen.x || d != this.pen.y) && (this.pen = { x: c, y: d }, this.g.quadraticCurveTo(a, b, c, d)) } }), Jb.DashedLine = uc; var vc = { DEFAULTS: { 'default': 1, 'default.vector': 1, 'vector.default': 1 }, VECTORS: { vector: 1, 'default.vector': 1, 'vector.default': 1 }, hasDefault: function(a) { if (a instanceof Ld) { var b = a.getStyle('body.type'); return vc.DEFAULTS[b] === 1 } return !0 }, hasVector: function(a) { if (a instanceof Ld) { var b = a.getStyle('body.type'); return vc.VECTORS[b] === 1 } return !1 }, hasAgentLinks: function(a) { for (var b = a.getChildrenSize(), c = 0; b > c; c++) { var d = a.getChildAt(c); if (d instanceof Ld && vc.hasAgentLinks(d)) return !0 } return a.hasAgentLinks() }, getParents: function(a, b, c) { c || (c = !0); for (var d = new nd(), e = a._parent; e != null && e !== b;)d.add(e, 0), e = e._parent; return c && e != null && e === b && d.add(e, 0), d }, getSubNetwork: function(a) { if (!a) return null; if (a instanceof Ib.Link) { var b = a._fromAgent, c = a._toAgent; if (!b || !c) return null; var d = vc.getSubNetwork(b), e = vc.getSubNetwork(c); return d === e ? d : null } var f = a._parent; if (!f) return null; for (;f instanceof Ib.Link && !f.ISubNetwork;)f = f._parent; return f.ISubNetwork ? f : vc.getSubNetwork(f) }, figureSameSubNetworkAgent: function(a) { if (!a) return null; for (var b = a._parent; b instanceof Nd;) { if (!(b._parent instanceof Nd)) return b.isExpanded() ? a : b; b.isExpanded() || (a = b), b = b._parent } return a }, figureSpanSubNetworkAgent: function(a, b) { if (!a || !b) return null; var c = vc.getSubNetwork(a), d = vc.getSubNetwork(b); if (c != d) { for (;d != null && c != d;)d = vc.getSubNetwork(d); if (c === d) return a; var e = new nd(); e.add(a, 0); for (var f = a._parent; f instanceof Ld && !b.isDescendantOf(f);)e.add(f, 0), f = f._parent; for (var g = e.size(), h = 0; g > h; h++) { var i = e.get(h); if (i instanceof Nd && !i.isExpanded()) return i; if (i.ISubNetwork) return i } return a } return a }, figureFromAgent: function(a) { if (a.isLooped()) return a.getFromNode(); var b = vc.figureSameSubNetworkAgent(a.getFromNode()), c = vc.figureSameSubNetworkAgent(a.getToNode()); return b === c ? a.getFromNode() : vc.figureSpanSubNetworkAgent(b, c) }, figureToAgent: function(a) { if (a.isLooped()) return a.getToNode(); var b = vc.figureSameSubNetworkAgent(a.getFromNode()), c = vc.figureSameSubNetworkAgent(a.getToNode()); return b === c ? a.getToNode() : vc.figureSpanSubNetworkAgent(c, b) }, getBundleLinks: function(a, b) { if (!a || !b) return null; var c, d, e, f; if (a === b) { if (f = a.getLoopedLinks(), !f) return null; f = new nd(f) } else { var g = a.getAgentLinks(), h = b.getAgentLinks(); if (!g || !h) return null; for (d = g.size(), c = 0; d > c; c++)e = g.get(c), h.contains(e) && (f || (f = new nd()), f.add(e)) } if (f != null) for (c = 0; c < f.size(); c++)e = f.get(c), e.getStyle('link.bundle.enable') || (e._setBundleLinks(null), f.removeAt(c), c--); return f }, resetBundleLinks: function(a, b) { var c = vc.getBundleLinks(a, b); if (c && c.size() !== 0) { var d = null; if (c.size() === 1) return d = c.get(0), void d._setBundleLinks(null); var e, f, g = new nd(); for (e = 0; e < c.size(); e++)d = c.get(e), f = d.getStyle('link.bundle.id'), g.indexOf(f) < 0 && g.add(f); g.sort(); var h, i, j = new nd(); for (i = 0; i < g.size(); i++) { f = g.get(i); var k = new nd(); for (e = 0; e < c.size(); e++)d = c.get(e), f === d.getStyle('link.bundle.id') && k.add(d); h = new Ib.BundleLinks(k, j), j.add(h) } for (i = 0; i < j.size(); i++) for (h = j.get(i), e = 0; e < h.getLinks().size(); e++)d = h.getLinks().get(e), d._setBundleLinks(h) } }, moveElements: function(a, b, c, d) { for (var e = vc.filterMovingElements(a, d), f = e.size(), g = 0; f > g; g++)e.get(g).translate(b, c) }, filterMovingElements: function(a, b) { for (var c = new nd(), d = a.size(), e = 0; d > e; e++) { var f = a.get(e); if (f instanceof Ld && (!b || b(f))) { for (var g = !0, h = c.toArray(), i = 0; i < h.length; i++) { var j = h[i]; g && j instanceof Ib.Follower && f instanceof Ib.Follower && f.isLoopedHostOn(j) ? g = !1 : j instanceof Ib.Follower && j.isHostOn(f) ? c.remove(j) : g && f instanceof Ib.Follower && j instanceof Ld && f.isHostOn(j) ? g = !1 : vc.isDescendantOfGroup(j, f) ? c.remove(j) : g && vc.isDescendantOfGroup(f, j) && (g = !1) }g && c.add(f) } } return c }, isDescendantOfGroup: function(a, b) { if (!(a && b instanceof Nd)) return !1; if (!b.hasChildren()) return !1; for (a = a._parent; a instanceof Nd;) { if (a === b) return !0; a = a._parent } return !1 } }; Jb.element = vc; var wc = { between: function(a, b, c) { return c >= a && b >= c ? !0 : c >= b && a >= c ? !0 : !1 }, considerEast: function(a, b, c) { return b ? wc.between(b.x, c.x, a.x) ? c.x > b.x : Math.abs(b.x - a.x) > Math.abs(c.x - a.x) : !0 }, considerWest: function(a, b, c) { return b ? wc.between(b.x, c.x, a.x) ? c.x < b.x : Math.abs(b.x - a.x) > Math.abs(c.x - a.x) : !0 }, considerNorth: function(a, b, c) { return b ? wc.between(b.y, c.y, a.y) ? c.y < b.y : Math.abs(b.y - a.y) > Math.abs(c.y - a.y) : !0 }, considerSouth: function(a, b, c) { return b ? wc.between(b.y, c.y, a.y) ? c.y > b.y : Math.abs(b.y - a.y) > Math.abs(c.y - a.y) : !0 }, getHorizontalPoint: function(a, b, c) { return wc.between(b.x, c.x, a.x) ? { x: a.x, y: b.y } : Math.abs(a.x - b.x) < Math.abs(a.x - c.x) ? { x: b.x, y: b.y } : { x: c.x, y: c.y } }, getVerticalPoint: function(a, b, c) { return wc.between(b.y, c.y, a.y) ? { x: b.x, y: a.y } : Math.abs(a.y - b.y) < Math.abs(a.y - c.y) ? { x: b.x, y: b.y } : { x: c.x, y: c.y } }, getPoint: function(a, b, c, d, e) { var f = Math.abs(d.x - c.x) > Math.abs(d.y - c.y); if (e === 'south') return f && wc.considerSouth(b, a, c) ? wc.getHorizontalPoint(b, c, d) : null; if (e === 'north') return f && wc.considerNorth(b, a, c) ? wc.getHorizontalPoint(b, c, d) : null; if (e === 'west') return !f && wc.considerWest(b, a, c) ? wc.getVerticalPoint(b, c, d) : null; if (e === 'east') return !f && wc.considerEast(b, a, c) ? wc.getVerticalPoint(b, c, d) : null; if (e === 'nearby') { var g; return g = f ? wc.getHorizontalPoint(b, c, d) : wc.getVerticalPoint(b, c, d), !a || Tb.getDistance(a, b) > Tb.getDistance(g, b) ? g : null } return null }, getBusPoint: function(a, b, c) { var d, e = a.size(); if (e > 0) { for (var f = a.get(0), g = 1; e > g; g++) { var h = a.get(g), i = wc.getPoint(d, b, f, h, c); i && (d = i), f = h }d || (d = { x: f.x, y: f.y }) } return d } }; Jb.bus = wc; var xc = { createFromPoint: function(a, b) { var c = a._element; if (!c.getFromAgent()) return { x: 0, y: 0 }; var d, e = c.getStyle('link.from.position'), f = c.getStyle('link.from.xoffset'), g = c.getStyle('link.from.yoffset'), h = c.getStyle('link.from.percent'); if (h && h instanceof Array && h.length === 2 && h[0] <= 1 && h[0] >= 0 && h[1] <= 1 && h[1] >= 0) { var i = c.getFromAgent(), j = i.getSize(), k = i.getRect().x + j.width * h[0], l = i.getRect().y + j.height * h[1]; return { x: k, y: l } } if (a._network._edgeDetect) { var i = c.getFromAgent(), m = c.getToAgent(), n = i.getImage(), o = Jb.images[n], p = i.getCenterLocation(), q = m.getCenterLocation(), r = this._getPointAngleDegree(q.x, q.y, p.x, p.y), s = { x: 0, y: 0 }; if (o) { var t = o._image; if (t && cd(t) || t && Ib.Util.getImageAsset(n)._cache) return cd(t) ? o._edgeData || (o._edgeData = o._createEdgeData(t, i._width, i._height)) : typeof t === 'object' && (o._edgeData || (o._edgeData = o._createEdgeData(Ib.Util.getImageAsset(n)._cache, i.getWidth(), i.getHeight()))), s.x = o._edgeData[r].x + i.getRect().x, s.y = o._edgeData[r].y + i.getRect().y, s } } if (!Jb.isCalculatingBus) { if (Jb.isCalculatingBus = !0, c.getFromAgent() instanceof Ib.Bus) { var u = c.getFromAgent(); if (vc.hasVector(u)) { var v = b ? b._getElementZoomRect(a, u.getRect()) : u.getRect(), w = u.getStyle('vector.shape'); if (w === 'oval')d = Tb.getEllipsePoint(v, xc.createToPoint(a)); else if (w === 'circle')d = Tb.getEllipsePoint(Tb.getCircleRect(v), xc.createToPoint(a)); else if (w === 'rectangle' || w === 'roundrect') { var x = new nd(); x.add({ x: u.x, y: u.y }), x.add({ x: u.x + u.width, y: u.y }), x.add({ x: u.x + u.width, y: u.y + u.height }), x.add({ x: u.x, y: u.y + u.height }), x.add({ x: u.x, y: u.y }), x = b ? b._getShapeNodeZoomPoints(a, x) : x, d = wc.getBusPoint(x, xc.createToPoint(a), u.getStyle('bus.style')) } } else { var x = b ? b._getShapeNodeZoomPoints(a, u.getPoints()) : u.getPoints(); d = wc.getBusPoint(x, xc.createToPoint(a), u.getStyle('bus.style')) } }Jb.isCalculatingBus = !1 } return d ? (d.x += f, d.y += g) : d = a._network.getPosition(e, c.getFromAgent(), null, f, g, !0), d }, createToPoint: function(a, b) { var c = a._element; if (!c.getToAgent()) return { x: 0, y: 0 }; var d, e = c.getStyle('link.to.position'), f = c.getStyle('link.to.xoffset'), g = c.getStyle('link.to.yoffset'), h = c.getStyle('link.to.percent'); if (h && h instanceof Array && h.length === 2 && h[0] <= 1 && h[0] >= 0 && h[1] <= 1 && h[1] >= 0) { var i = c.getToAgent(), j = i.getSize(), k = i.getRect().x + j.width * h[0], l = i.getRect().y + j.height * h[1]; return { x: k, y: l } } if (a._network._edgeDetect) { var m = c.getFromAgent(), i = c.getToAgent(), n = i.getImage(), o = Jb.images[n], p = m.getLocation(), q = i.getCenterLocation(), r = this._getPointAngleDegree(p.x, p.y, q.x, q.y), s = { x: 0, y: 0 }; if (o) { var t = o._image; if (t && cd(t) || t && Ib.Util.getImageAsset(n)._cache) return cd(t) ? o._edgeData || (o._edgeData = o._createEdgeData(t, i.getWidth(), i.getHeight())) : typeof t === 'object' && (o._edgeData || (o._edgeData = o._createEdgeData(Ib.Util.getImageAsset(n)._cache, i.getWidth(), i.getHeight()))), s.x = o._edgeData[r].x + i.getRect().x, s.y = o._edgeData[r].y + i.getRect().y, s } } if (!Jb.isCalculatingBus) { if (Jb.isCalculatingBus = !0, c.getToAgent() instanceof Ib.Bus) { var u = c.getToAgent(); if (vc.hasVector(u)) { var v = b ? b._getElementZoomRect(a, u.getRect()) : u.getRect(), w = u.getStyle('vector.shape'); if (w === 'oval')d = Tb.getEllipsePoint(v, xc.createFromPoint(a)); else if (w === 'circle')d = Tb.getEllipsePoint(Tb.getCircleRect(v), xc.createFromPoint(a)); else if (w === 'rectangle' || w === 'roundrect') { var x = new nd(); x.add({ x: u.x, y: u.y }), x.add({ x: u.x + u.width, y: u.y }), x.add({ x: u.x + u.width, y: u.y + u.height }), x.add({ x: u.x, y: u.y + u.height }), x.add({ x: u.x, y: u.y }), x = b ? b._getShapeNodeZoomPoints(a, x) : x, d = wc.getBusPoint(x, xc.createFromPoint(a), u.getStyle('bus.style')) } } else { var x = b ? b._getShapeNodeZoomPoints(a, u.getPoints()) : u.getPoints(); d = wc.getBusPoint(x, xc.createFromPoint(a), u.getStyle('bus.style')) } }Jb.isCalculatingBus = !1 } return d ? (d.x += f, d.y += g) : d = a._network.getPosition(e, c.getToAgent(), null, f, g, !0), d }, fillLoopedPoints: function(a, b, c) {
    var d, e = xc.getBundleGap(a, !0), f = e, g = a.getStyle('link.looped.type'), h = a.getStyle('link.looped.direction'); if (h === 'north') return g === 'arc' ? xc.drawArc(b.x + b.width / 2, b.y, 0, Math.PI, e, e, !1, c) : (d = { x: b.x + b.width / 2, y: b.y }, c.add({ x: d.x + f, y: d.y }), c.add({ x: d.x + f, y: d.y - e }), c.add({ x: d.x - f, y: d.y - e }), c.add({ x: d.x - f, y: d.y })), { x: b.x + b.width / 2, y: b.y - e }; if (h === 'northeast') {
      return g === 'arc' ? xc.drawArc(b.x + b.width, b.y, 1.5 * Math.PI, 1.5 * Math.PI, e, e, !1, c) : (d = {
        x: b.x + b.width, y: b.y }, c.add({ x: d.x, y: d.y + f }), c.add({ x: d.x + f, y: d.y + f }), c.add({ x: d.x + f, y: d.y - e }), c.add({ x: d.x - f, y: d.y - e }), c.add({ x: d.x - f, y: d.y })), { x: b.x + b.width + 0.707 * e, y: b.y - 0.707 * e }
    } if (h === 'east') return g === 'arc' ? xc.drawArc(b.x + b.width, b.y + b.height / 2, 1.5 * Math.PI, Math.PI, e, e, !1, c) : (d = { x: b.x + b.width, y: b.y + b.height / 2 }, c.add({ x: d.x, y: d.y - f }), c.add({ x: d.x + e, y: d.y - f }), c.add({ x: d.x + e, y: d.y + f }), c.add({ x: d.x, y: d.y + f })), { x: b.x + b.width + e, y: b.y + b.height / 2 }; if (h === 'southeast') return g === 'arc' ? xc.drawArc(b.x + b.width, b.y + b.height, Math.PI, 1.5 * Math.PI, e, e, !1, c) : (d = { x: b.x + b.width, y: b.y + b.height }, c.add({ x: d.x, y: d.y - f }), c.add({ x: d.x + f, y: d.y - f }), c.add({ x: d.x + f, y: d.y + e }), c.add({ x: d.x - f, y: d.y + e }), c.add({ x: d.x - f, y: d.y })), { x: b.x + b.width + 0.707 * e, y: b.y + b.height + 0.707 * e }; if (h === 'south') return g === 'arc' ? xc.drawArc(b.x + b.width / 2, b.y + b.height, Math.PI, Math.PI, e, e, !1, c) : (d = { x: b.x + b.width / 2, y: b.y + b.height }, c.add({ x: d.x - f, y: d.y }), c.add({ x: d.x - f, y: d.y + e }), c.add({ x: d.x + f, y: d.y + e }), c.add({ x: d.x + f, y: d.y })), { x: b.x + b.width / 2, y: b.y + b.height + e }; if (h === 'southwest') return g === 'arc' ? xc.drawArc(b.x, b.y + b.height, 0.5 * Math.PI, 1.5 * Math.PI, e, e, !1, c) : (d = { x: b.x, y: b.y + b.height }, c.add({ x: d.x, y: d.y - f }), c.add({ x: d.x - f, y: d.y - f }), c.add({ x: d.x - f, y: d.y + e }), c.add({ x: d.x + f, y: d.y + e }), c.add({ x: d.x + f, y: d.y })), { x: b.x - 0.707 * e, y: b.y + b.height + 0.707 * e }; if (h === 'west') return g === 'arc' ? xc.drawArc(b.x, b.y + b.height / 2, 0.5 * Math.PI, Math.PI, e, e, !1, c) : (d = { x: b.x, y: b.y + b.height / 2 }, c.add({ x: d.x, y: d.y - f }), c.add({ x: d.x - e, y: d.y - f }), c.add({ x: d.x - e, y: d.y + f }), c.add({ x: d.x, y: d.y + f })), { x: b.x - e, y: b.y + b.height / 2 }; if (h === 'northwest') return g === 'arc' ? xc.drawArc(b.x, b.y, 0, 1.5 * Math.PI, e, e, !1, c) : (d = { x: b.x, y: b.y }, c.add({ x: d.x, y: d.y + f }), c.add({ x: d.x - f, y: d.y + f }), c.add({ x: d.x - f, y: d.y - e }), c.add({ x: d.x + f, y: d.y - e }), c.add({ x: d.x + f, y: d.y })), { x: b.x - 0.707 * e, y: b.y - 0.707 * e }; throw "Can not resolve link looped direction '" + h + "'"
  }, drawArc: function(a, b, c, d, e, f, g, h) { var i, j, k, l, m, n, o, p, q, r, s; if (Math.abs(d) > 2 * Math.PI && (d = 2 * Math.PI), m = Math.ceil(Math.abs(d) / (Math.PI / 4)), i = d / m, j = -i, k = -c, m > 0) { n = a + Math.cos(c) * e, o = b + Math.sin(-c) * f, h.add({ x: n, y: o }); for (var t = 0; m > t; t++) { k += j, l = k - j / 2, p = a + Math.cos(k) * e, q = b + Math.sin(k) * f, r = a + Math.cos(l) * (e / Math.cos(j / 2)), s = b + Math.sin(l) * (f / Math.cos(j / 2)); var u = new nd(); u.add({ x: r, y: s }), u.add({ x: p, y: q }), h.add(u) } } }, fillBundlePoints: function(a, c, d, e, f, g) { { var h; a._element.getBundleCount(), a._element.getBundleIndex(), a.getStyle('link.bundle.expanded') } if (c !== 'parallel' && (h = xc.getBundleGap(a, !1)) === 0) return f.add(d), f.add(e), Tb.getCenterPoint(d, e); h === b && (h = xc.getBundleGap(a, !1)); var i = xc.getBundleOffset(a), j = Tb.getDistance(d, e); if (g) { var k = g.getSizeZoom(); i *= k, h *= k }(c === 'arc' || c === 'triangle') && f.add({ x: 0, y: 0 }), c === 'arc' && f.add({ x: 0, y: h }), f.add({ x: i, y: h }), f.add({ x: j - i, y: h }), c === 'arc' && f.add({ x: j, y: h }), (c === 'arc' || c === 'triangle') && f.add({ x: j, y: 0 }); for (var l = Math.atan2(e.y - d.y, e.x - d.x), m = Tb.createMatrix(l, 0, 0), n = 0, o = f.size(); o > n; n++) { var p = f.get(n); p = m.transform(p), p.x += d.x, p.y += d.y, f.set(n, p) } if (c === 'arc') { var q = Tb.getCenterPoint(f.get(2), f.get(3)), r = new nd(); return r.add(f.get(1)), r.add(f.get(2)), f.set(1, r), r = new nd(), r.add(f.get(4)), r.add(f.get(5)), f.set(4, r), f.removeAt(5), f.removeAt(2), q } return xc.calculateCenterPoint(f) }, calculateCenterPoint: function(a) { var b = a.size(); if (a == null || b < 1) return { x: 0, y: 0 }; if (b % 2 === 0) { var c = b / 2, d = a.get(c - 1), e = a.get(c); return { x: (d.x + e.x) / 2, y: (d.y + e.y) / 2 } } return a.get((b - 1) / 2) }, getBundleOffset: function(a) { var b = Tb.getDistance(a.getFromPoint(), a.getToPoint()), c = a.getStyle('link.bundle.offset'); return b > 2 * c ? c : b / 2 }, getBundleGap: function(a, b) { var c = a._element; if (!c.getBundleLinks()) return b ? c.getStyle('link.looped.gap') : 0; for (var d = b ? 'link.looped.gap' : 'link.bundle.gap', e = null, f = 0, g = 0, h = c.getBundleLinks().getSiblings(), i = 0, j = c.getStyle('link.bundle.independent'), k = c.getStyle('link.bundle.group.gap'), l = 0, m = h.size(); m > l; l++) { var n = h.get(l); if (!j || n === c.getBundleLinks()) { for (var o = 0, p = n.getLinks().size(); p > o; o++) { var q = n.getLinks().get(o); if (j === q.getStyle('link.bundle.independent') && a._network.isVisible(q)) { if (e == null)e = q, i = q.getStyle(d); else { var r = q.getStyle(d); g += i / 2 + r / 2, i = r }q === c && (f = g + k / 2) } }g += k } } if (b) return g - f + i; var s = f - g / 2; return e != null && c.getFromAgent() !== e.getFromAgent() && (s = -s), s }, isTargetPriority: function(a, b, c) { if (a) { if (b.height < c.height) return b.height + c.height < Math.max(b.y + b.height, c.y + c.height) - Math.min(b.y, c.y) + b.height / 2 } else if (b.width < c.width) return b.width + c.width < Math.max(b.x + b.width, c.x + c.width) - Math.min(b.x, c.x) + b.width / 2; return !0 }, calculateOrthogonalAndFlexionalLinkPoints: function(a, b, c, d) { var e = xc.isHorizontal(a, b, c, d), f = new nd(); if (xc.isFlexionalTypeLink(a))xc.flexional(e, b, c, f, d.getStyle('link.extend')); else { xc.orthogonal(a, b, c, f, e, d); var g = xc.isSplitByPercent(a, d), h = g ? xc.calculateSplitValueByPercent(a, e, b, c, d.getStyle('link.split.percent')) : d.getStyle('link.split.value'); h === 0 && (e = !e) } var i; f.size() === 0 ? xc.isTargetPriority(e, b, c) ? (i = { x: c.x + c.width / 2, y: c.y + c.height / 2 }, f.add(xc.rectanglePerimeter(b, !0, i)), f.add(xc.rectanglePerimeter(c, !1, f.get(f.size() - 1)))) : (i = { x: b.x + b.width / 2, y: b.y + b.height / 2 }, i = xc.rectanglePerimeter(c, !1, i), f.add(xc.rectanglePerimeter(b, !0, i)), f.add(i)) : (i = f.get(0), f.add(xc.rectanglePerimeter(b, !0, i), 0), f.add(xc.rectanglePerimeter(c, !1, f.get(f.size() - 1)))); var j = f.size(); if (j < 2) return f; for (var k = f.get(0), l = 1; j - 1 > l; l++) { var m = f.get(l); m.x === k.x && m.y === k.y && (f.remove(m), j--, l--), k = m } return f }, isHorizontal: function(a, b, c, d) { if (a) { if (a === 'flexional.horizontal' || a === 'orthogonal.horizontal' || a === 'orthogonal.H.V' || a === 'extend.left' || a === 'extend.right') return !0; if (a === 'flexional.vertical' || a === 'orthogonal.vertical' || a === 'orthogonal.V.H' || a === 'extend.top' || a === 'extend.bottom') return !1 } var e = xc.calculateXGap(b, c), f = xc.calculateYGap(b, c); return e >= f }, flexional: function(a, b, c, d, e) { a ? xc.flexionalHorizontal(b, c, d, e) : xc.flexionalVertical(b, c, d, e) }, isSplitByPercent: function(a, b) { return b.getStyle('link.split.by.percent') }, isExtendTypeLink: function(a) { return a && (a === 'extend.top' || a === 'extend.left' || a === 'extend.bottom' || a === 'extend.right') }, isFlexionalTypeLink: function(a) { return a && (a === 'flexional' || a === 'flexional.horizontal' || a === 'flexional.vertical') }, calculateControlPoint: function(a, b, c, d, e) { if (a === 'orthogonal.H.V' || a === 'orthogonal.V.H') return { x: d.x + d.width / 2, y: d.y + d.height / 2 }; var f; if (xc.isExtendTypeLink(a)) { var g = Math.min(c.y, d.y), h = Math.min(c.x, d.x), i = Math.max(c.y + c.height, d.y + d.height), j = Math.max(c.x + c.width, d.x + d.width); if (f = e.getStyle('link.extend'), a === 'extend.top') return { x: (h + j) / 2, y: g - f }; if (a === 'extend.left') return { x: h - f, y: (g + i) / 2 }; if (a === 'extend.bottom') return { x: (h + j) / 2, y: i + f }; if (a === 'extend.right') return { x: j + f, y: (g + i) / 2 } } var k = xc.isSplitByPercent(a, e); if (f = k ? xc.calculateSplitValueByPercent(a, b, c, d, e.getStyle('link.split.percent')) : e.getStyle('link.split.value'), f === Number.NEGATIVE_INFINITY || f === Number.POSITIVE_INFINITY) return { x: d.x + d.width / 2, y: d.y + d.height / 2 }; if (f === 0) return { x: c.x + c.width / 2, y: c.y + c.height / 2 }; if (b) { var l = c.x + c.x + c.width < d.x + d.x + d.width; return { x: xc.calculateSplitLocation(l, f, c.x, c.width), y: c.y + c.height / 2 } } var m = c.y + c.y + c.height < d.y + d.y + d.height; return { x: c.x + c.width / 2, y: xc.calculateSplitLocation(m, f, c.y, c.height) } }, calculateGap: function(a, b, c, d) { var e = Math.max(b, d) - Math.min(a, c); return e - (b - a + d - c) }, calculateXGap: function(a, b) { var c = Math.max(a.x + a.width, b.x + b.width) - Math.min(a.x, b.x); return c - a.width - b.width }, calculateYGap: function(a, b) { var c = Math.max(a.y + a.height, b.y + b.height) - Math.min(a.y, b.y); return c - a.height - b.height }, calculateSplitValueByPercent: function(a, b, c, d, e) { var f = xc.calculateSplitGapByPercent(e, b, c, d); return f * e }, calculateSplitGapByPercent: function(a, b, c, d, e) { return b ? xc._calculateSplitGapByPercent(a, c.x, c.x + c.width, d.x, d.x + d.width) : xc._calculateSplitGapByPercent(a, c.y, c.y + c.height, d.y, d.y + d.height) }, _calculateSplitGapByPercent: function(a, b, c, d, e) { var f = xc.calculateGap(b, c, d, e), g = d + e > b + c; if (f > 0) { if (a === 1) return f + (e - d) / 2; if (a >= 0 && a < 1) return f; if (a < 0) return g ? d - b : c - e } return Math.abs(g && a > 0 || !g && a < 0 ? c - e : b - d) }, calculateSplitPercentByControlPoint: function(a, b, c, d) { return b ? xc.calculateSplitPercent(a.x, c.x, c.x + c.width, d.x, d.x + d.width) : xc.calculateSplitPercent(a.y, c.y, c.y + c.height, d.y, d.y + d.height) }, calculateSplitPercent: function(a, b, c, d, e) { if (a >= b && c >= a) return 0; var f = xc.calculateGap(b, c, d, e); if (f > 0 && a >= d && e >= a) return 1; var g = d + e > b + c; if (f > 0) { if (a > Math.min(c, e) && a < Math.max(b, d)) return Math.abs(a - (g ? c : b)) / f; if (g) { if (b > a) return (a - b) / (d - b) } else if (a > c) return (c - a) / (c - e) } return a > c ? (g ? a - c : c - a) / Math.abs(c - e) : (g ? a - b : b - a) / Math.abs(b - d) }, calculateSplitLocation: function(a, b, c, d) { return a === b > 0 ? c + d + Math.abs(b) : c - Math.abs(b) }, calculateAngle: function(a, b) { if (a !== 0 && b !== 0) return Math.atan2(a, b); if (a === 0) { if (b > 0) return 0; if (b < 0) return Math.PI } return a > 0 ? Math.PI / 2 : -Math.PI / 2 }, drawCorner: function(a, b) { var c = a.size(); if (!(c < 3)) { var d = b.getStyle('link.corner'); if (d !== 'none') { for (var e, f, g, h, i = b.getStyle('link.xradius'), j = b.getStyle('link.yradius'), k = a.get(0), l = a.get(1), m = 2; c > m; m++) { var n = a.get(m), o = l.x - k.x, p = l.y - k.y, q = n.x - l.x, r = n.y - l.y, s = p === 0; if (o === 0 && r === 0 || p === 0 && q === 0) if (s ? (e = Math.min(m === 2 ? Math.abs(o) : Math.abs(o) / 2, i), f = Math.min(m === c - 1 ? Math.abs(r) : Math.abs(r) / 2, j), g = { x: l.x - (o > 0 ? e : -e), y: l.y }, h = { x: l.x, y: l.y + (r > 0 ? f : -f) }) : (e = Math.min(m === c - 1 ? Math.abs(q) : Math.abs(q) / 2, i), f = Math.min(m === 2 ? Math.abs(p) : Math.abs(p) / 2, j), g = { x: l.x, y: l.y - (p > 0 ? f : -f) }, h = { x: l.x + (q > 0 ? e : -e), y: l.y }), a.remove(l), m--, c--, (g.x !== k.x || g.y !== k.y) && (a.add(g, m), m++, c++), d === 'bevel')a.add(h, m), m++, c++; else if (d === 'round') { var t = new nd(); t.add(l), t.add(h), a.add(t, m), m++, c++ }k = l, l = n }h && h.x === l.x && h.y === l.y && a.remove(l) } } }, orthogonal: function(a, b, c, d, e, f) { var g = f.getStyle('link.control.point'), h = g == null; if (g) { var i = Tb.unionRect(b, c); Tb.containsPoint(i, g) || (e = xc.calculateIsHorizontalByControlPoint(g.x, g.y, i.y, i.x, i.y + i.height, i.x + i.width)) } else g = xc.calculateControlPoint(a, e, b, c, f); e ? xc.sideToSide(b, c, g, d, h) : xc.topToBottom(b, c, g, d, h) }, calculateIsHorizontalByControlPoint: function(a, b, c, d, e, f) { return c > b && c - b > d - a && c - b > a - f || b > e && b - e > d - a && b - e > a - f ? !1 : !0 }, contains: function(a, b, c) { return b >= a.x && b <= a.x + a.width && c >= a.y && c <= a.y + a.height }, topToBottom: function(a, b, c, d, e) { var f = Math.max(a.y, b.y), g = Math.min(a.y + a.height, b.y + b.height), h = c ? c.y : g + (f - g) / 2, i = a.x + a.width / 2, j = b.x + b.width / 2; if (!e && c && (c.x >= a.x && c.x <= a.x + a.width && (i = c.x), c.x >= b.x && c.x <= b.x + b.width && (j = c.x)), xc.contains(b, i, h) || xc.contains(a, i, h) || d.add({ x: i, y: h }), xc.contains(b, j, h) || xc.contains(a, j, h) || d.add({ x: j, y: h }), d.size() === 0) if (c)xc.contains(b, c.x, h) || xc.contains(a, c.x, h) || d.add({ x: c.x, y: h }); else { var k = Math.max(a.x, b.x), l = Math.min(a.x + a.width, b.x + b.width); d.add({ x: k + (l - k) / 2, y: h }) } }, sideToSide: function(a, b, c, d, e) { var f = Math.max(a.x, b.x), g = Math.min(a.x + a.width, b.x + b.width), h = c ? c.x : g + (f - g) / 2, i = a.y + a.height / 2, j = b.y + b.height / 2; if (!e && c && (c.y >= a.y && c.y <= a.y + a.height && (i = c.y), c.y >= b.y && c.y <= b.y + b.height && (j = c.y)), xc.contains(b, h, i) || xc.contains(a, h, i) || d.add({ x: h, y: i }), xc.contains(b, h, j) || xc.contains(a, h, j) || d.add({ x: h, y: j }), d.size() === 0) if (c)xc.contains(b, h, c.y) || xc.contains(a, h, c.y) || d.add({ x: h, y: c.y }); else { var k = Math.max(a.y, b.y), l = Math.min(a.y + a.height, b.y + b.height); d.add({ x: h, y: k + (l - k) / 2 }) } }, flexionalHorizontal: function(a, b, c, d) { var e = b.x + b.width < a.x, f = a.x + a.width < b.x, g = e ? a.x : a.x + a.width, h = a.y + a.height / 2, i = f ? b.x : b.x + b.width, j = b.y + b.height / 2, k = d, l = e ? -k : k, m = { x: g + l, y: h }; l = f ? -k : k; var n = { x: i + l, y: j }; if (e === f) { var o = e ? Math.min(g, i) - d : Math.max(g, i) + d; c.add({ x: o, y: h }), c.add({ x: o, y: j }) } else if (m.x < n.x === e) { var p = h + (j - h) / 2; c.add(m), c.add({ x: m.x, y: p }), c.add({ x: n.x, y: p }), c.add(n) } else c.add(m), c.add(n) }, flexionalVertical: function(a, b, c, d) { var e = b.y + b.height < a.y, f = a.y + a.height < b.y, g = a.x + a.width / 2, h = e ? a.y : a.y + a.height, i = b.x + b.width / 2, j = f ? b.y : b.y + b.height, k = d, l = e ? -k : k, m = { x: g, y: h + l }; l = f ? -k : k; var n = { x: i, y: j + l }; if (e === f) { var o = e ? Math.min(h, j) - d : Math.max(h, j) + d; c.add({ x: g, y: o }), c.add({ x: i, y: o }) } else if (m.y < n.y === e) { var p = g + (i - g) / 2; c.add(m), c.add({ x: p, y: m.y }), c.add({ x: p, y: n.y }), c.add(n) } else c.add(m), c.add(n) }, rectanglePerimeter: function(a, b, c) { var d = a.x + a.width / 2, e = a.y + a.height / 2, f = c.x - d, g = c.y - e, h = Math.atan2(g, f), i = { x: 0, y: 0 }, j = Math.PI, k = Math.PI / 2, l = k - h, m = Math.atan2(a.height, a.width); return -j + m > h || h > j - m ? (i.x = a.x, i.y = e - a.width * Math.tan(h) / 2) : -m > h ? (i.y = a.y, i.x = d - a.height * Math.tan(l) / 2) : m > h ? (i.x = a.x + a.width, i.y = e + a.width * Math.tan(h) / 2) : (i.y = a.y + a.height, i.x = d + a.height * Math.tan(l) / 2), c.x >= a.x && c.x <= a.x + a.width ? i.x = c.x : c.y >= a.y && c.y <= a.y + a.height && (i.y = c.y), c.x < a.x ? i.x = a.x : c.x > a.x + a.width && (i.x = a.x + a.width), c.y < a.y ? i.y = a.y : c.y > a.y + a.height && (i.y = a.y + a.height), i }, isSplitTypeLink: function(a) { return a && (a === 'orthogonal' || a === 'orthogonal.horizontal' || a === 'orthogonal.vertical') }, isOrthogonalOrFlexionalLink: function(a) { if (a instanceof Ib.ShapeLink) return !1; if (a.isLooped()) return !1; var b = a.getStyle('link.type'); return xc.isOrthogonalOrFlexionalType(b) }, isOrthogonalLink: function(a) { if (a instanceof Ib.ShapeLink) return !1; if (a.isLooped()) return !1; var b = a.getStyle('link.type'); return xc.isOrthogonalType(b) }, isOrthogonalOrFlexionalType: function(a) { return a === 'orthogonal' || a === 'orthogonal.horizontal' || a === 'orthogonal.H.V' || a === 'orthogonal.vertical' || a === 'orthogonal.V.H' || a === 'extend.top' || a === 'extend.left' || a === 'extend.bottom' || a === 'extend.right' || a === 'flexional' || a === 'flexional.horizontal' || a === 'flexional.vertical' }, isOrthogonalType: function(a) { return a === 'orthogonal' || a === 'orthogonal.horizontal' || a === 'orthogonal.H.V' || a === 'orthogonal.vertical' || a === 'orthogonal.V.H' || a === 'extend.top' || a === 'extend.left' || a === 'extend.bottom' || a === 'extend.right' }, hasControlPoint: function(a) { return a === 'orthogonal' || a === 'orthogonal.horizontal' || a === 'orthogonal.vertical' || a === 'extend.bottom' || a === 'extend.left' || a === 'extend.right' || a === 'extend.top' }, getControlPoint: function(a, b, c) { if (!a) throw "link can't be null"; var d = a.getStyle('link.type'); if (!xc.hasControlPoint(d)) return null; var e = a.getStyle('link.control.point'); if (e) return e; var f, g; if (b == null ? (f = a.getFromAgent().getRect(), g = a.getToAgent().getRect()) : (f = xc.getLinkSourceBounds(b, c), g = xc.getLinkTargetBounds(b, c)), f == null || g == null) return null; var h = xc.isHorizontal(d, f, g, a); return xc.calculateControlPoint(a.getStyle('link.type'), h, f, g, a) }, getSplitValueByControlPoint: function(a, b, c, d, e) { if (b === 'extend.top') return Math.min(c.y, d.y) - a.y; if (b === 'extend.left') return Math.min(c.x, d.x) - a.x; if (b === 'extend.bottom') return a.y - Math.max(c.y + c.height, d.y + d.height); if (b === 'extend.right') return a.x - Math.max(c.x + c.width, d.x + d.width); var f; if (e) { var g = c.x + c.x + c.width < d.x + d.x + d.width; return f = g ? a.x - c.x + c.width : c.x - a.x, f > 0 ? f : f > -c.width ? 0 : f + c.width } var h = c.y + c.y + c.height < d.y + d.y + d.height; return f = h ? a.y - c.y - c.height : c.y - a.y, f > 0 ? f : f > -c.height ? 0 : f + c.height }, isHorizontalByControlPoint: function(a, b, c, d, e) { var f = Tb.unionRect(c, d); return Tb.containsPoint(f, a) ? xc.isHorizontal(b, c, d, e) : xc.calculateIsHorizontalByControlPoint(a.x, a.y, f.y, f.x, f.y + f.height, f.x + f.width) }, setParamsByControlPoint: function(a, b, c, d, e) { var f = xc.isHorizontalByControlPoint(a, d, b, c, e), g = e.getStyle('link.control.point'); if ((g || d === 'orthogonal' || d === 'orthogonal.horizontal' || d === 'orthogonal.vertical') && e.setStyle('link.type', f ? 'orthogonal.horizontal' : 'orthogonal.vertical'), g) return void e.setStyle('link.control.point', a); var h = xc.getSplitValueByControlPoint(a, d, b, c, f); if (xc.isExtendTypeLink(d)) return void e.setStyle('link.extend', h); var i = xc.isSplitByPercent(d, e); return i ? h === 0 ? void e.setStyle('link.split.percent', 0) : void e.setStyle('link.split.percent', xc.calculateSplitPercentByControlPoint(a, f, b, c)) : void e.setStyle('link.split.value', h) }, getLinkNodeBounds: function(a, b, c, d, e, f) { if (f) { var g = f.getLocationZoom(); f.getSizeZoom(a) } if (a == null) return null; var h; if (d)f ? (h = a.getZoomBodyRect(), h.x += b, h.y += c) : (h = a.getBodyRect(), h.x += b, h.y += c); else { var i = a.getNetwork().getPosition(e, a, null, b, c); h = f ? { x: i.x * g, y: i.y * g, width: 1, height: 1 } : { x: i.x, y: i.y, width: 1, height: 1 } } return h }, getLinkSourceBounds: function(a, b) { var c = a._element, d = a.getNetwork().getElementUI(c.getFromAgent()); if (d == null) return null; var e = c.getStyle('link.from.position'), f = c.getStyle('link.from.xoffset'), g = c.getStyle('link.from.yoffset'), h = c.getStyle('link.from.at.edge'); return xc.getLinkNodeBounds(d, f, g, h, e, b) }, getLinkTargetBounds: function(a, b) { var c = a._element, d = a.getNetwork().getElementUI(c.getToAgent()); if (d == null) return null; var e = c.getStyle('link.to.position'), f = c.getStyle('link.to.xoffset'), g = c.getStyle('link.to.yoffset'), h = c.getStyle('link.to.at.edge'); return xc.getLinkNodeBounds(d, f, g, h, e, b) }, orthogonalAndFlexional: function(a, b, c) { var d = xc.getLinkSourceBounds(a, c); if (d == null) return null; var e = xc.getLinkTargetBounds(a, c); if (e == null) return null; var f = xc.calculateOrthogonalAndFlexionalLinkPoints(b, d, e, a._element); return xc.offsetLink(a, f), a.setHotSpot(xc.calculateCenterPoint(f)), b !== 'flexional' && xc.drawCorner(f, a._element), f }, offsetLink: function(a, b) { var c = a._element, d = c.isBundleAgent(); if (!d) { var e = xc.getBundleGap(a, !1); if (e !== 0) for (var f, g, h = !1, i = !1, j = b.get(0), k = Jb.clone(j), l = 1, m = b.size(); m > l; l++) { var n = b.get(l), o = n.x - k.x, p = n.y - k.y; k = Jb.clone(n), g = xc.calculateAngle(o, p), o === 0 ? ((g - f) % Math.PI === 0 && (g - f) % (2 * Math.PI) !== 0 && (h = !h, h && (p = -p)), (g - f) % Math.PI !== 0 && (j.x += p < 0 ? e : -e), n.x += p < 0 ? e : -e) : p === 0 && ((g - f) % Math.PI === 0 && (g - f) % (2 * Math.PI) !== 0 && (i = !i, i && (o = -o)), f && (g - f) % Math.PI === 0 || (j.y -= o < 0 ? e : -e), n.y -= o < 0 ? e : -e), f = g, j = n } } }, _getPointAngleDegree: function(a, b, c, d) { var e = c - a, f = d - b, g = Math.atan2(f, e); return g = g / Math.PI * 180, g = parseInt(g) + 180, g %= 360 } }; Jb.link = xc; var yc = { findMoveToBottomDatas: function(a, b, c) { for (var d = 0; d < c.size(); d++) { var e = c.get(d); a.contains(e) && b.add(e) } for (d = 0; d < c.size(); d++)e = c.get(d), yc.findMoveToBottomDatas(a, b, e.getChildren()) }, findMoveToTopDatas: function(a, b, c) { for (var d = 0; d < c.size(); d++) { var e = c.get(c.size() - 1 - d); a.contains(e) && b.add(e) } for (d = 0; d < c.size(); d++)e = c.get(d), yc.findMoveToTopDatas(a, b, e.getChildren()) }, findMoveUpDatas: function(a, b, c) { for (var d = !1, e = 0; e < c.size(); e++) { var f = c.get(e); a.contains(f) ? d && b.add(f) : d = !0 } for (e = 0; e < c.size(); e++)f = c.get(e), yc.findMoveUpDatas(a, b, f.getChildren()) }, findMoveDownDatas: function(a, b, c) { for (var d = !1, e = 0; e < c.size(); e++) { var f = c.get(c.size() - 1 - e); a.contains(f) ? d && b.add(f) : d = !0 } for (e = 0; e < c.size(); e++)f = c.get(e), yc.findMoveDownDatas(a, b, f.getChildren()) }, doLayout: function(a, b) { b = b || {}, b.type = b.type || 'round', b.animate = b.animate || !0, b.elements = b.elements || new Ib.List(), b.repulsion = b.repulsion || 1, b.expandGroup = b.expandGroup || !1; var c = new Ib.layout.AutoLayouter(a.getElementBox()); c.getElements = function() {} } }; Jb.box = yc; var zc = { scrollLeft: function() { return zc._filterResults(a.pageXOffset ? a.pageXOffset : 0, Ob.documentElement ? Ob.documentElement.scrollLeft : 0, Ob.body ? Ob.body.scrollLeft : 0) }, scrollTop: function() { return zc._filterResults(a.pageYOffset ? a.pageYOffset : 0, Ob.documentElement ? Ob.documentElement.scrollTop : 0, Ob.body ? Ob.body.scrollTop : 0) }, _filterResults: function(a, b, c) { var d = a || 0; return b && (!d || d > b) && (d = b), c && (!d || d > c) ? c : d }, isSingleTouch: function(a) { return a.touches && a.touches.length == 1 }, isMultiTouch: function(a) { return a.touches && a.touches.length > 1 }, getDistance: function(a) { if (!zc.isMultiTouch(a)) return 0; var b = a.touches[0], c = a.touches[1]; return Math.sqrt(Math.pow(b.clientX - c.clientX, 2) + Math.pow(b.clientY - c.clientY, 2)) } }; Jb.touch = zc; var Ac = { _string: function(a, b, c, d) { var e = c._stringPool.get(); e.style.whiteSpace = 'nowrap', e.style.verticalAlign = 'middle', e.style.padding = '0px 2px', Jb.setText(e, a, d), e.setAttribute('title', a), b.appendChild(e) }, _boolean: function(a, b, c) { var d = c._booleanPool.get(); b._editInfo ? (d._editInfo = b._editInfo, delete b._editInfo, d.disabled = !1) : d.disabled = !0, d.keepDefault = !0, d.type = 'checkbox', d.style.margin = '0px 2px', d.style.verticalAlign = 'middle', d.checked = a, b.appendChild(d), b.style.textAlign === '' && (b.style.textAlign = 'center') }, _color: function(a, b, c) { var d = c._colorPool.get(); d.style.width = '100%', d.style.height = '100%', d.style.backgroundColor = a, d.setAttribute('title', a), b.appendChild(d) }, render: function(a, b, c, d, e) { if (b != null) { var f = Ac['_' + a]; f ? f(b, c, d, e) : typeof b === 'boolean' ? Ac._boolean(b, c, d, e) : Ac._string(b, c, d, e) } } }; Jb.render = Ac; var Bc = { toolTipDiv: null, getToolTipDiv: function() { if (!Bc.toolTipDiv) { Bc.toolTipDiv = Ob.createElement('div'); var a = Ed, b = Bc.toolTipDiv.style; b.position = 'absolute', b.color = a.TOOLTIP_COLOR, b.background = a.TOOLTIP_BACKGROUND, b.fontSize = a.TOOLTIP_FONT_SIZE, b.padding = a.TOOLTIP_PADDING, b.border = a.TOOLTIP_BORDER, b.borderRadius = a.TOOLTIP_BORDER_RADIUS, b.boxShadow = a.TOOLTIP_BOX_SHADOW, b.zIndex = a.TOOLTIP_ZINDEX, b.setProperty && b.setProperty('-webkit-box-shadow', a.TOOLTIP_BOX_SHADOW, null) } return Bc.toolTipDiv }, isToolTipVisible: function() { return Bc.getToolTipDiv().parentNode ? !0 : !1 }, hideToolTip: function() { if (Bc._clearTimeout(), Bc._clearDismiss(), Bc.isToolTipVisible()) { var a = Bc.getToolTipDiv(); a.parentNode && a.parentNode.removeChild(a) } }, showToolTip: function(a, b) { return a && b ? void (Bc.isToolTipVisible() || Bc._reshow_timeout ? Bc._showToolTip(a, b) : (Bc._clearTimeout(), Bc._show_timeout = setTimeout(function() { Bc._showToolTip(a, b) }, Ed.TOOLTIP_INITIAL_DELAY))) : void Bc.hideToolTip() }, _showToolTip: function(a, b) { var c, d, e; if (a.target ? (c = a.clientX, d = a.clientY) : (c = a.x, d = a.y), e = Bc.getToolTipDiv(), Wb.clear(e), b instanceof Element) { var f = b.cloneNode(!0); e.appendChild(f) } else e.innerHTML = b; e.style.left = c + Ed.TOOLTIP_XOFFSET + 'px', e.style.top = d + Ed.TOOLTIP_YOFFSET + 'px', e.parentNode || Ob.body.appendChild(e), Bc._clearDismiss(), Bc._dismiss_timeout = setTimeout(Bc.hideToolTip, Ed.TOOLTIP_DISMISS_DELAY), Bc._clearReshow(), Bc._reshow_timeout = setTimeout(Bc._clearReshow, Ed.TOOLTIP_RESHOW_DELAY) }, _clearDismiss: function() { Bc._dismiss_timeout && (clearTimeout(Bc._dismiss_timeout), Bc._dismiss_timeout = null) }, _clearReshow: function() { Bc._reshow_timeout && (clearTimeout(Bc._reshow_timeout), Bc._reshow_timeout = null) }, _clearTimeout: function() { Bc._show_timeout && (clearTimeout(Bc._show_timeout), Bc._show_timeout = null) }, resetToolTip: function() { Bc.hideToolTip(), Bc.toolTipDiv = null } }; Jb.popup = Bc; var Cc = { handleClicked: function(a, b, c) { if (Qb.isTouchable || b.button === 0) if (c) { var d = Dc(c); d && d.onClick && d.onClick(c, a), a.onClickElement(c, b), a.fireInteractionEvent({ kind: 'clickElement', event: b, element: c }) } else a.onClickBackground(b), a.fireInteractionEvent({ kind: 'clickBackground', event: b }) }, handleDoubleClicked: function(a, b, c) { if ((Qb.isTouchable || b.button === 0) && !a.isEditingElement()) { if (c) { var d = Dc(c); d && d.onDoubleClick && d.onDoubleClick(c, a), a.onDoubleClickElement(c, b), a.fireInteractionEvent({ kind: 'doubleClickElement', event: b, element: c }) } else a.onDoubleClickBackground(b), a.fireInteractionEvent({ kind: 'doubleClickBackground', event: b }); c ? c instanceof Ib.Link && a.isDoubleClickToLinkBundle() ? c.ISubNetwork && a.isDoubleClickToSubNetwork() && !Jb.isCtrlDown(b) ? (a.isDoubleClickToEmptySubNetwork() || c.getChildrenSize() > 0) && a.setCurrentSubNetwork(c, a.isSubNetworkAnimate(), function() { a.fireInteractionEvent({ kind: 'enterSubNetwork', event: b, element: c }) }) : c.reverseBundleExpanded() && a.fireInteractionEvent({ kind: 'bundleLink', event: b, element: c }) : c.ISubNetwork && a.isDoubleClickToSubNetwork() ? (a.isDoubleClickToEmptySubNetwork() || c.getChildrenSize() > 0) && a.setCurrentSubNetwork(c, a.isSubNetworkAnimate(), function() { a.fireInteractionEvent({ kind: 'enterSubNetwork', event: b, element: c }) }) : c instanceof Nd && a.isDoubleClickToGroupExpand() && (c.reverseExpanded(), a.fireInteractionEvent({ kind: 'expandGroup', event: b, element: c })) : a.isDoubleClickToUpSubNetwork() && a.upSubNetwork(a.isSubNetworkAnimate(), function() { a.fireInteractionEvent({ kind: 'upSubNetwork', event: b }) }) } }, handleKeyDown: function(a, b) { Jb.isCtrlDown(b) && b.keyCode == 65 ? (a.isKeyboardSelectEnabled() && a.selectAll().size() > 0 && a.fireInteractionEvent({ kind: 'selectAll' }), Wb.preventDefault(b)) : b.keyCode == 46 ? (a.isKeyboardRemoveEnabled() && a.removeSelection() && a.fireInteractionEvent({ kind: 'removeElement' }), Wb.preventDefault(b)) : Jb.showVersion(b) }, handleLongClicked: function(a, b, c) { if (Qb.isTouchable || b.button === 0) if (c) { var d = Dc(c); d && d.onLongClick && d.onLongClick(c, a), a.onLongClickElement(c, b), a.fireInteractionEvent({ kind: 'longClickElement', event: b, element: c }) } else a.onLongClickBackground(b), a.fireInteractionEvent({ kind: 'longClickBackground', event: b }) } }, Dc = function(a) { if (a && a._image) { if (typeof a._image === 'object') return a._image; var b = Jb.getImageAsset(a._image); if (b) return b._image } return null }; Jb.interaction = Cc; var Ec = function(a) { return a.trim()[0].match(/[mlhvcsqta]/i) ? Kc(a) : Gc(a) }, Fc = {}, Gc = function(a) { var b = Fc[a]; return b || (Fc[a] = b = [], a.trim().split(' ').forEach(function(a) { a = a.split(','), b.push(a.length === 2 ? { x: parseFloat(a[0]), y: parseFloat(a[1]) } : a[0]) }), b) }, Hc = {}, Ic = /[mlhvcsqtaz][\d.,\-\s]*/gi, Jc = /-?(\d)+(\.(\d)+)?/g, Kc = function(a) { var b, c = Hc[a]; return c || (b = a.trim().match(Ic), Hc[a] = c = [], b && b.forEach(function(a) { var b, d = a[0], e = a.match(Jc), f = e && e.length; if (c.push(a = { c: d }), f) switch (e.forEach(function(a, b) { e[b] = parseFloat(a) }), d) { case 'M':case 'm':case 'L':case 'l':for (b = 0; f > b; b += 2)b !== 0 && c.push(a = { c: d === 'M' || d === 'L' ? 'L' : 'l' }), a.x = e[b], a.y = e[b + 1]; break; case 'H':case 'h':for (b = 0; f > b; b++)b !== 0 && c.push(a = { c: d }), a.x = e[b]; break; case 'V':case 'v':for (b = 0; f > b; b++)b !== 0 && c.push(a = { c: d }), a.y = e[b]; break; case 'C':case 'c':for (b = 0; f > b; b += 6)b !== 0 && c.push(a = { c: d }), a.x1 = e[b], a.y1 = e[b + 1], a.x2 = e[b + 2], a.y2 = e[b + 3], a.x = e[b + 4], a.y = e[b + 5]; break; case 'S':case 's':for (b = 0; f > b; b += 4)b !== 0 && c.push(a = { c: d }), a.x2 = e[b], a.y2 = e[b + 1], a.x = e[b + 2], a.y = e[b + 3]; break; case 'Q':case 'q':for (b = 0; f > b; b += 4)b !== 0 && c.push(a = { c: d }), a.x1 = e[b], a.y1 = e[b + 1], a.x = e[b + 2], a.y = e[b + 3]; break; case 'T':case 't':for (b = 0; f > b; b += 2)b !== 0 && c.push(a = { c: d }), a.x = e[b], a.y = e[b + 1] } }), c) }, Lc = function(a, b) { var c, d, e, f, g, h, i, j, k, l, m, n, o = a.transform && Mc(a.transform); return o && o.length && (c = Sb.identity(), o.forEach(function(a) { var b = a[0]; b === 'matrix' ? c.multiply(new Sb(a[1], a[2], a[3], a[4], a[5], a[6])) : b === 'translate' ? c.translate(a[1] || 0, a[2] || 0) : b === 'scale' ? c.scale(a[1] || 1, a[2] || a[1] || 1) : b === 'rotate' ? c.rotate(a[1] || 0, a[2] || 0, a[3] || 0) : b === 'skewX' ? c.skew(a[1] || 0, 0) : b === 'skewY' && c.skew(0, a[1] || 0) })), a.type === 'linear' ? (f = a.x1 || 0, g = a.y1 || 0, h = a.x2 || 0, i = a.y2 || 0, c && (d = c.transform(f, g), f = d.x, g = d.y, d = c.transform(h, i), h = d.x, i = d.y), e = b.createLinearGradient(f, g, h, i)) : a.type === 'radial' && (j = a.fx || 0, k = a.fy || 0, l = a.cx || 0, m = a.cy || 0, n = a.r || 0, a.fx == null && (j = l), a.fy == null && (k = m), e = b.createRadialGradient(j, k, 0, l, m, n)), e && a.stop && a.stop.length && a.stop.forEach(function(a) { e.addColorStop(parseFloat(a.offset), td(a.color, b._color)) }), e }, Mc = function(a) { return a.replace(/[\s\r\t\n]+/gm, ' ').trim().replace(/\)(\s?,\s?)/g, ') ').split(/\s(?=[a-z])/).map(function(a) { return a.replace(')', '').trim().split(/\s*\(\s*|\s+,?\s*|,\s*/).map(function(a, b) { return b === 0 ? a : parseFloat(a) }) }) }, Nc = function(a, b, c, d, e, f, g) { var h, i, j, k, l = 1; typeof b !== 'object' && (i = b, h = Jb.images[b], b = h && h.getImage()), cd(b) ? a.drawImage(h ? h.getImage(c, d.width, d.height) : b, d.x, d.y, d.width, d.height) : b && typeof b === 'object' && (a._data = e, a._view = f, i ? (j = d.width / (b.w && Yc(e, b, b, 'w') || e.getWidth()), k = d.height / (b.h && Yc(e, b, b, 'h') || e.getHeight()), f && (l = f.getSizeZoom ? f.getSizeZoom() * f.getGraphicsZoom() : f.getZoom()), !h._cache || Math.max(j * l, k * l) > 1 ? Oc(a, b, c, d, e, f, g) : a.drawImage(c ? h.getImage(c, d.width, d.height) : h._cache, d.x, d.y, d.width, d.height)) : Oc(a, b, c, d, e, f, g), a._data = null, a._view = null) }, Oc = function(a, b, c, d, e, f, g) { var h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A = e && e.getStyle('image.state'); if (p = a._vector, w = a._color, q = a._fill, r = a._pattern, s = a._lineWidth, t = a._alpha, u = a._sx, v = a._sy, m = b, Yc(e, m, m, 'visible', f) !== !1) { for (a._color = c, h = Yc(e, m, m, 'v', f), i = h && h.length, y = m.w && Yc(e, m, m, 'w') || e.getWidth(), z = m.h && Yc(e, m, m, 'h') || e.getHeight(), n = d.width / y, o = d.height / z, g === !0 ? (a._fill = null, a._pattern = null, a._lineWidth = null, a._alpha = null) : (a._sx = n, a._sy = o), a.save(), a.translate(d.x + d.width / 2, d.y + d.height / 2), (n !== 1 || o !== 1) && a.scale(n, o), m.origin && a.translate((m.origin.x - 0.5) * y, (m.origin.y - 0.5) * z), a._vector = m, m.clip && (a.beginPath(), m.clip === !0 ? a.rect(-(m.origin ? m.origin.x : 0.5) * y, -(m.origin ? m.origin.y : 0.5) * z, y, z) : m.clip.length ? m.clip.forEach(function(b) { a.drawShape(b) }) : a.drawShape(m.clip), a.clip()), Tc(e, m, m, a, f), j = 0, i = h.length; i > j; j++)l = h[j], a._shapeData = l, f && (f._shapeDataIndex = j, l.animate && wb(l, m, e, f)), x = Yc(e, m, l, 'state', f), Yc(e, m, l, 'visible', f) === !1 || x && !(Array.isArray(x) ? x.indexOf(A) >= 0 : x === A) || (k = Qc[l.shape], k && (a.save(), l.shape === 'vector' || l.shape === 'g' ? k(a, l, e, f) : Tc(e, m, l, a, f, function() { k(a, l, e, f) }), a.restore())), f && (f._shapeDataIndex = null), a._shapeData = null; a.restore(), a._vector = p, a._shapeData = null, a._color = w, a._fill = q, a._pattern = r, a._lineWidth = s, a._alpha = t, a._sx = u, a._sy = v } }, Pc = function(a, b, c, d, e) { var f, g, h, i, j, k, l, m, n, o = a._vector, p = o.origin, q = o.w && Yc(d, o, o, 'w') || d.getWidth(), r = o.h && Yc(d, o, o, 'h') || d.getHeight(); if (typeof b === 'string' ? (n = Jb.images[b], n && (h = n.getWidth(), i = n.getHeight())) : (h = b.w && Yc(d, b, b, 'w'), i = b.h && Yc(d, b, b, 'h')), h && i && c) for (j = c.w / h * a._sx, k = c.h / i * a._sy, f = c.x - q / 2 * (a._sx - 1), g = c.y - r / 2 * (a._sy - 1), p && (f -= (p.x - 0.5) * q * (a._sx - 1), g -= (p.y - 0.5) * r * (a._sy - 1)), (a._sx !== 1 || a._sy !== 1) && (a.scale(1 / a._sx, 1 / a._sy), f += ((p ? p.x : 0.5) * q + c.x) * (a._sx - 1), g += ((p ? p.x : 0.5) * r + c.y) * (a._sy - 1)), c = { x: 0, y: 0, width: h, height: i }, l = 0; j > l; l++) for (m = 0; k > m; m++)c.x = l * h + f, c.y = m * i + g, Nc(a, b, null, c, d, e, !0) }, Qc = { line: function(a, b, c, d) { var e, f, g, h, i = Yc(c, a._vector, b, 'p1', d), j = Yc(c, a._vector, b, 'p2', d); i ? (e = Zc(i.length ? i[0] : i.x, a), f = $c(i.length ? i[1] : i.y, a)) : (e = Yc(c, a._vector, b, 'x1', d, !0), f = Yc(c, a._vector, b, 'y1', d, !1)), j ? (g = Zc(j.length ? j[0] : j.x, a), h = $c(j.length ? j[1] : j.y, a)) : (g = Yc(c, a._vector, b, 'x2', d, !0), h = Yc(c, a._vector, b, 'y2', d, !1)), a.moveTo(e, f), a.lineTo(g, h) }, rect: function(a, b, c, d) { var e, f, g, h, i = Yc(c, a._vector, b, 'rect', d), j = Yc(c, a._vector, b, 'r', d); i ? (Array.isArray(i) ? (e = i[0], f = i[1], g = i[2], h = i[3]) : (e = i.x, f = i.y, g = i.w, h = i.h), e = Zc(e, a), f = $c(f, a), g = Zc(g, a), h = $c(h, a)) : (e = Yc(c, a._vector, b, 'x', d, !0), f = Yc(c, a._vector, b, 'y', d, !1), g = Yc(c, a._vector, b, 'w', d, !0), h = Yc(c, a._vector, b, 'h', d, !1)), a.drawRoundRect(e, f, g, h, j), (a._gradientFunc || a._pattern) && (a._rect = { x: e, y: f, w: g, h: h }) }, circle: function(a, b, c, d) { var e = Yc(c, a._vector, b, 'cx', d, !0), f = Yc(c, a._vector, b, 'cy', d, !1), g = a._vector.w && Yc(c, a._vector, a._vector, 'w') || c.getWidth(), h = a._vector.h && Yc(c, a._vector, a._vector, 'h') || c.getHeight(), i = _c(Yc(c, a._vector, b, 'r', d), Math.min(g, h), b, a._vector), j = Yc(c, a._vector, b, 'startAngle', d), k = Yc(c, a._vector, b, 'endAngle', d), l = Yc(c, a._vector, b, 'anticlockwise', d), m = Yc(c, a._vector, b, 'close', d); j == null && (j = 0), k == null && (k = 360), l == null && (l = !1), m && a.moveTo(e, f), a.arc(e, f, i, j / 180 * Math.PI, k / 180 * Math.PI, l), m && a.closePath(), (a._gradientFunc || a._pattern) && (a._rect = { x: e - i, y: f - i, w: 2 * i, h: 2 * i }) }, ellipse: function(a, b, c, d) { var e = Yc(c, a._vector, b, 'cx', d, !0), f = Yc(c, a._vector, b, 'cy', d, !1), g = Yc(c, a._vector, b, 'rx', d, !0), h = Yc(c, a._vector, b, 'ry', d, !1), i = Yc(c, a._vector, b, 'startAngle', d), j = Yc(c, a._vector, b, 'endAngle', d), k = Yc(c, a._vector, b, 'anticlockwise', d), l = Yc(c, a._vector, b, 'close', d); i == null && (i = 0), j == null && (j = 360), k == null && (k = !1), l && a.moveTo(e, f), a.ellipse(e, f, g, h, 0, i / 180 * Math.PI, j / 180 * Math.PI, k), l && a.closePath(), (a._gradientFunc || a._pattern) && (a._rect = { x: e - g, y: f - h, w: 2 * g, h: 2 * h }) }, path: function(a, b, c, d) { var e = Yc(c, a._vector, b, 'data', d); a.drawPath(e) }, text: function(a, b, c, d) { var e = Yc(c, a._vector, b, 'text', d), f = Yc(c, a._vector, b, 'x', d, !0), g = Yc(c, a._vector, b, 'y', d, !1), h = Yc(c, a._vector, b, 'w', d, !0); if (e != null) { e = String(e); var i = e.split('\n'), j = 2 * a.measureText('e').width, k = vb(a, e, h); g -= (k.h / j - 1) / 2 * j, i.forEach(function(b) { if (h) { var c, d, e, i, k, l = b.split(' '), m = l.length, n = ''; for (e = 0; m > e; e++) if (c = l[e] + (e === m - 1 ? '' : ' '), d = n + c, i = a.measureText(d).width, h > i)n = d; else if (i == h)a.fillText(n, f, g), n = '', g += j; else { for (k = 0; k < c.length; k++) if (d = n + c.substr(0, k + 1), a.measureText(d).width > h) { a.fillText(d.substring(0, d.length - 1), f, g), n = c.substring(k, c.length), g += j; break } for (;n.length > 0 && a.measureText(n).width > h;) for (k = 0; k < n.length; k++) if (d = n.substr(0, k + 1), a.measureText(d).width > h) { a.fillText(n.substr(0, k), f, g), n = n.substring(k, n.length), g += j; break } }a.fillText(n, f, g) } else a.fillText(b, f, g); g += j }) } }, draw: function(a, b, c, d) { var e, f, g = b.draw; typeof g === 'string' && ((e = g.match(Wc)) ? (f = 'with(data) { ' + e[1] + ' }', g = Ib.Util.newFunction('g', 'data', 'view', f)) : g = dd[g]), typeof g === 'function' && g.call(a._vector, a, c, d) }, vector: function(a, b, c, d) {
    var e, f, g, h, i, j, k, l, m, n, o, p, q, r = a._vector, s = Yc(c, r, b, 'name', d), t = Yc(c, r, b, 'x', d, !0), u = Yc(c, r, b, 'y', d, !1), v = Yc(c, r, b, 'w', d), w = Yc(c, r, b, 'h', d); if (typeof s === 'string' ? (l = Jb.images[s], k = l && l._image) : k = s,
      k) if (cd(k))v != null && w != null ? a.drawImage(k, t, u, Zc(v, a), $c(w, a)) : a.drawImage(k, t, u); else { for (m = Yc(c, k, k, 'v', d), n = m && m.length, o = k.w && Yc(c, k, k, 'w'), p = k.h && Yc(c, k, k, 'h'), v != null && w != null ? (v = Zc(v, a), w = $c(w, a)) : (v = o, w = p), a.save(), h = a._lineWidth, i = a._fill, j = a._alpha, Tc(c, k, k, a, d), Tc(c, r, b, a, d), a.translate(t, u), a.scale(v / o, w / p), k.origin && a.translate((k.origin.x - 0.5) * o, (k.origin.y - 0.5) * p), k.clip && (a.beginPath(), k.clip === !0 ? a.rect(-(k.origin ? k.origin.x : 0.5) * o, -(k.origin ? k.origin.y : 0.5) * p, o, p) : k.clip.length ? k.clip.forEach(function(b) { a.drawShape(b) }) : a.drawShape(k.clip), a.clip()), q = a._shapeData, a._vector = k, e = 0; n > e; e++)f = m[e], a._shapeData = f, d && (d._shapeDataIndex.length ? d._shapeDataIndex.push(e) : d._shapeDataIndex = [d._shapeDataIndex, e], f.animate && wb(f, r, c, d)), Yc(c, k, f, 'visible', d) !== !1 && (g = Qc[f.shape], g && (a.save(), f.shape === 'vector' || f.shape === 'g' ? g(a, f, c, d) : Tc(c, k, f, a, d, function() { g(a, f, c, d) }), a.restore())), d && d._shapeDataIndex.pop(); a._vector = r, a._shapeData = q, a._lineWidth = h, a._fill = i, a._alpha = j, a.restore() }
  }, g: function(a, b, c, d) { var e, f, g, h, i, j = Yc(c, a._vector, b, 'v', d); j && j.length && (a.save(), f = a._lineWidth, g = a._fill, h = a._alpha, i = a._shapeData, Tc(c, a._vector, b, a, d), j.forEach(function(b) { Yc(c, a._vector, b, 'visible', d) !== !1 && (e = Qc[b.shape], e && (a.save(), a._shapeData = b, b.shape === 'vector' || b.shape === 'g' ? e(a, b, c, d) : Tc(c, a._vector, b, a, d, function() { e(a, b, c, d) }), a.restore())) }), a._lineWidth = f, a._fill = g, a._alpha = h, a._shapeData = i, a.restore()) } }; Qc.image = Qc.vector; var Rc = Object.keys(Qc), Sc = { M: function(a, b) { return a.moveTo(b.x, b.y), a._path_start = b, a._rect && bd(a._rect, b.x, b.y), b }, m: function(a, b, c) { return c && (b = { x: c.x + b.x, y: c.y + b.y }), a.moveTo(b.x, b.y), a._path_start = b, a._rect && bd(a._rect, b.x, b.y), b }, Z: function(a) { return a.closePath(), a._path_start }, z: function(a) { return a.closePath(), a._path_start }, L: function(a, b) { return a.lineTo(b.x, b.y), a._rect && bd(a._rect, b.x, b.y), b }, l: function(a, b, c) { var d = { x: c.x + b.x, y: c.y + b.y }; return a.lineTo(d.x, d.y), a._rect && bd(a._rect, d.x, d.y), d }, H: function(a, b, c) { var d = { x: b.x, y: c.y }; return a.lineTo(d.x, d.y), a._rect && bd(a._rect, d.x, d.y), d }, h: function(a, b, c) { var d = { x: c.x + b.x, y: c.y }; return a.lineTo(d.x, d.y), a._rect && bd(a._rect, d.x, d.y), d }, V: function(a, b, c) { var d = { x: c.x, y: b.y }; return a.lineTo(d.x, d.y), a._rect && bd(a._rect, d.x, d.y), d }, v: function(a, b, c) { var d = { x: c.x, y: c.y + b.y }; return a.lineTo(d.x, d.y), a._rect && bd(a._rect, d.x, d.y), d }, Q: function(a, b) { return a._preQ_x = b.x1, a._preQ_y = b.y1, a.quadraticCurveTo(b.x1, b.y1, b.x, b.y), a._rect && (bd(a._rect, b.x1, b.y1), bd(a._rect, b.x, b.y)), b }, q: function(a, b, c) { var d = { x: c.x + b.x, y: c.y + b.y }, e = a._preQ_x = c.x + b.x1, f = a._preQ_y = c.y + b.y1; return a.quadraticCurveTo(e, f, d.x, d.y), a._rect && (bd(a._rect, e, f), bd(a._rect, d.x, d.y)), d }, T: function(a, b, c) { var d = a._preQ_x = 2 * c.x - a._preQ_x, e = a._preQ_y = 2 * c.y - a._preQ_y; return a.quadraticCurveTo(d, e, b.x, b.y), a._rect && (bd(a._rect, d, e), bd(a._rect, b.x, b.y)), b }, t: function(a, b, c) { var d = { x: c.x + b.x, y: c.y + b.y }, e = a._preQ_x = 2 * c.x - a._preQ_x, f = a._preQ_y = 2 * c.y - a._preQ_y; return a.quadraticCurveTo(e, f, d.x, d.y), a._rect && (bd(a._rect, e, f), bd(a._rect, d.x, d.y)), d }, C: function(a, b) { return a._preC_x = b.x2, a._preC_y = b.y2, a.bezierCurveTo(b.x1, b.y1, b.x2, b.y2, b.x, b.y), a._rect && (bd(a._rect, b.x1, b.y1), bd(a._rect, b.x2, b.y2), bd(a._rect, b.x, b.y)), b }, c: function(a, b, c) { var d = { x: c.x + b.x, y: c.y + b.y }, e = c.x + b.x1, f = c.y + b.y1, g = a._preC_x = c.x + b.x2, h = a._preC_y = c.y + b.y2; return a.bezierCurveTo(e, f, g, h, d.x, d.y), a._rect && (bd(a._rect, e, f), bd(a._rect, g, h), bd(a._rect, d.x, d.y)), d }, S: function(a, b, c) { var d = 2 * c.x - a._preC_x, e = 2 * c.y - a._preC_y; return a._preC_x = b.x2, a._preC_y = b.y2, a.bezierCurveTo(d, e, b.x2, b.y2, b.x, b.y), a._rect && (bd(a._rect, d, e), bd(a._rect, b.x2, b.y2), bd(a._rect, b.x, b.y)), b }, s: function(a, b, c) { var d = { x: c.x + b.x, y: c.y + b.y }, e = 2 * c.x - a._preC_x, f = 2 * c.y - a._preC_y, g = a._preC_x = c.x + b.x2, h = a._preC_y = c.y + b.y2; return a.bezierCurveTo(e, f, g, h, d.x, d.y), a._rect && (bd(a._rect, e, f), bd(a._rect, g, h), bd(a._rect, d.x, d.y)), d } }, Tc = function(a, b, c, d, e, f) { var g, h, i, j, k, l, m, n, o, p, q, r, s, t = Yc(a, b, c, 'line', e), u = Yc(a, b, c, 'fill', e), v = Yc(a, b, c, 'fillRule', e) || 'nonzero', w = Yc(a, b, c, 'gradient', e), x = Yc(a, b, c, 'gradientColor', e), y = Yc(a, b, c, 'pattern', e), z = Yc(a, b, c, 'font', e), A = Yc(a, b, c, 'textAlign', e) || 'center', B = Yc(a, b, c, 'textBaseline', e) || 'middle', C = Yc(a, b, c, 'translate', e), D = Yc(a, b, c, 'rotate', e), E = Yc(a, b, c, 'rotateOrigin', e), F = Yc(a, b, c, 'scale', e), G = Yc(a, b, c, 'transform', e), H = Yc(a, b, c, 'alpha', e), I = d._lineWidth, J = d._fill, K = d._pattern, L = d._alpha, M = d._gradientFunc; if (t ? (g = t.color, h = t.width, i = t.cap, j = t.join, k = t.miterLimit, l = t.dash, m = t.dashOffset) : (g = Yc(a, b, c, 'lineColor', e), h = Yc(a, b, c, 'lineWidth', e), i = Yc(a, b, c, 'lineCap', e), j = Yc(a, b, c, 'lineJoin', e), k = Yc(a, b, c, 'miterLimit', e), l = Yc(a, b, c, 'lineDash', e), m = Yc(a, b, c, 'lineDashOffset', e)), g != null && (d.strokeStyle = td(g, d._color)), h != null && (d.lineWidth = d._lineWidth = e && e.getSizeZoom && !e.zoomManager.sizeChange ? h / e.getSizeZoom() : h), i != null && (d.lineCap = i), j != null && (d.lineJoin = j), k != null && (d.miterLimit = k), l != null && (d.lineDash = l, d.setLineDash(l)), m != null && (d.lineDashOffset = m), y ? d._pattern = y : (u && (d.fillStyle = d._fill = td(u, d._color)), w && (typeof w === 'string' ? o = Yb[w] : (o = Yb[w.type], w.color && (x = w.color), o || (w = Lc(w, d))), d._gradientFunc = o)), z != null && (d.font = z), A != null && (d.textAlign = A), B != null && (d.textBaseline = B), Uc(a, b, c, d, e), G != null) typeof G === 'string' && (G = Mc(G)), G.length && G.forEach(function(a) { var b = a[0]; b === 'matrix' ? d.transform(a[1], a[2], a[3], a[4], a[5], a[6]) : b === 'translate' ? d.translate(a[1] || 0, a[2] || 0) : b === 'scale' ? d.scale(a[1] || 1, a[2] || a[1] || 1) : b === 'rotate' ? a.length > 2 ? (d.translate(a[2], a[3]), d.rotate(a[1]), d.translate(-a[2], -a[3])) : d.rotate(a[1]) : b === 'skewX' ? d.transform(1, 0, Math.tan(a[1] * Math.PI / 180), 1, 0, 0) : b === 'skewY' && d.transform(1, Math.tan(a[1] * Math.PI / 180), 0, 1, 0, 0) }); else { if (C != null && (Array.isArray(C) ? (r = C[0], s = C[1]) : typeof C === 'object' ? (r = C.x, s = C.y) : (r = C, s = 0), r = Zc(r, d), s = $c(s, d), (r !== 0 || s !== 0) && d.translate(r, s)), D != null && D % 360 !== 0) { var N, O; E && (Array.isArray(E) ? (N = E[0], O = E[1]) : typeof E === 'object' ? (N = E.x, O = E.y) : N = O = E, N = Zc(N, d), O = $c(O, d), (N !== 0 || O !== 0) && d.translate(N, O)), d.rotate(D * Math.PI / 180), E && (N !== 0 || O !== 0) && d.translate(-N, -O) }F != null && (Array.isArray(F) ? (p = F[0], q = F[1]) : typeof F === 'object' ? (p = F.x, q = F.y) : p = q = F, (p !== 1 || q !== 1) && d.scale(p, q)) }H != null && (d.globalAlpha = d._alpha = L != null ? L * H : H), f && (d.beginPath(), f(), n = d._rect || c.rect, d._pattern ? (d._lineWidth > 0 && d.stroke(), d.clip(), Pc(d, d._pattern, n, a, e)) : (o && n && (w = o(d, td(u || '#000000', d._color), td(x || '#FFFFFF', d._color), n.x, n.y, n.w, n.h)), w && (d.fillStyle = d._fill = w), d._fill && d.fill(v), d._lineWidth > 0 && d.stroke()), d._lineWidth = I, d._fill = J, d._pattern = K, d._alpha = L, d._gradientFunc = M, d._rect = null) }, Uc = function(a, b, c, d, e) { var f, g, h, i, j = Yc(a, b, c, 'shadow', e); j ? (f = j.offsetX, g = j.offsetY, h = j.blur, i = j.color) : (f = Yc(a, b, c, 'shadowOffsetX', e), g = Yc(a, b, c, 'shadowOffsetY', e), h = Yc(a, b, c, 'shadowBlur', e), i = Yc(a, b, c, 'shadowColor', e)), f != null && (d.shadowOffsetX = f), g != null && (d.shadowOffsetY = g), h != null && (d.shadowBlur = h), i != null && (d.shadowColor = i) }, Vc = /<%=([\s\S]+?)%>/, Wc = /<%([\s\S]+?)%>/, Xc = new RegExp([Vc.source, Wc.source].join('|')), Yc = function(a, c, d, e, f, g, h) { var i, j, k, l, m, n = d[e], o = typeof n; if (o === 'string' && (i = n.match(Xc)) ? (j = 'with(data) { ' + (i[1] ? 'return ' + i[1] : i[2]) + ' }', k = Ib.Util.newFunction('data', 'view', j), n = k.call(c, a, f)) : o === 'function' && (n = n.call(c, a, f)), g === !0 ? (l = c.w && Yc(a, c, c, 'w') || a.getWidth(), (d.rel === !0 || d.rel === b && c.rel) && n <= 1 && n >= -1 ? n *= l : typeof n === 'string' && (n = parseInt(n) / 100 * l), n = n || 0) : g === !1 && (m = c.h && Yc(a, c, c, 'h') || a.getHeight(), (d.rel === !0 || d.rel === b && c.rel) && n <= 1 && n >= -1 ? n *= m : typeof n === 'string' && (n = parseInt(n) / 100 * m), n = n || 0), h !== !1 && f && a && d.animate && a._animates) { var p, q = a._animates, r = f._shapeDataIndex; if (r.length) for (var s = 0; s < r.length; s++)p = r[s], q = q[p]; else p = r; var t = q[p], u = t[e]; if (u) if (Array.isArray(u)) for (var s = u.length - 1; s >= 0; s--) { var v = u[s]; if ((v.stopped || v.time > 0) && v.started) return Hb(v, n) } else if (u.started) return Hb(u, n) } return n }, Zc = function(a, c) { if (!a) return 0; var d = c._vector.w && Yc(c._data, c._vector, c._vector, 'w') || c._data.getWidth(); return (c._shapeData && c._shapeData.rel === !0 || (!c._shapeData || c._shapeData.rel === b) && c._vector.rel) && a <= 1 && a >= -1 ? a * d : typeof a === 'string' ? parseInt(a) / 100 * d : a }, $c = function(a, c) { if (!a) return 0; var d = c._vector.h && Yc(c._data, c._vector, c._vector, 'h') || c._data.getHeight(); return (c._shapeData && c._shapeData.rel === !0 || (!c._shapeData || c._shapeData.rel === b) && c._vector.rel) && a <= 1 && a >= -1 ? a * d : typeof a === 'string' ? parseInt(a) / 100 * d : a }, _c = function(a, c, d, e) { return a ? (d.rel === !0 || d.rel === b && e.rel) && a <= 1 && a >= -1 ? a * c : typeof a === 'string' ? parseInt(a) / 100 * c : a : 0 }, ad = (a.CanvasRenderingContext2D || Lb.Context2d).prototype; ad.drawShape = function(a) { var b = this, c = b._vector, d = b._shapeData, e = b._data, f = b._view, g = Qc[a.shape]; g && (b.save(), b._shapeData = a, a.shape === 'vector' || a.shape === 'g' ? g(b, a, e, f) : Tc(e, c, a, b, f, function() { g(b, a, e, f) }), b._shapeData = d, b.restore()) }, ad.drawPath = function(a) { var b, c, d, e, f, g, h, i, j, k, l, m, n = this; if (typeof a === 'string' && (a = Ec(a)), j = a ? a.length : 0, !(j <= 1)) { if ((n._gradientFunc || n._pattern) && (n._rect = k = { x: 0, y: 0, w: 0, h: 0 }), b = a && a[0] && a[0].c, b || (c = a && a[0] && a[0].x != null, d = a[j - 1] === 'z' || a[j - 1] === 'Z', d && j--), b) { for (e = 0; j > e; e++)g = a[e], h = Sc[g.c], h && (f = h(n, g, f)); n._path_start = null, n._preC_x = null, n._preC_y = null, n._preQ_x = null, n._preQ_y = null } else if (c) { for (i = a[0], l = Zc(i.x, n), m = $c(i.y, n), n.moveTo(l, m), k && bd(k, l, m), e = 1; j > e; e++)i = a[e], l = Zc(i.x, n), m = $c(i.y, n), n.lineTo(l, m), k && bd(k, l, m); d && n.closePath() } else { for (l = Zc(a[0], n), m = $c(a[1], n), n.moveTo(l, m), k && bd(k, l, m), e = 2; j > e; e += 2)l = Zc(a[e], n), m = $c(a[e + 1], n), n.lineTo(l, m), k && bd(k, l, m); d && n.closePath() } return a } }; var bd = function(a, b, c) { var d = Math.min(a.x, b), e = Math.max(a.x + a.w, b), f = Math.min(a.y, c), g = Math.max(a.y + a.h, c); a.x = d, a.y = f, a.w = e - d, a.h = g - f }; ad._fillPath = function(a, b) { var c = this; c.beginPath(), c.fillStyle = a, c.drawPath(b), c.fill() }, ad._fillRect = function(a, b, c, d, e) { var f = this; f.beginPath(), f.fillStyle = a, f.rect(b, c, d, e), f.fill() }, ad.ellipse || (ad.ellipse = function(a, b, c, d) { var e = this, f = 0.5522848, g = c * f, h = d * f, i = a + c, j = b + d, k = a - c, l = b - d; e.moveTo(k, b), e.bezierCurveTo(k, b - h, a - g, l, a, l), e.bezierCurveTo(a + g, l, i, b - h, i, b), e.bezierCurveTo(i, b + h, a + g, j, a, j), e.bezierCurveTo(a - g, j, k, b + h, k, b) }), ad.drawRoundRect = function(a, b, c, d, e) { var f = this; if (!e) return void f.rect(a, b, c, d); var g, h, i, j; if (Array.isArray(e)) if (e.length === 1)g = h = i = j = e[0]; else if (e.length === 2)g = h = e[0], i = j = e[1]; else { if (e.length !== 4) return void f.rect(a, b, c, d); g = e[0], h = e[1], i = e[2], j = e[3] } else g = h = i = j = e; var k = a + c, l = b + d, m = d > c ? 2 * c : 2 * d; g = m > g ? g : m, h = m > h ? h : m, i = m > i ? i : m, j = m > j ? j : m; var n = 0.292893218813453 * j, o = 0.585786437626905 * j; f.moveTo(k, l - j), f.quadraticCurveTo(k, l - o, k - n, l - n), f.quadraticCurveTo(k - o, l, k - j, l), n = 0.292893218813453 * i, o = 0.585786437626905 * i, f.lineTo(a + i, l), f.quadraticCurveTo(a + o, l, a + n, l - n), f.quadraticCurveTo(a, l - o, a, l - i), n = 0.292893218813453 * g, o = 0.585786437626905 * g, f.lineTo(a, b + g), f.quadraticCurveTo(a, b + o, a + n, b + n), f.quadraticCurveTo(a + o, b, a + g, b), n = 0.292893218813453 * h, o = 0.585786437626905 * h, f.lineTo(k - h, b), f.quadraticCurveTo(k - o, b, k - n, b + n), f.quadraticCurveTo(k, b + o, k, b + h), f.lineTo(k, l - j) }; var cd = function(a) { return Lb ? a instanceof Lb || a instanceof Pb : a instanceof HTMLImageElement || a instanceof HTMLCanvasElement || a instanceof HTMLVideoElement }, dd = {}, ed = function(a, b) { typeof b === 'function' && (dd[a] = b) }, fd = function(a, b) { typeof b === 'function' && Rc.indexOf(a) < 0 && (Qc[a] = b) }; !(function() { for (var b = ['webkit', 'moz'], c = 0; c < b.length && !a.requestAnimationFrame; ++c) { var d = b[c]; a.requestAnimationFrame = a[d + 'RequestAnimationFrame'], a.cancelAnimationFrame = a[d + 'CancelAnimationFrame'] || a[d + 'CancelRequestAnimationFrame'] } if (/iP(ad|hone|od).*OS 6/.test(a.navigator.userAgent) || !a.requestAnimationFrame || !a.cancelAnimationFrame) { var e = 0; a.requestAnimationFrame = function(a) { var b = Date.now(), c = Math.max(e + 16, b); return setTimeout(function() { a(e = c) }, c - b) }, a.cancelAnimationFrame = clearTimeout } }()); var gd = Ib.Animate = function(a) { var b = this; b.type = a.type == null ? 'number' : a.type, b.delay = a.delay == null ? 0 : a.delay, b.dur = a.dur == null ? 1e3 : a.dur, b.interval = a.interval == null ? 0 : a.interval, b.finish = a.finish == null ? b.delay + b.dur + b.interval : a.finish, a.finish == null ? b.finish = b.delay + b.dur + b.interval : (b.finish = a.finish, b.interval = b.finish - b.delay - b.dur), b.repeat = a.repeat == null ? 1 : a.repeat, b.reverse = a.reverse == null ? !0 : a.reverse, b.easing = a.easing == null ? 'easeNone' : a.easing, b.onUpdate = a.onUpdate, b.onDone = a.onDone, b.onStop = a.onStop, b.onPlay = a.onPlay, b.attr = a.attr, b.source = a.source, b.filter = a.filter, b.from = a.from, b.to = a.to, b.start = null, b.time = 0, b.total = 0, b.count = 0, b.started = !1, b.stopped = !1, b.paused = !1, b.pausedTime = null, b.pausedTotal = 0, b._speed = 1, b._oldSpeed = null, b._speedTotal = 0, b._speedTime = null, b._percent = 0, b._percentSet = null, b._percentDiff = 0, b.id = id++ }; Jb.ext('twaver.Animate', Object, { play: function() { return yb(this) }, stop: function(a) { return zb(this, a) }, pause: function() { this.stopped || (this.paused = !0) }, resume: function() { this.paused && (this.paused = !1, jd = !0) }, isPaused: function() { return this.paused }, percent: function(a) { return a == null ? this._percentSet || this._percent : (this._percentSet = a < 0 ? 0 : a > 100 ? 100 : a, this.paused && (jd = !0), this.started || (this.play(), this.pause()), this) }, speed: function(a) { return a == null ? this._speed : (a = a < 0 ? 1 : a, a !== this.speed && (this.stopped || (this._oldSpeed = this._speed), this._speed = a), this) }, clone: function() { return new gd(this) }, chain: function(a) { var b, c = this; return c.next = a, a.pre = c, c.onDone ? (b = c.onDone, c.onDone = function() { b.call(c), a.play() }) : c.onDone = function() { a.play() }, c } }); var hd = {}, id = 1, jd = !1; !(function If(a) { requestAnimationFrame(If), jd && (jd = !1, Db(a)) }(0)); var kd = { easeNone: function(a, b, c, d) { return c * a / d + b }, easeIn: function(a, b, c, d) { return c * (a /= d) * a + b }, easeOut: function(a, b, c, d) { return -c * (a /= d) * (a - 2) + b }, easeBoth: function(a, b, c, d) { return (a /= d / 2) < 1 ? c / 2 * a * a + b : -c / 2 * (--a * (a - 2) - 1) + b }, easeInStrong: function(a, b, c, d) { return c * (a /= d) * a * a * a + b }, easeOutStrong: function(a, b, c, d) { return -c * ((a = a / d - 1) * a * a * a - 1) + b }, easeBothStrong: function(a, b, c, d) { return (a /= d / 2) < 1 ? c / 2 * a * a * a * a + b : -c / 2 * ((a -= 2) * a * a * a - 2) + b }, elasticIn: function(a, b, c, d, e, f) { var g; return a === 0 ? b : (a /= d) === 1 ? b + c : (f || (f = 0.3 * d), !e || e < Math.abs(c) ? (e = c, g = f / 4) : g = f / (2 * Math.PI) * Math.asin(c / e), -(e * Math.pow(2, 10 * (a -= 1)) * Math.sin(2 * (a * d - g) * Math.PI / f)) + b) }, elasticOut: function(a, b, c, d, e, f) { var g; return a === 0 ? b : (a /= d) === 1 ? b + c : (f || (f = 0.3 * d), !e || e < Math.abs(c) ? (e = c, g = f / 4) : g = f / (2 * Math.PI) * Math.asin(c / e), e * Math.pow(2, -10 * a) * Math.sin(2 * (a * d - g) * Math.PI / f) + c + b) }, elasticBoth: function(a, b, c, d, e, f) { var g; return a === 0 ? b : (a /= d / 2) === 2 ? b + c : (f || (f = 0.3 * d * 1.5), !e || e < Math.abs(c) ? (e = c, g = f / 4) : g = f / (2 * Math.PI) * Math.asin(c / e), a < 1 ? -0.5 * e * Math.pow(2, 10 * (a -= 1)) * Math.sin(2 * (a * d - g) * Math.PI / f) + b : e * Math.pow(2, -10 * (a -= 1)) * Math.sin(2 * (a * d - g) * Math.PI / f) * 0.5 + c + b) }, backIn: function(a, c, d, e, f) { return f === b && (f = 1.70158), a === e && (a -= 0.001), d * (a /= e) * a * ((f + 1) * a - f) + c }, backOut: function(a, b, c, d, e) { return typeof e === 'undefined' && (e = 1.70158), c * ((a = a / d - 1) * a * ((e + 1) * a + e) + 1) + b }, backBoth: function(a, b, c, d, e) { return typeof e === 'undefined' && (e = 5.70158), (a /= d / 2) < 1 ? c / 2 * a * a * (((e *= 1.525) + 1) * a - e) + b : c / 2 * ((a -= 2) * a * (((e *= 1.525) + 1) * a + e) + 2) + b }, bounceIn: function(a, b, c, d) { return c - kd.bounceOut(d - a, 0, c, d) + b }, bounceOut: function(a, b, c, d) { return (a /= d) < 1 / 2.75 ? 7.5625 * c * a * a + b : 2 / 2.75 > a ? c * (7.5625 * (a -= 1.5 / 2.75) * a + 0.75) + b : 2.5 / 2.75 > a ? c * (7.5625 * (a -= 2.25 / 2.75) * a + 0.9375) + b : c * (7.5625 * (a -= 2.625 / 2.75) * a + 0.984375) + b }, bounceBoth: function(a, b, c, d) { return d / 2 > a ? 0.5 * kd.bounceIn(2 * a, 0, c, d) + b : 0.5 * kd.bounceOut(2 * a - d, 0, c, d) + 0.5 * c + b } }, ld = { draw: function(a, b) { var c = b.getCurrentSubNetwork() == null ? b.getElementBox() : b.getCurrentSubNetwork(), d = c.getStyle('background.type'); d == 'image' ? this.drawImage(a, c, b) : d == 'vector' ? this.drawVector(a, c) : d == 'image.vector' ? (this.drawImage(a, c, b), this.drawVector(a, c)) : d == 'vector.image' && (this.drawVector(a, c), this.drawImage(a, c, b)) }, drawImage: function(a, b, c) { var d = b.getStyle('background.image'), e = Jb.getImageAsset(d); if (e != null) { var f = { x: 0, y: 0, width: a.canvas.width, height: a.canvas.height }; b.getStyle('background.image.stretch') == 'none' && (f.width = e.getWidth(), f.height = e.getHeight()); var g = b.getStyle('background.image.padding'); if (g && Tb.grow(f, g, g), b.getStyle('background.image.stretch') == 'tile') { if (cd(e.getImage())) for (var h = 0; h < f.width; h += e.getWidth()) for (var i = 0; i < f.height; i += e.getHeight())a.drawImage(e.getImage(), h, i) } else (b.getStyle('background.image.stretch') == 'fill' || b.getStyle('background.image.stretch') == 'none') && Nc(a, e.getImage(), null, f, b, c) } }, drawVector: function(a, b) { var c = { x: 0, y: 0, width: a.canvas.width, height: a.canvas.height }, d = b.getStyle('background.outline.width'), e = (b.getStyle('background.outline.color'), b.getStyle('background.vector.fill')), f = b.getStyle('background.vector.fill.color'), g = b.getStyle('background.vector.padding'), h = b.getStyle('background.vector.shape'), i = b.getStyle('background.vector.pattern'); g && Tb.grow(c, g, g); var j = b.getStyle('background.vector.gradient'); e && (j ? Xb.fill(a, f, j, b.getStyle('background.vector.gradient.color'), c) : a.fillStyle = f, Xb.drawVector(a, h, i, c), a.fill()), d > 0 && (a.lineWidth = d, a.strokeStyle = b.getStyle('background.outline.color'), Xb.drawVector(a, h, i, c), a.stroke()) } }, md = Ib.UndoManager = function(a) { var b = this; b._list = [], b._cursor = -1, b._suspended = !1, b._dispatcher = new Ib.EventDispatcher(), b._box = a, b._enabled = !1, b._limit = 100 }; md._IGNORE_PROPERTIES = { alarmState: 1, propagateSeverity: 1, enablePropagation: 1, children: 1, fromAgent: 1, toAgent: 1, bundleLinks: 1 }, Jb.ext('twaver.UndoManager', Object, { setEnabled: function(a) { var b = this, c = b._box; b._enabled != a && (a ? (c.addDataBoxChangeListener(b._handleDataBoxChange, b, !0), c.addDataPropertyChangeListener(b._handleDataPropertyChange, b, !0)) : (c.removeDataBoxChangeListener(b._handleDataBoxChange, b), c.removeDataPropertyChangeListener(b._handleDataPropertyChange, b))), b._enabled = a }, isEnabled: function() { return this._enabled }, undo: function() { var a, b, c, d = this, e = d._list; if (d.canUndo()) { if (a = e[d._cursor--], d._suspended = !0, a.length) for (c = a.length, b = c - 1; b >= 0; b--)a[b].undo(); else a.undo(); d._suspended = !1, d._fire({ kind: 'undo', action: a }) } }, redo: function() { var a, b = this, c = b._list; b.canRedo() && (a = c[++b._cursor], b._suspended = !0, a.length ? a.forEach(function(a) { a.redo() }) : a.redo(), b._suspended = !1, b._fire({ kind: 'redo', action: a })) }, canUndo: function() { return this._cursor >= 0 }, canRedo: function() { return this._cursor < this._list.length - 1 }, _add: function(a) { var b = this, c = b._batch, d = b._list; c ? c.push(a) : (b._cursor !== d.length - 1 && d.splice(b._cursor + 1, d.length), b._limit !== 0 && d.length === b._limit && d.splice(0, 1), d.push(a), b._cursor = d.length - 1, b._fire({ kind: 'add', action: a })) }, _handleDataBoxChange: function(a) { if (!this._suspended) { var b = this, c = b._box, d = a.kind, e = a.data; d === 'add' ? b._add({ undo: function() { var a = this; a.parent = e.getParent(), a.host = e.getHost && e.getHost(), e.getFromNode && (a.fromNode = e.getFromNode(), a.toNode = e.getToNode()), c.remove(e) }, redo: function() { var a = this; a.parent && e.setParent(a.parent), e.getHost && a.host && e.setHost(a.host), e.getFromNode && (a.fromNode && e.setFromNode(a.fromNode), a.toNode && e.setToNode(a.toNode)), c.add(e) } }) : d === 'remove' && b._add({ undo: function() { c.add(e) }, redo: function() { c.remove(e) } }) } }, _handleDataPropertyChange: function(a) { if (!this._suspended) { var b = this, c = a.property, d = c.substr(0, 2), e = a.source, f = a.oldValue, g = a.newValue; d === 'C:' ? (c = c.substr(2), b._add({ undo: function() { e.setClient(c, f) }, redo: function() { e.setClient(c, g) } })) : d === 'S:' ? (c = c.substr(2), b._add({ undo: function() { e.setStyle(c, f) }, redo: function() { e.setStyle(c, g) } })) : md._IGNORE_PROPERTIES[c] || b._add({ undo: function() { e[Jb.setter(c)](f) }, redo: function() { e[Jb.setter(c)](g) } }) } }, size: function() { return this._list.length }, getCursor: function() { return this._cursor }, _fire: function(a) { this._dispatcher.fire(a) }, on: function(a, b, c) { this._dispatcher.add(a, b, c) }, off: function(a, b) { this._dispatcher.remove(a, b) }, isSuspended: function() { return this._suspended }, setSuspended: function(a) { this._suspended = a }, getLimit: function() { return this._limit }, setLimit: function(a) { var b, c, d = this, e = d._list; return a < 0 && (a = 0), a !== d._limit && (b = e.length - a, a > 0 && b > 0 && (c = d._cursor + 1, d._cursor -= b, d._cursor < -1 && (d._cursor = -1), c > 0 && e.splice(0, c), b -= c, b > 0 && e.splice(e.length - b, b)), d._limit = a, d._fire({ kind: 'change' })), d }, clear: function() { var a = this; return a._list = [], a._cursor = -1, a._fire({ kind: 'clear' }), a }, batch: function(a, b) { var c = this; return c.startBatch(), a.call(b), c.endBatch(), c }, startBatch: function() { var a = this; return a._batch || (a._batch = []), a }, endBatch: function() { var a, b = this; return b._batch && (a = b._batch, b._batch = null, a.length && b._add(a)), b } }), Ib.Pool = function(a, b) { this.func = typeof a === 'string' ? function() { return Ob.createElement(a) } : a, this.tagName = a, b != null && (this.redundancy = b) }, Jb.ext('twaver.Pool', Object, { redundancy: 2, currentIndex: -1, get: function() { if (this.currentIndex++, this.currentIndex === this.size()) { var a = this.func(); return a._pool = this, a.style.margin = '0px', a.style.padding = '0px', this.list || (this.list = new nd()), this.list.add(a), a } return this.list.get(this.currentIndex) }, release: function(a) { this.list && this.list.remove(a) >= 0 && (delete a._selectData, delete a._expandData, delete a._checkData, delete a._editInfo, delete a.keepDefault, a.style.margin = '0px', a.style.padding = '0px', a.style.backgroundColor = '', a.removeAttribute('title'), this.tagName === 'img' && a.removeAttribute && (a.removeAttribute('width'), a.removeAttribute('height'), a.removeAttribute('src')), this.list.add(a), this.currentIndex--) }, reset: function() { this.currentIndex = -1 }, clear: function() { if (this.list) for (;this.redundancy + this.currentIndex < this.list.size() - 1;) delete this.list.removeAt(this.list.size() - 1)._pool }, size: function() { return this.list ? this.list.size() : 0 } }); var nd = function() { if (this._as = [], arguments.length === 1) { var a = arguments[0]; if (a instanceof nd && (a = a._as), a instanceof Array) for (var b = a.length, c = 0; b > c; c++) this._as.push(a[c]); else a === !1 ? (this._duplicatable = !1, this._map = {}) : a != null && this._as.push(a) } else if (arguments.length > 1) for (b = arguments.length, c = 0; b > c; c++) this._as.push(arguments[c]) }; Ib.List = nd, Jb.ext('twaver.List', Object, { _duplicatable: !0, size: function() { return this._as.length }, isEmpty: function() { return this._as.length === 0 }, add: function(a, c) { if (!this._duplicatable) { if (this._map[a._id]) return; this._map[a._id] = !0 } return c === b ? this._as.push(a) : this._as.splice(c, 0, a) }, addAll: function(a) { if (a instanceof nd && (a = a._as), a instanceof Array) for (var b = a.length, c = 0; b > c; c++) this.add(a[c]); else this.add(a) }, get: function(a) { return this._as[a] }, remove: function(a) { if (!this._duplicatable && !this._map[a && a._id]) return -1; var b = this._as.indexOf(a); return b >= 0 && b < this._as.length && this.removeAt(b), b }, removeAt: function(a) { var b = this._as.splice(a, 1)[0]; return !this._duplicatable && b && delete this._map[b._id], b }, set: function(a, b) { var c = this._as[a]; if (c === b) return b; if (!this._duplicatable) { if (this._map[b._id]) throw 'duplicate item:' + b; delete this._map[c._id], this._map[b._id] = !0 } return this._as[a] = b, c }, clear: function() { return this._duplicatable || (this._map = {}), this._as.splice(0, this._as.length) }, contains: function(a) { return this._duplicatable ? this.indexOf(a) >= 0 : !!this._map[a && a._id] }, indexOf: function(a) { return this._as.indexOf(a) }, forEach: function(a, b) { for (var c = this._as.length, d = 0; c > d; d++) { var e = this._as[d]; b ? a.call(b, e) : a(e) } }, forEachReverse: function(a, b) { for (var c = this._as.length, d = c - 1; d >= 0; d--) { var e = this._as[d]; b ? a.call(b, e) : a(e) } }, toArray: function(a, b) { if (a) { for (var c = [], d = this._as.length, e = 0; d > e; e++) { var f = this._as[e]; b ? a.call(b, f) && c.push(f) : a(f) && c.push(f) } return c } return this._as.concat() }, toList: function(a, b) { if (a) { for (var c = new nd(), d = this._as.length, e = 0; d > e; e++) { var f = this._as[e]; b ? a.call(b, f) && c.add(f) : a(f) && c.add(f) } return c } return new nd(this) }, sort: function(a) { return a ? this._as.sort(a) : this._as.sort(), this }, toString: function() { return this._as.toString() } }); var od = { shapeMap: {}, init: function() { od.register('arrow.standard', od.createStandardArrow()), od.register('arrow.delta', od.createDeltaArrow()), od.register('arrow.diamond', od.createDiamondArrow()), od.register('arrow.short', od.createShortArrow()), od.register('arrow.slant', od.createSlantArrow()), od.register('arrow.doubledelta', od.createDoubleDeltaArrow()), od.register('arrow.tee', od.createTeeArrow()), od.register('arrow.box', od.createBoxArrow()), od.register('arrow.dot', od.createDotArrow()), od.register('arrow.tail', od.createTailArrow()) }, createStandardArrow: function() { var a = new nd(); return a.add({ x: -1, y: -5 / 9 }), a.add({ x: -0.75, y: 0 }), a.add({ x: -1, y: 5 / 9 }), a.add({ x: 0, y: 0 }), a.add({ x: -1, y: -5 / 9 }), { points: a } }, createDeltaArrow: function() { var a = new nd(); return a.add({ x: -1, y: -5 / 9 }), a.add({ x: -1, y: 5 / 9 }), a.add({ x: 0, y: 0 }), a.add({ x: -1, y: -5 / 9 }), { points: a } }, createDoubleDeltaArrow: function() { var a = new nd(); return a.add({ x: -1, y: -5 / 9 }), a.add({ x: -1, y: 5 / 9 }), a.add({ x: -0.5, y: 0 }), a.add({ x: -0.5, y: -5 / 9 }), a.add({ x: 0, y: 0 }), a.add({ x: -0.5, y: 5 / 9 }), a.add({ x: -0.5, y: 0 }), a.add({ x: -1, y: -5 / 9 }), { points: a } }, createTeeArrow: function() { var a = new nd(); return a.add({ x: -1 / 9, y: -5 / 9 }), a.add({ x: -1 / 9, y: 5 / 9 }), a.add({ x: 0, y: 5 / 9 }), a.add({ x: 0, y: -5 / 9 }), a.add({ x: -1 / 9, y: -5 / 9 }), { points: a } }, createBoxArrow: function() { var a = new nd(); return a.add({ x: -10 / 9, y: -5 / 9 }), a.add({ x: -10 / 9, y: 5 / 9 }), a.add({ x: 0, y: 5 / 9 }), a.add({ x: 0, y: -5 / 9 }), a.add({ x: -10 / 9, y: -5 / 9 }), { points: a } }, createDotArrow: function() { var a = {}, b = new Ib.List(); return b.add({ x: -0.5, y: 0 }), a.points = b, a.draw = function(a, b) { if (a && b && b.points && !(b.points.size() <= 0)) { var c = b.points._as, d = c[0], e = Math.min(b.width, b.height) / 2; a.save(), a.beginPath(), a.arc(d.x, d.y, e, 0, 2 * Math.PI, !1), a.closePath(), a.restore() } }, a }, createTailArrow: function() { for (var a = {}, b = new Ib.List(), c = 30, d = -c / 2; c / 2 > d; d++)b.add({ x: -d / 9, y: 0 }); return a.points = b, a.draw = function(a, b) { if (a && b && b.points && !(b.points.size() <= 0)) for (var c = b.points._as, d = b.shadow, e = b.shadowColor, f = b.shadowXOffset, g = b.shadowYOffset, h = b.shadowBlur, e = b.shadowColor, i = c.length - 4, j = Math.min(b.width, b.height) / 2, k = 0; i > k; k++) { var l = k / i, m = c[k], n = 0.4 * j; a.save(), a.restore(), a.beginPath(), a.globalAlpha = l * l, d && (a.shadowOffsetX = f, a.shadowOffsetY = g, a.shadowBlur = h, a.shadowColor = e), a.arc(m.x, m.y, n, 0, 2 * Math.PI, !1), a.closePath(), a.fill() } }, a }, createDiamondArrow: function() { var a = new nd(); return a.add({ x: -7 / 12, y: 5 / 9 }), a.add({ x: -14 / 12, y: 0 }), a.add({ x: -7 / 12, y: -5 / 9 }), a.add({ x: 0, y: 0 }), a.add({ x: -7 / 12, y: 5 / 9 }), { points: a } }, createShortArrow: function() { var a = new nd(); return a.add({ x: -8 / 12, y: 6 / 9 }), a.add({ x: -5 / 12, y: 0 }), a.add({ x: -8 / 12, y: -6 / 9 }), a.add({ x: 0, y: 0 }), a.add({ x: -8 / 12, y: 6 / 9 }), { points: a } }, createSlantArrow: function() { var a = new nd(); return a.add({ x: -1, y: -5 / 9 }), a.add({ x: -6.5 / 12, y: 0 }), a.add({ x: -0.75, y: 4 / 9 }), a.add({ x: 0, y: 0 }), a.add({ x: -1, y: -5 / 9 }), { points: a } }, register: function(a, b) { od.shapeMap[a] = b }, getShape: function(a) { if (a) return od.shapeMap[a]; throw "shape type can't be null" }, getArrowRect: function(a, b, c, d, e, f, g, h, i) { var j = od.getShape(d); if (j && j.points && !(j.points && j.points.size() <= 0)) { if (g > 0 && g < 1) { var k; k = a.getLineLength ? a.getLineLength() : a._element.getLineLength(), g *= k } else a.getLineLength && (g += od.calculateArrowXOffsetAtEdge(b, a, c, i)); i && (g *= i.getLocationZoom(), h *= i.getLocationZoom()); var l, m, n, o = Tb.calculatePointInfoAlongLine(b, c, g, h), p = o.point, q = o.angle, r = j.points._as, s = r.length, t = new nd(); for (n = new Sb(e, 0, 0, f, p.x, p.y), l = 0; s > l; l++)t.add(n.transform(r[l])); for (n = Tb.createMatrix(q + Math.PI, p.x, p.y), l = 0; s > l; l++)m = t.get(l), m instanceof nd && (m = m._as), m instanceof Array ? (m[0] = n.transform(m[0]), m[1] = n.transform(m[1])) : t.set(l, n.transform(m)); return Tb.getLineRect(t) } }, drawArrow: function(a, b, c, d, e, f, g, h, i, j, k, l, m) { i = i || 0, j = j || 0, k = k || 0; var n = m._element.getStyle('arrow.from.shadow'), o = m._element.getStyle('arrow.from.shadow.color'), p = m._element.getStyle('arrow.from.shadow.xoffset'), q = m._element.getStyle('arrow.from.shadow.yoffset'), r = m._element.getStyle('arrow.from.shadow.blur'), s = k >= 0 && l; if (g || s) { var t = od.getShape(f); if (t && t.points && !(t.points && t.points.size() <= 0)) { var u = Tb.calculatePointInfoAlongLine(d, e, i, j), v = u.point, w = u.angle; g && (a.fillStyle = h), a.beginPath(), s && (a.lineWidth = k, a.strokeStyle = l), od._drawArrow(a, t, w, v, b, c, l, o, n, p, q, r), n && (a.shadowOffsetX = p, a.shadowOffsetY = q, a.shadowBlur = r, a.shadowColor = o), g && a.fill(), s && a.stroke() } } }, _drawArrow: function(a, b, c, d, e, f, g, h, i, j, k, l) { if (b.draw) { for (var m = new Ib.List(), n = 0; n < b.points._as.length; n++)m.add(b.points.get(n)); m.add({ x: -1, y: -0.5 }), m.add({ x: -1, y: 0.5 }), m.add({ x: 0, y: 0.5 }), m.add({ x: 0, y: -0.5 }), m = m._as; var n, o, p, q = m.length, r = new nd(); p = new Sb(e, 0, 0, f, d.x, d.y); for (var n = 0; q > n; n++)r.add(p.transform(m[n])); r = r._as, p = Tb.createMatrix(c + Math.PI, d.x, d.y); for (var s = new nd(), n = 0; q > n; n++)s.add(p.transform(r[n])); b.draw && b.draw(a, { points: s, width: e, height: f, shadowColor: h, shadow: i, shadowXOffset: j, shadowYOffset: k, shadowBlur: l }) } else { var n, o, p, m = b.points._as, q = m.length, r = new nd(); for (p = new Sb(e, 0, 0, f, d.x, d.y), n = 0; q > n; n++)r.add(p.transform(m[n])); r = r._as, p = Tb.createMatrix(c + Math.PI, d.x, d.y); var t = r[0]; for (t = p.transform(t), a.moveTo(t.x, t.y), n = 1; q > n; n++)o = r[n], o instanceof nd && (o = o._as), o instanceof Array ? (o[0] = p.transform(o[0]), o[1] = p.transform(o[1]), a.quadraticCurveTo(o[0].x, o[0].y, o[1].x, o[1].y)) : (o = p.transform(o), a.lineTo(o.x, o.y)) } }, drawLinkArrow: function(a, b, c, d) { c.size() < 2 || (a._element.getStyle('arrow.from') && od._drawFromArrow(a, b, c, d), a._element.getStyle('arrow.to') && od._drawToArrow(a, b, c, d)) }, _drawFromArrow: function(a, b, c, d) { { var e = a._element, f = e.getStyle('arrow.from.fill'), g = e.getStyle('arrow.from.outline.width'); e.getStyle('arrow.from.shadow.color') } if (f || g >= 0) { var h = e.getStyle('arrow.from.width'), i = e.getStyle('arrow.from.height'), j = e.getStyle('arrow.from.xoffset'); if (j > 0 && j < 1) { var k; k = a.getLineLength ? a.getLineLength() : a._element.getLineLength(), j *= k } else a.getLineLength && (j += od.calculateArrowXOffsetAtEdge(c, a, !0, d)); var l = e.getStyle('arrow.from.yoffset'), m = e.getStyle('arrow.from.shape'); d && (j *= d.getLocationZoom(), l *= d.getLocationZoom()), od.drawArrow(b, h, i, c, !0, m, f, e.getStyle('arrow.from.color'), j, l, g, e.getStyle('arrow.from.outline.color'), a) } }, _drawToArrow: function(a, b, c, d) { var e = a._element, f = e.getStyle('arrow.to.fill'), g = e.getStyle('arrow.to.outline.width'); if (f || g >= 0) { var h = e.getStyle('arrow.to.width'), i = e.getStyle('arrow.to.height'), j = e.getStyle('arrow.to.xoffset'); if (j > 0 && j < 1) { var k; k = a.getLineLength ? a.getLineLength() : a._element.getLineLength(), j *= k } else a.getLineLength && (j += od.calculateArrowXOffsetAtEdge(c, a, !1)); var l = e.getStyle('arrow.to.yoffset'), m = e.getStyle('arrow.to.shape'); d && (j *= d.getLocationZoom(), l *= d.getLocationZoom()), od.drawArrow(b, h, i, c, !1, m, f, e.getStyle('arrow.to.color'), j, l, g, e.getStyle('arrow.to.outline.color'), a) } }, calculateArrowXOffsetAtEdge: function(a, b, c, d) { if (a == null || a.size() < 2) return 0; var e = b._element, f = e.getStyle(c ? 'arrow.from.at.edge' : 'arrow.to.at.edge'); if (!f) return 0; var g = b._network.getElementUI(c ? e.getFromAgent() : e.getToAgent()); if (!g) return 0; if (d) var h = g.getZoomBodyRect(); else var h = g._bodyRect; if (h == null) return 0; for (var i = Tb._getPoint(a.get(c ? 0 : a.size() - 1)), j = 0, k = b.getLineLength(); od._containsByInt(h, Math.floor(i.x), Math.floor(i.y), !1) && k > j;)i = Tb.calculatePointInfoAlongLine(a, c, j++).point; return j }, _containsByInt: function(a, c, d, e) { return e = e === b ? !0 : e, e ? c >= Math.floor(a.x) && c <= Math.floor(a.x + a.width) && d >= Math.floor(a.y) && d <= Math.floor(a.y + a.height) : c > Math.floor(a.x) && c < Math.floor(a.x + a.width) && d > Math.floor(a.y) && d < Math.floor(a.y + a.height) } }; od.init(), Jb.arrow = od, Ib.EventDispatcher = function() {}, Jb.ext('twaver.EventDispatcher', null, { contains: function(a, b) { if (this._ls) for (var c, d = 0, e = this._ls.size(); e > d; d++) if (c = this._ls.get(d), a === c.l && b === c.s) return !0; return !1 }, add: function(a, b, c) { var d = { l: a, s: b, a: c }; this._ls || (this._ls = new nd()), this._f ? (this._addPendings || (this._addPendings = new nd()), this._addPendings.add(d)) : d.a ? this._ls.add(d, 0) : this._ls.add(d) }, remove: function(a, b) { this._ls && (this._f ? (this._removePendings || (this._removePendings = new nd()), this._removePendings.add({ l: a, s: b })) : this._remove(a, b)) }, _remove: function(a, b) { for (var c, d = 0, e = this._ls.size(); e > d; d++) if (c = this._ls.get(d), c.l === a && c.s === b) return void this._ls.removeAt(d) }, fire: function(a) { if (this._ls) { var b, c, d = this._ls.size(); for (this._f = !0, b = 0; d > b; b++)c = this._ls.get(b), c.s ? c.l.call(c.s, a) : c.l(a); if (this._f = !1, this._removePendings) { for (d = this._removePendings.size(), b = 0; d > b; b++)c = this._removePendings.get(b), this._remove(c.l, c.s); delete this._removePendings } if (this._addPendings) { for (d = this._addPendings.size(), b = 0; d > b; b++)c = this._addPendings.get(b), c.a ? this._ls.add(c, 0) : this._ls.add(c); delete this._addPendings } } } }), Ib.ImageAsset = function(a, b, c, d, e) {
    this._name = a, this._width = c, this._height = d, this._svg = e, this._edgeData, typeof b === 'string' ? this._src = b : typeof b === 'function' ? this._func = b : cd(b) ? this._image = b : typeof b === 'object' && (this._image = b,
      this._width = b.w || b.width, this._height = b.h || b.height, b.cache !== !1 && zd(b) && (xd(a, b), this._cache = Cd(b)))
  }, Jb.ext('twaver.ImageAsset', Object, { getName: function() { return this._name }, getSrc: function() { return this._src }, isSvg: function() { return this._svg }, getImage: function(a, b, c) { if (!a || !this._image) return this._image; this._map || (this._map = {}); var d; d = this._svg && arguments.length === 3 ? a + ',' + b + ',' + c : a; var e = this._map[d]; return e || (e = ud(this._cache || this._image, sd(a), this._svg ? b || this.getWidth() : this.getWidth(), this._svg ? c || this.getHeight() : this.getHeight()), this._map[d] = e, e) }, getWidth: function() { return this._width }, getHeight: function() { return this._height }, getFunction: function() { return this._func }, _createEdgeData: function(a, b, c) { var d = 300, e = d / b; b > c && (e = d / c); var f = Math.floor(b * e), g = Math.floor(c * e); this.tempCanvas || (this.tempCanvas = Ob.createElement('canvas'), this.ctx = this.tempCanvas.getContext('2d')), this.tempCanvas.width = f, this.tempCanvas.height = g, this.ctx.clearRect(0, 0, f, g), this.ctx.drawImage(a, 0, 0, f, g); for (var h = this.ctx.getImageData(0, 0, f, g), i = !0, j = [], k = 0, b = f, c = g; c > k; k++) for (var l = 0; b > l; l++) { var m = 4 * (k * b + l), n = this._isTransparentPoint(h.data, m), o = i != n || !n && (l == 0 || l == b - 1); if (o) { var p = n ? 1 : 0; j.push({ x: l - p, y: k }) }i = n }i = !0; for (var l = 0, b = f, c = g; b > l; l++) for (var k = 0; c > k; k++) { var m = 4 * (k * b + l), n = this._isTransparentPoint(h.data, m), o = i != n || !n && (k == 0 || k == c - 1); if (o) { var p = n ? 1 : 0; j.push({ x: l, y: k - p }) }i = n } for (var q = b / 2, r = c / 2, s = [], t = 0; t < 360; t++)s.push({ x: q, y: r, dist: 0 }); for (var t = 0, u = j.length; u > t; t++) { var v = j[t], w = this._getPointAngleDegree(v.x, v.y, q, r), x = this._getPointDist(v.x, v.y, q, r); s[w].dist < x && (s[w] = { x: v.x, y: v.y, dist: x }) } for (var t = 0, u = s.length; u > t; t++) { var o = s[t]; o.x = o.x / e, o.y = o.y / e, delete o.dist } return s }, _isTransparentPoint: function(a, b) { return a[b] + a[b + 1] + a[b + 2] + a[b + 3] == 0 }, _getPointAngleDegree: function(a, b, c, d) { var e = c - a, f = d - b, g = Math.atan2(f, e); return g = g / Math.PI * 180, g = parseInt(g) + 180, g %= 360 }, _getPointDist: function(a, b, c, d) { var e = c - a, f = d - b; return Math.sqrt(e * e + f * f) } }); var pd = {}, qd = Wb.createCanvas(); qd.width = 1, qd.height = 1; var rd = qd.getContext('2d'), sd = function(a) { a = a || 'black'; var b, c = pd[a]; return c || (rd.clearRect(0, 0, 1, 1), rd.fillStyle = a, rd.fillRect(0, 0, 1, 1), b = rd.getImageData(0, 0, 1, 1).data, c = pd[a] = { r: b[0], g: b[1], b: b[2], a: b[3] }), c }, td = function(a, b) { if (!b) return a; if (b = sd(b), a = sd(a), Ed.PIXEL_FILTER_FUNCTION) { var c = Ed.PIXEL_FILTER_FUNCTION(a, b); return 'rgba(' + c.r + ',' + c.g + ',' + c.b + ',' + a.a + ')' } return null }, ud = function(a, b, c, d) { var e = Wb.createCanvas(c, d), f = e.getContext('2d'); f.drawImage(a, 0, 0, c, d); try { for (var g = f.getImageData(0, 0, c, d), h = g.data, i = 0, j = h.length; j > i; i += 4) { var k = { r: h[i + 0], g: h[i + 1], b: h[i + 2] }, l = Ed.PIXEL_FILTER_FUNCTION(k, b); h[i + 0] = l.r, h[i + 1] = l.g, h[i + 2] = l.b }f.putImageData(g, 0, 0) } catch (m) { return a } return e }, vd = {}, wd = function(a, b) { if (a) { var c = typeof a; c === 'string' && (a.match(Xc) || Jb.images[a] || (vd[a] || (vd[a] = [])).push(b)) } }, xd = function(a, b) { b.pattern && wd(b.pattern, a), b.v && b.v.forEach(function(b) { b.pattern && wd(b.pattern, a) }) }, yd = function(a) { var b = vd[a]; b && (b.forEach(function(a) { var b = Jb.images[a]; b._cache = Cd(b._image) }), delete vd[a]) }, zd = function(a) { return a.w && a.h ? Ad(a) : !1 }, Ad = function(a) { return !Object.keys(a).some(function(b) { if (/^on/.test(b)) return !1; var c = a[b], d = Bd(c); return d || b !== 'v' || (d = c.some(function(a) { if (a.shape === 'draw') return !0; if (a.shape === 'vector') { var b = Jb.images[a.name]; if (b && !b._cache) return !0 } var c = Object.keys(a).some(function(b) { return b === 'state' || b === 'animate' ? !0 : Bd(a[b]) }); return c ? !0 : a.shape === 'g' && a.v && a.v.length ? !Ad(a) : !1 })), d }) }, Bd = function(a) { var b = typeof a; return b === 'string' && a.match(Xc) || b === 'function' }, Cd = function(a) { var b = Wb.createCanvas(a.w, a.h), c = b.getContext('2d'); return Oc(c, a, null, { x: 0, y: 0, width: a.w, height: a.h }), b }, Dd = Ib.imageUtil = { IMAGE_LOAD_COMPLETED: 'IMAGE_LOAD_COMPLETED', _dispatcher: new Ib.EventDispatcher(), addEventListener: function(a, b, c) { Dd._dispatcher.add(a, b, c) }, removeEventListener: function(a, b) { Dd._dispatcher.remove(a, b) }, images: {}, registerImageByUrl: function(a, b, c) { if (b = b || Dd.getImageType(a), c = c || Dd.getImageName(a), !Dd.images[c]) { Dd.images[c] = a; var d = new Pb(); d.src = a, d.onload = function() { Jb.registerImage(c, d, d.width, d.height, b === !0), d.onload = null, delete Dd.images[c]; var e = { type: Dd.IMAGE_LOAD_COMPLETED, url: a, svg: b, name: c }; Dd._dispatcher.fire(e) } } }, getImageName: function(a) { if (typeof a !== 'string') return null; var b = a.lastIndexOf('/'), c = a; return b >= 0 && (c = a.substring(b + 1)), b = c.lastIndexOf('.'), b >= 0 && (c = c.substring(0, b)), c }, getImageType: function(a) { if (typeof a !== 'string') return null; var b = a.lastIndexOf('/'), c = a; return b >= 0 && (c = a.substring(b + 1)), b = c.lastIndexOf('.'), b >= 0 && (c = c.substring(b + 1)), c } }, Ed = { COLORS: ['#6495ED', '#FFFF00', '#00FFFF', '#FF0000', '#7FFF00', '#E0A580', '#5FC0CB', '#FA00F0', '#A1BC50', '#FFD700', '#4169E1', '#E5A5F5', '#1E90FF', '#696969', '#FF6347', '#00BFEF', '#FFD700', '#80E090', '#5F9EA0', '#A000FF', '#7FAF00', '#228BA2', '#FF00FF', '#7FFFD4', '#800000', '#0000CD', '#20B2AA', '#D2691E', '#6495BD', '#DC143C', '#F0A8AF', '#008B8B', '#800080', '#B8860B', '#4B0082', '#00FF00', '#FFA500', '#FF4500', '#FFFF00', '#9ACD32', '#00008B', '#FF1493', '#ADFF2F', '#4682B4', '#00C0B1'], CALL_LATER_DELAY: 17, SCROLL_BAR_WIDTH: 17, SELECT_COLOR: '#C2CFF1', FOCUS_ON_CLICK: !0, VIEW_POSITION: 'absolute', VIEW_FONT_SIZE: '12px', VIEW_FONT_FAMILY: 'arial, tahoma, helvetica, sans-serif', TOOLTIP_BACKGROUND: 'lightyellow', TOOLTIP_FONT_SIZE: '12px', TOOLTIP_COLOR: 'black', TOOLTIP_PADDING: '4px 8px', TOOLTIP_BORDER: '1px solid gray', TOOLTIP_BORDER_RADIUS: '6px', TOOLTIP_XOFFSET: 12, TOOLTIP_YOFFSET: 12, TOOLTIP_BOX_SHADOW: '0px 0px 3px #AAA', TOOLTIP_ZINDEX: 1e5, TOOLTIP_INITIAL_DELAY: 750, TOOLTIP_RESHOW_DELAY: 500, TOOLTIP_DISMISS_DELAY: 4e3, ZOOM_MAX: 5, ZOOM_MIN: 0.1, ZOOM_INCREMENT: 1.3, ZOOM_ANIMATE: !0, COLUMN_INNER_TEXT: !0, COLUMN_WIDTH: 80, COLUMN_HORIZONTAL_ALIGN: '', COLUMN_PROPERTY_TYPE: 'accessor', COLUMN_VALUE_TYPE: 'string', COLUMN_EDITABLE: !1, COLUMN_SORTABLE: !0, COLUMN_VISIBLE: !0, COLUMN_RESIZABLE: !0, COLUMN_MOVABLE: !0, COLUMN_RENDER_CELL: null, COLUMN_RENDER_HEADER: null, PROPERTY_INNER_TEXT: !0, PROPERTY_HORIZONTAL_ALIGN: '', PROPERTY_PROPERTY_TYPE: 'accessor', PROPERTY_VALUE_TYPE: 'string', PROPERTY_EDITABLE: !1, PROPERTY_CATEGORY_NAME: null, PROPERTY_RENDER_NAME: null, PROPERTY_RENDER_VALUE: null, PROPERTY_RENDER_EDITOR: null, TAB_WIDTH: 100, TAB_CLOSABLE: !1, TAB_RESIZABLE: !0, TAB_MOVABLE: !0, TAB_DISABLED: !1, TAB_VISIBLE: !0, ACCORDION_EXPAND_ICON: 'expand_icon', ACCORDION_COLLAPSE_ICON: 'collapse_icon', ACCORDION_TITLE_HEIGHT: 20, ACCORDION_TITLE_BACKGROUND: '#EBEBEB', ACCORDION_BORDER_BOTTOM_COLOR: 'lightgray', ACCORDION_ICON_POSITION: 'left', TITLEPANE_TITLE_HEIGHT: 20, TITLEPANE_TITLE_BACKGROUND: '#DDD', TITLEPANE_TITLE_HORIZONTAL_ALIGN: 'left', BORDERPANE_HGAP: 0, BORDERPANE_VGAP: 0, CHARTPANE_TITLE_HEIGHT: 20, CHARTPANE_TITLE_HORIZONTAL_ALIGN: 'center', CHARTPANE_LEGEND_ORIENTATION: 'bottom', CHARTPANE_LEGEND_WIDTH: 80, LEGENDPANE_ICON_WIDTH: 10, LEGENDPANE_ICON_HEIGHT: 10, LEGENDPANE_ICON_RADIUS: 0, LEGENDPANE_ROW_HEIGHT: 20, LEGENDPANE_ORIENTATION: 'horizontal', LEGENDPANE_HIDDEN_COLOR: '#BABBBC', LEGENDPANE_SELECT_BACKGROUND_COLOR: '#00007D', LEGENDPANE_SELECT_FOREGROUND_COLOR: '#FFFFFF', CHART_TOOLTIP_ENABLED: !0, CHART_SELECT_TOLERANCE: 0, CHART_XGAP: 6, CHART_YGAP: 6, CHART_XZOOM_ENABLED: !0, CHART_YZOOM_ENABLED: !0, CHART_XTRANSLATE_ENABLED: !0, CHART_YTRANSLATE_ENABLED: !0, CHART_DOUBLE_CLICK_TO_RESET: !0, CHART_VALUE_VISIBLE: !0, CHART_VALUE_FONT: null, CHART_BACKGROUND_VISIBLE: !1, CHART_BACKGROUND_FILL: !0, CHART_BACKGROUND_FILL_COLOR: 'rgba(50,50,50,0.11)', CHART_BACKGROUND_OUTLINE_WIDTH: 1, CHART_BACKGROUND_OUTLINE_COLOR: 'rgba(50,50,50,0.11)', CHART_BACKGROUND_GRADIENT: 'linear.north', CHART_BACKGROUND_GRADIENT_COLOR: '#FFFFFF', PIECHART_TYPE: 'oval', PIECHART_START_ANGLE: 0, PIECHART_SELECT_OFFSET: 5, PIECHART_SHADOW_OFFSET: 1, PIECHART_SHADOW_COLOR: '#C2CFF1', PIECHART_LINE_RATE: 0.5, PIECHART_DONUT_RATE: 0.5, PIECHART_VALUE_POSITION: 0.5, BARCHART_TYPE: 'default', BARCHART_UPPER_LIMIT: null, BARCHART_LOWER_LIMIT: 0, BARCHART_XAXIS_LINE_COLOR: '#808080', BARCHART_XAXIS_LINE_WIDTH: 1, BARCHART_XAXIS_TEXT_COLOR: '#000000', BARCHART_XAXIS_TEXT_FONT: null, BARCHART_YAXIS_LINE_COLOR: '#808080', BARCHART_YAXIS_LINE_WIDTH: 1, BARCHART_YAXIS_TEXT_COLOR: '#000000', BARCHART_YAXIS_TEXT_FONT: null, BARCHART_XSCALE_TEXT_FONT: null, BARCHART_XSCALE_TEXT_COLOR: '#000000', BARCHART_XSCALE_TEXT_ORIENTATION: 'horizontal', BARCHART_YSCALE_TEXT_VISIBLE: !0, BARCHART_YSCALE_TEXT_COLOR: '#000000', BARCHART_YSCALE_TEXT_FONT: null, BARCHART_YSCALE_LINE_COLOR: '#808080', BARCHART_YSCALE_LINE_WIDTH: 0.3, BARCHART_YSCALE_VALUE_GAP: 0, BARCHART_YSCALE_PIXEL_GAP: 20, BARCHART_YSCALE_MIN_TEXT_VISIBLE: !1, LINECHART_INTERRUPTABLE: !0, LINECHART_UPPER_LIMIT: null, LINECHART_LOWER_LIMIT: null, LINECHART_XAXIS_LINE_COLOR: '#808080', LINECHART_XAXIS_LINE_WIDTH: 1, LINECHART_XAXIS_TEXT_COLOR: '#000000', LINECHART_XAXIS_TEXT_FONT: null, LINECHART_YAXIS_LINE_COLOR: '#808080', LINECHART_YAXIS_LINE_WIDTH: 1, LINECHART_YAXIS_TEXT_COLOR: '#000000', LINECHART_YAXIS_TEXT_FONT: null, LINECHART_XSCALE_TEXT_FONT: null, LINECHART_XSCALE_TEXT_COLOR: '#000000', LINECHART_XSCALE_TEXT_ORIENTATION: 'horizontal', LINECHART_XSCALE_LINE_COLOR: '#808080', LINECHART_XSCALE_LINE_WIDTH: 0.3, LINECHART_YSCALE_TEXT_VISIBLE: !0, LINECHART_YSCALE_TEXT_COLOR: '#000000', LINECHART_YSCALE_TEXT_FONT: null, LINECHART_YSCALE_LINE_COLOR: '#808080', LINECHART_YSCALE_LINE_WIDTH: 0.3, LINECHART_YSCALE_VALUE_GAP: 0, LINECHART_YSCALE_PIXEL_GAP: 20, LINECHART_YSCALE_MIN_TEXT_VISIBLE: !1, LINECHART_VALUESPANCOUNT: 1, BUBBLECHART_UPPER_LIMIT: null, BUBBLECHART_LOWER_LIMIT: null, BUBBLECHART_XAXIS_UPPER_LIMIT: null, BUBBLECHART_XAXIS_LOWER_LIMIT: null, BUBBLECHART_XAXIS_LINE_COLOR: '#808080', BUBBLECHART_XAXIS_LINE_WIDTH: 1, BUBBLECHART_XAXIS_TEXT_COLOR: '#000000', BUBBLECHART_XAXIS_TEXT_FONT: null, BUBBLECHART_YAXIS_LINE_COLOR: '#808080', BUBBLECHART_YAXIS_LINE_WIDTH: 1, BUBBLECHART_YAXIS_TEXT_COLOR: '#000000', BUBBLECHART_YAXIS_TEXT_FONT: null, BUBBLECHART_XSCALE_TEXT_FONT: null, BUBBLECHART_XSCALE_TEXT_COLOR: '#000000', BUBBLECHART_XSCALE_TEXT_ORIENTATION: 'horizontal', BUBBLECHART_XSCALE_LINE_COLOR: '#808080', BUBBLECHART_XSCALE_LINE_WIDTH: 0.3, BUBBLECHART_YSCALE_TEXT_VISIBLE: !0, BUBBLECHART_YSCALE_TEXT_COLOR: '#000000', BUBBLECHART_YSCALE_TEXT_FONT: null, BUBBLECHART_YSCALE_LINE_COLOR: '#808080', BUBBLECHART_YSCALE_LINE_WIDTH: 0.3, BUBBLECHART_YSCALE_VALUE_GAP: 0, BUBBLECHART_YSCALE_PIXEL_GAP: 20, BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE: !1, BUBBLECHART_SELECT_SHADOW_COLOR: '#000000', BUBBLECHART_SELECT_SHADOW_OFFSET: 3, RADARCHART_AXIS_TEXT_FONT: null, RADARCHART_AXIS_TEXT_COLOR: '#000000', RADARCHART_AXIS_TEXT_VISIBLE: !0, RADARCHART_SCALE_TEXT_FONT: null, RADARCHART_SCALE_TEXT_COLOR: '#000000', RADARCHART_SCALE_TEXT_VISIBLE: !0, RADARCHART_AXIS_VISIBLE: !0, RADARCHART_AXIS_LINE_COLOR: '#808080', RADARCHART_AXIS_LINE_WIDTH: 3, RADARCHART_AXIS_START_ANGLE: 0, RADARCHART_RING_VISIBLE: !0, RADARCHART_RING_TYPE: 'line', RADARCHART_RING_LINE_COLOR: '#808080', RADARCHART_RING_LINE_WIDTH: 1, RADARCHART_SCALE_COUNT: 5, RADARCHART_SCALE_MAXVALUE: 1, RADARCHART_SCALE_MINVALUE: 0, RADARCHART_ANCHOR_VISIBLE: !0, RADARCHART_AREA_FILL: !0, RADARCHART_AREA_FILL_ALPHA: 0.2, RADARCHART_AREA_SELECT_FILL_ALPHA: 0.5, DIALCHART_UPPER_LIMIT: 100, DIALCHART_LOWER_LIMIT: 0, DIALCHART_START_ANGLE: 0, DIALCHART_END_ANGLE: 360, DIALCHART_INNER_RADIUS: 0.8, DIALCHART_COLOR_RANGE_FILL_COLOR: '#808080', DIALCHART_OUTLINE_WIDTH: 0, DIALCHART_OUTLINE_COLOR: '#808080', DIALCHART_SCALE_INSIDE: !0, DIALCHART_MAJOR_SCALE_COUNT: 11, DIALCHART_MAJOR_SCALE_LINE_WIDTH: 2, DIALCHART_MAJOR_SCALE_LINE_LENGTH: 8, DIALCHART_MAJOR_SCALE_LINE_COLOR: '#000000', DIALCHART_MINOR_SCALE_COUNT: 4, DIALCHART_MINOR_SCALE_LINE_WIDTH: 1, DIALCHART_MINOR_SCALE_LINE_LENGTH: 4, DIALCHART_MINOR_SCALE_LINE_COLOR: '#000000', DIALCHART_SCALE_TEXT_VISIBLE: !0, DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE: !0, DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE: !0, DIALCHART_SCALE_TEXT_FONT: null, DIALCHART_SCALE_TEXT_COLOR: '#000000', DIALCHART_PIVOT_RADIUS: 10, DIALCHART_PIVOT_FILL: !0, DIALCHART_PIVOT_FILL_COLOR: '#808080', DIALCHART_PIVOT_OUTLINE_WIDTH: 0, DIALCHART_PIVOT_OUTLINE_COLOR: '#808080', DIALCHART_VALUE_POSITION: 0.5, DIALCHART_INNER_DARKER_RADIUS: 10, DIALCHART_OUTER_BRIGHTER_RADIUS: 10, DIALCHART_SELECT_SHADOW_COLOR: '#000000', DIALCHART_SELECT_SHADOW_OFFSET: 3, TABPANE_TAB_GAP: 1, TABPANE_TAB_RADIUS: 0, TABPANE_TAB_HEIGHT: 24, TABPANE_TAB_ORIENTATION: 'top', TABPANE_RESIZE_TOLERANCE: 3, TABPANE_TAB_BACKGROUND: '#EBEBEB', TABPANE_DISABLED_COLOR: '#BABBBC', TABPANE_SELECT_BACKGROUND: 'white', TABPANE_MOVE_BACKGROUND: 'rgba(184,211,240,0.7)', TABPANE_INSERT_BACKGROUND: 'orange', TABPANE_HORIZONTAL_ALIGN: 'center', TABPANE_CLOSE_ICON: 'close_icon', TABPANE_SELECT_NEXT_ON_CLOSE: !0, TABPANE_SELECT_NEXT_ON_INVISIBLE: !0, LISTBASE_INNER_TEXT: !0, LIST_ROW_HEIGHT: 19, LIST_INDENT: 2, LIST_ROW_LINE_WIDTH: 0, LIST_ROW_LINE_COLOR: '#DDD', LIST_MAKE_VISIBLE_ON_SELECTED: !0, LIST_KEYBOARD_REMOVE_ENABLED: !0, LIST_KEYBOARD_SELECT_ENABLED: !0, TREE_ROW_HEIGHT: 19, TREE_INDENT: 16, TREE_ROW_LINE_WIDTH: 0, TREE_ROW_LINE_COLOR: '#DDD', TREE_MAKE_VISIBLE_ON_SELECTED: !0, TREE_KEYBOARD_REMOVE_ENABLED: !0, TREE_KEYBOARD_SELECT_ENABLED: !0, TREE_EXPAND_ICON: 'expand_icon', TREE_COLLAPSE_ICON: 'collapse_icon', TREE_LINE_TYPE: 'none', TREE_LINE_THICKNESS: 2, TREE_LINE_COLOR: '#000000', TREE_LINE_ALPHA: 1, TREE_LINE_DASH: [4, 2], TABLE_ROW_HEIGHT: 19, TABLE_ROW_LINE_WIDTH: 1, TABLE_ROW_LINE_COLOR: '#DDD', TABLE_COLUMN_LINE_WIDTH: 1, TABLE_COLUMN_LINE_COLOR: '#DDD', TABLE_MAKE_VISIBLE_ON_SELECTED: !0, TABLE_KEYBOARD_REMOVE_ENABLED: !0, TABLE_KEYBOARD_SELECT_ENABLED: !0, TABLE_EDITABLE: !1, TABLEHEADER_HEIGHT: 24, TABLEHEADER_RESIZE_TOLERANCE: 3, TABLEHEADER_BACKGROUND: '#EBEBEB', TABLEHEADER_MOVE_BACKGROUND: 'rgba(184,211,240,0.7)', TABLEHEADER_INSERT_BACKGROUND: 'orange', TABLEHEADER_COLUMN_LINE_COLOR: '#DDD', TABLEHEADER_SORT_DESC_ICON: 'sort_desc', TABLEHEADER_SORT_ASC_ICON: 'sort_asc', TABLEHEADER_SORT_ICON_POSITION: '98% 50%', TREETABLE_ROW_HEIGHT: 19, TREETABLE_INDENT: 16, TREETABLE_ROW_LINE_WIDTH: 1, TREETABLE_ROW_LINE_COLOR: '#DDD', TREETABLE_COLUMN_LINE_WIDTH: 1, TREETABLE_COLUMN_LINE_COLOR: '#DDD', TREETABLE_MAKE_VISIBLE_ON_SELECTED: !0, TREETABLE_KEYBOARD_REMOVE_ENABLED: !0, TREETABLE_KEYBOARD_SELECT_ENABLED: !0, TREETABLE_EXPAND_ICON: 'expand_icon', TREETABLE_COLLAPSE_ICON: 'collapse_icon', TREETABLE_EDITABLE: !1, PROPERTYSHEET_AUTO_ADJUSTABLE: !0, PROPERTYSHEET_INDENT: 16, PROPERTYSHEET_ROW_HEIGHT: 19, PROPERTYSHEET_ROW_LINE_WIDTH: 1, PROPERTYSHEET_COLUMN_LINE_WIDTH: 1, PROPERTYSHEET_BORDER_COLOR: '#EBEBEB', PROPERTYSHEET_EXPAND_ICON: 'expand_icon', PROPERTYSHEET_COLLAPSE_ICON: 'collapse_icon', PROPERTYSHEET_PROPERTY_NAME_WIDTH: 100, PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN: '', PROPERTYSHEET_SUM_WIDTH: 200, PROPERTYSHEET_RESIZE_TOLERANCE: 3, PROPERTYSHEET_EDITABLE: !1, PROPERTYSHEET_CATEGORIZABLE: !0, PROPERTYSHEET_EXPAND_CATEGORY: !0, POPUPMENU_SUBNENU_ENABLE_ICON: 'submenu_enable_icon', POPUPMENU_SUBNENU_DISABLE_ICON: 'submenu_disable_icon', POPUPMENU_CHECKBOX_SELECTED_ICON: 'checkbox_selected_icon', POPUPMENU_CHECKBOX_UNSELECTED_ICON: 'checkbox_unselected_icon', POPUPMENU_RADIOBUTTON_SELECTED_ICON: 'radiobutton_selected_icon', POPUPMENU_RADIOBUTTON_UNSELECTED_ICON: 'radiobutton_unselected_icon', SPLITPANE_ORIENTATION: 'horizontal', SPLITPANE_POSITION: 0.5, SPLITPANE_DIVIDER_WIDTH: 6, SPLITPANE_DIVIDER_BACKGROUND: '#CCCCFF', SPLITPANE_DIVIDER_OPACITY: 0.5, SPLITPANE_MASK_BACKGROUND: '', SPLITPANE_UP_EXPAND_ICON: 'up_expand_icon', SPLITPANE_DOWN_EXPAND_ICON: 'down_expand_icon', SPLITPANE_LEFT_EXPAND_ICON: 'left_expand_icon', SPLITPANE_RIGHT_EXPAND_ICON: 'right_expand_icon', NODE_WIDTH: 50, NODE_HEIGHT: 50, IMAGE_NODE: 'node_image', IMAGE_GROUP: 'group_image', IMAGE_SUBNETWORK: 'subnetwork_image', ICON_DATABOX: 'databox_icon', ICON_DATA: 'data_icon', ICON_NODE: 'node_icon', ICON_LINK: 'link_icon', ICON_GROUP: 'group_icon', ICON_SUBNETWORK: 'subnetwork_icon', ICON_GRID: 'grid_icon', ICON_BUS: 'bus_icon', ICON_SHAPENODE: 'shapenode_icon', ICON_SHAPELINK: 'shapelink_icon', ICON_LINKSUBNETWORK: 'linksubnetwork_icon', ICON_SHAPESUBNETWORK: 'shapesubnetwork_icon', LAYER_DEFAULT_ID: 'default', LAYER_DEFAULT_NAME: 'default', ATTACHMENT_POINTER_LENGTH: 10, ATTACHMENT_POINTER_WIDTH: 8, ATTACHMENT_CORNER_RADIUS: 5, ATTACHMENT_CONTENT_WIDTH: 30, ATTACHMENT_CONTENT_HEIGHT: 20, ATTACHMENT_POSITION: 'topright.topright', ATTACHMENT_XOFFSET: 0, ATTACHMENT_YOFFSET: 0, ATTACHMENT_PADDING: 0, ATTACHMENT_PADDING_LEFT: 0, ATTACHMENT_PADDING_RIGHT: 0, ATTACHMENT_PADDING_TOP: 0, ATTACHMENT_PADDING_BOTTOM: 0, ATTACHMENT_DIRECTION: 'right', ATTACHMENT_FILL: !1, ATTACHMENT_FILL_COLOR: '#000000', ATTACHMENT_GRADIENT: null, ATTACHMENT_GRADIENT_COLOR: '#FFFFFF', ATTACHMENT_OUTLINE_WIDTH: -1, ATTACHMENT_OUTLINE_COLOR: '#000000', ATTACHMENT_CAP: 'butt', ATTACHMENT_JOIN: 'miter', ATTACHMENT_SHADOWABLE: !0, NETWORK_TOOLTIP_ENABLED: !0, NETWORK_SELECT_MODE: 'mix', NETWORK_MAKE_VISIBLE_ON_SELECTED: !0, NETWORK_NO_AGENT_LINK_VISIBLE: !1, NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE: !1, NETWORK_SUBNETWORK_ANIMATE: !0, NETWORK_SENDTOTOP_ON_SELECTED: !0, NETWORK_KEYBOARD_REMOVE_ENABLED: !0, NETWORK_KEYBOARD_SELECT_ENABLED: !0, NETWORK_RECT_SELECT_ENABLED: !0, NETWORK_DOUBLECLICK_TO_SUBNETWORK: !0, NETWORK_DOUBLECLICK_TO_UPSUBNETWORK: !0, NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK: !0, NETWORK_DOUBLECLICK_TO_LINKBUNDLE: !0, NETWORK_DOUBLECLICK_TO_GROUPEXPAND: !0, NETWORK_SELECT_OUTLINE_COLOR: '#2877A8', NETWORK_SELECT_OUTLINE_WIDTH: 1, NETWORK_SELECT_FILL_COLOR: 'rgba(184,211,240,0.4)', NETWORK_LAZYMOVE_OUTLINE_COLOR: '#2877A8', NETWORK_LAZYMOVE_OUTLINE_WIDTH: 1, NETWORK_LAZYMOVE_FILL_COLOR: 'rgba(184,211,240,0.4)', NETWORK_LAZYMOVE_FILL: !0, NETWORK_LAZYMOVE_ANIMATE: !0, NETWORK_RESIZE_POINT_SIZE: 3, NETWORK_RESIZE_POINT_FILL_COLOR: '#FFFFFF', NETWORK_RESIZE_POINT_OUTLINE_COLOR: '#000000', NETWORK_RESIZE_POINT_OUTLINE_WIDTH: 1, NETWORK_RESIZE_LINE_COLOR: '#000000', NETWORK_RESIZE_LINE_WIDTH: 1, NETWORK_RESIZE_ANIMATE: !0, NETWORK_EDIT_POINT_SIZE: 3, NETWORK_EDIT_POINT_FILL_COLOR: '#FFFF00', NETWORK_EDIT_POINT_OUTLINE_COLOR: '#000000', NETWORK_EDIT_POINT_OUTLINE_WIDTH: 1, NETWORK_EDIT_LINE_COLOR: 'rgba(184,211,240,0.7)', NETWORK_EDIT_LINE_WIDTH: 2, NETWORK_ROTATE_POINT_SIZE: 5, NETWORK_ROTATE_POINT_FILL_COLOR: '#FFFF00', NETWORK_ROTATE_POINT_OFFSET: 15, NETWORK_ROTATE_POINT_OUTLINE_WIDTH: 1, NETWORK_ROTATE_POINT_OUTLINE_COLOR: 'rgba(0,0,0,1)', NETWORK_ROTATE_SCALE_FILL_COLOR: 'rgb(227,166,103)', NETWORK_ROTATE_SCALE_FONT_COLOR: '#FFFFFF', NETWORK_ROTATE_SCALE_WIDTH: 30, NETWORK_ROTATE_SCALE_HEIGHT: 20, NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION: !0, NETWORK_LINK_FLOW_STEPPING: 3, NETWORK_LINK_FLOW_COLOR: '#FF0000', NETWORK_LINK_FLOW_INTERVAL: 600, NETWORK_SELECTION_TOLERANCE: 2, NETWORK_TRANSPARENT_SELECTION_ENABLE: !1, SHOW_ALARM_IN_ATTACHMENT_DIV: !0, SHOW_LABEL_IN_ATTACHMENT_DIV: !1, SHOW_LABEL2_IN_ATTACHMENT_DIV: !1, SHOW_ICON_IN_ATTACHMENT_DIV: !1, SHOW_EDIT_IN_ATTACHMENT_DIV: !1, OVERVIEW_FILL_COLOR: 'rgba(184,211,240,0.4)', OVERVIEW_OUTLINE_COLOR: '#B8D3F0', OVERVIEW_OUTLINE_WIDTH: 1, OVERVIEW_SELECT_COLOR: '#0000FF', OVERVIEW_SELECT_WIDTH: 1, OVERVIEW_PADDING: 1, OVERVIEW_ANIMATE: !0, OVERVIEW_MAX_PACKING_WIDTH: -1, OVERVIEW_MAX_PACKING_HEIGHT: -1, TOUCH_MOVE_THRESHOLD: 5, TOUCH_RECT_SELECT_THRESHOLD: 20, TOUCH_ZOOM_THRESHOLD: 30, LINK_BUNDLE_AGENT_FUNCTION: null, IS_LINK_ADJUSTED_TO_BOTTOM: !1, ELEMENTUI_FUNCTION: function(a, b) { var c = b.getElementUIClass(); return c ? new c(a, b) : null }, CANVASUI_FUNCTION: function(a, b) { var c = b.getCanvasUIClass(); return c ? new c(a, b) : null }, VECTORUI_FUNCTION: function(a, b) { var c = b.getVectorUIClass(); return c ? new c(a, b) : null }, KEEP_DEFAULT_FUNCTION: function(a) { return a.target.keepDefault || a.target.getAttribute('keepDefault') ? !0 : a.target.parentNode && (a.target.parentNode.keepDefault || a.target.parentNode.getAttribute('keepDefault')) ? !0 : a.shiftKey ? !0 : !1 }, SORT_FUNCTION: function(a, c) { if (a === c) return 0; if (a == null && c != null) return 1; if (a != null && c == null) return -1; if (a == null && c == null) return 0; var d, e = typeof a, f = typeof c; return e === 'string' && f === 'string' && (d = a.localeCompare(c)), e === 'number' && f === 'number' && (d = a - c), d === b && (d = ('' + a).localeCompare('' + c)), d > 0 ? 1 : d < 0 ? -1 : 0 }, CENTER_LOCATION: !1, PIXEL_FILTER_FUNCTION: function(a, b) { if (!b) return a; var c = 0.3 * a.r + 0.59 * a.g + 0.11 * a.b; return { r: Math.floor(b.r * c / 255), g: Math.floor(b.g * c / 255), b: Math.floor(b.b * c / 255) } } }; !(function() { var b = Ed; if (a.OverrideTWaverDefaults) for (var c in OverrideTWaverDefaults)b[c] = OverrideTWaverDefaults[c]; b.FONT = b.VIEW_FONT_SIZE && b.VIEW_FONT_FAMILY ? b.VIEW_FONT_SIZE + ' ' + b.VIEW_FONT_FAMILY : Ob.createElement('canvas').getContext('2d').font, b.CHART_VALUE_FONT || (b.CHART_VALUE_FONT = '10px ' + b.VIEW_FONT_FAMILY), b.BARCHART_XSCALE_TEXT_FONT || (b.BARCHART_XSCALE_TEXT_FONT = '10px ' + b.VIEW_FONT_FAMILY), b.BARCHART_YSCALE_TEXT_FONT || (b.BARCHART_YSCALE_TEXT_FONT = '10px ' + b.VIEW_FONT_FAMILY), b.BARCHART_XAXIS_TEXT_FONT || (b.BARCHART_XAXIS_TEXT_FONT = '12px ' + b.VIEW_FONT_FAMILY), b.BARCHART_YAXIS_TEXT_FONT || (b.BARCHART_YAXIS_TEXT_FONT = '12px ' + b.VIEW_FONT_FAMILY), b.LINECHART_XSCALE_TEXT_FONT || (b.LINECHART_XSCALE_TEXT_FONT = '10px ' + b.VIEW_FONT_FAMILY), b.LINECHART_YSCALE_TEXT_FONT || (b.LINECHART_YSCALE_TEXT_FONT = '10px ' + b.VIEW_FONT_FAMILY), b.LINECHART_XAXIS_TEXT_FONT || (b.LINECHART_XAXIS_TEXT_FONT = '12px ' + b.VIEW_FONT_FAMILY), b.LINECHART_YAXIS_TEXT_FONT || (b.LINECHART_YAXIS_TEXT_FONT = '12px ' + b.VIEW_FONT_FAMILY), b.BUBBLECHART_XAXIS_TEXT_FONT || (b.BUBBLECHART_XAXIS_TEXT_FONT = '12px ' + b.VIEW_FONT_FAMILY), b.BUBBLECHART_YAXIS_TEXT_FONT || (b.BUBBLECHART_YAXIS_TEXT_FONT = '12px ' + b.VIEW_FONT_FAMILY), b.BUBBLECHART_XSCALE_TEXT_FONT || (b.BUBBLECHART_XSCALE_TEXT_FONT = '10px ' + b.VIEW_FONT_FAMILY), b.BUBBLECHART_YSCALE_TEXT_FONT || (b.BUBBLECHART_YSCALE_TEXT_FONT = '10px ' + b.VIEW_FONT_FAMILY), b.RADARCHART_AXIS_TEXT_FONT || (b.RADARCHART_AXIS_TEXT_FONT = '12px ' + b.VIEW_FONT_FAMILY), b.RADARCHART_SCALE_TEXT_FONT || (b.RADARCHART_SCALE_TEXT_FONT = '10px ' + b.VIEW_FONT_FAMILY), b.DIALCHART_SCALE_TEXT_FONT || (b.DIALCHART_SCALE_TEXT_FONT = '10px ' + b.VIEW_FONT_FAMILY) }()), Ib.Defaults = Ed, Jb.ext('twaver.Defaults', Object, {}), Ib.Colors = { orange: '#EC6C00', orange_light: '#EF8200', orange_dark: '#EA5404', gray_light: '#666666', gray_dark: '#242424', green_light: '#57AB9A', green_dark: '#238475', blue_light: '#61B6D8', blue_dark: '#0089C1' }, Ib.SerializationSettings = function() { var a = Ib.SerializationSettings; this.isDataBoxSerializable = a.isDataBoxSerializable, this.isLayerBoxSerializable = a.isLayerBoxSerializable, this.isStyleSerializable = a.isStyleSerializable, this.isClientSerializable = a.isClientSerializable, this.isImageSerializable = a.isImageSerializable, this._pm = Jb.clone(a._pm), this._sm = Jb.clone(a._sm), this._cm = Jb.clone(a._cm) }, (function() { var a = Ib.SerializationSettings; a.isDataBoxSerializable = !0, a.isLayerBoxSerializable = !0, a.isStyleSerializable = !0, a.isClientSerializable = !0, a.isImageSerializable = !0, a._pm = {}, a._sm = {}, a._cm = {}, a.setPropertyType = function(b, c) { a._pm[b] = c }, a.getPropertyType = function(b) { return a._pm[b] }, a.setStyleType = function(b, c) { a._sm[b] = c }, a.getStyleType = function(b) { return a._sm[b] }, a.setClientType = function(b, c) { a._cm[b] = c }, a.getClientType = function(b) { return a._cm[b] } }()), Jb.ext('twaver.SerializationSettings', Object, { setPropertyType: function(a, b) { this._pm[a] = b }, getPropertyType: function(a) { return this._pm[a] }, setStyleType: function(a, b) { this._sm[a] = b }, getStyleType: function(a) { return this._sm[a] }, setClientType: function(a, b) { this._cm[a] = b }, getClientType: function(a) { return this._cm[a] } }), Ib.Styles = { _m: {}, setStyle: function(a, b) { b == null ? delete Ib.Styles._m[a] : Ib.Styles._m[a] = b }, getStyle: function(a) { return Ib.Styles._m[a] }, getStyleProperties: function() { return Jb.keys(Ib.Styles._m) } }, (function() {
    var a = function(a, b) { Ib.SerializationSettings.setPropertyType(a, b) }; a('name', 'cdata'), a('name2', 'cdata'), a('icon', 'string'), a('toolTip', 'cdata'), a('parent', 'data'), a('layerId', 'string'), a('alarmState', 'alarmstate'), a('image', 'string'), a('imageUrl', 'string'), a('location', 'point'), a('width', 'number'), a('height', 'number'), a('expanded', 'boolean'), a('host', 'data'), a('fromNode', 'data'), a('toNode', 'data'), a('points', 'list.point'), a('segments', 'list.string'), a('angle', 'number'), a('visible', 'boolean'), a = function(a, b, c) { c == null && (c = b != null ? typeof b : 'string'), Ib.Styles.setStyle(a, b), Ib.SerializationSettings.setStyleType(a, c) }, a('chart.color', null), a('chart.value', 0), a('chart.values', null, 'list.number'), a('chart.value.color', '#000000'), a('chart.value.font', null), a('chart.line.width', 2), a('chart.marker.size', 6), a('chart.marker.shape', 'circle'), a('chart.bubble.shape', 'circle'), a('chart.names', null, 'list.string'), a('chart.xaxis.values', null, 'list.number'), a('chart.yaxis.values', null, 'list.number'), a('dialchart.rear.extension', 0), a('dialchart.base.width', 5), a('dialchart.top.width', 0), a('dialchart.radius', 0.8), a('inner.color', null), a('outer.shape', 'rectangle'), a('outer.color', null), a('outer.width', 2), a('outer.padding', 1), a('outer.padding.left', 0), a('outer.padding.right', 0), a('outer.padding.top', 0), a('outer.padding.bottom', 0), a('outer.cap', 'butt'), a('outer.join', 'miter'), a('outer.style', 'border'), a('shadow.color', null), a('shadow.xoffset', 3), a('shadow.yoffset', 3), a('shadow.blur', 6), a('select.style', 'shadow'), a('select.color', 'rgba(0, 0, 0, 0.7)'), a('select.shape', 'rectangle'), a('select.width', 2), a('select.padding', 2), a('select.padding.left', 0), a('select.padding.right', 0), a('select.padding.top', 0), a('select.padding.bottom', 0), a('select.cap', 'butt'), a('select.join', 'miter'), a('whole.alpha', 1), a('body.type', 'default'), a('network.label', null, 'cdata'), a('image.padding', 0), a('image.padding.left', 0), a('image.padding.right', 0), a('image.padding.top', 0), a('image.padding.bottom', 0), a('image.state', null), a('vector.shape', 'rectangle'), a('vector.fill', !0), a('vector.fill.color', '#CCCCFF'), a('vector.outline.width', -1), a('vector.outline.pattern', null, 'array.number'), a('vector.outline.color', '#5B5B5B'), a('vector.gradient', 'none'), a('vector.gradient.color', '#FFFFFF'), a('vector.padding', 0), a('vector.padding.left', 0), a('vector.padding.right', 0), a('vector.padding.top', 0), a('vector.padding.bottom', 0), a('vector.cap', 'butt'), a('vector.join', 'miter'), a('vector.deep', 0), a('group.shape', 'rectangle'), a('group.fill', !0), a('group.fill.color', '#CCCCFF'), a('group.outline.width', -1), a('group.outline.color', '#5B5B5B'), a('group.gradient', 'none'), a('group.gradient.color', '#FFFFFF'), a('group.padding', 5), a('group.padding.left', 0), a('group.padding.right', 0), a('group.padding.top', 0), a('group.padding.bottom', 0), a('group.cap', 'butt'), a('group.join', 'miter'), a('group.deep', 1), a('group.shape.roundrect.radius', -1), a('label.alpha', 1), a('label.color', '#000000'), a('label.font', null), a('label.position', 'bottom.bottom'), a('label.direction', 'below'), a('label.corner.radius', 0), a('label.pointer.length', 0), a('label.pointer.width', 8), a('label.xoffset', 0), a('label.yoffset', 2), a('label.padding', 0), a('label.padding.left', 0), a('label.padding.right', 0), a('label.padding.top', 0), a('label.padding.bottom', 0), a('label.fill', !1), a('label.fill.color', '#C0C0C0'), a('label.gradient', 'none'), a('label.gradient.color', '#FFFFFF'), a('label.outline.width', -1), a('label.outline.color', '#000000'), a('label.cap', 'butt'), a('label.join', 'miter'), a('label.shadowable', !0), a('label.align', 'center'), a('label.rotate.angle', 0), a('label.maxlength', 0), a('link.label.rotatable', !1), a('label2.alpha', 1), a('label2.color', '#000000'), a('label2.font', null), a('label2.position', 'top.top'), a('label2.direction', 'below'), a('label2.corner.radius', 0), a('label2.pointer.length', 0), a('label2.pointer.width', 8), a('label2.xoffset', 0), a('label2.yoffset', -2), a('label2.padding', 0), a('label2.padding.left', 0), a('label2.padding.right', 0), a('label2.padding.top', 0), a('label2.padding.bottom', 0), a('label2.fill', !1), a('label2.fill.color', '#C0C0C0'), a('label2.gradient', 'none'), a('label2.gradient.color', '#FFFFFF'), a('label2.outline.width', -1), a('label2.outline.color', '#000000'), a('label2.cap', 'butt'), a('label2.join', 'miter'), a('label2.shadowable', !0), a('label2.align', 'center'), a('label2.rotate.angle', 0), a('label2.maxlength', 0), a('link.label2.rotatable', !1), a('icons.names', null, 'array.string'), a('icons.colors', null, 'array.string'), a('icons.position', null, 'array.string'), a('icons.orientation', null, 'array.string'), a('icons.xoffset', [0], 'array.number'), a('icons.yoffset', [0], 'array.number'), a('icons.xgap', [1], 'array.number'), a('icons.ygap', [1], 'array.number'), a('alarm.alpha', 1), a('alarm.color', '#000000'), a('alarm.font', null), a('alarm.position', 'hotspot'), a('alarm.direction', 'aboveright'), a('alarm.corner.radius', 5), a('alarm.pointer.length', 10), a('alarm.pointer.width', 8), a('alarm.xoffset', 0), a('alarm.yoffset', 0), a('alarm.padding', 0), a('alarm.padding.left', 0), a('alarm.padding.right', 0), a('alarm.padding.top', 0), a('alarm.padding.bottom', 0), a('alarm.gradient', 'none'), a('alarm.gradient.color', '#FFFFFF'), a('alarm.outline.width', -1), a('alarm.outline.color', '#000000'), a('alarm.cap', 'butt'), a('alarm.join', 'miter'), a('alarm.shadowable', !0), a('link.color', '#658DC1'), a('link.width', 3), a('link.cap', 'butt'), a('link.join', 'miter'), a('link.type', 'arc'), a('link.pattern', null, 'array.number'), a('link.extend', 20), a('link.control.point', null, 'point'), a('link.bundle.id', 0), a('link.bundle.enable', !0), a('link.bundle.expanded', !0), a('link.bundle.independent', !1), a('link.bundle.offset', 20), a('link.bundle.gap', 12), a('link.bundle.group.gap', 0), a('link.looped.gap', 6), a('link.looped.direction', 'northwest'), a('link.looped.type', 'arc'), a('link.from.position', 'center'), a('link.from.xoffset', 0), a('link.from.yoffset', 0), a('link.from.percent', null), a('link.from.at.edge', !0), a('link.to.position', 'center'), a('link.to.xoffset', 0), a('link.to.yoffset', 0), a('link.to.percent', null), a('link.to.at.edge', !0), a('link.split.by.percent', !0), a('link.split.percent', 0.5), a('link.split.value', 20), a('link.corner', 'round'), a('link.xradius', 8), a('link.yradius', 8), a('link.flow', !1), a('link.flow.converse', !1), a('link.handler.alpha', 1), a('link.handler.color', '#000000'), a('link.handler.font', null), a('link.handler.position', 'topleft.topleft'), a('link.handler.direction', 'below'), a('link.handler.corner.radius', 0), a('link.handler.pointer.length', 0), a('link.handler.pointer.width', 8), a('link.handler.xoffset', 0), a('link.handler.yoffset', 0), a('link.handler.padding', 0), a('link.handler.padding.left', 0), a('link.handler.padding.right', 0), a('link.handler.padding.top', 0), a('link.handler.padding.bottom', 0), a('link.handler.fill', !1), a('link.handler.fill.color', '#C0C0C0'), a('link.handler.gradient', 'none'), a('link.handler.gradient.color', '#FFFFFF'), a('link.handler.outline.width', -1), a('link.handler.outline.color', '#000000'), a('link.handler.cap', 'butt'), a('link.handler.join', 'miter'), a('link.handler.shadowable', !0), a('follower.row.index', 0), a('follower.column.index', 0), a('follower.row.span', 1), a('follower.column.span', 1), a('follower.padding', 0), a('follower.padding.left', 0), a('follower.padding.right', 0), a('follower.padding.top', 0), a('follower.padding.bottom', 0), a('follower.fill.cell', !0), a('follower.cell.position', 'center'), a('glow.blur', 20), a('grid.row.count', 1), a('grid.column.count', 1), a('grid.row.percents', null, 'array.number'), a('grid.column.percents', null, 'array.number'), a('grid.border', 1), a('grid.border.left', 0), a('grid.border.right', 0), a('grid.border.top', 0), a('grid.border.bottom', 0), a('grid.padding', 1), a('grid.padding.left', 0), a('grid.padding.right', 0), a('grid.padding.top', 0), a('grid.padding.bottom', 0), a('grid.fill', !0), a('grid.fill.color', '#C0C0C0'), a('grid.deep', 1), a('grid.cell.deep', -1), a('shapelink.type', 'lineto'), a('shapenode.closed', !1), a('shapenode.pattern', null, 'array.number'), a('bus.style', 'nearby'), a('arrow.from', !1), a('arrow.from.fill', !0), a('arrow.from.shape', 'arrow.standard'), a('arrow.from.color', '#000000'), a('arrow.from.xoffset', 0), a('arrow.from.yoffset', 0), a('arrow.from.width', 12), a('arrow.from.height', 9), a('arrow.from.outline.color', '#000000'), a('arrow.from.outline.width', -1), a('arrow.from.at.edge', !0), a('arrow.from.shadow', !1), a('arrow.from.shadow.color', '#000000'), a('arrow.from.shadow.xoffset', 0), a('arrow.from.shadow.yoffset', 0), a('arrow.from.shadow.blur', 16), a('arrow.to', !1), a('arrow.to.fill', !0), a('arrow.to.shape', 'arrow.standard'), a('arrow.to.color', '#000000'), a('arrow.to.xoffset', 0), a('arrow.to.yoffset', 0), a('arrow.to.width', 12), a('arrow.to.height', 9), a('arrow.to.outline.color', '#000000'), a('arrow.to.outline.width', -1), a('arrow.to.at.edge', !0), a('background.image', null), a('background.type', 'none'), a('background.outline.width', -1), a('background.outline.color', null), a('background.vector.padding', 0), a('background.image.padding', 0), a('background.image.stretch', 'fill'), a('background.vector.fill', null), a('background.vector.fill.color', null), a('background.vector.gradient', !1), a('background.vector.gradient.color', null), a('background.vector.shape', 'rectangle'), a('background.outline.pattern', null, 'array.number'),
    a('attachment.label.style', 'html'), a('attachment.label2.style', 'html'), a('attachment.alarm.style', 'html'), a('attachment.htmllabel.hyperlink', !1), a('attachment.htmllabel2.hyperlink', !1)
  }()), Jb.ext('twaver.Styles', Object, {}), Ib.PropertyChangeDispatcher = function() { this._dispatcher = new Ib.EventDispatcher() }, Jb.ext('twaver.PropertyChangeDispatcher', Object, { addPropertyChangeListener: function(a, b, c) { this._dispatcher.add(a, b, c) }, removePropertyChangeListener: function(a, b) { this._dispatcher.remove(a, b) }, firePropertyChange: function(a, b, c) { if (b == c) return !1; var d = { property: a, oldValue: b, newValue: c, source: this }; return this._dispatcher.fire(d), this.onPropertyChanged(d), !0 }, onPropertyChanged: function(a) {} }), Ib.animate.Animate = function() {}, Jb.ext('twaver.animate.Animate', Object, { current: 0, step: 8, delay: 4, finishFunction: null, shouldBeFinished: !1, getCurrentDelay: function() { return this.delay * this.current + 1 }, action: function(a) {} }), Ib.animate.AnimateProperty = function(a, b, c) { this.objects = a, this.newValues = b, this.finishFunction = c, this.oldValues = new nd(); for (var d = this.objects.size(), e = 0; d > e; e++) { var f = this.objects.get(e); this.oldValues.add(this.getPropertyValue(f)) } }, Jb.ext('twaver.animate.AnimateProperty', Ib.animate.Animate, { action: function(a) { for (var b = this.objects.size(), c = 0; b > c; c++) { var d = this.objects.get(c), e = this.oldValues.get(c), f = this.newValues.get(c); this.currentAction(d, e, f, a) } }, getPropertyValue: function(a) {}, currentAction: function(a, b, c, d) {} }), Ib.animate.AnimateBounds = function(a, b, c) { this.node = a, this.newBounds = b, this.oldBounds = a.getRect(), this.finishFunction = c }, Jb.ext('twaver.animate.AnimateBounds', Ib.animate.Animate, { shouldBeFinished: !0, action: function(a) { var b = this.oldBounds, c = this.newBounds; this.node.setLocation(b.x + (c.x - b.x) * a, b.y + (c.y - b.y) * a), this.node.setSize(b.width + (c.width - b.width) * a, b.height + (c.height - b.height) * a) } }), Ib.animate.AnimateCenterLocation = function(a, b, c) { Ib.animate.AnimateCenterLocation.superClass.constructor.call(this, a, b, c) }, Jb.ext('twaver.animate.AnimateCenterLocation', Ib.animate.AnimateProperty, { getPropertyValue: function(a) { return a.getCenterLocation() }, currentAction: function(a, b, c, d) { var e = b.x + (c.x - b.x) * d, f = b.y + (c.y - b.y) * d; a.setCenterLocation(e, f) } }), Ib.animate.AnimateLocation = function(a, b, c) { Ib.animate.AnimateLocation.superClass.constructor.call(this, a, b, c) }, Jb.ext('twaver.animate.AnimateLocation', Ib.animate.AnimateProperty, { getPropertyValue: function(a) { return a.getLocation() }, currentAction: function(a, b, c, d) { var e = b.x + (c.x - b.x) * d, f = b.y + (c.y - b.y) * d; a.setLocation(e, f) } }), Ib.animate.AnimateScrollPosition = function(a, b, c) { this.view = a, this.oldHorizontalOffset = a.scrollLeft, this.oldVerticalOffset = a.scrollTop, this.newHorizontalOffset = b, this.newVerticalOffset = c }, Jb.ext('twaver.animate.AnimateScrollPosition', Ib.animate.Animate, { action: function(a) { this.view.scrollLeft = this.oldHorizontalOffset + (this.newHorizontalOffset - this.oldHorizontalOffset) * a, this.view.scrollTop = this.oldVerticalOffset + (this.newVerticalOffset - this.oldVerticalOffset) * a } }), Ib.animate.AnimateZoom = function(a, b, c) { this.view = a, this.oldZoom = a.getZoom(), this.newZoom = b, this.finishFunction = c }, Jb.ext('twaver.animate.AnimateZoom', Ib.animate.Animate, { shouldBeFinished: !0, action: function(a) { this.view.setZoom(this.oldZoom + (this.newZoom - this.oldZoom) * a, !1) } }), Ib.animate.AnimateXZoom = function(a, b, c) { this.view = a, this.oldXZoom = a.getXZoom(), this.newXZoom = b, this.finishFunction = c }, Jb.ext('twaver.animate.AnimateXZoom', Ib.animate.Animate, { shouldBeFinished: !0, action: function(a) { this.view.setXZoom(this.oldXZoom + (this.newXZoom - this.oldXZoom) * a, !1) } }), Ib.animate.AnimateYZoom = function(a, b, c) { this.view = a, this.oldYZoom = a.getYZoom(), this.newYZoom = b, this.finishFunction = c }, Jb.ext('twaver.animate.AnimateYZoom', Ib.animate.Animate, { shouldBeFinished: !0, action: function(a) { this.view.setYZoom(this.oldYZoom + (this.newYZoom - this.oldYZoom) * a, !1) } }), Ib.animate.AnimateXYZoom = function(a, b, c, d) { this.view = a, this.oldXZoom = a.getXZoom(), this.newXZoom = b, this.oldYZoom = a.getYZoom(), this.newYZoom = c, this.finishFunction = d }, Jb.ext('twaver.animate.AnimateXYZoom', Ib.animate.Animate, { shouldBeFinished: !0, action: function(a) { this.view.setXZoom(this.oldXZoom + (this.newXZoom - this.oldXZoom) * a, !1), this.view.setYZoom(this.oldYZoom + (this.newYZoom - this.oldYZoom) * a, !1) } }), Ib.animate.AnimateSubNetwork = function(a, b, c) { this.network = a, this.subNetwork = b, this.finishFunction = c }, Jb.ext('twaver.animate.AnimateSubNetwork', Ib.animate.Animate, { shouldBeFinished: !0, action: function(a) { a > 0.5 ? (this.network.getView().style.opacity = 2 * a - 1, this.network._setCurrentSubNetwork(this.subNetwork)) : this.network.getView().style.opacity = 1 - 2 * a } }), Ib.animate.AnimateManager = { timer: null, animate: null, start: function(a, b) { var c = Ib.animate.AnimateManager; a.current < 0 && (a.current = 0), b ? Jb.callLater(c.startImpl, null, [a], b) : c.startImpl(a) }, startImpl: function(a) { var b = Ib.animate.AnimateManager; b.animate && b.endAnimate(), b.animate = a, b.timer = setTimeout(b.tick, a.getCurrentDelay()) }, tick: function() { var a = Ib.animate.AnimateManager, b = a.animate; if (b) { if (b.current < 0) return void b.current++; b.current < b.step && (b.current++, b.action(b.current / b.step), a.timer = setTimeout(a.tick, b.getCurrentDelay())), b.current >= b.step && a.endAnimate() } }, endAnimate: function() { var a = Ib.animate.AnimateManager; if (a.animate) { a.animate.shouldBeFinished && a.animate.current < a.animate.step && (a.animate.current = a.animate.step, a.animate.action(a.animate.current / a.animate.step)); var b = a.animate.finishFunction; a.animate = null, a.timer && (clearTimeout(a.timer), a.timer = null), b && b() } else a.timer && (clearTimeout(a.timer), a.timer = null) } }, Ib.DataBox = function(a) { Ib.DataBox.superClass.constructor.apply(this, arguments), arguments.length === 1 && (this._name = a), this._dataList = new nd(), this._dataMap = {}, this._rootList = new nd(), this._rootMap = {}, this._clientMap = {}, this._dataBoxChangeDispatcher = new Ib.EventDispatcher(), this._dataPropertyChangeDispatcher = new Ib.EventDispatcher(), this._hierarchyChangeDispatcher = new Ib.EventDispatcher(), this._selectionModel = new Ib.SelectionModel(this) }, Jb.ext('twaver.DataBox', Ib.PropertyChangeDispatcher, { IClient: !0, __client: 1, __new: 1, _limit: -1, _name: 'DataBox', _icon: Ed.ICON_DATABOX, __accessor: ['name', 'icon', 'toolTip'], getSelectionModel: function() { return this._selectionModel }, size: function() { return this._dataList.size() }, isEmpty: function() { return this._dataList.isEmpty() }, getLimit: function() { return this._limit }, setLimit: function(a) { var b = this._limit; this._limit = a, this.firePropertyChange('limit', b, a), this._checkLimit() }, _checkLimit: function() { this._limit >= 0 && this.size() > this._limit && this.removeFirst(this.size() - this._limit) }, removeFirst: function(a) { for (arguments.length === 0 && (a = 1); a > 0 && this._dataList.size() > 0;) { var b = this._dataList.get(0); this.remove(b), a-- } }, getSiblings: function(a) { if (!this.contains(a)) throw a + " dosen't belong to this dataBox"; var b = a.getParent(); return b ? b.getChildren() : this._rootList }, getRoots: function() { return this._rootList }, getSiblingIndex: function(a) { return a.getParent() ? a.getParent().getChildren().indexOf(a) : this._rootList.indexOf(a) }, getDatas: function() { return this._dataList }, getDataAt: function(a) { return this._dataList.get(a) }, toDatas: function(a, b) { return this._dataList.toList(a, b) }, forEach: function(a, b) { this._dataList.forEach(a, b) }, forEachReverse: function(a, b) { this._dataList.forEachReverse(a, b) }, forEachByDepthFirst: function(a, b, c) { if (b) this._depthFirst(a, b, c); else for (var d = this._rootList.size(), e = 0; d > e; e++) { var f = this._rootList.get(e); if (this._depthFirst(a, f, c) === !1) return } }, _depthFirst: function(a, b, c) { for (var d = b.getChildrenSize(), e = 0; d > e; e++) { var f = b.getChildAt(e); if (this._depthFirst(a, f, c) === !1) return !1 } if (c) { if (a.call(c, b) === !1) return !1 } else if (a(b) === !1) return !1 }, forEachByBreadthFirst: function(a, b, c) { var d = new nd(); for (b ? d.add(b) : this._rootList.forEach(d.add, d); d.size() > 0;) if (b = d.removeAt(0), b.getChildren().forEach(d.add, d), c) { if (a.call(c, b) === !1) return } else if (a(b) === !1) return }, add: function(a, b) { if (a) { arguments.length === 1 && (b = -1); var c = a.getId(); if (this._dataMap.hasOwnProperty(c)) throw "Data with ID '" + c + "' already exists"; this._dataBoxChangeDispatcher.fire({ kind: 'preAdd', data: a }), this._dataMap[c] = a, this._dataList.add(a), a.getParent() || (this._rootMap[c] = a, b >= 0 ? this._rootList.add(a, b) : this._rootList.add(a)), a.addPropertyChangeListener(this.handleDataPropertyChange, this, !0), this._dataBoxChangeDispatcher.fire({ kind: 'add', data: a }), this._checkLimit() } }, addByDescendant: function(a) { this.add(a), a.getChildren().size() > 0 && a.getChildren().forEach(function(a) { this.addByDescendant(a) }, this) }, remove: function(a) { this.removeById(a.getId()) }, removeSelection: function() { this._selectionModel.toSelection().forEach(function(a) { this.remove(a) }, this) }, removeById: function(a) { var b = this.getDataById(a); b && (this._dataBoxChangeDispatcher.fire({ kind: 'preRemove', data: b }), b instanceof Ib.Link && (b.setFromNode(null), b.setToNode(null)), b instanceof Ld && b.getLinks() && b.getLinks().toList().forEach(function(a) { this.remove(a) }, this), b instanceof Ld && b.getFollowers() && b.getFollowers().toList().forEach(function(a) { a.setHost(null) }), b instanceof Ib.Follower && b.getHost() && b.setHost(null), b.toChildren().forEach(function(a) { this.remove(a) }, this), b.getParent() && b.getParent().removeChild(b), this._dataList.remove(b), delete this._dataMap[a], this._rootMap[a] && (delete this._rootMap[a], this._rootList.remove(b)), this._dataBoxChangeDispatcher.fire({ kind: 'remove', data: b }), b.removePropertyChangeListener(this.handleDataPropertyChange, this)) }, clear: function() { if (this._dataList.size() > 0) { this._dataList.forEach(function(a) { a.removePropertyChangeListener(this.handleDataPropertyChange, this) }, this); var a = this._dataList.toList(); this._dataList.clear(), this._dataMap = {}, this._rootList.clear(), this._rootMap = {}, this._dataBoxChangeDispatcher.fire({ kind: 'clear', datas: a }) } }, getDataById: function(a) { return this._dataMap[a] }, containsById: function(a) { return this._dataMap.hasOwnProperty(a) }, contains: function(a) { return a ? this._dataMap[a._id] === a : !1 }, moveTo: function(a, b) { if (!this.contains(a)) throw a + " dosen't belong to this dataBox"; var c = this.getSiblings(a), d = c.indexOf(a); d === b || d < 0 || b >= 0 && b <= c.size() && (c.remove(a), b > c.size() && b--, c.add(a, b), this._hierarchyChangeDispatcher.fire({ data: a, oldIndex: d, newIndex: b })) }, moveUp: function(a) { var b = this.getSiblings(a); this.moveTo(a, b.indexOf(a) - 1) }, moveDown: function(a) { var b = this.getSiblings(a); this.moveTo(a, b.indexOf(a) + 1) }, moveToTop: function(a) { this.moveTo(a, 0) }, moveToBottom: function(a) { var b = this.getSiblings(a); this.moveTo(a, b.size()) }, moveSelectionUp: function(a) { a || (a = this._selectionModel); var b = new nd(); yc.findMoveUpDatas(a, b, this._rootList), b.forEach(this.moveUp, this) }, moveSelectionDown: function(a) { a || (a = this._selectionModel); var b = new nd(); yc.findMoveDownDatas(a, b, this._rootList), b.forEach(this.moveDown, this) }, moveSelectionToTop: function(a) { a || (a = this._selectionModel); var b = new nd(); yc.findMoveToTopDatas(a, b, this._rootList), b.forEach(this.moveToTop, this) }, moveSelectionToBottom: function(a) { a || (a = this._selectionModel); var b = new nd(); yc.findMoveToBottomDatas(a, b, this._rootList), b.forEach(this.moveToBottom, this) }, handleDataPropertyChange: function(a) { var b = a.source; if (a.property === 'parent') { var c = b.getId(); b.getParent() ? this._rootMap[c] && (delete this._rootMap[c], this._rootList.remove(b)) : this._rootMap[c] || (this._rootMap[c] = b, this._rootList.add(b)) } this.onDataPropertyChanged(b, a), this._dataPropertyChangeDispatcher.fire(a) }, onDataPropertyChanged: function(a, b) {}, addDataBoxChangeListener: function(a, b, c) { this._dataBoxChangeDispatcher.add(a, b, c) }, removeDataBoxChangeListener: function(a, b) { this._dataBoxChangeDispatcher.remove(a, b) }, addDataPropertyChangeListener: function(a, b, c) { this._dataPropertyChangeDispatcher.add(a, b, c) }, removeDataPropertyChangeListener: function(a, b) { this._dataPropertyChangeDispatcher.remove(a, b) }, addHierarchyChangeListener: function(a, b, c) { this._hierarchyChangeDispatcher.add(a, b, c) }, removeHierarchyChangeListener: function(a, b) { this._hierarchyChangeDispatcher.remove(a, b) }, getRandomData: function(a) { if (a) { for (var b = new Ib.List(), c = 0; c < this._dataList.size() - 1; c++) { var d = this._dataList.get(c); d instanceof a && b.add(d) } if (b.size() == 0) return null } var e = a ? b.get(parseInt(Ib.Util.random() * b.size())) : this._dataList.get(parseInt(Ib.Util.random() * this._dataList.size())); return e } }), Ib.ElementBox = function(a) { Ib.ElementBox.superClass.constructor.apply(this, arguments), this._styleMap = {}, this._alarmBox = new Ib.AlarmBox(this), this._layerBox = new Ib.LayerBox(this), this._alarmStatePropagator = new Ib.AlarmStatePropagator(this), this._alarmStatePropagator.setEnable(!0), this._indexChangeDispatcher = new Ib.EventDispatcher(), this._undoManager = new Ib.UndoManager(this) }, Ib.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY = { fromAgent: 1, toAgent: 1, expanded: 1, parent: 1, host: 1 }, Jb.ext('twaver.ElementBox', Ib.DataBox, { IStyle: !0, __style: 1, _name: 'ElementBox', add: function(a, b) { if (a) { if (!a.IElement) throw 'Only IElement can be added into ElementBox'; Ib.ElementBox.superClass.add.apply(this, arguments), this.adjustElementIndex(a) } }, onDataPropertyChanged: function(a, b) { Ib.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[b.property] && this.adjustElementIndex(a), Ib.ElementBox.superClass.onDataPropertyChanged.apply(this, arguments) }, addIndexChangeListener: function(a, b, c) { this._indexChangeDispatcher.add(a, b, c) }, removeIndexChangeListener: function(a, b) { this._indexChangeDispatcher.remove(a, b) }, sendToTop: function(a) { if (this.contains(a)) { if (a !== this.getDatas().get(this.size() - 1)) { var b = this.getDatas().indexOf(a); this.getDatas().removeAt(b), this.getDatas().add(a), this._indexChangeDispatcher.fire({ element: a, oldIndex: b, newIndex: this.size() - 1 }) }a instanceof Ib.Link && (a.getFromAgent() && !a.getFromAgent().isAdjustedToBottom() && this.sendToTop(a.getFromAgent()), a.getToAgent() && !a.getToAgent().isAdjustedToBottom() && this.sendToTop(a.getToAgent())), a instanceof Ld && a.getFollowers() && a.getFollowers().forEach(function(b) { b.isRelatedTo(a) || a instanceof Ib.Follower && b.isLoopedHostOn(a) || this.sendToTop(b) }, this), a.ISubNetwork || a instanceof Nd && !a.isExpanded() || a.getChildren().forEach(function(a) { a instanceof Ib.Link || this.sendToTop(a) }, this) } }, sendToBottom: function(a, b) { if (a !== b && this.contains(a) && (!b || this.contains(b))) { var c = this.getDatas().remove(a), d = 0; b && (d = this.getDatas().indexOf(b)), this.getDatas().add(a, d), c != d && (this._indexChangeDispatcher.fire({ element: a, oldIndex: c, newIndex: d }), !a.getParent() || a.getParent().ISubNetwork || a.getParent() instanceof Ib.Link || this.sendToBottom(a.getParent(), a)) } }, fireIndexChange: function(a, b, c) { this._indexChangeDispatcher.fire({ element: a, oldIndex: b, newIndex: c }) }, adjustElementIndex: function(a) { this.contains(a) && (a.isAdjustedToBottom() ? (this.sendToBottom(a), a.getChildren().forEach(this.adjustElementIndex, this)) : this.sendToTop(a)) }, forEachByLayer: function(a, b, c) { var d = this.size(), e = this.getDatas(); if (b) for (var f = 0; d > f; f++) { var g = e.get(f); if (this._layerBox.getLayerByElement(g) === b) if (c) { if (a.call(c, g) === !1) return } else if (a(g) === !1) return } else this._layerBox.forEachByDepthFirst(function(b) { for (var f = 0; d > f; f++) { var g = e.get(f); if (this._layerBox.getLayerByElement(g) === b) if (c) { if (a.call(c, g) === !1) return } else if (a(g) === !1) return } }, null, this) }, forEachByLayerReverse: function(a, b, c) { var d = new nd(); this.forEachByLayer(function(a) { d.add(a, 0) }, b), d.forEach(a, c) }, getLayerBox: function() { return this._layerBox }, getAlarmBox: function() { return this._alarmBox }, getAlarmStatePropagator: function() { return this._alarmStatePropagator }, startBatch: function(a, b) { Ib._isInitializing = !0, Ib._bundleLinks = {}, Ib._links = {}, a.call(b); var c, d; for (var e in Ib._links)c = Ib._links[e], c._checkAgentNodeImpl(); for (var e in Ib._bundleLinks)d = Ib._bundleLinks[e], vc.resetBundleLinks(d[0], d[1]); Ib._bundleLinks = null, Ib._links = null, Ib._isInitializing = !1 }, getUndoManager: function() { return this._undoManager } }), Ib.SelectionModel = function(a) { Ib.SelectionModel.superClass.constructor.apply(this, arguments), this._selectionMode = 'multipleSelection', this._selectionList = new nd(), this._selectionChangeDispatcher = new Ib.EventDispatcher(), this._selectionMap = {}, this._setDataBox(a) }, Jb.ext('twaver.SelectionModel', Ib.PropertyChangeDispatcher, { getSelectionMode: function() { return this._selectionMode }, setSelectionMode: function(a) { if (this._selectionMode !== a && (a === 'noneSelection' || a === 'singleSelection' || a === 'multipleSelection')) { this.clearSelection(); var b = this._selectionMode; this._selectionMode = a, this.firePropertyChange('selectionMode', b, this._selectionMode) } }, getDataBox: function() { return this._dataBox }, _setDataBox: function(a) { if (!a) throw 'dataBox can not be null'; if (this._dataBox !== a) { this._dataBox && (this.clearSelection(), this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange, this)); var b = this._dataBox; this._dataBox = a, this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange, this, !0), this.firePropertyChange('dataBox', b, this._dataBox) } }, dispose: function() { this.clearSelection(), this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange, this) }, handleDataBoxChange: function(a) { if (a.kind === 'remove') { var b = a.data; this.contains(b) && (this._selectionList.remove(b), delete this._selectionMap[b.getId()], this.fireSelectionChange('remove', new nd(b))) } else a.kind === 'clear' && this.clearSelection() }, getFilterFunction: function() { return this._filterFunction }, setFilterFunction: function(a) { if (this._filterFunction !== a) { this.clearSelection(); var b = this._filterFunction; this._filterFunction = a, this.firePropertyChange('filterFunction', b, this._filterFunction) } }, fireSelectionChange: function(a, b, c) { c && (this._selectionList.forEach(function(a) { c.contains(a) ? c.remove(a) : c.add(a) }), b = c.toList()), this._selectionChangeDispatcher.fire({ kind: a, datas: new nd(b) }) }, addSelectionChangeListener: function(a, b, c) { this._selectionChangeDispatcher.add(a, b, c) }, removeSelectionChangeListener: function(a, b) { this._selectionChangeDispatcher.remove(a, b) }, _filterList: function(a, b) { for (var c = new nd(a), d = 0; d < c.size(); d++) { var e = c.get(d); (this._filterFunction && !this._filterFunction(e) || b && this.contains(e) || !b && !this.contains(e) || !this._dataBox.contains(e)) && (c.removeAt(d), d--) } return c }, appendSelection: function(a) { if (this._selectionMode !== 'noneSelection') { var b = this._filterList(a, !0); if (!b.isEmpty()) { var c = null; this._selectionMode === 'singleSelection' && (c = new nd(this._selectionList), this._selectionList.clear(), this._selectionMap = {}, b = new nd(b.get(b.size() - 1))); for (var d = 0; d < b.size(); d++) { var e = b.get(d); this._selectionList.add(e), this._selectionMap[e.getId()] = e } this.fireSelectionChange('append', b, c) } } }, removeSelection: function(a) { var b = this._filterList(a); if (b.size() !== 0) { for (var c = 0; c < b.size(); c++) { var d = b.get(c); this._selectionList.remove(d), delete this._selectionMap[d.getId()] } this.fireSelectionChange('remove', b) } }, toSelection: function(a, b) { return this._selectionList.toList(a, b) }, getSelection: function() { return this._selectionList }, setSelection: function(a) { if (this._selectionMode !== 'noneSelection' && (this._selectionList.size() !== 0 || a != null)) { var b = new nd(this._selectionList); this._selectionList.clear(), this._selectionMap = {}; var c = this._filterList(a, !0); this._selectionMode === 'singleSelection' && c.size() > 1 && (c = new nd(c.get(c.size() - 1))); for (var d = 0; d < c.size(); d++) { var e = c.get(d); this._selectionList.add(e), this._selectionMap[e.getId()] = e } this.fireSelectionChange('set', null, b) } }, clearSelection: function() { if (this._selectionList.size() > 0) { var a = this._selectionList.toList(); this._selectionList.clear(), this._selectionMap = {}, this.fireSelectionChange('clear', a) } }, selectAll: function() { if (this._selectionMode !== 'noneSelection') { var a = this._dataBox.toDatas(), b = 0, c = null; if (this._filterFunction) for (b = 0; b < a.size(); b++)c = a.get(b), this._filterFunction(c) || (a.removeAt(b), b--); var d = new nd(this._selectionList); for (this._selectionList.clear(), this._selectionMap = {}, this._selectionMode === 'singleSelection' && a.size() > 1 && (a = new nd(a.get(a.size() - 1))), b = 0; b < a.size(); b++)c = a.get(b), this._selectionList.add(c), this._selectionMap[c.getId()] = c; this.fireSelectionChange('all', null, d) } }, size: function() { return this._selectionList.size() }, contains: function(a) { return a ? this._selectionMap[a.getId()] != null : !1 }, getLastData: function() { return this._selectionList.size() > 0 ? this._selectionList.get(this._selectionList.size() - 1) : null }, getFirstData: function() { return this._selectionList.size() > 0 ? this._selectionList.get(0) : null }, isSelectable: function(a) { return a ? this._selectionMode === 'noneSelection' ? !1 : this._filterFunction && !this._filterFunction(a) ? !1 : !0 : !1 } }), Ib.QuickFinder = function(a, b, c, d, e) { if (this._map = {}, !a) throw 'dataBox can not be null'; if (!b) throw 'propertyName can not be null'; this._dataBox = a, this._propertyName = b, this._propertyType = c || 'accessor', this._propertyType === 'accessor' && (this._getter = Jb.getter(b)), this._valueFunction = d || this.getValue, this._filterFunction = e || this.isInterested, this._dataBox.forEach(this._addData, this), this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange, this, !0), this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange, this, !0) }, Jb.ext('twaver.QuickFinder', Object, { _NULL_: 'twaver-null-key', getValueFunction: function() { return this._valueFunction }, getFilterFunction: function() { return this._filterFunction }, handleDataBoxChange: function(a) { a.kind === 'add' ? this._addData(a.data) : a.kind === 'remove' ? this._removeData(a.data) : a.kind === 'clear' && (this._map = {}) }, handleDataPropertyChange: function(a) { if (this._filterFunction.call(this, a.source)) { if (this._propertyType === 'accessor' && this._propertyName === a.property);else if (this._propertyType === 'style' && a.source.IStyle && 'S:' + this._propertyName === a.property);else if (this._propertyType !== 'client' || 'C:' + this._propertyName !== a.property) return; var b = this._getMap(a.oldValue); b && b.remove(a.source), this._addData(a.source) } }, _getMap: function(a) { return a = a == null ? this._NULL_ : a, this._map[a] }, find: function(a) { var b = this._getMap(a); return b ? b.toList() : new nd() }, findFirst: function(a) { var b = this._getMap(a); return !b || b.isEmpty() ? null : b.get(0) }, _addData: function(a) { if (this._filterFunction.call(this, a)) { var b = this._valueFunction.call(this, a), c = this._getMap(b); c || (c = new nd(), b = b == null ? this._NULL_ : b, this._map[b] = c), c.add(a) } }, _removeData: function(a) { if (this._filterFunction.call(this, a)) { var b = this._valueFunction.call(this, a), c = this._getMap(b); c && (c.remove(a), c.isEmpty() && (b = b == null ? this._NULL_ : b, delete this._map[b])) } }, dispose: function() { this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange, this), this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange, this), delete this._dataBox }, getDataBox: function() { return this._dataBox }, getPropertyType: function() { return this._propertyType }, getPropertyName: function() { return this._propertyName }, isInterested: function(a) { return (this._propertyType !== 'style' || a.IStyle) && (this._propertyType !== 'accessor' || this._valueFunction !== this.getValue || a[this._getter]) ? !0 : !1 }, getValue: function(a) { return this._propertyType === 'accessor' ? a[this._getter]() : this._propertyType === 'style' && a.getStyle ? a.getStyle(this._propertyName) : this._propertyType === 'client' && a.getClient ? a.getClient(this._propertyName) : null } }), Ib.PropertyPropagator = function(a, b, c) { if (!a) throw 'dataBox can not be null'; if (!b) throw 'propertyName can not be null'; this._dataBox = a, this._propertyName = b, this._propertyType = c || 'accessor', this._propertyType === 'accessor' && (this._getter = Jb.getter(b), this._setter = Jb.setter(b)), this._enable = !1, this._isPropagating = !1 }, Jb.ext('twaver.PropertyPropagator', Object, { getDataBox: function() { return this._dataBox }, getPropertyType: function() { return this._propertyType }, getPropertyName: function() { return this._propertyName }, isEnable: function() { return this._enable }, setEnable: function(a) { this._enable !== a && (this._enable = a, this._enable ? (this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange, this), this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange, this), this._dataBox.forEach(function(a) { this.propagate(a) }, this)) : (this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange, this), this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange, this))) }, handleDataBoxChange: function(a) { a.data && this.propagate(a.data) }, handleDataPropertyChange: function(a) { if (this.isInterestedProperty(a)) this.propagate(a.source); else if (a.property === 'parent') { var b = a.oldValue; b && this.propagate(b), this.propagate(a.source) } }, isInterestedProperty: function(a) { return this._propertyType === 'accessor' && this._propertyName === a.property ? !0 : this._propertyType === 'style' && a.IElement && 'S:' + this._propertyName === a.property ? !0 : this._propertyType === 'client' && 'C:' + this._propertyName === a.property ? !0 : !1 }, propagate: function(a) { a && !this._isPropagating && (this._isPropagating = !0, this.propagateToTop(a), this._isPropagating = !1) }, propagateToTop: function(a) { for (this.propagateToParent(null, a); a && a.getParent();) this.propagateToParent(a, a.getParent()), a = a.getParent() }, propagateToParent: function(a, b) {} }), Ib.AlarmStatePropagator = function(a) { Ib.AlarmStatePropagator.superClass.constructor.call(this, a, 'alarmState') }, Jb.ext('twaver.AlarmStatePropagator', Ib.PropertyPropagator, { handleDataPropertyChange: function(a) { a.property === 'enablePropagation' ? this.propagate(a.source) : Ib.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this, a) }, propagateToParent: function(a, b) { var c = null; b.getChildren().forEach(function(a) { var b = a.getAlarmState().getHighestOverallAlarmSeverity(); Ib.AlarmSeverity.compare(b, c) > 0 && (c = b) }), b.getAlarmState().setPropagateSeverity(c) } }), Ib.AlarmSeverity = function(a, b, c, d, e) { this.value = a, this.name = b, this.nickName = c, this.color = d, this.displayName = e }, Jb.ext('twaver.AlarmSeverity', Object, { toString: function() { return this.displayName ? this.displayName : this.name } }), (function() { var a = Ib.AlarmSeverity; a.severities = new nd(), a._vm = {}, a._nm = {}, a._cp = function(a, b) { if (a && b) { var c = a.value - b.value; return c > 0 ? 1 : c < 0 ? -1 : 0 } return a && !b ? 1 : !a && b ? -1 : 0 }, a.forEach = function(b, c) { a.severities.forEach(b, c) }, a.getSortFunction = function() { return a._cp }, a.setSortFunction = function(b) { a._cp = b, a.severities.sort(b) }, a.add = function(b, c, d, e, f) { var g = new a(b, c, d, e, f); return a._vm[b] = g, a._nm[c] = g, a.severities.add(g), a.severities.sort(a._cp), g }, a.remove = function(b) { var c = a._nm[b]; return c && (delete a._nm[b], delete a._vm[c.value], a.severities.remove(c)), c }, a.CRITICAL = a.add(500, 'Critical', 'C', '#FF0000'), a.MAJOR = a.add(400, 'Major', 'M', '#FFA000'), a.MINOR = a.add(300, 'Minor', 'm', '#FFFF00'), a.WARNING = a.add(200, 'Warning', 'W', '#00FFFF'), a.INDETERMINATE = a.add(100, 'Indeterminate', 'N', '#C800FF'), a.CLEARED = a.add(0, 'Cleared', 'R', '#00FF00'), a.isClearedAlarmSeverity = function(a) { return a ? a.value === 0 : !1 }, a.getByName = function(b) { return a._nm[b] }, a.getByValue = function(b) { return a._vm[b] }, a.clear = function() { a.severities.clear(), a._vm = {}, a._nm = {} }, a.compare = function(b, c) { return a._cp(b, c) } }()), Ib.AlarmState = function(a) { this._e = a, this._nm = {}, this._am = {}, this._ps = null, this._haa = null, this._hna = null, this._hoa = null, this._hta = null, this._hls = !1, this._aac = 0, this._nac = 0 }, Jb.ext('twaver.AlarmState', Object, { _ep: !0, _f: function() { this._c1(), this._c2(), this._c3(), this._c4(), this._c5(), this._c6(), this._c7(), this._e.firePropertyChange('alarmState', null, this) }, getHighestAcknowledgedAlarmSeverity: function() { return this._haa }, getHighestNewAlarmSeverity: function() { return this._hna }, getHighestOverallAlarmSeverity: function() { return this._hoa }, getHighestNativeAlarmSeverity: function() { return this._hta }, hasLessSevereNewAlarms: function() { return this._hls }, _c1: function() { var a = null; for (var b in this._am)b = Ib.AlarmSeverity.getByName(b), Ib.AlarmSeverity.isClearedAlarmSeverity(b) || this.getAcknowledgedAlarmCount(b) !== 0 && (a = a && Ib.AlarmSeverity.compare(a, b) > 0 ? a : b); this._haa = a }, _c2: function() { var a = null; for (var b in this._nm)b = Ib.AlarmSeverity.getByName(b), Ib.AlarmSeverity.isClearedAlarmSeverity(b) || this.getNewAlarmCount(b) !== 0 && (a = a && Ib.AlarmSeverity.compare(a, b) > 0 ? a : b); this._hna = a }, _c3: function() { if (!this._hna) return void (this._hls = !1); for (var a in this._nm) if (a = Ib.AlarmSeverity.getByName(a), !Ib.AlarmSeverity.isClearedAlarmSeverity(a) && this.getNewAlarmCount(a) !== 0 && Ib.AlarmSeverity.compare(this._hna, a) > 0) return void (this._hls = !0); this._hls = !1 }, _c4: function() { var a = this._haa, b = this._hna, c = this._ps; this._hoa = a, Ib.AlarmSeverity.compare(b, this._hoa) > 0 && (this._hoa = b), Ib.AlarmSeverity.compare(c, this._hoa) > 0 && (this._hoa = c) }, _c5: function() { var a = this._haa, b = this._hna; this._hta = a, Ib.AlarmSeverity.compare(b, this._hta) > 0 && (this._hta = b) }, increaseAcknowledgedAlarm: function(a, b) { if (b == null && (b = 1), b !== 0) { var c = this._am[a.name]; c == null && (c = 0), c += b, this._am[a.name] = c, this._f() } }, increaseNewAlarm: function(a, b) { if (b == null && (b = 1), b !== 0) { var c = this._nm[a.name]; c == null && (c = 0), c += b, this._nm[a.name] = c, this._f() } }, decreaseAcknowledgedAlarm: function(a, b) { if (b == null && (b = 1), b !== 0) { var c = this._am[a.name]; if (c == null && (c = 0), c -= b, c < 0) throw 'Alarm count can not be negative'; this._am[a.name] = c, this._f() } }, decreaseNewAlarm: function(a, b) { if (b == null && (b = 1), b !== 0) { var c = this._nm[a.name]; if (c == null && (c = 0), c -= b, c < 0) throw 'Alarm count can not be negative'; this._nm[a.name] = c, this._f() } }, acknowledgeAlarm: function(a) { this.decreaseNewAlarm(a, 1), this.increaseAcknowledgedAlarm(a, 1) }, acknowledgeAllAlarms: function(a) { if (a) { var b = this.getNewAlarmCount(a); this.decreaseNewAlarm(a, b), this.increaseAcknowledgedAlarm(a, b) } else for (var c in this._nm) this.acknowledgeAllAlarms(Ib.AlarmSeverity.getByName(c)) }, _c6: function() { this._aac = 0; for (var a in this._am)a = Ib.AlarmSeverity.getByName(a), this._aac += this.getAcknowledgedAlarmCount(a) }, getAcknowledgedAlarmCount: function(a) { if (a) { var b = this._am[a.name]; return b == null ? 0 : b } return this._aac }, getAlarmCount: function(a) { return this.getAcknowledgedAlarmCount(a) + this.getNewAlarmCount(a) }, _c7: function() { this._nac = 0; for (var a in this._nm)a = Ib.AlarmSeverity.getByName(a), this._nac += this.getNewAlarmCount(a) }, getNewAlarmCount: function(a) { if (a) { var b = this._nm[a.name]; return b == null ? 0 : b } return this._nac }, setNewAlarmCount: function(a, b) { this._nm[a.name] = b, this._f() }, removeAllNewAlarms: function(a) { a ? delete this._nm[a] : this._nm = {}, this._f() }, setAcknowledgedAlarmCount: function(a, b) { this._am[a.name] = b, this._f() }, removeAllAcknowledgedAlarms: function(a) { a ? delete this._am[a.name] : this._am = {}, this._f() }, isEmpty: function() { return this._hoa == null }, clear: function() { this._am = {}, this._nm = {}, this._f() }, getPropagateSeverity: function() { return this._ps }, setPropagateSeverity: function(a) { if (this._ep || (a = null), this._ps !== a) { var b = this._ps; this._ps = a, this._f(), this._e.firePropertyChange('propagateSeverity', b, a) } }, isEnablePropagation: function() { return this._ep }, setEnablePropagation: function(a) { var b = this._ep; this._ep = a, this._e.firePropertyChange('enablePropagation', b, a) && (a || this.setPropagateSeverity(null)) } }), Ib.AlarmBox = function(a) { if (!a) throw 'elementBox can not be null.'; Ib.AlarmBox.superClass.constructor.call(this), this._elementBox = a, this._alarmElementMapping = new Ib.AlarmElementMapping(this, a), this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange, this, !0), this.addDataBoxChangeListener(this.handleAlarmBoxChange, this, !0), this.addDataPropertyChangeListener(this.handleAlarmPropertyChange, this, !0) }, Jb.ext('twaver.AlarmBox', Ib.DataBox, { __accessor: ['removeAlarmWhenElementIsRemoved'], _name: 'AlarmBox', _removeAlarmWhenAlarmIsCleared: !1, _removeAlarmWhenElementIsRemoved: !0, getElementBox: function() { return this._elementBox }, isRemoveAlarmWhenAlarmIsCleared: function() { return this._removeAlarmWhenAlarmIsCleared }, setRemoveAlarmWhenAlarmIsCleared: function(a) { var b = this._removeAlarmWhenAlarmIsCleared; this._removeAlarmWhenAlarmIsCleared = a, this.firePropertyChange('removeAlarmWhenAlarmIsCleared', b, a), a && this.toDatas(function(a) { return a.isCleared() }).forEach(this.remove, this) }, getAlarmElementMapping: function() { return this._alarmElementMapping }, setAlarmElementMapping: function(a) { if (!a) throw 'alarmElementMapping can not be null'; if (this._alarmElementMapping !== a) { var b = this._alarmElementMapping; this.getDatas().forEach(this._decreaseAlarmState, this), this._alarmElementMapping = a, this.getDatas().forEach(this._increaseAlarmState, this), this.firePropertyChange('alarmElementMapping', b, a) } }, handleElementBoxChange: function(a) {
    a.kind === 'add' ? this.handleElementAdded(a.data) : a.kind === 'remove' ? (this.handleElementRemoved(a.data),
      this._removeAlarmWhenElementIsRemoved && this.removeAlarmsByElement(a.data)) : a.kind === 'clear' && (a.datas.forEach(this.handleElementRemoved, this), this._removeAlarmWhenElementIsRemoved && this.clear())
  }, handleAlarmBoxChange: function(a) { a.kind === 'add' ? this._increaseAlarmState(a.data) : a.kind === 'remove' ? this._decreaseAlarmState(a.data) : a.kind === 'clear' && a.datas.forEach(this._decreaseAlarmState, this) }, handleAlarmPropertyChange: function(a) { var b = a.source; b.isCleared() || (a.property === 'alarmSeverity' ? this.handleAlarmSeverityChange(b, a) : a.property === 'acked' && this.handleAckedChange(b, a)), a.property === 'cleared' && (b.isCleared() ? (this._decreaseAlarmState(b, !0), this._removeAlarmWhenAlarmIsCleared && this.remove(b)) : this._increaseAlarmState(b, !0)) }, handleAckedChange: function(a, b) { if (a.getAlarmSeverity()) { var c = this.getCorrespondingElements(a); if (c) for (var d = 0; d < c.size(); d++) { var e = c.get(d); b.oldValue ? e.getAlarmState().decreaseAcknowledgedAlarm(a.getAlarmSeverity()) : e.getAlarmState().decreaseNewAlarm(a.getAlarmSeverity()), b.newValue ? e.getAlarmState().increaseAcknowledgedAlarm(a.getAlarmSeverity()) : e.getAlarmState().increaseNewAlarm(a.getAlarmSeverity()) } } }, handleAlarmSeverityChange: function(a, b) { var c = b.oldValue, d = b.newValue, e = this.getCorrespondingElements(a); if (e) for (var f = 0; f < e.size(); f++) { var g = e.get(f); c && (a.isAcked() ? g.getAlarmState().decreaseAcknowledgedAlarm(c) : g.getAlarmState().decreaseNewAlarm(c)), d && (a.isAcked() ? g.getAlarmState().increaseAcknowledgedAlarm(d) : g.getAlarmState().increaseNewAlarm(d)) } }, getCorrespondingAlarms: function(a) { return this._alarmElementMapping.getCorrespondingAlarms(a) }, getCorrespondingElements: function(a) { return this._alarmElementMapping.getCorrespondingElements(a) }, handleElementAdded: function(a) { var b = this.getCorrespondingAlarms(a); if (b) for (var c = 0; c < b.size(); c++) { var d = b.get(c); if (!d.isCleared()) { var e = d.getAlarmSeverity(); e && (d.isAcked() ? a.getAlarmState().increaseAcknowledgedAlarm(e) : a.getAlarmState().increaseNewAlarm(e)) } } }, _increaseAlarmState: function(a, b) { if (!a.isCleared() || b) { var c = a.getAlarmSeverity(); if (c) { var d = this.getCorrespondingElements(a); if (d) for (var e = 0; e < d.size(); e++) { var f = d.get(e); a.isAcked() ? f.getAlarmState().increaseAcknowledgedAlarm(c) : f.getAlarmState().increaseNewAlarm(c) } } } }, _decreaseAlarmState: function(a, b) { if (!a.isCleared() || b) { var c = a.getAlarmSeverity(); if (c) { var d = this.getCorrespondingElements(a); if (d) for (var e = 0; e < d.size(); e++) { var f = d.get(e); a.isAcked() ? f.getAlarmState().decreaseAcknowledgedAlarm(c) : f.getAlarmState().decreaseNewAlarm(c) } } } }, handleElementRemoved: function(a) { var b = this.getCorrespondingAlarms(a); b && b.forEach(function(b) { !b.isCleared() && b.getAlarmSeverity() && (b.isAcked() ? a.getAlarmState().decreaseAcknowledgedAlarm(b.getAlarmSeverity()) : a.getAlarmState().decreaseNewAlarm(b.getAlarmSeverity())) }) }, removeAlarmsByElement: function(a) { var b = this.getCorrespondingAlarms(a); b && b.forEach(this.remove, this) }, add: function(a, b) { if (!a.IAlarm) throw 'Only IAlarm can be added into AlarmBox'; this._removeAlarmWhenAlarmIsCleared && a.isCleared() || Ib.AlarmBox.superClass.add.apply(this, arguments) } }), Ib.AlarmElementMapping = function(a, b) { if (!b) throw 'ElementBox can not be null'; if (!a) throw 'AlarmBox can not be null'; this._elementBox = b, this._alarmBox = a, this._alarmsFinder = new Ib.QuickFinder(a, 'elementId') }, Jb.ext('twaver.AlarmElementMapping', Object, { getCorrespondingAlarms: function(a) { return this._alarmsFinder.find(a.getId()) }, getCorrespondingElements: function(a) { var b = this._elementBox.getDataById(a.getElementId()); return new nd(b) }, dispose: function() { this._alarmsFinder.dispose(), delete this._elementBox, delete this._alarmBox, delete this._alarmsFinder } }), Ib.AlarmStateStatistics = function(a) { Ib.AlarmStateStatistics.superClass.constructor.apply(this, arguments), this.sumNew = 0, this.sumAcked = 0, this.sumTotal = 0, this.severtiyMap = {}, this.elementMap = {}, this.setElementBox(a) }, Jb.ext('twaver.AlarmStateStatistics', Ib.PropertyChangeDispatcher, { getElementBox: function() { return this._elementBox }, setElementBox: function(a) { if (!a) throw 'ElementBox can not be null'; if (this._elementBox !== a) { var b = this._elementBox; b && (b.removeDataPropertyChangeListener(this.handleElementPropertyChange, this), b.removeDataBoxChangeListener(this.handleElementBoxChange, this), this.severtiyMap = {}, this.elementMap = {}), this._elementBox = a, this.reset(), a.addDataPropertyChangeListener(this.handleElementPropertyChange, this), a.addDataBoxChangeListener(this.handleElementBoxChange, this), this.firePropertyChange('elementBox', b, a) } }, dispose: function() { this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange, this), this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange, this), delete this._elementBox }, handleElementPropertyChange: function(a) { a.property === 'alarmState' && (this.increase(a.source), this.fireAlarmStateChange()) }, handleElementBoxChange: function(a) { a.kind === 'add' ? (this.increase(a.data), this.fireAlarmStateChange()) : a.kind === 'remove' ? (this.decrease(a.data), this.fireAlarmStateChange()) : a.kind === 'clear' && (this.severtiyMap = {}, this.elementMap = {}, this.fireAlarmStateChange()) }, fireAlarmStateChange: function() { this.sumAcked = 0, this.sumNew = 0, this.sumTotal = 0, Ib.AlarmSeverity.forEach(function(a) { var b = this.getSumInfo(a); this.sumAcked += b.ackedCount, this.sumNew += b.newCount, this.sumTotal += b.totalCount }, this), this.firePropertyChange('alarmState', !1, !0) }, getNewAlarmCount: function(a) { if (!a) return this.sumNew; var b = this.getSumInfo(a); return b.newCount }, getAcknowledgedAlarmCount: function(a) { if (!a) return this.sumAcked; var b = this.getSumInfo(a); return b.ackedCount }, getTotalAlarmCount: function(a) { if (!a) return this.sumTotal; var b = this.getSumInfo(a); return b.totalCount }, getSumInfo: function(a) { var b = this.severtiyMap[a.name]; return b || (b = {}, b.newCount = 0, b.ackedCount = 0, b.totalCount = 0, this.severtiyMap[a.name] = b), b }, decrease: function(a) { var b = this.elementMap[a.getId()]; b && (delete this.elementMap[a.getId()], Ib.AlarmSeverity.forEach(function(a) { var c = b[a.name], d = this.getSumInfo(a); d.newCount = d.newCount - c.newCount, d.ackedCount = d.ackedCount - c.ackedCount, d.totalCount = d.totalCount - c.totalCount }, this)) }, increase: function(a) { if (this.decrease(a), !this._filterFunction || this._filterFunction(a)) { var b = {}; this.elementMap[a.getId()] = b, Ib.AlarmSeverity.forEach(function(c) { var d = {}; d.newCount = a.getAlarmState().getNewAlarmCount(c), d.ackedCount = a.getAlarmState().getAcknowledgedAlarmCount(c), d.totalCount = a.getAlarmState().getAlarmCount(c), b[c.name] = d; var e = this.getSumInfo(c); e.newCount = e.newCount + d.newCount, e.ackedCount = e.ackedCount + d.ackedCount, e.totalCount = e.totalCount + d.totalCount }, this) } }, reset: function() { this.severtiyMap = {}, this.elementMap = {}, this._elementBox.forEach(this.increase, this), this.fireAlarmStateChange() }, setFilterFunction: function(a) { var b = this._filterFunction; this._filterFunction = a, this.reset(), this.firePropertyChange('filterFunction', b, a) }, getFilterFunction: function() { return _filterFunction } }), Ib.LayerBox = function(a) { Ib.LayerBox.superClass.constructor.call(this), this._elementBox = a, this._defaultLayer = new Ib.Layer(Ed.LAYER_DEFAULT_ID, Ed.LAYER_DEFAULT_NAME), this.add(this._defaultLayer) }, Jb.ext('twaver.LayerBox', Ib.DataBox, { _name: 'LayerBox', getElementBox: function() { return this._elementBox }, getDefaultLayer: function() { return this._defaultLayer }, add: function(a, b) { if (!a.ILayer) throw 'Only ILayer can be added into LayerBox'; Ib.LayerBox.superClass.add.apply(this, arguments) }, removeById: function(a) { if (a === this._defaultLayer.getId()) throw 'Cannot remove default layer'; Ib.LayerBox.superClass.removeById.call(this, a) }, getLayerByElement: function(a) { if (!a) return null; if (a._layerId === Ed.LAYER_DEFAULT_ID) return this._defaultLayer; var b = this.getDataById(a.getLayerId()); return b || this._defaultLayer }, clear: function() { this.toDatas().forEach(function(a) { a != this._defaultLayer && this.removeById(a.getId()) }, this) } }), Ib.BundleLinks = function(a, b) { this._links = a, this._siblings = b; var c, d, e = Ib.Styles.getStyle('link.bundle.expanded'); for (c = 0; c < a.size(); c++) { d = a.get(c); var f = d.getStyle('link.bundle.expanded', !1); if (f != null) { e = f; break } } if (e == null && (e = !0), Ed.LINK_BUNDLE_AGENT_FUNCTION) { var g = Ed.LINK_BUNDLE_AGENT_FUNCTION(a); g == null ? g = a.get(0) : g != a.get(0) && (a.remove(g), a.add(g, 0)) } for (c = 0; c < a.size(); c++)a.get(c).setStyle('link.bundle.expanded', e) }, Jb.ext('twaver.BundleLinks', Object, { getLinks: function() { return this._links }, getSiblings: function() { return this._siblings }, forEachSiblingLink: function(a, b) { this._siblings.forEach(function(c) { c.getLinks().forEach(a, b) }) } }); var Fd = { bitsToNum: function(a) { return a.reduce(function(a, b) { return 2 * a + b }, 0) }, byteToBitArr: function(a) { for (var b = [], c = 7; c >= 0; c--)b.push(!!(a & 1 << c)); return b }, lzwDecode: function(a, b) { for (var c, d, e = 0, f = function(a) { for (var c = 0, d = 0; a > d; d++)b.charCodeAt(e >> 3) & 1 << (7 & e) && (c |= 1 << d), e++; return c }, g = [], h = 1 << a, i = h + 1, j = a + 1, k = [], l = function() { k = [], j = a + 1; for (var b = 0; h > b; b++)k[b] = [b]; k[h] = [], k[i] = null }; ;) if (d = c, c = f(j), c !== h) { if (c === i) break; if (c < k.length)d !== h && k.push(k[d].concat(k[c][0])); else { if (c !== k.length) throw new Error('Invalid LZW code.'); k.push(k[d].concat(k[d][0])) }g.push.apply(g, k[c]), k.length === 1 << j && j < 12 && j++ } else l(); return g } }, Gd = function(a) { this.data = a, this.len = this.data.length, this.pos = 0 }; Jb.ext(Gd, Object, { readByte: function() { if (this.pos >= this.data.length) throw new Error('Attempted to read past end of stream.'); return 255 & this.data.charCodeAt(this.pos++) }, readBytes: function(a) { for (var b = [], c = 0; a > c; c++)b.push(this.readByte()); return b }, read: function(a) { for (var b = '', c = 0; a > c; c++)b += String.fromCharCode(this.readByte()); return b }, readUnsigned: function() { var a = this.readBytes(2); return (a[1] << 8) + a[0] } }); var Hd = function(a) { var b, c = a, d = null, e = null, f = null, g = 0, h = null, i = null, j = null; this.frames = [], this.size = {}; var k = this, l = Ob.createElement('canvas'); this.loaded = !1; var m = function() { d = null, e = null, h = f, f = null, i = null }; this.doParse = function() { Id(c, t) }; var n = function(a) { b = a, k.size.width = b.width, k.size.height = b.height }, o = function(a) { p(), m(), d = a.transparencyGiven ? a.transparencyIndex : null, e = a.delayTime, f = a.disposalMethod }, p = function() { i && k.frames.push({ data: i.getImageData(0, 0, b.width, b.height), delay: e }) }, q = function(a) { i || (i = l.getContext('2d')); var c = k.frames.length, e = a.lctFlag ? a.lct : b.gct; c > 0 && (h === 3 ? i.putImageData(k.frames[g].data, 0, 0) : g = c - 1, h === 2 && (j || i.clearRect(j.leftPos, j.topPos, j.width, j.height))); var f = i.getImageData(a.leftPos, a.topPos, a.width, a.height); a.pixels.forEach(function(a, b) { a !== d && (f.data[4 * b + 0] = e[a][0], f.data[4 * b + 1] = e[a][1], f.data[4 * b + 2] = e[a][2], f.data[4 * b + 3] = 255) }), i.putImageData(f, a.leftPos, a.topPos), j = a }, r = function() {}, s = function(a) { return function(b) { a(b) } }, t = { hdr: s(n), gce: s(o), com: s(r), app: { NETSCAPE: s(r) }, img: s(q), eof: function(a) { p(), k.loaded = !0 } } }, Id = function(a, b) { b || (b = {}); var c = function(b) { for (var c = [], d = 0; b > d; d++)c.push(a.readBytes(3)); return c }, d = function() { var b, c; c = ''; do b = a.readByte(), c += a.read(b); while (b !== 0);return c }, e = function() { var d = {}; if (d.sig = a.read(3), d.ver = a.read(3), d.sig !== 'GIF') throw new Error('Not a GIF file.'); d.width = a.readUnsigned(), d.height = a.readUnsigned(); var e = Fd.byteToBitArr(a.readByte()); d.gctFlag = e.shift(), d.colorRes = Fd.bitsToNum(e.splice(0, 3)), d.sorted = e.shift(), d.gctSize = Fd.bitsToNum(e.splice(0, 3)), d.bgColor = a.readByte(), d.pixelAspectRatio = a.readByte(), d.gctFlag && (d.gct = c(1 << d.gctSize + 1)), b.hdr && b.hdr(d) }, f = function(c) { var e = function(c) { var d = (a.readByte(), Fd.byteToBitArr(a.readByte())); c.reserved = d.splice(0, 3), c.disposalMethod = Fd.bitsToNum(d.splice(0, 3)), c.userInput = d.shift(), c.transparencyGiven = d.shift(), c.delayTime = a.readUnsigned(), c.transparencyIndex = a.readByte(), c.terminator = a.readByte(), b.gce && b.gce(c) }, f = function(a) { a.comment = d(), b.com && b.com(a) }, g = function(c) { a.readByte(); c.ptHeader = a.readBytes(12), c.ptData = d(), b.pte && b.pte(c) }, h = function(c) { { var e = function(c) { a.readByte(); c.unknown = a.readByte(), c.iterations = a.readUnsigned(), c.terminator = a.readByte(), b.app && b.app.NETSCAPE && b.app.NETSCAPE(c) }, f = function(a) { a.appData = d(), b.app && b.app[a.identifier] && b.app[a.identifier](a) }; a.readByte() } switch (c.identifier = a.read(8), c.authCode = a.read(3), c.identifier) { case 'NETSCAPE':e(c); break; default:f(c) } }, i = function(a) { a.data = d(), b.unknown && b.unknown(a) }; switch (c.label = a.readByte(), c.label) { case 249:c.extType = 'gce', e(c); break; case 254:c.extType = 'com', f(c); break; case 1:c.extType = 'pte', g(c); break; case 255:c.extType = 'app', h(c); break; default:c.extType = 'unknown', i(c) } }, g = function(e) { var f = function(a, b) { for (var c = new Array(a.length), d = a.length / b, e = function(d, e) { var f = a.slice(e * b, (e + 1) * b); c.splice.apply(c, [d * b, b].concat(f)) }, f = [0, 4, 2, 1], g = [8, 8, 4, 2], h = 0, i = 0; i < 4; i++) for (var j = f[i]; d > j; j += g[i])e(j, h), h++; return c }; e.leftPos = a.readUnsigned(), e.topPos = a.readUnsigned(), e.width = a.readUnsigned(), e.height = a.readUnsigned(); var g = Fd.byteToBitArr(a.readByte()); e.lctFlag = g.shift(), e.interlaced = g.shift(), e.sorted = g.shift(), e.reserved = g.splice(0, 2), e.lctSize = Fd.bitsToNum(g.splice(0, 3)), e.lctFlag && (e.lct = c(1 << e.lctSize + 1)), e.lzwMinCodeSize = a.readByte(); var h = d(); e.pixels = Fd.lzwDecode(e.lzwMinCodeSize, h), e.interlaced && (e.pixels = f(e.pixels, e.width)), b.img && b.img(e) }, h = function() { var c = {}; switch (c.sentinel = a.readByte(), String.fromCharCode(c.sentinel)) { case '!':c.type = 'ext', f(c); break; case ',':c.type = 'img', g(c); break; case ';':c.type = 'eof', b.eof && b.eof(c); break; default:throw new Error('Unknown block: 0x' + c.sentinel.toString(16)) }c.type !== 'eof' && setTimeout(h, 0) }, i = function() { e(), setTimeout(h, 0) }; i() }, Jd = function(a, b, c) { var d = Ob.createElement('canvas'); return Kd(d, b.width, b.height), d.getContext('2d').clearRect(0, 0, b.width, b.height), d.getContext('2d').putImageData(a[c].data, 0, 0), d }, Kd = function(a, b, c) { a.width = b, a.height = c, a.style.width = b + 'px', a.style.height = c + 'px' }; Ib.Data = function(a) { if (Ib.Data.superClass.constructor.apply(this, arguments), this._childList = new nd(), this._childMap = {}, this._clientMap = {}, a === b || a === null) this._id = Jb.id(); else if (typeof a === 'string' || typeof a === 'number' || typeof a === 'boolean') this._id = a; else { for (var c in a) if (c === 'clients') for (var d in a.clients) this._clientMap[d] = a.clients[d]; else if (c === 'styles') for (var e in a.styles) this._styleMap[e] = a.styles[e]; else a[c] != null && (c === 'id' ? this._id = a[c] : this[Jb.setter(c)] && this[Jb.setter(c)](a[c])); this._id == null && (this._id = Jb.id()) } }, Jb.ext('twaver.Data', Ib.PropertyChangeDispatcher, { IData: !0, IClient: !0, __client: 1, __new: 1, _parent: null, __accessor: ['name', 'name2', 'icon', 'toolTip'], _icon: Ed.ICON_DATA, getId: function() { return this._id }, getChildren: function() { return this._childList }, getChildrenSize: function() { return this._childList.size() }, toChildren: function(a, b) { return this._childList.toList(a, b) }, addChild: function(a, c) { return c === b && (c = this._childList.size()), a && a !== this ? this._childMap[a.getId()] ? !1 : this.isDescendantOf(a) ? !1 : (a.getParent() && a.getParent().removeChild(a), (c < 0 || c > this._childList.size()) && (c = this._childList.size()), this._childList.add(a, c), this._childMap[a._id] = a, a.setParent(this), this.firePropertyChange('children', null, a), this.onChildAdded(a, c), !0) : !1 }, onChildAdded: function(a, b) {}, removeChild: function(a) { if (!a) return !1; if (!this._childMap[a._id]) return !1; var b = this._childList.remove(a); return delete this._childMap[a._id], this.firePropertyChange('children', a, null), a.setParent(null), this.onChildRemoved(a, b), !0 }, onChildRemoved: function(a, b) {}, getChildAt: function(a) { return this._childList.get(a) }, clearChildren: function() { if (this._childList.size() === 0) return !1; for (var a = this._childList.toArray(), b = a.length, c = 0; b > c; c++) this.removeChild(a[c]); return this.onChildrenCleared(a), !0 }, onChildrenCleared: function(a) {}, getParent: function() { return this._parent }, setParent: function(a) { if (!(this._isUpdatingParent || this._parent === a || this === a || a && a.isDescendantOf(this))) { var b = this._parent; this._parent = a, this._isUpdatingParent = !0, b && b.removeChild(this), a && a.addChild(this), delete this._isUpdatingParent, this.firePropertyChange('parent', b, a), this.onParentChanged(b, a) } }, onParentChanged: function(a, b) {}, hasChildren: function() { return this._childList.size() > 0 }, isRelatedTo: function(a) { return a ? this.isDescendantOf(a) || a.isDescendantOf(this) : !1 }, isParentOf: function(a) { return a ? this._childMap[a._id] != null : !1 }, isDescendantOf: function(a) { if (!a) return !1; if (!a.hasChildren()) return !1; for (var b = this._parent; b;) { if (a === b) return !0; b = b.getParent() } return !1 }, toString: function() { return this.getName() ? this.getName() : this._id } }), Ib.Alarm = function(a, b, c, d, e) { Ib.Alarm.superClass.constructor.call(this, a), this._elementId = b, this._alarmSeverity = c, this._acked = d || !1, this._cleared = e || !1 }, Jb.ext('twaver.Alarm', Ib.Data, { IAlarm: !0, getElementId: function() { return this._elementId }, __accessor: ['acked', 'cleared', 'alarmSeverity'] }), Ib.Layer = function(a) { Ib.Layer.superClass.constructor.call(this, a) }, Jb.ext('twaver.Layer', Ib.Data, { ILayer: !0, __accessor: ['visible', 'movable', 'editable', 'rotatable'], _visible: !0, _movable: !0, _editable: !0, _rotatable: !0, _name: 'Default' }), Ib.Element = function(a) { this._styleMap = this._styleMap || {}, this._alarmState = new Ib.AlarmState(this), Ib.Element.superClass.constructor.call(this, a) }, Jb.ext('twaver.Element', Ib.Data, { IElement: !0, IStyle: !0, __accessor: ['layerId'], __bool: ['visible', 'movable'], __style: 1, _layerId: Ed.LAYER_DEFAULT_ID, _visible: !0, _movable: !0, getAlarmState: function() { return this._alarmState }, isAdjustedToBottom: function() { return !1 }, getElementUIClass: function() { return null }, getCanvasUIClass: function() { return null }, getVectorUIClass: function() { return null }, s: function(a, c) { return c === b ? this.getStyle(a) : (this.setStyle(a, c), this) } }), Ib.Dummy = function(a) { Ib.Dummy.superClass.constructor.call(this, a) }, Jb.ext('twaver.Dummy', Ib.Element, { IDummy: !0 }); var Ld = function(a) { this._location = { x: 0, y: 0 }, Ld.superClass.constructor.call(this, a) }; Ib.Node = Ld, Ld.IS_INTERESTED_NODE_PROPERTY = { location: 1, width: 1, height: 1, expanded: 1 }, Jb.ext('twaver.Node', Ib.Element, { _icon: Ed.ICON_NODE, _image: Ed.IMAGE_NODE, _imageUrl: null, _angle: 0, getLoopedLinks: function() { return this._loopedLinks }, getLinks: function() { return this._links }, getAgentLinks: function() { return this._agentLinks }, getFollowers: function() { return this._followers }, _addFollower: function(a) { this._followers || (this._followers = new nd()), this._followers.add(a) }, _removeFollower: function(a) { this._followers.remove(a), this._followers.isEmpty() && delete this._followers }, getFromLinks: function() { return this._fromLinks }, getToLinks: function() { return this._toLinks }, _addFromLink: function(a) { this._links || (this._links = new nd(!1)), this._fromLinks || (this._fromLinks = new nd(!1)), this._links.add(a), this._toLinks && this._toLinks.contains(a) && (this._loopedLinks || (this._loopedLinks = new nd(!1)), this._loopedLinks.add(a)), this._fromLinks.add(a) }, _addToLink: function(a) { this._links || (this._links = new nd(!1)), this._toLinks || (this._toLinks = new nd(!1)), this._links.add(a), this._fromLinks && this._fromLinks.contains(a) && (this._loopedLinks || (this._loopedLinks = new nd(!1)), this._loopedLinks.add(a)), this._toLinks.add(a) }, _removeFromLink: function(a) { this._links && this._links.remove(a), this._fromLinks && this._fromLinks.remove(a), this._loopedLinks && this._loopedLinks.remove(a) }, _removeToLink: function(a) { this._links && this._links.remove(a), this._toLinks && this._toLinks.remove(a), this._loopedLinks && this._loopedLinks.remove(a) }, hasAgentLinks: function() { return this._agentLinks != null && !this._agentLinks.isEmpty() }, getFromAgentLinks: function() { return this._fromAgentLinks }, getToAgentLinks: function() { return this._toAgentLinks }, _addFromAgentLink: function(a) { this._fromAgentLinks || (this._fromAgentLinks = new nd(!1)), this._agentLinks || (this._agentLinks = new nd(!1)), this._fromAgentLinks.add(a), this._agentLinks.add(a) }, _addToAgentLink: function(a) { this._toAgentLinks || (this._toAgentLinks = new nd(!1)), this._agentLinks || (this._agentLinks = new nd(!1)), this._toAgentLinks.add(a), this._agentLinks.add(a) }, _removeFromAgentLink: function(a) { this._fromAgentLinks && this._fromAgentLinks.remove(a), this._agentLinks && this._agentLinks.remove(a) }, _removeToAgentLink: function(a) { this._toAgentLinks && this._toAgentLinks.remove(a), this._agentLinks && this._agentLinks.remove(a) }, getImage: function() { return this._image }, setImage: function(a) { var b = this._image, c = this.getWidth(), d = this.getHeight(); this._image = a, this.firePropertyChange('image', b, a), this.firePropertyChange('width', c, this.getWidth()), this.firePropertyChange('height', d, this.getHeight()) }, getImageUrl: function() { return this._imageUrl }, setImageUrl: function(a) { if (this._imageUrl != a) { var b = this._imageUrl; this._imageUrl = a, Dd.images[a] || Ib.imageUtil.registerImageByUrl(a, Ib.imageUtil.getImageType(a) === 'svg', a), this.setImage(a), this.firePropertyChange('imageUrl', b, a) } }, getX: function() { return this._location.x }, getY: function() { return this._location.y }, setX: function(a) { this.setLocation(a, this._location.y) }, setY: function(a) { this.setLocation(this._location.x, a) }, getLocation: function() { return this._location }, setLocation: function(a, b) { var c; if (c = arguments.length === 2 ? { x: arguments[0], y: arguments[1] } : arguments[0], Jb.num(c.x) && Jb.num(c.y) && (c.x !== this._location.x || c.y !== this._location.y)) { var d = this._location; this._location = c, this.firePropertyChange('location', d, c) } }, getCenterLocation: function() { return Ed.CENTER_LOCATION ? this._location : { x: this.getX() + this.getWidth() / 2, y: this.getY() + this.getHeight() / 2 } }, setCenterLocation: function(a, b) { var c; c = arguments.length === 2 ? { x: arguments[0], y: arguments[1] } : Jb.clone(arguments[0]), Jb.num(c.x) && Jb.num(c.y) && (Ed.CENTER_LOCATION || (c.x -= this.getWidth() / 2, c.y -= this.getHeight() / 2), this.setLocation(c)) }, translate: function(a, b) { this.setLocation(this.getX() + a, this.getY() + b) }, getWidth: function() { if (Jb.num(this._width) && this._width >= 0) return this._width; if (typeof this._image !== 'object') { var a = Jb.getImageAsset(this._image); if (a) { var b = a.getWidth(); return Jb.num(b) && b >= 0 ? b : (a = a._image, Yc(this, a, a, 'w')) } } else if (this._image) return this._image.w; return Ed.NODE_WIDTH }, setWidth: function(a) { var b = this._width; this._width = a, this.firePropertyChange('width', b, a) }, getHeight: function() { if (Jb.num(this._height) && this._height >= 0) return this._height; if (typeof this._image !== 'object') { var a = Jb.getImageAsset(this._image); if (a) { var b = a.getHeight(); return Jb.num(b) && b >= 0 ? b : (a = a._image, Yc(this, a, a, 'h')) } } else if (this._image) return this._image.h; return Ed.NODE_HEIGHT }, setHeight: function(a) { var b = this._height; this._height = a, this.firePropertyChange('height', b, a) }, setSize: function() { arguments.length === 2 ? (this.setWidth(arguments[0]), this.setHeight(arguments[1])) : (this.setWidth(arguments[0].width), this.setHeight(arguments[0].height)) }, getSize: function() { return { width: this.getWidth(), height: this.getHeight() } }, getRect: function() { var a = this.getOriginalRect(); if (this._angle === 0) return a; for (var b = Tb.createMatrix(this._angle * Math.PI / 180, a.x + a.width / 2, a.y + a.height / 2), c = [{ x: a.x, y: a.y }, { x: a.x + a.width, y: a.y }, { x: a.x + a.width, y: a.y + a.height }, { x: a.x, y: a.y + a.height }], d = 0, e = c.length; e > d; d++)c[d] = b.transform(c[d]); var f = Tb.getRect(c); return f }, getOriginalRect: function() { var a = this, b = a.getWidth(), c = a.getHeight(); return Ed.CENTER_LOCATION ? { x: a._location.x - b / 2, y: a._location.y - c / 2, width: b, height: c } : { x: a.getX(), y: a.getY(), width: b, height: c } }, getAngle: function() { return this._angle }, setAngle: function(a) { var b = this._angle; this._angle = a % 360, this.firePropertyChange('angle', b, this._angle) }, onParentChanged: function(a, b) { Ld.superClass.onParentChanged.call(this, a, b), this._checkLinkAgent() }, _checkLinkAgent: function() { if (Ib._isInitializing) { if (this._links) for (var a = this._links.size(), b = 0; a > b; b++) this._links.get(b)._checkAgentNode() } else Ib.ElementBox.prototype.startBatch(function() { if (this._links) for (var a = this._links.size(), b = 0; a > b; b++) this._links.get(b)._checkAgentNode() }, this) }, onPropertyChanged: function(a) { if (Ld.superClass.onPropertyChanged.call(this, a), this._followers) for (var b = this._followers.size(), c = 0; b > c; c++) this._followers.get(c).handleHostPropertyChange(a); this.getParent() instanceof Nd && Ld.IS_INTERESTED_NODE_PROPERTY[a.property] && this.getParent().updateLocationFromChildren() }, getElementUIClass: function() { return Ib.network.NodeUI }, getCanvasUIClass: function() { return Ib.canvas.NodeUI }, getVectorUIClass: function() { return Ib.vector.NodeUI } }); var Md = function(a) { Md.superClass.constructor.call(this, a) }; Ib.HTMLNode = Md, Jb.ext('twaver.HTMLNode', Ib.Node, { getElementUIClass: function() { return Ib.network.HTMLNodeUI }, getCanvasUIClass: function() { return Ib.canvas.HTMLNodeUI }, getVectorUIClass: function() { return Ib.vector.HTMLNodeUI } }), Ib.Link = function(a, b, c) { Ib.Link.superClass.constructor.call(this, a instanceof Ld ? null : a), a instanceof Ld && (c = b, b = a), b && this.setFromNode(b), c && this.setToNode(c) }, Ib.Link.IS_INTERESTED_BUNDLE_STYLE = { 'link.bundle.enable': 1, 'link.bundle.id': 1, 'link.bundle.independent': 1 }, Jb.ext('twaver.Link', Ib.Element, { _fromNode: null, _toNode: null, _fromAgent: null, _toAgent: null, _icon: Ed.ICON_LINK, getFromNode: function() { return this._fromNode }, getToNode: function() { return this._toNode }, getFromAgent: function() { return this._fromAgent }, getToAgent: function() { return this._toAgent }, setFromNode: function(a) { if (this._fromNode !== a) { var b = this._fromNode; this._fromNode = a, b && b._removeFromLink(this), this._fromNode && this._fromNode._addFromLink(this), this._checkAgentNode(), this.firePropertyChange('fromNode', b, a) } }, setToNode: function(a) { if (this._toNode !== a) { var b = this._toNode; this._toNode = a, b && b._removeToLink(this), this._toNode && this._toNode._addToLink(this), this._checkAgentNode(), this.firePropertyChange('toNode', b, a) } }, isLooped: function() { return this._fromNode === this._toNode && this._fromNode != null && this._toNode != null }, _checkAgentNode: function() { Ib._isInitializing ? Ib._links[this._id] || (Ib._links[this._id] = this) : this._checkAgentNodeImpl() }, _checkAgentNodeImpl: function() { var a, b, c = vc.figureFromAgent(this), d = this; this._fromAgent != c && (a = this._fromAgent, this._fromAgent && this._fromAgent._removeFromAgentLink(this), this._fromAgent = c, this._fromAgent && this._fromAgent._addFromAgentLink(this), this.firePropertyChange('fromAgent', a, this._fromAgent), Ib._isInitializing ? (a && this._toAgent && (b = a._id + ':' + this._toAgent._id, Ib._bundleLinks[b] || (Ib._bundleLinks[b] = [a, this._toAgent])), this._fromAgent && this._toAgent && (b = this._fromAgent._id + ':' + this._toAgent._id, Ib._bundleLinks[b] || (Ib._bundleLinks[b] = [this._fromAgent, this._toAgent]))) : (vc.resetBundleLinks(a, d._toAgent), vc.resetBundleLinks(d._fromAgent, d._toAgent))); var e = vc.figureToAgent(this); this._toAgent != e && (a = this._toAgent, this._toAgent && this._toAgent._removeToAgentLink(this), this._toAgent = e, this._toAgent && this._toAgent._addToAgentLink(this), this.firePropertyChange('toAgent', a, this._toAgent), Ib._isInitializing ? (a && this._fromAgent && (b = a._id + ':' + this._fromAgent._id, Ib._bundleLinks[b] || (Ib._bundleLinks[b] = [a, this._fromAgent])), this._toAgent && this._fromAgent && (b = this._toAgent._id + ':' + this._fromAgent._id, Ib._bundleLinks[b] || (Ib._bundleLinks[b] = [this._toAgent, this._fromAgent]))) : (vc.resetBundleLinks(a, d._fromAgent), vc.resetBundleLinks(d._toAgent, d._fromAgent))) }, _setBundleLinks: function(a) { this._bundleLinks = a, this.firePropertyChange('bundleLinks', !0, !1) }, getBundleLinks: function() { return this._bundleLinks }, getBundleCount: function() { return this._bundleLinks ? this._bundleLinks.getLinks().size() : 1 }, getBundleIndex: function() { return this._bundleLinks ? this._bundleLinks.getLinks().indexOf(this) : 0 }, reverseBundleExpanded: function() { if (this._bundleLinks && this._bundleLinks.getLinks().size() > 0) { var a, b, c = this._bundleLinks.getLinks(), d = !this.getStyle('link.bundle.expanded'); for (a = 0; a < c.size(); a++)b = c.get(a), b.setStyle('link.bundle.expanded', d); var e = this._bundleLinks.getSiblings(); for (a = 0; a < e.size(); a++) { var f = e.get(a); if (f != this._bundleLinks) { c = f.getLinks(); for (var g = 0; g < c.size(); g++)b = c.get(g), b.firePropertyChange('bundleLinks', null, f) } } return !0 } return !1 }, isBundleAgent: function() { return this._bundleLinks != null && this._bundleLinks.getLinks().size() > 1 && this === this._bundleLinks.getLinks().get(0) && !this.getStyle('link.bundle.expanded') }, onStyleChanged: function(a, b, c) { Ib.Link.superClass.onStyleChanged.call(this, a, b, c), Ib.Link.IS_INTERESTED_BUNDLE_STYLE[a] && vc.resetBundleLinks(this._toAgent, this._fromAgent) }, getElementUIClass: function() { return Ib.network.LinkUI }, getCanvasUIClass: function() { return Ib.canvas.LinkUI }, getVectorUIClass: function() { return Ib.vector.LinkUI }, isAdjustedToBottom: function() { return Ed.IS_LINK_ADJUSTED_TO_BOTTOM } }), Ib.HTMLLink = function(a, b, c) { Ib.HTMLLink.superClass.constructor.call(this, a, b, c) }, Ib.Util.ext('twaver.HTMLLink', Ib.Link, { getElementUIClass: function() { return Ib.network.HTMLLinkUI }, getCanvasUIClass: function() { return Ib.canvas.HTMLLinkUI }, getVectorUIClass: function() { return Ib.vector.HTMLLinkUI } }), Ib.Follower = function(a) { this._isUpdatingFollower = !1, this._isUpdatingLocation = !1, Ib.Follower.superClass.constructor.call(this, a) }, Ib.Follower.IS_INTERESTED_HOST_GRID_PROPERTY = { location: 1, width: 1, height: 1, 'S:grid.row.count': 1, 'S:grid.column.count': 1, 'S:grid.row.percents': 1, 'S:grid.column.percents': 1, 'S:grid.border': 1, 'S:grid.border.left': 1, 'S:grid.border.right': 1, 'S:grid.border.top': 1, 'S:grid.border.bottom': 1, 'S:grid.padding': 1, 'S:grid.padding.left': 1, 'S:grid.padding.right': 1, 'S:grid.padding.top': 1, 'S:grid.padding.bottom': 1 }, Ib.Follower.IS_INTERESTED_FOLLOWER_STYLE = { 'follower.row.index': 1, 'follower.column.index': 1, 'follower.row.span': 1, 'follower.column.span': 1, 'follower.padding': 1, 'follower.padding.left': 1, 'follower.padding.right': 1, 'follower.padding.top': 1, 'follower.padding.bottom': 1 }, Jb.ext('twaver.Follower', Ld, { _host: null, getHost: function() { return this._host }, setHost: function(a) { if (this !== a && this._host !== a) { var b = this._host; b && b._removeFollower(this), this._host = a, this._host && this._host._addFollower(this), this.firePropertyChange('host', b, a), this.onHostChanged(b, a) } }, onStyleChanged: function(a, b, c) { Ib.Follower.superClass.onStyleChanged.call(this, a, b, c), Ib.Follower.IS_INTERESTED_FOLLOWER_STYLE[a] && this.updateFollower(null) }, setLocation: function() { this._isUpdatingLocation || (this._isUpdatingLocation = !0, Ib.Follower.superClass.setLocation.apply(this, arguments), this._isUpdatingLocation = !1) }, onHostChanged: function(a, b) { this.updateFollower(null) }, handleHostPropertyChange: function(a) { this.updateFollower(a) }, updateFollower: function(a) { this._isUpdatingFollower || Jb.isDeserializing || (this._isUpdatingFollower = !0, this.updateFollowerImpl(a), this._isUpdatingFollower = !1) }, updateFollowerImpl: function(a) { var b = this.getHost(); if (b instanceof Ib.Grid) { if (!a || Ib.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[a.property]) { var c = this.getStyle('follower.row.index'), d = this.getStyle('follower.column.index'), e = b.getCellRect(c, d); if (!e) return; var f = this.getStyle('follower.row.span'), g = this.getStyle('follower.column.span'); if (f != 1 || g != 1) { var h = b.getCellRect(c + f - 1, d + g - 1); h && (e = Tb.unionRect(e, h)) } if (Tb.addPadding(e, this, 'follower.padding'), this.getStyle('follower.fill.cell')) this.setLocation(e.x, e.y), this.setWidth(e.width), this.setHeight(e.height); else { var i = this.getStyle('follower.cell.position'); e = Vb.get(i, e, this.getRect()), this.setLocation(e.x, e.y) } } } else if (a != null && a.property === 'location') { var j = a.oldValue, k = a.newValue, l = this.getLocation(); this.setLocation(l.x + (k.x - j.x), l.y + (k.y - j.y)) } }, isHostOn: function(a) { if (!a) return !1; for (var b = {}, c = this._host; c && c != this && !b[c.getId()];) { if (c === a) return !0; b[c.getId()] = c, c = c instanceof Ib.Follower ? c.getHost() : null } return !1 }, isLoopedHostOn: function(a) { return this.isHostOn(a) && a.isHostOn(this) } }); var Nd = function(a) { this._isUpdatingLocationFromChildren = !1, this._isAdjusting = !1, this._expanded = !1, Nd.superClass.constructor.call(this, a) }; Ib.Group = Nd, Jb.ext('twaver.Group', Ib.Follower, { _image: Ed.IMAGE_GROUP, _icon: Ed.ICON_GROUP, isAdjustedToBottom: function() { return this.isExpanded() && vc.hasAgentLinks(this) }, onChildAdded: function(a, b) { Nd.superClass.onChildAdded.apply(this, arguments), this.updateLocationFromChildren() }, onChildRemoved: function(a, b) { Nd.superClass.onChildRemoved.apply(this, arguments), this.updateLocationFromChildren() }, updateLocationFromChildren: function() {
    if (!this._isAdjusting && !Jb.isDeserializing) {
      for (var a, b, c = 0, d = this.getChildrenSize(); d > c; c++)b = this.getChildAt(c), b instanceof Ld && (a = Tb.unionRect(a, this.getChildRect(b))); a && (this._isUpdatingLocationFromChildren = !0, this.setLocation(a.x + a.width / 2 - this.getWidth() / 2, a.y + a.height / 2 - this.getHeight() / 2), this._isUpdatingLocationFromChildren = !1)
    }
  }, getChildRect: function(a) { var b; return a instanceof Ld && (a instanceof Nd ? (a.isExpanded() && a.getChildren().forEach(function(c) { b = Tb.unionRect(b, a.getChildRect(c)) }), b || (b = a.getRect())) : b = a.getRect()), b }, setLocation: function() { if (!this._isAdjusting) { var a; if (a = arguments.length === 2 ? { x: arguments[0], y: arguments[1] } : arguments[0], !Jb.isDeserializing && !this._isUpdatingLocationFromChildren) { this._isAdjusting = !0; var b = a.x - this.getX(), c = a.y - this.getY(); vc.moveElements(this.getChildren(), b, c), this._isAdjusting = !1 }Nd.superClass.setLocation.call(this, a) } }, reverseExpanded: function() { this.setExpanded(!this.isExpanded()) }, isExpanded: function() { return this._expanded }, setExpanded: function(a) { if (this._expanded !== a) { var b = this._expanded; this._expanded = a, this.firePropertyChange('expanded', b, this._expanded), this._checkLinkAgent() } }, _checkLinkAgent: function() { Nd.superClass._checkLinkAgent.call(this); for (var a = this.getChildrenSize(), b = 0; a > b; b++) { var c = this.getChildAt(b); c instanceof Ld && c._checkLinkAgent() } }, getElementUIClass: function() { return Ib.network.GroupUI }, getCanvasUIClass: function() { return Ib.canvas.GroupUI }, getVectorUIClass: function() { return Ib.vector.GroupUI } }), Ib.SubNetwork = function(a) { Ib.SubNetwork.superClass.constructor.call(this, a) }, Jb.ext('twaver.SubNetwork', Ib.Follower, { ISubNetwork: !0, _image: Ed.IMAGE_SUBNETWORK, _icon: Ed.ICON_SUBNETWORK, _checkLinkAgent: function() { Ib.SubNetwork.superClass._checkLinkAgent.call(this); for (var a = this.getChildrenSize(), b = 0; a > b; b++) { var c = this.getChildAt(b); c instanceof Ld && c._checkLinkAgent() } } }), Ib.Grid = function(a) { Ib.Grid.superClass.constructor.call(this, a) }, Jb.ext('twaver.Grid', Ib.Follower, { _icon: Ed.ICON_GRID, _image: null, getCellObject: function(a, b) { arguments.length === 1 && (b = a.y, a = a.x); for (var c = this.getStyle('grid.row.count'), d = this.getStyle('grid.column.count'), e = 0; c > e; e++) for (var f = 0; d > f; f++) { var g = this.getCellRect(e, f); if (Tb.containsPoint(g, a, b)) return { rowIndex: e, columnIndex: f, rect: g } } return null }, getCellRect: function(a, b) { var c = this.getStyle('grid.row.count'), d = this.getStyle('grid.column.count'); if (c <= 0 || d <= 0) return null; if (a < 0 || a >= c) return null; if (b < 0 || b >= d) return null; var e = this.getRect(); Tb.addPadding(e, this, 'grid.border'); var f = 0, g = this.getStyle('grid.row.percents'), h = this.getStyle('grid.column.percents'); if (g && g.length === c) { var i = 0; for (f = 0; a > f; f++)i += e.height * g[f]; e.y += i, e.height = e.height * g[a] } else e.height = e.height / c, e.y += e.height * a; if (h && h.length === d) { var j = 0; for (f = 0; b > f; f++)j += e.width * h[f]; e.x += j, e.width = e.width * h[b] } else e.width = e.width / d, e.x += e.width * b; return Tb.addPadding(e, this, 'grid.padding'), e }, getElementUIClass: function() { return Ib.network.GridUI }, getCanvasUIClass: function() { return Ib.canvas.GridUI }, getVectorUIClass: function() { return Ib.vector.GridUI } }), Ib.ShapeNode = function(a) { this._isUpdatingShapeNode = !1, this._points = new nd(), Ib.ShapeNode.superClass.constructor.call(this, a) }, Jb.ext('twaver.ShapeNode', Ib.Follower, { _icon: Ed.ICON_SHAPENODE, __accessor: ['segments'], getElementUIClass: function() { return Ib.network.ShapeNodeUI }, getCanvasUIClass: function() { return Ib.canvas.ShapeNodeUI }, getVectorUIClass: function() { return Ib.vector.ShapeNodeUI }, getPoints: function() { return this._points }, setPoints: function(a) { a || (a = new nd()); var b = new nd(this._points); this._points = a, this.firePointsChange(b, this._points) }, getSegments: function() { return this._segments }, setSegments: function(a) { a || (a = new nd()); var b = new nd(this._segments); this._segments = a, this._reCalculateLineLength(), this.firePropertyChange('segments', b, this._segments) }, addPoint: function(a, b) { var c = new nd(this._points); this._points.add(a, b), this.firePointsChange(c, this._points) }, setPoint: function(a, b) { var c = new nd(this._points); this._points.set(a, b), this.firePointsChange(c, this._points) }, removePoint: function(a) { var b = new nd(this._points); this._points.remove(a), this.firePointsChange(b, this._points) }, removeAt: function(a) { var b = new nd(this._points); this._points.removeAt(a), this.firePointsChange(b, this._points) }, setWidth: function(a) { if (a < 1 && (a = 1), !this._isUpdatingShapeNode && !Jb.isDeserializing) { this._isUpdatingShapeNode = !0; for (var b = new nd(this._points), c = 0; c < this._points.size(); c++) { var d = this._points.get(c); d.x = (d.x - this.getX()) * a / this.getWidth() + this.getX() } this.firePointsChange(b, this._points), this._isUpdatingShapeNode = !1 }Ib.ShapeNode.superClass.setWidth.apply(this, arguments) }, setHeight: function(a) { if (a < 1 && (a = 1), !this._isUpdatingShapeNode && !Jb.isDeserializing) { this._isUpdatingShapeNode = !0; for (var b = new nd(this._points), c = 0; c < this._points.size(); c++) { var d = this._points.get(c); d.y = (d.y - this.getY()) * a / this.getHeight() + this.getY() } this.firePointsChange(b, this._points), this._isUpdatingShapeNode = !1 }Ib.ShapeNode.superClass.setHeight.apply(this, arguments) }, setLocation: function() { if (!this._isUpdatingShapeNode && !Jb.isDeserializing) { var a; if (a = arguments.length === 2 ? { x: arguments[0], y: arguments[1] } : arguments[0], !Jb.num(a.x) || !Jb.num(a.y)) return; var b = a.x - this.getX(), c = a.y - this.getY(); if (b === 0 && c === 0) return; this._isUpdatingShapeNode = !0; for (var d = new nd(this._points), e = 0; e < this._points.size(); e++) { var f = this._points.get(e); f.x += b, f.y += c } this.firePointsChange(d, this._points), this._isUpdatingShapeNode = !1 }Ib.ShapeNode.superClass.setLocation.apply(this, arguments) }, firePointsChange: function(a, b) { if (!this._isUpdatingShapeNode && !Jb.isDeserializing) { var c = Tb.getRect(b); c ? (this._isUpdatingShapeNode = !0, Ed.CENTER_LOCATION ? this.setLocation(c.x + c.width / 2, c.y + c.height / 2) : this.setLocation(c.x, c.y), this.setWidth(c.width), this.setHeight(c.height), this._isUpdatingShapeNode = !1) : (this._isUpdatingShapeNode = !0, this.setWidth(0), this.setHeight(0), this._isUpdatingShapeNode = !1) } this._reCalculateLineLength(), this.firePropertyChange('points', a, b) }, _reCalculateLineLength: function() { this._lineLength = this._points != null && this._points.size() > 0 ? Tb.calculateLineLength(this._points, this._segments) : 0 }, getLineLength: function() { return this._lineLength } }), Ib.Bus = function(a) { this._styleMap = {}, this._styleMap['vector.fill'] = !1, this._styleMap['shapenode.closed'] = !1, Ib.Bus.superClass.constructor.call(this, a) }, Jb.ext('twaver.Bus', Ib.ShapeNode, { _icon: Ed.ICON_BUS, firePointsChange: function(a, b) { var c = b.size(); if (!Jb.isDeserializing && c >= 2) for (var d = b.get(0), e = 1; c > e; e++) { var f = b.get(e); Math.abs(f.x - d.x) > Math.abs(f.y - d.y) ? f.y = d.y : f.x = d.x, d = f }Ib.Bus.superClass.firePointsChange.apply(this, arguments) } }), Ib.ShapeLink = function(a, b, c) { this._points = new nd(), this._styleMap = {}, this._styleMap['link.bundle.enable'] = !1, Ib.ShapeLink.superClass.constructor.call(this, a, b, c) }, Jb.ext('twaver.ShapeLink', Ib.Link, { _icon: Ed.ICON_SHAPELINK, getElementUIClass: function() { return Ib.network.ShapeLinkUI }, getCanvasUIClass: function() { return Ib.canvas.ShapeLinkUI }, getVectorUIClass: function() { return Ib.vector.ShapeLinkUI }, getPoints: function() { return this._points }, setPoints: function(a) { a || (a = new nd()); var b = new nd(this._points); this._points = a, this.firePointsChange(b, this._points) }, addPoint: function(a, b) { var c = new nd(this._points); this._points.add(a, b), this.firePointsChange(c, this._points) }, setPoint: function(a, b) { var c = new nd(this._points); this._points.set(a, b), this.firePointsChange(c, this._points) }, removePoint: function(a) { var b = new nd(this._points); this._points.remove(a), this.firePointsChange(b, this._points) }, removeAt: function(a) { var b = new nd(this._points); this._points.removeAt(a), this.firePointsChange(b, this._points) }, firePointsChange: function(a, b) { this.firePropertyChange('points', a, b) } }), Ib.ShapeSubNetwork = function(a) { Ib.ShapeSubNetwork.superClass.constructor.call(this, a) }, Jb.ext('twaver.ShapeSubNetwork', Ib.ShapeNode, { ISubNetwork: !0, _icon: Ed.ICON_SHAPESUBNETWORK, _checkLinkAgent: function() { Ib.ShapeSubNetwork.superClass._checkLinkAgent.call(this); for (var a = this.getChildrenSize(), b = 0; a > b; b++) { var c = this.getChildAt(b); c instanceof Ld && c._checkLinkAgent() } } }), Ib.LinkSubNetwork = function() { Ib.LinkSubNetwork.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.LinkSubNetwork', Ib.Link, { ISubNetwork: !0, _icon: Ed.ICON_LINKSUBNETWORK }), Ib.ShapeLinkSubNetwork = function() { Ib.ShapeLinkSubNetwork.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.ShapeLinkSubNetwork', Ib.ShapeLink, { ISubNetwork: !0, _icon: Ed.ICON_LINKSUBNETWORK }), Ib.RotatableNode = function(a) { Ib.RotatableNode.superClass.constructor.call(this, a) }, Jb.ext('twaver.RotatableNode', Ib.Follower, { getWidth: function() { return this._angle == 0 ? this._getOrignalWidth() : this._getRotateRect().width }, setWidth: function(a) {}, getHeight: function() { return this._angle == 0 ? this._getOrignalHeight() : this._getRotateRect().height }, setHeight: function(a) {}, getElementUIClass: function() { return Ib.network.RotatableNodeUI }, getCanvasUIClass: function() { return Ib.canvas.RotatableNodeUI }, getVectorUIClass: function() { return Ib.vector.RotatableNodeUI }, _getRotateRect: function() { for (var a = this._getOrignalWidth(), b = this._getOrignalHeight(), c = Tb.createMatrix(this._angle * Math.PI / 180, a / 2, b / 2), d = [{ x: 0, y: 0 }, { x: a, y: 0 }, { x: a, y: b }, { x: 0, y: b }], e = 0, f = d.length; f > e; e++)d[e] = c.transform(d[e]); return Tb.getRect(d) }, _getOrignalWidth: function() { return Ib.RotatableNode.superClass.getWidth.call(this) }, _getOrignalHeight: function() { return Ib.RotatableNode.superClass.getHeight.call(this) } }), Ib.controls.ControlBase = function() { Ib.controls.ControlBase.superClass.constructor.apply(this, arguments), this._pools = new nd() }, Jb.ext('twaver.controls.ControlBase', Ib.PropertyChangeDispatcher, { _autoAdjustBounds: !1, addPool: function(a) { this._pools.contains(a) || this._pools.add(a) }, removePool: function(a) { this._pools.remove(a) }, adjustBounds: function(a) { var b = this._view.style; b.position = 'absolute', b.left = a.x + 'px', b.top = a.y + 'px', b.width = a.width + 'px', b.height = a.height + 'px', this._autoAdjustBounds === !0 && (b.left = '0px', b.top = '0px', b.right = '0px', b.bottom = '0px'), this.invalidate && this.invalidate() }, setAutoAdjustBounds: function(b) { b === !0 ? Wb.addEventListener('resize', '_handleResize', a, this) : Wb.removeEventListener('resize', a, this), this._autoAdjustBounds = b }, isAutoAdjustBounds: function() { return this._autoAdjustBounds }, _handleResize: function(a) { this.adjustBounds({ x: 0, y: 0, width: Ob.documentElement.clientWidth, height: Ob.documentElement.clientHeight }) }, getView: function() { return this._view }, invalidate: function(a) { this._invalidate || (this._invalidate = !0, Jb.callLater(this.validate, this, null, a)) }, validate: function() { this._invalidate && (this._invalidate = !1, this._view.offsetWidth === 0 && this._view.offsetHeight === 0 && this._reinvalidateCount !== null ? (this._reinvalidateCount === b && (this._reinvalidateCount = 100), this._reinvalidateCount > 0 ? this._reinvalidateCount-- : this._reinvalidateCount = null, this.invalidate()) : this.validateImpl()) }, validateImpl: function() {} }), Ib.controls.ViewBase = function() { Ib.controls.ViewBase.superClass.constructor.apply(this, arguments), this._interactionDispatcher = new Ib.EventDispatcher(), this._viewDispatcher = new Ib.EventDispatcher() }, Jb.ext('twaver.controls.ViewBase', Ib.controls.ControlBase, { __bool: ['focusOnClick'], _focusOnClick: Ed.FOCUS_ON_CLICK, getSelectionModel: function() { return this._selectionModel ? this._selectionModel : this._box.getSelectionModel() }, isShareSelectionModel: function() { return this._selectionModel == null }, setShareSelectionModel: function(a) { var b = this._selectionModel == null; b !== a && (a ? (this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this), this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange, this), this._selectionModel.dispose(), this._selectionModel = null) : (this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this), this._selectionModel = new Ib.SelectionModel(this._box), this._selectionModel.addSelectionChangeListener(this.handleSelectionChange, this)), this.onShareSelectionModelChanged(), this.firePropertyChange('shareSelectionModel', b, a)) }, removeSelection: function() { if (this.getSelectionModel().size() === 0) return null; var a = this.getSelectionModel().toSelection(); return this._box._undoManager._enabled && this._box._undoManager.startBatch(), a.forEach(function(a) { this._box.remove(a) }, this), this._box._undoManager._enabled && this._box._undoManager.endBatch(), a }, selectAll: function() { var a = new nd(); return this._box.forEach(function(b) { this.isVisible(b) && a.add(b) }, this), this.getSelectionModel().setSelection(a), a }, isSelected: function(a) { return this.getSelectionModel().contains(a) }, isSelectable: function(a) { return this.getSelectionModel().isSelectable(a) }, getLabel: function(a) { return a.getName() }, getToolTip: function(a) { return a.getToolTip() }, getIcon: function(a) { return a.getIcon() }, getSelectColor: function(a) { return Ed.SELECT_COLOR }, addViewListener: function(a, b, c) { this._viewDispatcher.add(a, b, c) }, removeViewListener: function(a, b) { this._viewDispatcher.remove(a, b) }, fireViewEvent: function(a) { this._viewDispatcher.fire(a) }, addInteractionListener: function(a, b, c) { this._interactionDispatcher.add(a, b, c) }, removeInteractionListener: function(a, b) { this._interactionDispatcher.remove(a, b) }, fireInteractionEvent: function(a) { this._interactionDispatcher.fire(a) }, invalidate: function(a) { this._invalidate || (this._invalidate = !0, this.fireViewEvent({ kind: 'invalidate' }), Jb.callLater(this.validate, this, null, a)) }, validate: function() { this._invalidate && (this._invalidate = !1, Mb || this._view.offsetWidth !== 0 || this._view.offsetHeight !== 0 || this._reinvalidateCount === null ? (this._isValidating = !0, this.fireViewEvent({ kind: 'validateStart' }), this.validateImpl(), this.fireViewEvent({ kind: 'validateEnd' }), delete this._isValidating) : (this._reinvalidateCount === b && (this._reinvalidateCount = 100), this._reinvalidateCount > 0 ? this._reinvalidateCount-- : this._reinvalidateCount = null, this.invalidate())) } }), Ib.controls.View = function() { Ib.controls.View.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.controls.View', Ib.controls.ViewBase, { _zoom: 1, _maxZoom: Ed.ZOOM_MAX, _minZoom: Ed.ZOOM_MIN, getRootDiv: function() { return this._rootDiv }, isValidEvent: function(a) { return Wb.isValidEvent(this._view, a) }, getAlarmFillColor: function(a) { if (a.IElement) { var b = a.getAlarmState().getHighestNewAlarmSeverity(); if (b) return b.color } return null }, getInnerColor: function(a) { if (a.IElement) { var b = a.getAlarmState().getHighestNativeAlarmSeverity(); return b ? b.color : a.getStyle('inner.color') } return null }, getOuterColor: function(a) { if (a.IElement) { var b = a.getAlarmState().getPropagateSeverity(); return b ? b.color : a.getStyle('outer.color') } return null }, zoomOverview: function(a) { var b = Math.min(this._view.clientWidth / this._viewRect.width, this._view.clientHeight / this._viewRect.height); this.setZoom(b, a) }, getLogicalPoint: function(a) { return Wb.getLogicalPoint(this._view, a, this.getZoom(), this._rootDiv) }, centerByLogicalPoint: function(a, b, c) { c && Ib.animate.AnimateManager.endAnimate(); var d = this._view.scrollWidth - this._view.clientWidth, e = this._view.scrollHeight - this._view.clientHeight, f = (a - this._view.clientWidth / this._zoom / 2) * this._zoom, g = (b - this._view.clientHeight / this._zoom / 2) * this._zoom; f < 0 && (f = 0), g < 0 && (g = 0), f > d && (f = d), g > e && (g = e), c ? Ib.animate.AnimateManager.start(new Ib.animate.AnimateScrollPosition(this._view, f, g)) : (this._view.scrollLeft = f, this._view.scrollTop = g) }, panByOffset: function(a, b) { a *= this.getZoom(), b *= this.getZoom(); var c = this._view.scrollLeft + a, d = this._view.scrollTop + b, e = this._view.scrollWidth - this._view.clientWidth, f = this._view.scrollHeight - this._view.clientHeight; c < 0 && (c = 0), c > e && (c = e), d < 0 && (d = 0), d > f && (d = f); var g = { x: (c - this._view.scrollLeft) / this.getZoom(), y: (d - this._view.scrollTop) / this.getZoom() }; return this._view.scrollLeft = c, this._view.scrollTop = d, g }, getMaxZoom: function() { return this._maxZoom }, setMaxZoom: function(a) { if (!(a < 0)) { var b = this._maxZoom; this._maxZoom = a, this.firePropertyChange('maxZoom', b, a), this.getZoom() > a && this.setZoom(a) } }, getMinZoom: function() { return this._minZoom }, setMinZoom: function(a) { if (!(a < 0)) { var b = this._minZoom; this._minZoom = a, this.firePropertyChange('minZoom', b, a), this.getZoom() < a && this.setZoom(a, !1) } }, getZoom: function() { return this._zoom }, onZoomChanged: function(a, b) {}, zoomIn: function(a) { this.setZoom(this._zoom * Ed.ZOOM_INCREMENT, a) }, zoomOut: function(a) { this.setZoom(this._zoom / Ed.ZOOM_INCREMENT, a) }, zoomReset: function(a) { this.setZoom(1, a) }, checkZoom: function(a) { return a < this._minZoom && (a = this._minZoom), a > this._maxZoom && (a = this._maxZoom), a }, setZoom: function(a, b) { if (Jb.num(a) && !(a <= 0) && (a = this.checkZoom(a), a !== this._zoom)) if (b == null && (b = Ed.ZOOM_ANIMATE), b)Ib.animate.AnimateManager.start(new Ib.animate.AnimateZoom(this, a)); else { var c = (this._view.scrollLeft + this._view.clientWidth / 2) / this._zoom, d = (this._view.scrollTop + this._view.clientHeight / 2) / this._zoom, e = this._zoom; this._zoom = a, Wb.setZoom(this._rootDiv, a), this.firePropertyChange('zoom', e, a), this.onZoomChanged(e, a), this.centerByLogicalPoint(c, d, !1) } }, setTouchZoom: function(a) { this.setZoom(a, !1) } }), (function() {
    var a = function(a, b, c, d) { var e = new Pb(); e.src = d, Ib.Util.registerImage(a, e, b, c) }; a('subnetwork_image', 64, 46, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC'), a('bus_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC'), a('data_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=='), a('databox_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII='), a('grid_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=='), a('group_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=='), a('group_image', 32, 29, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC'), a('link_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=='), a('linksubnetwork_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII='), a('node_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=='), a('node_image', 30, 32, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII='), a('shapelink_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII='), a('shapenode_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC'), a('shapesubnetwork_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII='), a('subnetwork_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII='), a = function(a, b, c, d) { Ib.Util.registerImage(a, d, b, c) }, a('expand_icon', 16, 18, 'data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=='),
    a('collapse_icon', 16, 18, 'data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7'), a('close_icon', 11, 11, 'data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs='), a('sort_desc', 9, 5, 'data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs='), a('sort_asc', 9, 5, 'data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs='), a('submenu_enable_icon', 8, 8, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAA7SURBVHjafI9BDgAgDMKqH3c/ryd1iTqOpARARQUYJG0/AWboB2yoAgTG8jtvtXvMSUdVEdXIeN2cAwDPLmAjfDYS7AAAAABJRU5ErkJggg=='), a('submenu_disable_icon', 8, 8, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABKSURBVHjafM9BDoAgDETRD1cTz0W9luDZxhUBCjpJkzZ9m0ESkrhLzW0fJ9JjpT4Zl+juBXmwoB0ACH/gOtNhX2B6AjDUtF3NdwAU6zx4LEQe5AAAAABJRU5ErkJggg=='), a('checkbox_selected_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAflJREFUeNqkk09oE1EQxn+7btyIYBRCbayFtlhEtLeAin+KouDNo548eJHCQkFQC1K0Bw8VqT1EVIqo0IMUvejNg6AIIglSsdSCiA0WolaIOWi3+2fGw242CRFBHPjg8d7MfPO+mTEcxzkNDAF5/s1KwE0cxylWKhX1fV89r44gget6bVhd9bRcLqvjOEULyGezWTwvAMAwjIRCRAnD8I/0nZ05gLwZOTYeVBXQOIGgqgk+flrk3MUxVBWRyMeMw5oCG2eREFVBVZibf8+x4ydZLH9GVRISq5W5uXwhDKPSvnz9xolTZ/A29GNZFiJ1kjhBnVFVEw0a7MrQ8HlqbMZwXeYXlpL7ti/Usbz8Hd8PEBGmHzxk9kMVfI+BrWt4PHM/0abtC67r8vTZC4qlWY4c2s/Azh2MTxQwpIPduzZx99Z1bNtu1yBiFp6/fMXr4ht+/NzI+MQNBg/sxdccPbmAqcI1UqkUEresTQMR5ejhQbb19XJ25BJzC8Lbd3dIp22mCtPY9tokuDmB2VyBqtDb082VyxdYv26JXysrTF4dY0uuI3lvoKWCaOoMA1SF7q4u7t2eZObREw7u25MMTbPF8VGCqHNRB4IgQFXY3t/H6MhwLFirGYZBfeItoFSr1fKZTAbVaPbT6fRf19A0TarVKkDJ+N91/j0A8Y5o3Yt7KRAAAAAASUVORK5CYII='), a('checkbox_unselected_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiUlEQVR42qXM3QYFIRiF4d3dJpIhI5FKJCOSSHe7f9gn4ztZo3Wwzt6HvTbHfhdCeD8Nvw27Ad57OI4xUsA5BwMpJQpYa2Eg50wBYwwMlFIocJ4nDFzXRQGtNQzUWilwHAcMtNYooJSCgd47BaSUMDDGoIAQAgbmnBTgnMPAWosCcP3fDdjZNvABvRhVEQglsV8AAAAASUVORK5CYII='), a('radiobutton_selected_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNrUUz9rwkAUv0syBVxMm01L2lIdilOg4BcQ7eKcIV/AqZAxo1/B2a/QoSSTH6AQCoFMJUSig5C0EiPEv8G+Z604eJNTHxz37vf73Y977+7obrcjlwRHLoyLDYTThWmav6AgKDA9wrg6UF8wvO12O8RFt9s9bwACwvP8U6lUajWbzbYsy/eIR1Hk27b9GgSBlef5O7OEzWZzC5ufNU17gc01gEQcmCOGHGqYJaxWq1qj0WhzHFfwfZ84jrPHVVUliqIUkPM87wOg4KzBcrm8liTpbr1ek8FgQNI03eOz2Yzouk6QQw3zBFmWUewDxnQ6JUmSHHsDRz9qmD0A8ns8HgcortfrRxxzxJBDDfMEi8XC7ff7b4Zh3FSr1UKlUtnjlFI0mCOHGqZBHMd+GIbWZDIROp1OCxqH74HA9Q17vZ7luq4liqJ/uoee/oVyufxX/wPctwqpfKAieB9OsVj8xMVoNDpv8D8/048AAwDskrF8QGeJUgAAAABJRU5ErkJggg=='), a('radiobutton_unselected_icon', 16, 16, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATVJREFUeNrUU71qhEAQ9q8S0mhip3C5kCpcFcgjiJfmal/BKr2lr2DtK1wR9BkCaYRUQTzUQtDE5sB/MTOJAQs3jVUGhp2Z75vPnV2XHseRWmMMtdJWC3DzxDTNnyLHbWC5A7+coA/wt77vT5hYlrUsAASKZdkHWZb3mqYdJEm6wXqWZYHneccwDN1hGF6II3Rddw3Nj7quP0HzDko8OsZYQww5RIGmaXaqqh4YhrnA3cwda4ghh3gGdV1fiaK4bdt28cAQQw5RoCxLGr/2lyGHOAKAn0mShDAnteSIIYcoUFWV7zjOM5DPuJPfxik+I4Yc4gh5ngdRFLlpmnKGYew3YFiH6zvZtu36vu/yPB/Me+j5W1AU5XstiuIW7vseQmmCMvg/XgVBeMckjuNlgf/5mL4EGAAhHbltcqEYDQAAAABJRU5ErkJggg=='), a('right_expand_icon', 6, 11, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjJGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjNGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE5MUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE5MkZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqPQWR4AAABJSURBVHjaYvT08vrPwMAgCsQM27ZufcMABUxQ+jWI8PL2FkGXwJBElkCRRJeAS2KTAEvikhDFJiGKzSi4f5iwCSLrwPA5QIABAAmgFhOOHdKvAAAAAElFTkSuQmCC'), a('left_expand_icon', 6, 11, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjZGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjdGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3RkFFMUVCNEZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3RkFFMUVCNUZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PmpWGHAAAABISURBVHjaYvz//z8DDHh5e4tAma+ZsAmCCCZsgiDAfOr0aQxBuA50QZgEhiBMQhSXBAM2SaZtW7e+wSYJ1oFNEu5BdEmAAAMAvV8Xc/cw3YgAAAAASUVORK5CYII='), a('up_expand_icon', 11, 6, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEZGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOTBGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE4REZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE4RUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnCNygcAAABGSURBVHjaYvz//z8DDHh5e4tAma+BWBTE2LZ16xuYPBMOhXAaSRyiGItCBmwaGD29vHApRAaiyM7ApxAuz0SEQrgGgAADALOxFSETkKKwAAAAAElFTkSuQmCC'), a('down_expand_icon', 11, 6, 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0xpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOENGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEJGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtPgXX8AAAA7SURBVHjaYvH08vrPQCRgAmJRItWKMsEYhBSCTd62desbAhrA4iB1TDAGDg2iyPIwZ2DTIIomzgAQYAAmahUFv1Iq6AAAAABJRU5ErkJggg==')
  }()), Rb.__tree = function(a, b) { a._rootVisible = !0, a._initTree = function(a) { this._rootData = null, this._expandMap = {}, this._levelMap = {} }, a.validateModel = function() { this._rowDatas.clear(), this._levelMap = {}, this._dataRowMap = {}, this._currentLevel = 0, this._rootData ? this._rootVisible ? this.isVisible(this._rootData) && this._buildData(this._rootData) : this._buildChildren(this._rootData) : this._buildChildren(), delete this._currentLevel }, a._buildData = function(a) { this._dataRowMap[a.getId()] = this._rowDatas.size(), this._rowDatas.add(a), this._levelMap[a.getId()] = this._currentLevel, this.isExpanded(a) && (this._currentLevel++, this._buildChildren(a), this._currentLevel--) }, a._buildChildren = function(a) { var b = a ? a.getChildren() : this._box.getRoots(), c = this.getCurrentSortFunction(); c && this.isChildrenSortable(a) ? b.toList(this.isVisible, this).sort(c).forEach(function(a) { this._buildData(a) }, this) : b.forEach(function(a) { this.isVisible(a) && this._buildData(a) }, this) }, a.getLevel = function(a) { return this._levelMap[a.getId()] }, a.getToggleImage = function(a) { return a.getChildrenSize() > 0 ? this.isExpanded(a) ? this._expandIcon : this._collapseIcon : null }, a.isCheckable = function(a) { return this.isCheckMode() }, a.isCheckMode = function() { return Rb.__tree._checkMap[this._checkMode] === 1 }, a.isChildrenSortable = function(a) { return !0 }, a.handleDataBoxChange = function(a) { a.kind === 'remove' ? delete this._expandMap[a.data.getId()] : a.kind === 'clear' && (this._expandMap = {}), this.invalidateModel() }, a.isExpanded = function(a) { return this._expandMap[a.getId()] === 1 }, a.expand = function(a) { if (!this.isExpanded(a)) { for (var b = a.getParent(); b != null && b !== this._rootData;) this._expandMap[b.getId()] = 1, b = b.getParent(); this._expandMap[a.getId()] = 1, this.invalidateModel() } }, a.collapse = function(a) { this.isExpanded(a) && (delete this._expandMap[a.getId()], this.invalidateModel()) }, a.expandAll = function() { this._box.forEach(function(a) { this._expandMap[a.getId()] = 1 }, this), this.invalidateModel() }, a.collapseAll = function() { this._expandMap = {}, this.invalidateModel() }, a._handleClick = function(a) { if (this.isFocusOnClick() && Ib.Util.setFocus(this._view), !this._isValidating) { var b; if (a.target._expandData)b = a.target._expandData, this.isExpanded(b) ? (this.collapse(b), this.fireInteractionEvent({ kind: 'collapse', data: b })) : (this.expand(b), this.fireInteractionEvent({ kind: 'expand', data: b })); else if (a.target._selectData || a.target.parentNode._selectData) { if (this._handlePressSelection(a.target._selectData || a.target.parentNode._selectData, a), this.isCheckMode()) { var c = this.getRowIndexAt(a); c >= 0 && this.__handleClick(a) } } else this._treeColumn ? (b = this.getDataAt(a), b && (this.isCheckMode() ? a.target._checkData || this.__handleClick(a) : this._handlePressSelection(b, a))) : this.isCheckMode() && !a.target._checkData && this.__handleClick(a); if (this._currentEditor && !this._isCommitting && (this._isCommitting = !0, this.commitEditValue(this._currentEditor._editInfo, this._currentEditor)), this.updateCurrentEditor) { var d = this; setTimeout(function() { d.updateCurrentEditor(a) }, 0) } } }, a.__handleClick = function(a) { var b = this.getDataAt(a), c = this.getRowIndexByData(b); if (this._focusedRow !== c) { var d = this._rowDatas.get(this._focusedRow); this._focusedRow = c, d && this.invalidateData(d), this.invalidateData(b) } }, a.handleChange = function(a) { if (!(this._isCommitting || this._isCanceling || this._isValidating)) { var b = a.target._checkData; if (b) { var c, d = this.isSelected(b), e = this.getSelectionModel(); if (this._checkMode === 'default')d ? e.removeSelection(b) : e.appendSelection(b); else if (this._checkMode === 'children')c = new nd(b), c.addAll(b.getChildren()); else if (this._checkMode === 'descendant')c = new nd(), Jb.fillDescendant(b, c); else if (this._checkMode === 'descendantAncestor' && (c = new nd(), Jb.fillDescendant(b, c), !d)) for (var f = b.getParent(); f;)c.add(f), f = f.getParent(); d ? e.removeSelection(c) : e.appendSelection(c) }a.target._editInfo && this.commitEditValue && (this._isCommitting = !0, this.commitEditValue(a.target._editInfo, a.target)) } }, a.onLabelRendered = function(a, b, c, d, e, f) {}, a.onToggleImageRendered = function(a) {}, a._renderTree = function(a, b, c, d) { var e = this._levelMap[b.getId()], f = this.getToggleImage(b), g = this.getLineType(), h = this._indent, i = this.__spanPool.get(); i.style.width = f ? this._indent * e + 'px' : this._indent * (e + 1) + 'px', i.style.display = 'inline-block', i.style.position = 'relative', i.style.verticalAlign = 'top', i.style.margin = '0px 1px 0px 1px', i.style.width = (e + 1) * h + 'px', a.appendChild(i); var j = b, k = j.getParent(), l = 0; if (g === 'dotted' || g === 'solid') { if (k == null) { var m = this.getIcon(b); this._addLine(i, b, m, !0) } for (;k !== null;) { var n = k.getChildren(), o = j === n.get(n.size() - 1), m = this.getIcon(j); j.setClient('isLast', o), l == 0 && this._addLine(i, b, m, o), l++, j = k, k = k.getParent() } } if (f) { var p = this.__imagePool.get(); p.setAttribute('src', Jb.getImageSrc(f)), p.style.verticalAlign = 'middle', p._expandData = b, p.style.position = 'absolute', p.style.right = '0px'; var q = this; p.onload = function() { p.style.top = q.getRowHeight() / 2 - p.height / 2 + 'px' }, i.appendChild(p), this.onToggleImageRendered(p) } var r = this.isCheckable(b), s = this.getUncheckableStyle() === 'disabled'; if (r || s) { var t = this._addCheckBox(a, b, d); t.disabled = !r } var m = this.getIcon(b); if (m) { var u = this.isCheckMode() || this._treeColumn ? null : b; this._addIcon(a, b, m, u) } var v = this.getLabel(b); v && (i = this.__textPool.get(), i.style.whiteSpace = 'nowrap', i.style.verticalAlign = 'middle', i.style.padding = '1px 2px 1px 2px', Jb.setText(i, v, this._treeColumn ? this._treeColumn.isInnerText() : this._innerText), this.isCheckMode() || this._treeColumn ? this._focusedRow === c && (i.style.backgroundColor = this.getSelectColor(b)) : (i._selectData = b, i.style.backgroundColor = d ? this.getSelectColor(b) : ''), this.onLabelRendered(i, b, v, c, e, d), a.appendChild(i), a.title = this.getToolTip(b)) } }, Rb.__tree._checkMap = { 'default': 1, children: 1, descendant: 1, descendantAncestor: 1 }, Ib.Column = function(a) { Ib.Column.superClass.constructor.call(this, a) }, Jb.ext('twaver.Column', Ib.Data, { IColumn: !0, __property: 1, __accessor: ['width', 'horizontalAlign', 'valueType', 'propertyType', 'propertyName', 'editable', 'visible', 'sortable', 'resizable', 'movable', 'sortDirection', 'sortFunction', 'enumInfo'], __bool: ['innerText'], _innerText: Ed.COLUMN_INNER_TEXT, _width: Ed.COLUMN_WIDTH, _horizontalAlign: Ed.COLUMN_HORIZONTAL_ALIGN, _propertyName: null, _propertyType: Ed.COLUMN_PROPERTY_TYPE, _valueType: Ed.COLUMN_VALUE_TYPE, _editable: Ed.COLUMN_EDITABLE, _sortable: Ed.COLUMN_SORTABLE, _visible: Ed.COLUMN_VISIBLE, _resizable: Ed.COLUMN_RESIZABLE, _movable: Ed.COLUMN_MOVABLE, _sortDirection: 'asc', _sortFunction: Ed.SORT_FUNCTION, _enumInfo: null, renderCell: Ed.COLUMN_RENDER_CELL, renderHeader: Ed.COLUMN_RENDER_HEADER, setParent: function(a) { throw 'parent not supported' }, getEnumInfo: function() { return typeof this._enumInfo === 'object' ? this._enumInfo : typeof this._enumInfo === 'function' ? arguments.length === 1 ? this._enumInfo(arguments[0]) : this._enumInfo() : void 0 } }), Ib.ColumnBox = function(a) { Ib.ColumnBox.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.ColumnBox', Ib.DataBox, { _name: 'ColumnBox', add: function(a, b) { if (!a.IColumn) throw 'Only IColumn can be added into ColumnBox'; Ib.ColumnBox.superClass.add.apply(this, arguments) } }), Ib.Property = function(a) { Ib.Property.superClass.constructor.call(this, a) }, Jb.ext('twaver.Property', Ib.Data, { IProperty: !0, __property: 1, __accessor: ['horizontalAlign', 'valueType', 'editable', 'propertyType', 'propertyName', 'categoryName', 'enumInfo'], __bool: ['innerText'], _innerText: Ed.PROPERTY_INNER_TEXT, _horizontalAlign: Ed.PROPERTY_HORIZONTAL_ALIGN, _propertyName: null, _propertyType: Ed.PROPERTY_PROPERTY_TYPE, _valueType: Ed.PROPERTY_VALUE_TYPE, _editable: Ed.PROPERTY_EDITABLE, _categoryName: Ed.PROPERTY_CATEGORY_NAME, _enumInfo: null, renderName: Ed.PROPERTY_RENDER_NAME, renderValue: Ed.PROPERTY_RENDER_VALUE, isVisible: null, renderEditor: Ed.PROPERTY_RENDER_EDITOR, setParent: function(a) { throw 'parent not supported' }, setPropertyName: function(a) { var b = this._propertyName; this._propertyName = a, this.firePropertyChange('propertyName', b, a) }, setPropertyType: function(a) { var b = this._propertyType; this._propertyType = a, this.firePropertyChange('propertyType', b, a) }, getEnumInfo: function() { return typeof this._enumInfo === 'object' ? this._enumInfo : typeof this._enumInfo === 'function' ? arguments.length === 1 ? this._enumInfo(arguments[0]) : this._enumInfo() : void 0 } }), Ib.PropertyBox = function(a) { Ib.PropertyBox.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.PropertyBox', Ib.DataBox, { _name: 'PropertyBox', add: function(a, b) { if (!a.IProperty) throw 'Only IProperty can be added into PropertyBox'; Ib.PropertyBox.superClass.add.apply(this, arguments) } }), Ib.Tab = function(a) { Ib.Tab.superClass.constructor.call(this, a) }, Jb.ext('twaver.Tab', Ib.Data, { ITab: !0, __accessor: ['view', 'width', 'closable', 'resizable', 'movable', 'disabled', 'visible'], _icon: null, _width: Ed.TAB_WIDTH, _closable: Ed.TAB_CLOSABLE, _resizable: Ed.TAB_RESIZABLE, _movable: Ed.TAB_MOVABLE, _disabled: Ed.TAB_DISABLED, _visible: Ed.TAB_VISIBLE, setParent: function(a) { throw 'parent not supported' } }), Ib.TabBox = function(a) { Ib.TabBox.superClass.constructor.apply(this, arguments), this.getSelectionModel().setSelectionMode('singleSelection') }, Jb.ext('twaver.TabBox', Ib.DataBox, { _name: 'TabBox', add: function(a, b) { if (!a.ITab) throw 'Only ITab can be added into TabBox'; Ib.TabBox.superClass.add.apply(this, arguments) } }), Ib.controls.ListBase = function(a) {
    Ib.controls.ListBase.superClass.constructor.apply(this, arguments), this._invalidate = !1, this._invalidateModel = !1, this._invalidateDisplay = !1, this._invalidateDatas = null, this._rowDatas = new nd(), this._startRowIndex = 0, this._endRowIndex = 0, this._renderMap = {}, this._dataRowMap = {}, this.__divPool = new Ib.Pool('div', 20), this.__imagePool = new Ib.Pool('img', 20), this.__canvasPool = new Ib.Pool('canvas', 20), this.__spanPool = new Ib.Pool('span', 20), this.__textPool = new Ib.Pool('span', 20), this.__checkBoxPool = new Ib.Pool('input', 20), this.__linePool = new Ib.Pool('canvas', 20), this._pools.add(this.__divPool), this._pools.add(this.__linePool), this._pools.add(this.__imagePool), this._pools.add(this.__canvasPool), this._pools.add(this.__spanPool), this._pools.add(this.__textPool), this._pools.add(this.__checkBoxPool), this._view = Wb.createView('auto', !0), this._rootDiv = Wb.createDiv(), this._dataDiv = Wb.createDiv(), this._dataDiv.style.width = '1px',
    this._view.appendChild(this._rootDiv), this._rootDiv.appendChild(this._dataDiv), this.setDataBox(a || new Ib.DataBox()); var b = this; b.handleChange && b._view.addEventListener('change', function(a) { b.handleChange(a) }, !1), Qb.isTouchable ? Qb.isMSTouchable ? new Ib.controls.ListBaseMSTouchInteraction(this) : (new Ib.controls.ListBaseTouchInteraction(this), new Ib.controls.ListBaseInteraction(this)) : new Ib.controls.ListBaseInteraction(this)
  }, Jb.ext('twaver.controls.ListBase', Ib.controls.View, { __bool: ['innerText'], _innerText: Ed.LISTBASE_INNER_TEXT, getDataDiv: function() { return this._dataDiv }, getStartRowIndex: function() { return this._startRowIndex }, getEndRowIndex: function() { return this._endRowIndex }, getRowDatas: function() { return this._rowDatas }, getRowIndexByData: function(a) { return this._dataRowMap[a.getId()] }, getRowIndexById: function(a) { return this._dataRowMap[a] }, getRowSize: function() { return this._rowDatas.size() }, getDataBox: function() { return this._box }, setDataBox: function(a) { if (!a) throw 'DataBox can not be null'; if (this._box !== a) { var b = this._box; b && (b.removeDataBoxChangeListener(this.handleDataBoxChange, this), b.removeDataPropertyChangeListener(this.handlePropertyChange, this), b.removeHierarchyChangeListener(this.handleHierarchyChange, this), this._selectionModel || b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)), this._box = a, this._box.addDataBoxChangeListener(this.handleDataBoxChange, this), this._box.addDataPropertyChangeListener(this.handlePropertyChange, this), this._box.addHierarchyChangeListener(this.handleHierarchyChange, this), this._selectionModel ? this._selectionModel._setDataBox(a) : this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this), this.invalidateModel(), this.firePropertyChange('dataBox', b, this._box) } }, onPropertyChanged: function(a) { a.property === 'zoom' ? this.invalidate() : this.invalidateModel() }, invalidateModel: function() { this._invalidateModel || (this._invalidateModel = !0, this._invalidateDisplay = !0, this._invalidateDatas = null, this.invalidate()) }, invalidateDisplay: function() { this._invalidateDisplay || (this._invalidateDisplay = !0, this._invalidateDatas = null, this.invalidate()) }, invalidateData: function(a) { this._invalidateDisplay || (this._invalidateDatas || (this._invalidateDatas = {}), this._invalidateDatas[a.getId()] = a, this.invalidate()) }, validateImpl: function() { var a = this._view.scrollLeft, b = this._view.scrollTop; this._invalidateModel && (this._invalidateModel = !1, this.validateModel()), this._invalidateDisplay && (this._invalidateDisplay = !1, this._renderMap = {}, Wb.release(this._dataDiv), this._dataDiv.style.height = this.getRowSize() * this._rowHeight + 'px'); var c; if (this._invalidateDatas) { for (c in this._invalidateDatas) { var d = this._renderMap[c]; d && (Wb.release(d), this._dataDiv.removeChild(d), delete this._renderMap[c]) } this._invalidateDatas = null } var e = this._view.scrollTop / this._zoom, f = this._view.clientHeight / this._zoom; this._startRowIndex = Math.floor(e / this._rowHeight) - 2, this._endRowIndex = Math.ceil((e + f) / this._rowHeight) + 2, this._startRowIndex < 0 && (this._startRowIndex = 0), this._endRowIndex > this._rowDatas.size() && (this._endRowIndex = this._rowDatas.size()); for (var g = this._rowHeight - this._rowLineWidth - 2 + 'px', h = this._rowLineWidth + 'px', i = this._startRowIndex; i < this._endRowIndex; i++) { var j = this._rowDatas.get(i); c = j.getId(); var k = this._renderMap[c]; if (!k) { k = this.__divPool.get(); var l = k.style; l.position = 'absolute', l.whiteSpace = 'nowrap', l.lineHeight = g, l.top = i * this._rowHeight + 'px', l.borderStyle = 'solid', l.borderWidth = '0px', l.borderBottomWidth = h, l.borderBottomColor = this._rowLineColor, l.opacity = j.getStyle ? j.getStyle('whole.alpha') : 1, this._dataDiv.appendChild(k), this._renderMap[c] = k; var m = this.isSelected(j); this.renderData(k, j, i, m), this.onDataRendered(k, j, i, m) } } this._dataDiv.style.width = this.calculateSumWidth() + 'px', this._dataDiv.style.height === '0px' && (this._dataDiv.style.height = '1px'), Jb.keys(this._renderMap).forEach(function(a) { var b = this.getRowIndexById(a); if (b < this._startRowIndex || b >= this._endRowIndex) { var c = this._renderMap[a]; Wb.release(c), this._dataDiv.removeChild(c), delete this._renderMap[a] } }, this), this._pools.forEach(function(a) { a.clear() }), this._view.scrollLeft !== a && (this._view.scrollLeft = a), this._view.scrollTop !== b && (this._view.scrollTop = b), this.adjustRowSize(), this.onValidated() }, adjustRowSize: function() { var a, b, c = this._rowHeight - this._rowLineWidth + 'px', d = Math.floor((this._view.scrollLeft + this._view.clientWidth) / this._zoom) + 'px'; for (a in this._renderMap)b = this._renderMap[a], b.style.height = c, b.style.width = d }, onValidated: function() {}, onDataRendered: function(a, b, c, d) {}, calculateSumWidth: function() { return 0 }, _addCheckBox: function(a, b, c) { var d = this.__checkBoxPool.get(); return d.keepDefault = !0, d.type = 'checkbox', d.style.margin = '0px 2px', d.style.verticalAlign = 'middle', d._checkData = b, d.checked = c, d.disabled = !1, a.appendChild(d), d }, _addIcon: function(a, b, c, d) { var e, f = Jb.getImageAsset(c), g = this.getInnerColor(b), h = this.getOuterColor(b), i = this.getAlarmFillColor(b); if (f && f.getImage()) { var j = f.getWidth(), k = f.getHeight(); e = this.__canvasPool.get(), e.style.verticalAlign = 'middle', e.setAttribute('width', j), e.setAttribute('height', k); var l = e.getContext('2d'); l.clearRect(0, 0, j, k); var m = { x: 0, y: 0, width: j, height: k }; Nc(l, c, g, m, b, this), h && (l.lineWidth = 2, l.strokeStyle = h, l.beginPath(), l.rect(0, 0, j, k), l.closePath(), l.stroke()), i && (l.fillStyle = Xb.createRadialGradient(l, i, 'white', 1, k - 9, 8, 8, 0.75, 0.25), l.beginPath(), l.arc(5, k - 5, 4, 0, 2 * Math.PI, !0), l.closePath(), l.fill()) } else e = this.__imagePool.get(), e.style.verticalAlign = 'middle', e.setAttribute('src', Jb.getImageSrc(c)); e.style.margin = '0px 1px 0px 1px', e._selectData = d, a.appendChild(e) }, _addLine: function(a, b, c, d) { { var e, f, g = this.__linePool.get(), h = Jb.getImageAsset(c), i = this.getToggleImage(b), j = this._levelMap[b.getId()], k = this._indent, l = k, m = k, n = 0; this.isCheckable(b), this.getUncheckableStyle() === 'disabled' }n = 2, h && (l = h.getWidth(), m = h.getHeight()), d ? (e = (j + n - 1) * k + l, f = this.getRowHeight()) : (e = (j + n - 1) * k + l, f = this.getRowHeight()), a.style.width = (j + n - 1) * k + 'px', a.style.height = f + 'px'; { var o = this.getLineType(), p = this.getLineColor(), q = this.getLineAlpha(), r = this.getLineThickness(), s = this.getLineDash(); Jb.getImageSrc(i) }g.style.verticalAlign = 'top', g.style.margin = '0px 0px 0px 0px', g.style.zIndex = -1, g.setAttribute('width', e), g.setAttribute('height', f); var t = g.getContext('2d'); t.lineWidth = r, t.strokeStyle = p, t.globalAlpha = q, o === 'dotted' && t.setLineDash(s); var u = 2 * (j + n); if (d) { var v = b, w = v.getParent(); t.clearRect(0, 0, e, f); w === null && b.getChildrenSize() !== 0 && this.isExpanded(b) && (t.moveTo((j + n + 1) * e / u, f / 2 + m / 2), t.lineTo((j + n + 1) * e / u, f), t.stroke()); for (var x = 2 * j - 1; x >= 1; x -= 2) { if (v.getClient('isLast')) { if (v = w, w = v.getParent(), (x + 1) / 2 != j) continue } else v = w, w = v.getParent(); x == 2 * j - 1 ? (t.moveTo((x + n) * e / u, 0), t.lineTo((x + n) * e / u, f / 2), t.stroke(), t.moveTo((x + n) * e / u, f / 2), t.lineTo((x + n + 1) * e / u, f / 2), t.stroke(), b.getChildrenSize() !== 0 && this.isExpanded(b) && (t.moveTo((x + n + 2) * e / u, f / 2 + m / 2), t.lineTo((x + n + 2) * e / u, f), t.stroke())) : (t.moveTo((x + n) * e / u, 0), t.lineTo((x + n) * e / u, f), t.stroke()) } } else { var v = b, w = v.getParent(); t.clearRect(0, 0, e, f); for (var x = 2 * j - 1; x >= 1; x -= 2) { if (v.getClient('isLast')) { if (v = w, w = v.getParent(), (x + 1) / 2 != j) continue } else v = w, w = v.getParent(); t.moveTo((x + n) * e / u, 0), t.lineTo((x + n) * e / u, f), t.stroke(), x == 2 * j - 1 && (t.moveTo((x + n) * e / u, f / 2), t.lineTo((x + n + 1) * e / u, f / 2), t.stroke(), b.getChildrenSize() !== 0 && this.isExpanded(b) && (t.moveTo((x + n + 2) * e / u, f / 2 + m / 2), t.lineTo((x + n + 2) * e / u, f), t.stroke())) } } return a.appendChild(g), g }, isVisible: function(a) { return this._box.contains(a) ? this._visibleFunction ? this._visibleFunction(a) : !0 : !1 }, handleDataBoxChange: function(a) { this.invalidateModel() }, handlePropertyChange: function(a) { a.property === 'parent' ? this.invalidateModel() : this.invalidateData(a.source) }, handleHierarchyChange: function(a) { this.invalidateModel() }, handleSelectionChange: function(a) { a.datas.forEach(function(a) { this.invalidateData(a) }, this), this.onSelectionChanged(a) }, getRowIndexAt: function(a) { var b = this.getLogicalPoint(a); if (!b) return -1; var c = parseInt(b.y / this._rowHeight); return c >= 0 && c < this._rowDatas.size() ? c : -1 }, getDataAt: function(a) { var b = this.getRowIndexAt(a); return b >= 0 ? this._rowDatas.get(b) : null }, getCurrentSortFunction: function() { return this._sortFunction }, validateModel: function() { this._rowDatas.clear(), this._dataRowMap = {}, this._buildChildren(this._box.getRoots()), this._rowDatas = this._rowDatas.toList(this.isVisible, this); var a = this.getCurrentSortFunction(); a && this._rowDatas.sort(a); for (var b = this._rowDatas.size(), c = 0; b > c; c++) this._dataRowMap[this._rowDatas.get(c).getId()] = c }, _buildChildren: function(a) { a.forEach(function(a) { this._rowDatas.add(a), this._buildChildren(a.getChildren()) }, this) }, _handlePressSelection: function(a, b) { var c = this.getSelectionModel(); if (Jb.isCtrlDown(b))c.contains(a) ? c.removeSelection(a) : c.appendSelection(a); else if (b.shiftKey && c.getLastData()) { var d = c.getLastData(), e = this.getRowIndexByData(d), f = this.getRowIndexByData(a), g = new nd(); for (g.add(this.getRowDatas().get(e)); e !== f;)e += f > e ? 1 : -1, g.add(this.getRowDatas().get(e)); c.setSelection(g) } else c.size() === 1 && c.contains(a) || c.setSelection(a); this.fireInteractionEvent({ kind: b.detail === 2 ? 'doubleClick' : 'click', data: a }) }, _handleClick: function(a) { this.isFocusOnClick() && Ib.Util.setFocus(this._view); var b = this.getDataAt(a); if (b) { if (this.isCheckMode() && !a.target._checkData) { var c = this.getRowIndexByData(b); if (this._focusedRow !== c) { var d = this._rowDatas.get(this._focusedRow); this._focusedRow = c, d && this.invalidateData(d), this.invalidateData(b) } } this.isCheckMode() || this._handlePressSelection(b, a) } if (this._currentEditor && this.commitEditValue(this._currentEditor._editInfo, this._currentEditor), this.updateCurrentEditor) { var e = this; setTimeout(function() { e.updateCurrentEditor(a) }, 0) } }, handleChange: function(a) { if (!this._isCanceling && !this._isValidating) { var b = a.target._checkData; if (b) { var c = this.isSelected(b), d = this.getSelectionModel(); c ? d.removeSelection(b) : d.appendSelection(b) }a.target._editInfo && this.commitEditValue && this.commitEditValue(a.target._editInfo, a.target) } }, scrollToData: function(a) { if (a) { var b = this.getRowIndexById(a.getId()); if (!(b < 0)) { var c = b * this._rowHeight * this._zoom, d = c + this._rowHeight * this._zoom, e = this._view.scrollTop; this._view.scrollTop > c && (e = c), this._view.scrollTop + this._view.clientHeight < d && (e = d - this._view.clientHeight), this._view.scrollTop != e && (this._view.scrollTop = e, this.invalidate()) } } }, makeVisible: function(a) { this.isVisible(a) && (this.expand && this.expand(a), Jb.callLater(this.scrollToData, this, [a], 2 * Ed.CALL_LATER_DELAY)) }, onSelectionChanged: function(a) { this._makeVisibleOnSelected && (a.kind === 'append' || a.kind === 'set' || a.kind === 'all') && (this.expand && this.getSelectionModel().getSelection().forEach(function(a) { a.getParent() && this.expand(a.getParent()) }, this), Jb.callLater(this.scrollToData, this, [this.getSelectionModel().getLastData()], 2 * Ed.CALL_LATER_DELAY)) }, onShareSelectionModelChanged: function() { this.invalidateModel() } }), Ib.controls.TableBase = function(a) { this._columnBox = new Ib.ColumnBox(), this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange, this), this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange, this), this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange, this), Ib.controls.TableBase.superClass.constructor.apply(this, arguments), this._cellPool = new Ib.Pool('div', 20), this._stringPool = new Ib.Pool('span', 20), this._booleanPool = new Ib.Pool('input', 20), this._colorPool = new Ib.Pool('div', 20), this._pools.add(this._cellPool), this._pools.add(this._stringPool), this._pools.add(this._booleanPool), this._pools.add(this._colorPool) }, Jb.ext('twaver.controls.TableBase', Ib.controls.ListBase, { getColumnBox: function() { return this._columnBox }, handleColumnBoxChange: function(a) { this.invalidateDisplay() }, handleColumnPropertyChange: function(a) { a.source !== this._sortColumn || a.property !== 'sortDirection' && a.property !== 'sortFunction' && a.property !== 'sortable' ? this.invalidateDisplay() : this.invalidateModel() }, handleColumnHierarchyChange: function(a) { this.invalidateDisplay() }, renderData: function(a, b, c, d) { for (var e, f = this._columnBox.getRoots(), g = f.size(), h = 0, i = this._rowHeight - this._rowLineWidth + 'px', j = 0; g > j; j++) { var k = f.get(j), l = k.getWidth(); l < 0 && (l = 0); var m = Math.min(this._columnLineWidth, l); if (k.isVisible()) { var n = this._cellPool.get(); e = n.style, e.position = 'absolute', e.whiteSpace = 'nowrap', e.verticalAlign = 'middle', e.textAlign = k.getHorizontalAlign(), e.overflow = 'hidden', e.textOverflow = 'ellipsis', e.left = h + 'px', e.width = l - m + 'px', e.height = i, e.borderStyle = 'solid', e.borderWidth = '0px', e.borderRightWidth = m + 'px', e.borderRightColor = this._columnLineColor, j === 0 ? (e.borderLeftWidth = m + 'px', e.borderLeftColor = this._columnLineColor) : e.borderLeftWidth = '0px', a.appendChild(n); var o = { data: b, value: this.getValue(b, k), div: n, view: this, column: k, rowIndex: c, selected: d }; this.renderCell(o), this.onCellRendered(o), h += l } }e = a.style, e.width = h + 'px', e.height = i, e.backgroundColor = this.isCheckMode() && this._focusedRow === c || !this.isCheckMode() && d ? this.getSelectColor(b) : '' }, adjustRowSize: function() {}, onCellRendered: function(a) {}, calculateSumWidth: function() { for (var a = this._columnBox.getRoots(), b = a.size(), c = 0, d = 0; b > d; d++) { var e = a.get(d), f = e.getWidth(); f < 0 && (f = 0), c += f } return c }, getCurrentSortFunction: function() { var a = this._sortColumn; if (a) { var b = a.getSortFunction(); if (b) { var c = this, d = a.getSortDirection() === 'asc' ? 1 : -1; return function(e, f) { var g = c.getValue(e, a), h = c.getValue(f, a); return b.call(c, g, h, e, f) * d } } } return this._sortFunction }, renderCell: function(a) { var b = a.column; if (b.renderCell) return void b.renderCell(a); var c = a.value, d = b.getEnumInfo(a.rowIndex); d && !Array.isArray(d) && (c = d.map[c]), a.view.isCellEditable(a.data, b) && (a.enumInfo = d, a.div._editInfo = a), Ac.render(b.getValueType(), c, a.div, a.view, b.isInnerText()) }, getValue: function(a, b) { return b.getValue(a, this) }, setValue: function(a, b, c) { b.setValue(a, c, this) }, getColumnAt: function(a) { var b = this.getLogicalPoint(a); if (!b) return null; for (var c = this._columnBox.getRoots(), d = 0, e = c.size(), f = 0; e > d; d++) { var g = c.get(d), h = g.getWidth(); if (h < 0 && (h = 0), b.x > f && b.x < f + h) return g; f += h } return null }, isCellEditable: function(a, b) { return this.isEditable() && b.isEditable() }, commitEditValue: function(a, b) { if (!this._isCanceling) { var c; c = b.type === 'checkbox' ? b.checked : b.value; var d = a.column, e = d.getValueType(); if (e === 'int' && typeof c === 'string' ? c = parseInt(c) : e === 'number' && typeof c === 'string' && (c = parseFloat(c)), this.setValue(a.data, d, c), this._currentEditor) { var f = this._currentEditor.parentNode, g = this._currentEditor; delete this._currentEditor, f && f.removeChild(g), Ib.Util.setFocus(this._view) } delete this._isCommitting } }, cancelEditing: function() { if (this._currentEditor) { this._isCanceling = !0; var a = this._currentEditor.parentNode, b = this._currentEditor; delete this._currentEditor, a && a.removeChild(b), Ib.Util.setFocus(this._view), delete this._isCanceling } }, renderEditor: function(a) {}, onEditorRendered: function(a) {}, updateCurrentEditor: function(a) { var b = a.target; if (b !== this._currentEditor && b.parentNode !== this._currentEditor) { for (var c; b && b !== this._view && !(c = b._editInfo);)b = b.parentNode; if (c && b === c.div) { var d = this.renderEditor && this.renderEditor(c); d ? (this._currentEditor = d.view, c.value != null && (this._currentEditor.value = c.value)) : c.enumInfo ? this._currentEditor = Wb.createSelect(c.enumInfo, c.value) : (this._currentEditor = Ob.createElement('input'), c.value != null && (this._currentEditor.value = c.value)); var e = this; if (this._currentEditor) { if (d && d.onKeyDown) { var f = d.onKeyDown; f && Array.isArray(f) && e._currentEditor.addEventListener('keydown', function(a) { for (var b = 0; b < f.length; b++) if (f[b].combKey) { var c = null; switch (f[b].combKey) { case 'ctrlKey':c = a.ctrlKey; break; case 'shiftKey':c = a.shiftKey; break; case 'altKey':c = a.altKey }a.keyCode === f[b].keyCode && c && f[b].handlerEvent && f[b].handlerEvent(a) } else a.keyCode === f[b].keyCode && f[b].handlerEvent && f[b].handlerEvent(a) }) } else this._currentEditor.addEventListener('keydown', function(a) { var b = a.target._editInfo.view; a.keyCode === 13 && a.shiftKey || (a.keyCode === 13 ? b.commitEditValue(a.target._editInfo, a.target) : a.keyCode === 27 && b.cancelEditing()) }, !1); if (this._currentEditor.addEventListener('blur', function(a) { var b = a.target._editInfo.view; b._isCanceling || b.commitEditValue(a.target._editInfo, a.target) }, !1), this._currentEditor.keepDefault = !0, this._currentEditor._editInfo = c, !this._currentEditor.parentNode) { var g = this._currentEditor.style; g.position = 'absolute', g.margin = '0px', g.border = '0px', g.padding = '0px', g.left = c.div.style.left, g.top = c.div.parentNode.style.top, g.width = c.div.style.width, g.height = c.div.style.height, this._rootDiv.appendChild(this._currentEditor) }Ib.Util.setFocus(this._currentEditor) } } } }, onColumnSorted: function(a) {}, getCurrentEditor: function() { return this._currentEditor } }), Ib.controls.List = function(a) { Ib.controls.List.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.controls.List', Ib.controls.ListBase, { __accessor: ['rowHeight', 'indent', 'rowLineWidth', 'rowLineColor', 'sortFunction', 'visibleFunction'], __bool: ['makeVisibleOnSelected', 'keyboardRemoveEnabled', 'keyboardSelectEnabled'], _checkMode: !1, _rowHeight: Ed.LIST_ROW_HEIGHT, _indent: Ed.LIST_INDENT, _rowLineWidth: Ed.LIST_ROW_LINE_WIDTH, _rowLineColor: Ed.LIST_ROW_LINE_COLOR, _makeVisibleOnSelected: Ed.LIST_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: Ed.LIST_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: Ed.LIST_KEYBOARD_SELECT_ENABLED, isCheckMode: function() { return this._checkMode }, setCheckMode: function(a) { delete this._focusedRow; var b = this._checkMode; this._checkMode = a, this.firePropertyChange('checkMode', b, a) }, isCheckable: function(a) { return this._checkMode === !0 }, renderData: function(a, b, c, d) { var e; this._indent > 0 && (e = this.__spanPool.get(), e.style.width = this._indent + 'px', e.style.display = 'inline-block', a.appendChild(e)); var f = this.isCheckable(b); f && this._addCheckBox(a, b, d); var g = this.getIcon(b); g && this._addIcon(a, b, g); var h = this.getLabel(b); if (h) { e = this.__textPool.get(); var i = e.style; i.whiteSpace = 'nowrap', i.verticalAlign = 'middle', i.padding = '1px 2px 1px 2px', i.display = 'inline-block', Jb.setText(e, h, this._innerText), this.onLabelRendered(e, b, h, c, d), a.appendChild(e) }a.style.backgroundColor = this.isCheckMode() ? this._focusedRow === c ? this.getSelectColor(b) : '' : d ? this.getSelectColor(b) : '' }, onLabelRendered: function(a, b, c, d, e) {} }), Ib.controls.ListBaseInteraction = function(a) { this.listBase = a, this.view = a._view; var b = this; this.view.addEventListener('scroll', function(a) { b.handleScroll(a) }, !1), this.view.addEventListener('mousedown', function(a) { b.handleMouseDown(a) }, !1), this.view.addEventListener('keydown', function(a) { b.handleKeyDown(a) }, !1) }, Jb.ext('twaver.controls.ListBaseInteraction', Object, { handleMouseDown: function(a) { var b = this.listBase; a.target !== b._currentEditor && a.target.parentNode !== b._currentEditor && b._handleClick(a) }, handleKeyDown: function(a) { var b = this.listBase; if (!b._currentEditor) if (Jb.isCtrlDown(a) && a.keyCode == 65)b.isKeyboardSelectEnabled() && b.selectAll().size() > 0 && b.fireInteractionEvent({ kind: 'selectAll' }), Wb.preventDefault(a); else if (a.keyCode == 46)b.isKeyboardRemoveEnabled() && b.removeSelection() && b.fireInteractionEvent({ kind: 'removeElement' }), Wb.preventDefault(a); else if (b.isCheckMode() || a.keyCode !== 38 && a.keyCode !== 40 && a.keyCode !== 37 && a.keyCode !== 39)Jb.showVersion(a); else { var c = b.getSelectionModel().getLastData(); if (c) if (a.keyCode === 38 || a.keyCode === 40) { var d = b.getRowDatas(), e = b.getRowIndexByData(c); e >= 0 && (a.keyCode === 38 ? e !== 0 && (c = d.get(e - 1), b.getSelectionModel().setSelection(c)) : e !== d.size() - 1 && (c = d.get(e + 1), b.getSelectionModel().setSelection(c))) } else !b.expand || a.keyCode !== 37 && a.keyCode !== 39 || c.hasChildren() && (a.keyCode === 37 ? b.collapse(c) : b.expand(c)); else b.getRowDatas().size() > 0 && (c = b.getRowDatas().get(0), b.getSelectionModel().setSelection(c)) } }, handleScroll: function(a) { this.listBase.invalidate() } }), Ib.controls.ListBaseTouchInteraction = function(a) { this.listBase = a, this.view = a._view, Wb.addEventListener('touchstart', 'handleTouchstart', this.view, this) }, Jb.ext('twaver.controls.ListBaseTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a), this.startPoint = this.lastPoint = this.listBase.getLogicalPoint(a), Wb.addEventListener('touchmove', 'handleTouchmove', this.view, this), Wb.addEventListener('touchend', 'handleTouchend', this.view, this), zc.isMultiTouch(a) && (this.distance = zc.getDistance(a), this.zoom = this.listBase._zoom) }, handleTouchmove: function(a) { Wb.preventDefault(a); var b = this.listBase.getLogicalPoint(a); if (!(Tb.getDistance(this.startPoint, b) < 20)) if (this.moved || (this.moved = !0), zc.isSingleTouch(a)) { if (this.lastPoint) { var c = this.lastPoint.x - b.x, d = this.lastPoint.y - b.y, e = this.listBase.panByOffset(c, d); this.listBase.invalidate(), this.lastPoint.x -= c - e.x, this.lastPoint.y -= d - e.y } } else if (this.distance) { var f = zc.getDistance(a) / this.distance; this.listBase.setZoom(this.zoom * f, !1) } }, handleTouchend: function(a) { Wb.preventDefault(a), this.moved || a.target === this.listBase._currentEditor || a.target.parentNode === this.listBase._currentEditor || this.listBase._handleClick(a), delete this.startPoint, delete this.lastPoint, delete this.moved, delete this.distance, delete this.zoom, Wb.removeEventListener('touchmove', this.view, this), Wb.removeEventListener('touchend', this.view, this) } }), Ib.controls.ListBaseMSTouchInteraction = function(a) { Ib.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this, arguments), this._pointerMap = {}, this._pointerIdArray = [], Wb.addEventListener('MSPointerDown', 'handleTouchstart', this.view, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', this.view, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', this.view, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', this.view, this), this.superHandleMouseDown = Ib.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown }, Jb.ext('twaver.controls.ListBaseMSTouchInteraction', Ib.controls.ListBaseInteraction, { handleMouseDown: function(a) {}, handleTouchstart: function(a) { a.isPrimary && this._pointerIdArray.length > 0 && (this._pointerMap = {}, this._pointerIdArray = []), this._pointerMap[a.pointerId] || this.listBase.getLogicalPoint(a) == null || (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a), this._pointerIdArray.length == 1 && a.pointerType == a.MSPOINTER_TYPE_MOUSE && this.superHandleMouseDown(a), this._pointerIdArray.length == 1 ? (this._startTouchPoint = this.listBase.getLogicalPoint(a), this._startTouchTime = new Date()) : this._pointerIdArray.length == 2 && (this._distance = this._getDistance(), this._zoom = this.listBase.getZoom()) }, handleTouchmove: function(a) { if (this._startTouchPoint != null && this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 10)) if (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2) { var b = this._getDistance() / this._distance; this.listBase.setZoom(this._zoom * b, !1) } else if (this._pointerIdArray.length == 1 && a.pointerType != a.MSPOINTER_TYPE_MOUSE && this._startTouchPoint) { var c = this.listBase.getLogicalPoint(a); if (c == null) return; var d = this._startTouchPoint.x - c.x, e = this._startTouchPoint.y - c.y, f = this.listBase.panByOffset(d, e); this.listBase.invalidate(), this._startTouchPoint.x -= d - f.x, this._startTouchPoint.y -= e - f.y } }, handleTouchend: function(a) { if (this._startTouchPoint && this._pointerIdArray.length == 1 && a.pointerType != a.MSPOINTER_TYPE_MOUSE) { var b = this.listBase.getLogicalPoint(a); if (b) { var c = new Date(); c.getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, b) <= 20 && this.superHandleMouseDown(a) } } this._pointerMap = {}, this._pointerIdArray = [] }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) } }), Ib.controls.Tree = function(a) { this._interactionDispatcher = new Ib.EventDispatcher(), this._initTree(a), Ib.controls.Tree.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.controls.Tree', Ib.controls.ListBase, { __tree: 1, __accessor: ['rootData', 'sortFunction', 'visibleFunction', 'indent', 'rowHeight', 'rowLineWidth', 'rowLineColor', 'expandIcon', 'collapseIcon', 'uncheckableStyle', 'lineType', 'lineColor', 'lineThickness', 'lineAlpha', 'lineDash'], __bool: ['rootVisible', 'makeVisibleOnSelected', 'keyboardRemoveEnabled', 'keyboardSelectEnabled'], _checkMode: !1, _indent: Ed.TREE_INDENT, _rowHeight: Ed.TREE_ROW_HEIGHT, _rowLineWidth: Ed.TREE_ROW_LINE_WIDTH, _rowLineColor: Ed.TREE_ROW_LINE_COLOR, _makeVisibleOnSelected: Ed.TREE_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: Ed.TREE_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: Ed.TREE_KEYBOARD_SELECT_ENABLED, _expandIcon: Ed.TREE_EXPAND_ICON, _collapseIcon: Ed.TREE_COLLAPSE_ICON, _uncheckableStyle: 'none', _lineType: Ed.TREE_LINE_TYPE, _lineColor: Ed.TREE_LINE_COLOR, _lineThickness: Ed.TREE_LINE_THICKNESS, _lineAlpha: Ed.TREE_LINE_ALPHA, _lineDash: Ed.TREE_LINE_DASH, getCheckMode: function() { return this._checkMode }, setCheckMode: function(a) { delete this._focusedRow; var b = this._checkMode; this._checkMode = a, this.firePropertyChange('checkMode', b, a) }, renderData: function(a, b, c, d) { this._renderTree(a, b, c, d) }, getToolTip: function(a) { return a.getToolTip() || a.getName() } }), Ib.controls.Table = function(a) { this._checkColumn = new Ib.Column(), this._checkColumn.setName('check'), this._checkColumn.setEditable(!0), this._checkColumn.setWidth(40), this._checkColumn.setHorizontalAlign('center'), this._checkColumn.renderCell = this.renderCheckCell; var b = this; this._checkColumn.getValue = function(a, c) { return b.isSelected(a) }, Ib.controls.Table.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.controls.Table', Ib.controls.TableBase, { __accessor: ['rowHeight', 'rowLineWidth', 'rowLineColor', 'columnLineWidth', 'columnLineColor', 'sortFunction', 'visibleFunction', 'sortColumn'], __bool: ['editable', 'makeVisibleOnSelected', 'keyboardRemoveEnabled', 'keyboardSelectEnabled'], _editable: Ed.TABLE_EDITABLE, _rowHeight: Ed.TABLE_ROW_HEIGHT, _rowLineWidth: Ed.TABLE_ROW_LINE_WIDTH, _rowLineColor: Ed.TABLE_ROW_LINE_COLOR, _columnLineWidth: Ed.TABLE_COLUMN_LINE_WIDTH, _columnLineColor: Ed.TABLE_COLUMN_LINE_COLOR, _makeVisibleOnSelected: Ed.TABLE_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: Ed.TABLE_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: Ed.TABLE_KEYBOARD_SELECT_ENABLED, getCheckColumn: function() { return this._checkColumn }, isCheckMode: function() { return this._columnBox.contains(this._checkColumn) }, setCheckMode: function(a) { a !== this.isCheckMode() && (delete this._focusedRow, a ? this._columnBox.add(this._checkColumn, 0) : this._columnBox.remove(this._checkColumn), this.firePropertyChange('checkMode', !a, a)) }, renderCheckCell: function(a) { var b = a.view._booleanPool.get(); b.disabled = !1, b.type = 'checkbox', b.style.margin = '0px 2px', b.style.verticalAlign = 'middle', b.checked = a.selected; var c = a.div; c.appendChild(b), c.style.textAlign === '' && (c.style.textAlign = 'center'), b._checkData = a.data } }), Ib.controls.TableHeader = function(a) { Ib.controls.TableHeader.superClass.constructor.apply(this, arguments), this._invalidateScroll = !1, this._invalidateDisplay = !1, this._divPool = new Ib.Pool('div'), this._imagePool = new Ib.Pool('img'), this._textPool = new Ib.Pool('span'), this._resizePool = new Ib.Pool('div'), this._pools.add(this._divPool), this._pools.add(this._imagePool), this._pools.add(this._textPool), this._pools.add(this._resizePool), this._table = a, this._tableView = a.getView(), this._columnBox = a.getColumnBox(), this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange, this), this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange, this), this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange, this); var b = this; a.getView().addEventListener('scroll', function(a) { b.invalidateScroll() }, !1), a.addPropertyChangeListener(function(a) { b.invalidateDisplay() }, this), this._view = Wb.createView('hidden'), this._view.tabIndex = -1, this._view.style.background = Ed.TABLEHEADER_BACKGROUND, this._rootDiv = Wb.createDiv(), this._view.appendChild(this._rootDiv), this.invalidateDisplay(), Qb.isTouchable && new Ib.controls.TableHeaderTouchInteraction(this), new Ib.controls.TableHeaderInteraction(this) }, Jb.ext('twaver.controls.TableHeader', Ib.controls.ControlBase, { __accessor: ['height', 'moveBackground', 'insertBackground', 'columnLineColor', 'resizeTolerance', 'sortDescIcon', 'sortAscIcon', 'sortIconPosition'], _height: Ed.TABLEHEADER_HEIGHT, _moveBackground: Ed.TABLEHEADER_MOVE_BACKGROUND, _insertBackground: Ed.TABLEHEADER_INSERT_BACKGROUND, _columnLineColor: Ed.TABLEHEADER_COLUMN_LINE_COLOR, _resizeTolerance: Ed.TABLEHEADER_RESIZE_TOLERANCE, _sortDescIcon: Ed.TABLEHEADER_SORT_DESC_ICON, _sortAscIcon: Ed.TABLEHEADER_SORT_ASC_ICON, _sortIconPosition: Ed.TABLEHEADER_SORT_ICON_POSITION, getRootDiv: function() { return this._rootDiv }, handleColumnBoxChange: function(a) { this.invalidateDisplay() }, handleColumnPropertyChange: function(a) { this.invalidateDisplay() }, handleColumnHierarchyChange: function(a) { this.invalidateDisplay() }, onPropertyChanged: function(a) { this.invalidateDisplay() }, invalidateScroll: function() { this._invalidateScroll || (this._invalidateScroll = !0, this.invalidate()) }, invalidateDisplay: function() { this._invalidateDisplay || (this._invalidateDisplay = !0, this._invalidateScroll = !0, this.invalidate()) }, validate: function() { this._invalidate && (this._invalidate = !1, this._invalidateDisplay && (this._invalidateDisplay = !1, this.validateDisplay()), this._invalidateScroll && (this._invalidateScroll = !1, this._rootDiv.style.left = -this._tableView.scrollLeft + 'px')) }, validateDisplay: function() { Wb.release(this._rootDiv); for (var a = this._table.getZoom(), b = this.getHeight() + 'px', c = this.getHeight() - 2 + 'px', d = this._table.getColumnBox().getRoots(), e = d.size(), f = 0, g = this._table._columnLineWidth * a, h = 0; e > h; h++) { var i = d.get(h); if (i.isVisible()) { var j = i.getWidth() * a; j < 0 && (j = 0); var k = Math.min(g, j), l = this._divPool.get(); l._column = i; var m = l.style; m.position = 'absolute', m.whiteSpace = 'nowrap', m.lineHeight = c, m.overflow = 'hidden', m.textOverflow = 'ellipsis', m.backgroundPosition = this._sortIconPosition ? this._sortIconPosition : '', m.backgroundRepeat = 'no-repeat', m.backgroundImage = '', m.textAlign = i.getHorizontalAlign(), m.borderStyle = 'solid', m.borderWidth = '0px', m.borderRightWidth = k + 'px', m.borderRightColor = this._columnLineColor, h === 0 ? (m.borderLeftWidth = k + 'px', m.borderLeftColor = this._columnLineColor) : m.borderLeftWidth = '0px', m.left = f + 'px', m.width = j - k + 'px', m.height = b, l._x = f, l._width = j - k, this._rootDiv.insertBefore(l, this._rootDiv.firstChild), this.renderColumn(l, i), this.onColumnRendered(l, i), f += j, i.isResizable() && (l = this._resizePool.get(), l._resizeColumn = i, m = l.style, m.position = 'absolute', m.backgroundColor = 'white', m.opacity = 0, m.left = f - k - this._resizeTolerance + 'px', m.width = k + 2 * this._resizeTolerance + 'px', m.height = b, this._rootDiv.appendChild(l)) } } this._pools.forEach(function(a) { a.clear() }), this._rootDiv.style.width = f + 'px', this._rootDiv.style.height = b }, renderColumn: function(a, b) { if (b.renderHeader)b.renderHeader(a); else { var c = this._textPool.get(); if (c.style.whiteSpace = 'nowrap', c.style.verticalAlign = 'middle', c.style.padding = '1px 2px 1px 2px', c.innerHTML = b.getName() ? b.getName() : b.getPropertyName(), c.setAttribute('title', c.innerHTML), a.appendChild(c), Qb.isOpera) { var d = a.cloneNode(!1); d.style.left = '0px', d.style.top = '0px', d.style.opacity = 0, a.appendChild(d) } } if (this._table.getSortColumn() === b && b.isSortable()) { var e = b.getSortDirection() === 'asc' ? this._sortAscIcon : this._sortDescIcon, f = Jb.getImageSrc(e); if (this._sortIconPosition && this._sortIconPosition !== '')a.style.backgroundImage = 'url(' + f + ')'; else { var g = this._imagePool.get(); g.setAttribute('src', f), g.style.verticalAlign = 'middle', a.appendChild(g) } } }, onColumnRendered: function(a, b) {} }), Ib.controls.TableHeaderInteraction = function(a) { this.header = a, this.table = a._table, this.view = a._view; var b = this; this.view.addEventListener('mousedown', function(a) { b.handleMouseDown(a) }, !1), this.view.addEventListener('mousemove', function(a) { b.handleMouseMove(a) }, !1) }, Jb.ext('twaver.controls.TableHeaderInteraction', Object, { handleMouseDown: function(a) {
    if (a.button === 0) {
      if (this.movableDiv) return void this.handleMouseUp(a); this.resizeColumn = a.target._resizeColumn, this.resizeColumn || (this.movableDiv = this.getMovableDivAt(a)), this.changeCursor(a), this._startClient = Wb.getClientPoint(a), this.lastX = this.getX(a), this._startLogicalX = this.lastX,
      Wb.handle_mousedown(this, a)
    }
  }, changeCursor: function(a) { var b = ''; if (a.target._resizeColumn)b = 'ew-resize'; else { var c = this.getColumnAt(a); c && (c.isMovable() || c.isSortable()) && (b = 'pointer') } this.view.style.cursor = b }, handleMouseMove: function(a) { if (this.lastX == null) return void this.changeCursor(a); if (Wb.target === this) { var b = this._startLogicalX + a.clientX - this._startClient.x; if (this.resizeColumn) { if (this.stopX != null) { if (b < this.stopX) return; delete this.stopX } var c = this.resizeColumn.getWidth() + (b - this.lastX) / this.table.getZoom(); c < 10 && (c = 10, this.stopX = b), this.resizeColumn.setWidth(c), this.lastX = b } else if (this.movableDiv) { var d = b - this.lastX; if (!this.cloneDiv) { if (Math.abs(d) < 3) return; this.cloneDiv = this.movableDiv.cloneNode(!0), this.cloneDiv._x = this.movableDiv._x, this.cloneDiv.style.background = this.header.getMoveBackground(), this.insertDiv = Wb.createDiv(), this.insertDiv.style.width = '1px', this.insertDiv.style.height = this.cloneDiv.style.height, this.insertDiv.style.background = this.header.getInsertBackground(), this.movableDiv.parentNode.appendChild(this.cloneDiv), this.movableDiv.parentNode.appendChild(this.insertDiv) } var e = this.cloneDiv._x + d; this.cloneDiv.style.left = e + 'px', this.cloneDiv._x = e, this.lastX = b, this.columnInfo = this.getColumnInfoAt(a), this.columnInfo && (this.insertDiv.style.left = this.columnInfo.position) } } }, handleMouseUp: function(a) { if (a.button === 0) { var b; if (this.resizeColumn);else if (this.movableDiv && this.columnInfo) { b = this.movableDiv._column; var c = this.columnInfo.index; this.table.getColumnBox().moveTo(b, c) } else if (b = this.getColumnAt(a), b && b.isSortable()) { var d = b.getSortDirection(); this.table.getSortColumn() === b ? (d === 'desc' && this.table.setSortColumn(null), b.setSortDirection(d === 'asc' ? 'desc' : 'asc')) : this.table.setSortColumn(b), this.table.onColumnSorted(this.table.getSortColumn()) } this.clear() } }, clear: function() { this.view.style.cursor = '', this.cloneDiv && this.movableDiv && this.movableDiv.parentNode.removeChild(this.cloneDiv), this.insertDiv && this.movableDiv && this.movableDiv.parentNode.removeChild(this.insertDiv), delete this.movableDiv, delete this.columnInfo, delete this.insertDiv, delete this.cloneDiv, delete this.resizeColumn, delete this.stopX, delete this.lastX, delete this._startClient, delete this._startLogicalX }, getColumnAt: function(a) { a = a.target; for (var b; a && a !== this.view && !(b = a._column);)a = a.parentNode; return b }, getMovableDivAt: function(a) { a = a.target; for (var b; a && a !== this.view && !(b = a._column);)a = a.parentNode; return b && b.isMovable() ? a : null }, getX: function(a) { var b = Wb.getLogicalPoint(this.view, a); return b ? b.x : null }, getColumnInfoAt: function(a) { for (var b = this._startLogicalX + a.clientX - this._startClient.x + this.table.getView().scrollLeft, c = this.table.getColumnBox().getRoots(), d = c.size(), e = this.table.getZoom(), f = 0, g = !1, h = 0; d > h; h++) { var i = c.get(h); if (i === this.movableDiv._column && (g = !0), i.isVisible()) { var j = i.getWidth() * e; if (j <= 0) continue; if (b >= f && f + j >= b) { var k = f + j / 2 > b; !g || i === this.movableDiv._column && k || h--; var l = k ? Math.max(0, h) : Math.min(h + 1, d), m = k ? f : f + j; return m = Math.max(0, m - 1), { index: l, column: i, position: m + 'px' } }f += j } } return this.columnInfo } }), Ib.controls.TableHeaderTouchInteraction = function(a) { this.header = a, this.table = a._table, this.view = a._view, Wb.addEventListener('touchstart', 'handleTouchstart', this.view, this) }, Jb.ext('twaver.controls.TableHeaderTouchInteraction', Object, { handleTouchstart: function(a) { return Wb.preventDefault(a), this.movableDiv ? void this.handleTouchend(a) : (this.resizeColumn = a.target._resizeColumn, this.resizeColumn || (this.movableDiv = this.getMovableDivAt(a)), this.lastX = this.getX(a), Wb.addEventListener('touchmove', 'handleTouchmove', this.view, this), void Wb.addEventListener('touchend', 'handleTouchend', this.view, this)) }, handleTouchmove: function(a) { if (Wb.preventDefault(a), this.lastX != null) { var b; if (this.resizeColumn) { if (b = this.getX(a), this.stopX != null) { if (b < this.stopX) return; delete this.stopX } var c = this.resizeColumn.getWidth() + (b - this.lastX) / this.table.getZoom(); c < 0 && (c = 0, this.stopX = b), this.resizeColumn.setWidth(c), this.lastX = b } else if (this.movableDiv) { b = this.getX(a); var d = b - this.lastX; if (!this.cloneDiv) { if (Math.abs(d) < 3) return; this.cloneDiv = this.movableDiv.cloneNode(!0), this.cloneDiv._x = this.movableDiv._x, this.cloneDiv.style.background = this.header.getMoveBackground(), this.insertDiv = Wb.createDiv(), this.insertDiv.style.width = '1px', this.insertDiv.style.height = this.cloneDiv.style.height, this.insertDiv.style.background = this.header.getInsertBackground(), this.movableDiv.parentNode.appendChild(this.cloneDiv), this.movableDiv.parentNode.appendChild(this.insertDiv) } var e = this.cloneDiv._x + d; this.cloneDiv.style.left = e + 'px', this.cloneDiv._x = e, this.lastX = b, this.columnInfo = this.getColumnInfoAt(a), this.columnInfo && (this.insertDiv.style.left = this.columnInfo.position) } } }, handleTouchend: function(a) { Wb.preventDefault(a); var b; if (this.resizeColumn);else if (this.movableDiv && this.columnInfo) { b = this.movableDiv._column; var c = this.columnInfo.index; this.table.getColumnBox().moveTo(b, c) } else if (b = this.getColumnAt(a), b && b.isSortable()) { var d = b.getSortDirection(); this.table.getSortColumn() === b ? (d === 'desc' && this.table.setSortColumn(null), b.setSortDirection(d === 'asc' ? 'desc' : 'asc')) : this.table.setSortColumn(b) } this.clear(), Wb.removeEventListener('touchmove', this.view, this), Wb.removeEventListener('touchend', this.view, this) }, clear: function() { this.cloneDiv && this.movableDiv && this.movableDiv.parentNode.removeChild(this.cloneDiv), this.insertDiv && this.movableDiv && this.movableDiv.parentNode.removeChild(this.insertDiv), delete this.movableDiv, delete this.columnInfo, delete this.insertDiv, delete this.cloneDiv, delete this.resizeColumn, delete this.stopX, delete this.lastX }, getColumnAt: function(a) { a = a.target; for (var b; a && a !== this.view && !(b = a._column);)a = a.parentNode; return b }, getMovableDivAt: function(a) { a = a.target; for (var b; a && a !== this.view && !(b = a._column);)a = a.parentNode; return b && b.isMovable() ? a : null }, getX: function(a) { var b = Wb.getLogicalPoint(this.view, a); return b ? b.x : null }, getColumnInfoAt: function(a) { for (var b = this.getX(a) + this.table.getView().scrollLeft, c = this.table.getColumnBox().getRoots(), d = c.size(), e = this.table.getZoom(), f = 0, g = !1, h = 0; d > h; h++) { var i = c.get(h); if (i === this.movableDiv._column && (g = !0), i.isVisible()) { var j = i.getWidth() * e; if (j <= 0) continue; if (b >= f && f + j >= b) { var k = f + j / 2 > b; !g || i === this.movableDiv._column && k || h--; var l = k ? Math.max(0, h) : Math.min(h + 1, d), m = k ? f : f + j; return m = Math.max(0, m - 1), { index: l, column: i, position: m + 'px' } }f += j } } return this.columnInfo } }), Ib.controls.TablePane = function(a, b) { Ib.controls.TablePane.superClass.constructor.apply(this, arguments), this.invalidate(), this._table = a, this._tableHeader = b || new Ib.controls.TableHeader(a), this._view = Wb.createView('hidden', !0), this._view.tabIndex = -1, this._view.appendChild(this._tableHeader.getView()), this._view.appendChild(this._table.getView()); var c = this; this._tableHeader.addPropertyChangeListener(function(a) { a.property === 'height' && c.invalidate() }) }, Jb.ext('twaver.controls.TablePane', Ib.controls.ControlBase, { onPropertyChanged: function(a) { this.invalidate() }, getTable: function() { return this._table }, getTableHeader: function() { return this._tableHeader }, validateImpl: function() { var a = this._view.offsetWidth, b = this._view.offsetHeight, c = this._tableHeader.getHeight(); this._tableHeader.adjustBounds({ x: 0, y: 0, width: a, height: c }), this._table.adjustBounds({ x: 0, y: c, width: a, height: Math.max(0, b - c) }) } }), Ib.controls.TreeTable = function(a) { this._treeColumn = new Ib.Column(), this._treeColumn.setName('tree'), this._treeColumn.setWidth(120), this._treeColumn.renderCell = this.renderTreeCell, this._treeColumn.getValue = this.getTreeValue, this._treeColumn.setValue = this.setTreeValue, this._initTree(a), Ib.controls.TreeTable.superClass.constructor.apply(this, arguments), this._columnBox.add(this._treeColumn) }, Jb.ext('twaver.controls.TreeTable', Ib.controls.TableBase, { __tree: 1, __accessor: ['sortFunction', 'visibleFunction', 'checkMode', 'rootData', 'sortColumn', 'indent', 'rowHeight', 'rowLineWidth', 'rowLineColor', 'columnLineWidth', 'columnLineColor', 'expandIcon', 'collapseIcon', 'uncheckableStyle', 'lineType', 'lineColor', 'lineThickness', 'lineAlpha', 'lineDash'], __bool: ['editable', 'rootVisible', 'makeVisibleOnSelected', 'keyboardRemoveEnabled', 'keyboardSelectEnabled'], _editable: Ed.TREETABLE_EDITABLE, _indent: Ed.TREETABLE_INDENT, _rowHeight: Ed.TREETABLE_ROW_HEIGHT, _rowLineWidth: Ed.TREETABLE_ROW_LINE_WIDTH, _rowLineColor: Ed.TREETABLE_ROW_LINE_COLOR, _columnLineWidth: Ed.TREETABLE_COLUMN_LINE_WIDTH, _columnLineColor: Ed.TREETABLE_COLUMN_LINE_COLOR, _makeVisibleOnSelected: Ed.TREETABLE_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: Ed.TREETABLE_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: Ed.TREETABLE_KEYBOARD_SELECT_ENABLED, _expandIcon: Ed.TREETABLE_EXPAND_ICON, _collapseIcon: Ed.TREETABLE_COLLAPSE_ICON, _lineType: Ed.TREE_LINE_TYPE, _lineColor: Ed.TREE_LINE_COLOR, _lineThickness: Ed.TREE_LINE_THICKNESS, _lineAlpha: Ed.TREE_LINE_ALPHA, _lineDash: Ed.TREE_LINE_DASH, getTreeColumn: function() { return this._treeColumn }, renderTreeCell: function(a) { a.view._renderTree(a.div, a.data, a.rowIndex, a.selected) }, getTreeValue: function(a, b) { return b.getLabel(a) }, setTreeValue: function(a, b, c) { a.setName(b) } }), Ib.controls.PropertySheet = function(a) { Ib.controls.PropertySheet.superClass.constructor.apply(this, arguments), this._currentRowIndex = -1, this._currentEditor = null, this._currentData = null, this._invalidate = !1, this._resizeDiv = Wb.createDiv(), this._resizeDiv.style.backgroundColor = 'white', this._resizeDiv.style.opacity = 0, this._resizeDiv.style.top = '0px', this._categoryList = new nd(), this._categoryMap = {}, this._rowList = new nd(), this._propertyBox = new Ib.PropertyBox(), this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox, this), this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox, this), this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox, this), this.__divPool = new Ib.Pool('div', 2), this.__cellPool = new Ib.Pool('div', 2), this.__imagePool = new Ib.Pool('img', 2), this.__textPool = new Ib.Pool('span', 2), this._stringPool = new Ib.Pool('span', 2), this._booleanPool = new Ib.Pool('input', 2), this._colorPool = new Ib.Pool('div', 2), this._pools.add(this.__divPool), this._pools.add(this.__cellPool), this._pools.add(this.__imagePool), this._pools.add(this.__textPool), this._pools.add(this._stringPool), this._pools.add(this._booleanPool), this._pools.add(this._colorPool), this._view = Wb.createView('auto'), this._rootDiv = Wb.createDiv(), this._dataDiv = Wb.createDiv(), this._view.appendChild(this._rootDiv), this._rootDiv.appendChild(this._dataDiv), this.setDataBox(a || new Ib.DataBox()); var b = this; this._view.addEventListener('change', function(a) { b.handleChange(a) }, !1), Qb.isTouchable ? Qb.isMSTouchable ? new Ib.controls.PropertySheetMSTouchInteraction(this) : (new Ib.controls.PropertySheetTouchInteraction(this), new Ib.controls.PropertySheetInteraction(this)) : new Ib.controls.PropertySheetInteraction(this) }, Jb.ext('twaver.controls.PropertySheet', Ib.controls.View, { __accessor: ['indent', 'rowHeight', 'sumWidth', 'propertyNameWidth', 'propertyNameHorizontalAlign', 'autoAdjustable', 'rowLineWidth', 'columnLineWidth', 'borderColor', 'categorizable', 'resizeTolerance', 'editable', 'selectColor', 'expandIcon', 'collapseIcon', 'sortFunction', 'visibleFunction'], _autoAdjustable: Ed.PROPERTYSHEET_AUTO_ADJUSTABLE, _selectColor: Ed.SELECT_COLOR, _categorizable: Ed.PROPERTYSHEET_CATEGORIZABLE, _editable: Ed.PROPERTYSHEET_EDITABLE, _propertyNameWidth: Ed.PROPERTYSHEET_PROPERTY_NAME_WIDTH, _propertyNameHorizontalAlign: Ed.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN, _sumWidth: Ed.PROPERTYSHEET_SUM_WIDTH, _indent: Ed.PROPERTYSHEET_INDENT, _rowHeight: Ed.PROPERTYSHEET_ROW_HEIGHT, _rowLineWidth: Ed.PROPERTYSHEET_ROW_LINE_WIDTH, _columnLineWidth: Ed.PROPERTYSHEET_COLUMN_LINE_WIDTH, _borderColor: Ed.PROPERTYSHEET_BORDER_COLOR, _expandIcon: Ed.PROPERTYSHEET_EXPAND_ICON, _collapseIcon: Ed.PROPERTYSHEET_COLLAPSE_ICON, _resizeTolerance: Ed.PROPERTYSHEET_RESIZE_TOLERANCE, getPropertyBox: function() { return this._propertyBox }, getCurrentData: function() { return this._currentData }, getDataDiv: function() { return this._dataDiv }, getDataBox: function() { return this._box }, setDataBox: function(a) { if (!a) throw 'DataBox can not be null'; if (this._box !== a) { var b = this._box; b && (b.removeDataPropertyChangeListener(this.handlePropertyChange, this), this._selectionModel || b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)), this._box = a, this._box.addDataPropertyChangeListener(this.handlePropertyChange, this), this._selectionModel ? this._selectionModel._setDataBox(a) : this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this), this.invalidate(), this.firePropertyChange('dataBox', b, this._box) } }, invalidatePropertyBox: function() { this._isValidating || this.invalidate() }, onPropertyChanged: function(a) { a.property !== 'zoom' && this.invalidate() }, isVisible: function(a) { return a.isVisible && !a.isVisible(this._currentData, this) ? !1 : this._visibleFunction ? this._visibleFunction(a) : !0 }, handlePropertyChange: function(a) { this._currentData === a.source && this.invalidate() }, handleSelectionChange: function(a) { this._currentData !== this.getSelectionModel().getLastData() && (this._currentRowIndex = -1, this.invalidate()) }, isExpanded: function(a) { if (!a) return !0; var b = this._categoryMap[a]; return b ? b.isExpanded : Ed.PROPERTYSHEET_EXPAND_CATEGORY }, expand: function(a) { if (a) { var b = this._categoryMap[a]; b && !b.isExpanded && (b.isExpanded = !0, this.invalidate()) } }, expandAll: function() { for (var a in this._categoryMap) { var b = this._categoryMap[a]; b && (b.isExpanded = !0) } this.invalidate() }, collapse: function(a) { if (a) { var b = this._categoryMap[a]; b && b.isExpanded && (b.isExpanded = !1, this.invalidate()) } }, collapseAll: function() { for (var a in this._categoryMap) { var b = this._categoryMap[a]; b && (b.isExpanded = !1) } this.invalidate() }, getCategoryName: function(a) { if (!this.isCategorizable()) return 'null'; var b = a.getCategoryName(); return b || 'null' }, validateModel: function() { this._rowList.clear(), this._categoryList.clear(); var a, b, c, d, e, f = {}, g = new nd(), h = this._currentData ? this._propertyBox.getRoots() : new nd(); for (d = h.size(), a = 0; d > a; a++)e = h.get(a), this.isVisible(e) && (g.add(e), c = this.getCategoryName(e), f[c] || (this._categoryList.add(c), f[c] = { isExpanded: this.isExpanded(c), properties: new nd() })); for (this._sortFunction && g.sort(this._sortFunction), this._categoryMap = f, d = g.size(), a = 0; a < this._categoryList.size(); a++) { c = this._categoryList.get(a), c !== 'null' && this._rowList.add(c); var i = f[c]; if (i.isExpanded) for (b = 0; d > b; b++)e = g.get(b), this.getCategoryName(e) === c && (i.properties.add(e), this._rowList.add({ view: this, data: this._currentData, property: e, value: this._currentData ? this.getValue(this._currentData, e) : null })) } }, adjustWidth: function() { var a = this._view.offsetWidth, b = this._view.offsetHeight; a <= this._indent || b <= 0 || (a -= this._indent, this._rowList.size() * this._rowHeight > b && (a -= Ed.SCROLL_BAR_WIDTH, a <= 0) || (this._propertyNameWidth = this._sumWidth === 0 || this._propertyNameWidth > this._sumWidth ? a / 2 : a * (this._propertyNameWidth / this._sumWidth), this._sumWidth = a, this._view.style.overflowX = 'hidden', this._view.style.overflowY = 'auto')) }, validateDisplay: function() { var a = this._rowList.size(), b = this._borderColor, c = this._indent, d = this._rowHeight, e = this._propertyNameWidth, f = Math.max(0, this._sumWidth - e), g = this._rowLineWidth, h = this._columnLineWidth, i = d - g + 'px', j = d - g - 2 + 'px', k = c + 'px', l = e - h + 'px', m = f - h + 'px', n = e + f + 'px', o = g + 'px', p = h + 'px', q = e + 'px', r = this._dataDiv, s = r.style; s.height = a * d + 'px', s.width = c + e + f + 'px'; var t = this.__divPool.get(); s = t.style, s.position = 'absolute', s.left = '0px', s.top = '0px', s.width = k, s.height = r.style.height, s.borderWidth = '0px', s.backgroundColor = b, r.appendChild(t); for (var u = 0; a > u; u++) { var v = this._rowList.get(u), w = u * d + 'px', x = this.__divPool.get(); if (v.rowDiv = x, s = x.style, s.position = 'absolute', s.whiteSpace = 'nowrap', s.overflow = 'hidden', s.textOverflow = 'ellipsis', s.left = k, s.top = w, s.width = n, s.height = i, s.lineHeight = j, s.borderStyle = 'solid', s.borderWidth = '0px', s.borderBottomWidth = o, s.borderBottomColor = b, r.appendChild(x), typeof v === 'string') { s.backgroundColor = b, t = this.__divPool.get(), s = t.style, s.position = 'absolute', s.left = '0px', s.top = w, s.width = k, s.height = i, s.lineHeight = j, s.borderWidth = '0px', r.appendChild(t); var y = this.__imagePool.get(), z = this.isExpanded(v) ? this._expandIcon : this._collapseIcon; y.setAttribute('src', Jb.getImageSrc(z)), s = y.style, s.verticalAlign = 'middle', y._expandData = v, t.appendChild(y), this.renderCategory(x, v), this.onCategoryRendered(x, v) } else { var A = v.property, B = this.__cellPool.get(); v.nameRender = B, s = B.style, this._currentRowIndex === u && (s.backgroundColor = this.getSelectColor()), s.position = 'absolute', s.verticalAlign = 'middle', s.textAlign = this._propertyNameHorizontalAlign, s.overflow = 'hidden', s.textOverflow = 'ellipsis', s.whiteSpace = 'nowrap', s.left = '0px', s.top = '0px', s.width = l, s.height = i, s.borderStyle = 'solid', s.borderWidth = '0px', s.borderRightWidth = p, s.borderRightColor = b, x.appendChild(B), this.renderName(v), this.onNameRendered(v), B = this.__cellPool.get(), v.valueRender = B, s = B.style, s.position = 'absolute', s.verticalAlign = 'middle', s.textAlign = A.getHorizontalAlign(), s.whiteSpace = 'nowrap', s.overflow = 'hidden', s.textOverflow = 'ellipsis', s.left = q, s.top = '0px', s.width = m, s.height = i, s.borderStyle = 'solid', s.borderWidth = '0px', s.borderRightWidth = p, s.borderRightColor = b, x.appendChild(B), this.renderValue(v), this.onValueRendered(v) } }s = this._resizeDiv.style, s.left = c + e - h - this._resizeTolerance + 'px', s.width = h + 2 * this._resizeTolerance + 'px', s.height = r.style.height, r.appendChild(this._resizeDiv) }, renderCategory: function(a, b) { var c = this.__textPool.get(), d = c.style; d.fontWeight = 'bold', d.whiteSpace = 'nowrap', d.overflow = 'hidden', d.textOverflow = 'ellipsis', d.verticalAlign = 'middle', d.padding = '1px 2px 1px 2px', c.innerHTML = b, c.setAttribute('title', b), a.appendChild(c) }, onCategoryRendered: function(a, b) {}, renderName: function(a) { if (a.property.renderName) return void a.property.renderName(a); var b = this.__textPool.get(), c = b.style; c.fontWeight = '', c.whiteSpace = 'nowrap', c.verticalAlign = 'middle', c.padding = '1px 2px 1px 2px'; var d = a.property.getName(); d || (d = a.property.getPropertyName()), b.innerHTML = d, b.setAttribute('title', d), a.nameRender.appendChild(b) }, onNameRendered: function(a) {}, renderValue: function(a) { var b = a.property; if (b.renderValue) return void b.renderValue(a); var c = a.value, d = b.getEnumInfo(this._currentData); d && !Array.isArray(d) && (c = d.map[c]), a.view.isCellEditable(a.data, b) && (a.enumInfo = d, a.valueRender._editInfo = a), a.valueRender.innerHTML = '', Ac.render(b.getValueType(), c, a.valueRender, a.view, b.isInnerText()) }, onValueRendered: function(a) {}, renderEditor: function(a) {}, onEditorRendered: function(a) {}, updateCurrentData: function() { this._currentData = this.getSelectionModel().getLastData() }, validateImpl: function() { var a = this._view.scrollLeft, b = this._view.scrollTop; Wb.release(this._dataDiv), this.updateCurrentData(), this.validateModel(), this.isAutoAdjustable() && this.adjustWidth(), this.validateDisplay(), this._pools.forEach(function(a) { a.clear() }), this._view.scrollLeft !== a && (this._view.scrollLeft = a), this._view.scrollTop !== b && (this._view.scrollTop = b) }, getValue: function(a, b) { return a ? b.getValue(a, this) : null }, setValue: function(a, b, c) { a && b.setValue(a, c, this) }, isCellEditable: function(a, b) { return a ? this.isEditable() && b.isEditable() : !1 }, getRowIndexAt: function(a) { var b = this.getLogicalPoint(a); if (!b) return -1; var c = parseInt(b.y / this._rowHeight); return c >= 0 && c < this._rowList.size() ? c : -1 }, handleChange: function(a) { this._isCommitting || this._isCanceling || this._isValidating || a.target._editInfo && this.commitEditValue && this.commitEditValue(a.target._editInfo, a.target) }, commitEditValue: function(a, b) { var c; c = b.type === 'checkbox' ? b.checked : b.value; var d = a.property, e = d.getValueType(); if (e === 'int' && typeof c === 'string')c = parseInt(c); else if (e === 'number' && typeof c === 'string')c = parseFloat(c); else if (e === 'array.string')c = c.split(','); else if (e === 'array.number') { c = c.split(','); for (var f = 0, g = c.length; g > f; f++)c[f] = parseFloat(c[f]) } if (b._rowInfo && (b._rowInfo.value = c, this.renderValue(b._rowInfo)), this.setValue(a.data, d, c), Ib.Util.setFocus(this._view), this._currentEditor) { var h = this._currentEditor.parentNode; h && h.removeChild(this._currentEditor), delete this._currentEditor } delete this._isCommitting }, cancelEditing: function() { if (this._currentEditor) { var a = this._currentEditor.parentNode; a && a.removeChild(this._currentEditor), delete this._currentEditor, delete this._isCanceling } }, updateCurrentRowIndex: function(a) { var b = this._rowList.size(); (a < 0 || a >= b) && (a = -1); var c, d = this._currentRowIndex; if (a !== d && (d >= 0 && b > d && (c = this._rowList.get(d), c.nameRender && (c.nameRender.style.backgroundColor = '')), this._currentRowIndex = a), a >= 0 && (c = this._rowList.get(a), c.nameRender && (c.nameRender.style.backgroundColor = this.getSelectColor(), !this._currentEditor && c.valueRender && c.valueRender._editInfo))) { var e = c.valueRender._editInfo, f = this.renderEditor && this.renderEditor(c); f ? (this._currentEditor = f.view, e.value != null && (this._currentEditor.value = e.value)) : e.enumInfo ? this._currentEditor = Wb.createSelect(e.enumInfo, e.value) : (this._currentEditor = Ob.createElement('input'), e.value != null && (this._currentEditor.value = e.value)); var g = this; if (this._currentEditor) { if (f && f.onKeyDown) { var h = f.onKeyDown; h && Array.isArray(h) && g._currentEditor.addEventListener('keydown', function(a) { for (var b = 0; b < h.length; b++) if (h[b].combKey) { var c = null; switch (h[b].combKey) { case 'ctrlKey':c = a.ctrlKey; break; case 'shiftKey':c = a.shiftKey; break; case 'altKey':c = a.altKey }a.keyCode === h[b].keyCode && c && h[b].handlerEvent && h[b].handlerEvent(a) } else a.keyCode === h[b].keyCode && h[b].handlerEvent && h[b].handlerEvent(a) }) } else this._currentEditor.addEventListener('keydown', function(a) { var b = a.target._editInfo.view; if (a.keyCode !== 13 || !a.shiftKey) if (a.keyCode === 13) { if (b._isCommitting) return; b._isCommitting = !0, b.commitEditValue(a.target._editInfo, a.target) } else a.keyCode === 27 && (b._isCanceling = !0, b.cancelEditing()) }, !1); if (this._currentEditor.addEventListener('blur', function(a) { var b = a.target._editInfo.view; b._isCommitting || b._isCanceling || (b._isCommitting = !0, b.commitEditValue(a.target._editInfo, a.target)) }, !1), this._currentEditor.keepDefault = !0, this._currentEditor._rowInfo = c, this._currentEditor._editInfo = e, !this._currentEditor.parentNode) { var i = this._currentEditor.style; i.position = 'absolute', i.margin = '0px', i.border = '0px', i.padding = '0px', i.left = this._indent + this._propertyNameWidth + 'px', i.top = c.rowDiv.style.top, i.width = c.valueRender.style.width, i.height = c.valueRender.style.height, this._rootDiv.appendChild(this._currentEditor) }Ib.Util.setFocus(this._currentEditor) } } } }), Ib.controls.PropertySheetInteraction = function(a) { this.sheet = a, this.view = a._view, this.resizeDiv = a._resizeDiv; var b = this; this.view.addEventListener('mousedown', function(a) { a.button === 0 && b.handleMouseDown(a) }, !1), this.view.addEventListener('mousemove', function(a) { b.handleMouseMove(a) }, !1) }, Jb.ext('twaver.controls.PropertySheetInteraction', Object, { minGap: 10, handleMouseDown: function(a) { if (a.target !== this.sheet._currentEditor && a.target.parentNode !== this.sheet._currentEditor && (this.sheet.isFocusOnClick() && Ib.Util.setFocus(this.view), !this.sheet._isValidating)) if (a.target._expandData) { var b = a.target._expandData; this.sheet.isExpanded(b) ? this.sheet.collapse(b) : this.sheet.expand(b) } else if (a.target === this.resizeDiv) this.lastX = this.getX(a), Wb.handle_mousedown(this, a); else { this.sheet._currentEditor && !this.sheet._isCommitting && (this.sheet._isCommitting = !0, this.sheet.commitEditValue(this.sheet._currentEditor._editInfo, this.sheet._currentEditor)); var c = this.sheet.getRowIndexAt(a); this.sheet.updateCurrentRowIndex(c) } }, handleMouseMove: function(a) { if (this.lastX == null && !Wb.target) return void this.changeCursor(a); if (Wb.target === this && this.lastX != null) { var b = this.getX(a); if (this.stopLeft != null) { if (b < this.stopLeft) return; delete this.stopLeft } if (this.stopRight != null) { if (b > this.stopRight) return; delete this.stopRight } var c = this.sheet.getPropertyNameWidth() + (b - this.lastX); c < this.minGap ? (c = this.minGap, this.stopLeft = b) : c > this.sheet.getSumWidth() - this.minGap && (c = this.sheet.getSumWidth() - this.minGap, this.stopRight = b), this.sheet.setPropertyNameWidth(c), this.lastX = b } }, handleMouseUp: function(a) { a.button === 0 && (this.view.style.cursor = 'default', delete this.stopLeft, delete this.stopRight, delete this.lastX) }, changeCursor: function(a) { this.view.style.cursor = a.target === this.resizeDiv ? 'ew-resize' : 'default' }, getX: function(a) { return a.clientX / this.sheet.getZoom() } }), Ib.controls.PropertySheetTouchInteraction = function(a) { this.sheet = a, this.view = a._view, this.resizeDiv = a._resizeDiv, Wb.addEventListener('touchstart', 'handleTouchstart', this.view, this) }, Jb.ext('twaver.controls.PropertySheetTouchInteraction', Object, { minGap: 10, handleTouchstart: function(a) { Wb.preventDefault(a), a.target !== this.sheet._currentEditor && a.target.parentNode !== this.sheet._currentEditor && (this.sheet.isFocusOnClick() && Ib.Util.setFocus(this.view), this.sheet._isValidating || (a.target === this.resizeDiv && (this.lastX = this.getX(a)), this.lastPoint = this.sheet.getLogicalPoint(a), zc.isMultiTouch(a) && (this.distance = zc.getDistance(a), this.zoom = this.sheet.getZoom()), Wb.addEventListener('touchmove', 'handleTouchmove', this.view, this), Wb.addEventListener('touchend', 'handleTouchend', this.view, this))) }, handleTouchmove: function(a) { if (Wb.preventDefault(a), this.moved || (this.moved = !0), this.lastX != null) { var b = this.getX(a); if (this.stopLeft != null) { if (b < this.stopLeft) return; delete this.stopLeft } if (this.stopRight != null) { if (b > this.stopRight) return; delete this.stopRight } var c = this.sheet.getPropertyNameWidth() + (b - this.lastX); c < this.minGap ? (c = this.minGap, this.stopLeft = b) : c > this.sheet.getSumWidth() - this.minGap && (c = this.sheet.getSumWidth() - this.minGap, this.stopRight = b), this.sheet.setPropertyNameWidth(c), this.lastX = b } else if (zc.isSingleTouch(a)) { if (this.lastPoint) { var d = this.sheet.getLogicalPoint(a), e = this.lastPoint.x - d.x, f = this.lastPoint.y - d.y, g = this.sheet.panByOffset(e, f); this.lastPoint.x -= e - g.x, this.lastPoint.y -= f - g.y } } else if (this.distance) { var h = zc.getDistance(a) / this.distance; this.sheet.setZoom(this.zoom * h, !1) } }, handleTouchend: function(a) { if (Wb.preventDefault(a), !this.moved) if (a.target._expandData) { var b = a.target._expandData; this.sheet.isExpanded(b) ? this.sheet.collapse(b) : this.sheet.expand(b) } else if (a.target === this.resizeDiv);else { var c = this.sheet.getRowIndexAt(a); this.sheet.updateCurrentRowIndex(c) } delete this.stopLeft, delete this.stopRight, delete this.lastX, delete this.lastPoint, delete this.distance, delete this.zoom, delete this.moved, Wb.removeEventListener('touchmove', this.view, this), Wb.removeEventListener('touchend', this.view, this) }, getX: function(a) { var b = a.changedTouches[0]; return b.clientX } }), Ib.controls.PropertySheetMSTouchInteraction = function(a) { this.sheet = a, this.view = a._view, this.resizeDiv = a._resizeDiv, this._pointerMap = {}, this._pointerIdArray = [], Wb.addEventListener('MSPointerDown', 'handleTouchstart', this.view, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', this.view, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', this.view, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', this.view, this), this.superHandleMouseDown = Ib.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown }, Jb.ext('twaver.controls.PropertySheetMSTouchInteraction', Ib.controls.PropertySheetInteraction, { handleMouseDown: function(a) {}, handleTouchstart: function(a) { a.isPrimary && this._pointerIdArray.length > 0 && (this._pointerMap = {}, this._pointerIdArray = []), this._pointerMap[a.pointerId] || this.sheet.getLogicalPoint(a) == null || (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a), this._pointerIdArray.length == 1 && a.pointerType == a.MSPOINTER_TYPE_MOUSE && this.superHandleMouseDown(a), this._pointerIdArray.length == 1 ? (this._startTouchPoint = this.sheet.getLogicalPoint(a), this._startTouchTime = new Date()) : this._pointerIdArray.length == 2 && (this._distance = this._getDistance(), this._zoom = this.sheet.getZoom()) }, handleTouchmove: function(a) { if (this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 10)) if (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2) { var b = this._getDistance() / this._distance; this.sheet.setZoom(this._zoom * b, !1) } else if (this._pointerIdArray.length == 1 && a.pointerType != a.MSPOINTER_TYPE_MOUSE && this._startTouchPoint) { var c = this.sheet.getLogicalPoint(a); if (c == null) return; var d = this._startTouchPoint.x - c.x, e = this._startTouchPoint.y - c.y, f = this.sheet.panByOffset(d, e); this._startTouchPoint.x -= d - f.x, this._startTouchPoint.y -= e - f.y } }, handleTouchend: function(a) { if (this._pointerIdArray.length == 1 && a.pointerType != a.MSPOINTER_TYPE_MOUSE) { var b = this.sheet.getLogicalPoint(a), c = new Date(); c.getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, b) <= 20 && this.superHandleMouseDown(a) } this._pointerMap = {}, this._pointerIdArray = [] }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) } }), Ib.controls.SplitPane = function(a, b, c, d) { Ib.controls.SplitPane.superClass.constructor.apply(this, arguments), this._view = Wb.createView('hidden', !0), this._view.tabIndex = -1, this._dividerDiv = Wb.createDiv(), this._dividerDiv.tabIndex = -1, this._view.appendChild(this._dividerDiv), a && this.setFirstView(a), b && this.setNextView(b), c && this.setOrientation(c), d != null && this.setPosition(d), this.setDividerDraggable(!0), this.setExpandable(!1), this.invalidate(), Qb.isTouchable && new Ib.controls.SplitPaneTouchInteraction(this), new Ib.controls.SplitPaneInteraction(this) }, Jb.ext('twaver.controls.SplitPane', Ib.controls.ControlBase, { __accessor: ['orientation', 'dividerWidth', 'dividerBackground', 'dividerOpacity', 'maskBackground', 'upExpandIcon', 'downExpandIcon', 'leftExpandIcon', 'rightExpandIcon'], __bool: ['dividerDraggable', 'expandable'], _position: Ed.SPLITPANE_POSITION, _orientation: Ed.SPLITPANE_ORIENTATION, _dividerWidth: Ed.SPLITPANE_DIVIDER_WIDTH, _dividerBackground: Ed.SPLITPANE_DIVIDER_BACKGROUND, _dividerOpacity: Ed.SPLITPANE_DIVIDER_OPACITY, _maskBackground: Ed.SPLITPANE_MASK_BACKGROUND, _upExpandIcon: Ed.SPLITPANE_UP_EXPAND_ICON, _downExpandIcon: Ed.SPLITPANE_DOWN_EXPAND_ICON, _leftExpandIcon: Ed.SPLITPANE_LEFT_EXPAND_ICON, _rightExpandIcon: Ed.SPLITPANE_RIGHT_EXPAND_ICON, onPropertyChanged: function(a) { this.invalidate() }, getDividerDiv: function() { return this._dividerDiv }, getPosition: function() { return this._position }, setPosition: function(a) { if (a < 0 && (a = 0), a > 1 && (a = 1), a !== this._position) { var b = this._position; this._position = a, this.firePropertyChange('position', b, a), this.lastDividerLocation == null && (this.lastDividerLocation = a) } }, setFirstView: function(a) { if (this._firstView !== a) { var b = this._firstView; b && this._view.removeChild(b.getView ? b.getView() : b), this._firstView = a, a && (a.getView ? this._view.insertBefore(a.getView(), this._dividerDiv) : this._view.insertBefore(a, this._dividerDiv)), this.firePropertyChange('firstView', b, a) } }, getFirstView: function() { return this._firstView }, setNextView: function(a) { if (this._nextView !== a) { var b = this._nextView; b && this._view.removeChild(b.getView ? b.getView() : b), this._nextView = a, a && (a.getView ? this._view.insertBefore(a.getView(), this._dividerDiv) : this._view.insertBefore(a, this._dividerDiv)), this.firePropertyChange('nextView', b, a) } }, getNextView: function() { return this._nextView }, validateImpl: function() {
    var a, b = this._position, c = this._view.offsetWidth, d = this._view.offsetHeight, e = this._dividerWidth; if (e >= 8 || e === 0 ? this._coverDiv && (this._dividerDiv.removeChild(this._coverDiv), delete this._coverDiv) : this._coverDiv || (this._coverDiv = Wb.createDiv(), this._coverDiv.tabIndex = -1, this._dividerDiv.appendChild(this._coverDiv)), this._orientation === 'horizontal') {
      e > c && (e = c); var f = (c - e) * b, g = c - e - f + 1; Jb.setViewBounds(this._firstView, { x: 0, y: 0, width: f, height: d }), Jb.setViewBounds(this._nextView, { x: f + e, y: 0, width: g, height: d }), Jb.setViewBounds(this._dividerDiv, { x: f, y: 0, width: e, height: d }), this._dividerDiv.position = f, this._coverDiv && Jb.setViewBounds(this._coverDiv, { x: e / 2 - 4, y: 0, width: 8, height: d }), this._expandable && (this._expandCvs1 || (a = Jb.html.createDiv(), a.tabIndex = -1, Jb.setViewBounds(a, { x: 0, y: 0, width: e, height: 11 }), this._expandCvs1 = Jb.html.createImg(Jb.getImageSrc(this._leftExpandIcon)),
        this._expandCvs1.style.left = e / 2 - 3 + 'px', a.appendChild(this._expandCvs1), this._dividerDiv.appendChild(a)), this._expandCvs2 || (a = Jb.html.createDiv(), a.tabIndex = -1, Jb.setViewBounds(a, { x: 0, y: 15, width: e, height: 11 }), this._expandCvs2 = Jb.html.createImg(Jb.getImageSrc(this._rightExpandIcon)), this._expandCvs2.style.left = e / 2 - 3 + 'px', a.appendChild(this._expandCvs2), this._dividerDiv.appendChild(a)))
    } else { e > d && (e = d); var h = (d - e) * b, i = d - e - h; Jb.setViewBounds(this._firstView, { x: 0, y: 0, width: c, height: h }), Jb.setViewBounds(this._nextView, { x: 0, y: h + e, width: c, height: i }), Jb.setViewBounds(this._dividerDiv, { x: 0, y: h, width: c, height: e }), this._dividerDiv.position = h, this._coverDiv && Jb.setViewBounds(this._coverDiv, { x: 0, y: e / 2 - 4, width: c, height: 8 }), this._expandable && (this._expandCvs1 || (a = Jb.html.createDiv(), a.tabIndex = -1, Jb.setViewBounds(a, { x: 0, y: 0, width: 11, height: e }), this._expandCvs1 = Jb.html.createImg(Jb.getImageSrc(this._upExpandIcon)), this._expandCvs1.style.top = e / 2 - 3 + 'px', a.appendChild(this._expandCvs1), this._dividerDiv.appendChild(a)), this._expandCvs2 || (a = Jb.html.createDiv(), a.tabIndex = -1, Jb.setViewBounds(a, { x: 15, y: 0, width: 11, height: e }), this._expandCvs2 = Jb.html.createImg(Jb.getImageSrc(this._downExpandIcon)), this._expandCvs2.style.top = e / 2 - 3 + 'px', a.appendChild(this._expandCvs2), this._dividerDiv.appendChild(a))) } var j = this._dividerDiv.style; j.background = this._dividerBackground
  } }), Ib.controls.SplitPaneInteraction = function(a) { this.splitPane = a, this.view = a._view, this.dividerDiv = a._dividerDiv; var b = this; this.view.addEventListener('mousedown', function(a) { a.button === 0 && b.handleMouseDown(a) }, !1), this.view.addEventListener('mousemove', function(a) { b.handleMouseMove(a) }, !1) }, Jb.ext('twaver.controls.SplitPaneInteraction', Object, { handleMouseDown: function(a) { if (this.splitPane.isExpandable()) { var b, c, d = this.splitPane._dividerWidth; if (a.target === this.splitPane._expandCvs1) return void (this.splitPane._orientation === 'horizontal' ? (b = this.view.clientWidth, d > b && (d = b), this.splitPane.lastDividerLocation === this.splitPane.getPosition() ? this.splitPane.setPosition(0) : this.splitPane.lastDividerLocation < this.splitPane.getPosition() && (this.splitPane.setPosition(this.splitPane.lastDividerLocation), this.splitPane.lastDividerLocation = this.splitPane.getPosition())) : (c = this.view.clientHeight, d > c && (d = c), this.splitPane.lastDividerLocation === this.splitPane.getPosition() ? this.splitPane.setPosition(0) : this.splitPane.lastDividerLocation < this.splitPane.getPosition() && (this.splitPane.setPosition(this.splitPane.lastDividerLocation), this.splitPane.lastDividerLocation = this.splitPane.getPosition()))); if (a.target === this.splitPane._expandCvs2) return void (this.splitPane._orientation === 'horizontal' ? (b = this.view.clientWidth, d > b && (d = b), this.splitPane.lastDividerLocation === this.splitPane.getPosition() ? this.splitPane.setPosition(1) : this.splitPane.lastDividerLocation > this.splitPane.getPosition() && (this.splitPane.setPosition(this.splitPane.lastDividerLocation), this.splitPane.lastDividerLocation = this.splitPane.getPosition())) : (c = this.view.clientHeight, d > c && (d = c), this.splitPane.lastDividerLocation === this.splitPane.getPosition() ? this.splitPane.setPosition(1) : this.splitPane.lastDividerLocation > this.splitPane.getPosition() && (this.splitPane.setPosition(this.splitPane.lastDividerLocation), this.splitPane.lastDividerLocation = this.splitPane.getPosition()))) } if (this.splitPane.isDividerDraggable()) if (this.resizeDiv) this.clear(a); else if (a.target === this.dividerDiv || a.target === this.splitPane._coverDiv) { this.resizeDiv = Wb.createDiv(); var e = this.resizeDiv.style; e.left = this.dividerDiv.style.left, e.top = this.dividerDiv.style.top, e.width = this.dividerDiv.style.width, e.height = this.dividerDiv.style.height, e.opacity = this.splitPane.getDividerOpacity(), e.background = this.splitPane.getDividerBackground(), this.resizeDiv.lastPosition = this.splitPane._orientation === 'horizontal' ? a.clientX : a.clientY, this.resizeDiv.maskDiv = Wb.createDiv(), e = this.resizeDiv.maskDiv.style, e.left = '0px', e.top = '0px', e.width = this.view.clientWidth + 'px', e.height = this.view.clientHeight + 'px', e.background = this.splitPane.getMaskBackground(), this.view.appendChild(this.resizeDiv.maskDiv), this.view.appendChild(this.resizeDiv), Wb.handle_mousedown(this, a), a.preventDefault() } }, handleMouseMove: function(a) { if ((!this.splitPane.isExpandable() || a.target !== this.splitPane._expandCvs1 && a.target !== this.splitPane._expandCvs2) && this.splitPane.isDividerDraggable()) if (this.resizeDiv || Wb.target) this.resizeDiv && Wb.target === this && (this.splitPane._orientation === 'horizontal' ? this.resizeDiv.style.left = this.dividerDiv.position + a.clientX - this.resizeDiv.lastPosition + 'px' : this.resizeDiv.style.top = this.dividerDiv.position + a.clientY - this.resizeDiv.lastPosition + 'px'); else { var b = this.splitPane._orientation === 'horizontal' ? 'ew-resize' : 'ns-resize'; this.view.style.cursor = a.target === this.dividerDiv || a.target === this.splitPane._coverDiv ? b : 'default' } }, handleMouseUp: function(a) { (!this.splitPane.isExpandable() || a.target !== this.splitPane._expandCvs1 && a.target !== this.splitPane._expandCvs2) && this.splitPane.isDividerDraggable() && a.button === 0 && this.clear(a) }, clear: function(a) { if (this.resizeDiv) { var b, c = this.splitPane._dividerWidth; if (this.splitPane._orientation === 'horizontal') { var d = this.view.clientWidth; c > d && (c = d), b = this.dividerDiv.position + a.clientX - this.resizeDiv.lastPosition, this.splitPane.setPosition(b / (d - c)) } else { var e = this.view.clientHeight; c > e && (c = e), b = this.dividerDiv.position + a.clientY - this.resizeDiv.lastPosition, this.splitPane.setPosition(b / (e - c)) } this.splitPane.lastDividerLocation = this.splitPane.getPosition(), this.view.removeChild(this.resizeDiv.maskDiv), this.view.removeChild(this.resizeDiv), delete this.resizeDiv } } }), Ib.controls.SplitPaneTouchInteraction = function(a) { this.splitPane = a, this.view = a._view, this.dividerDiv = a._dividerDiv, Wb.addEventListener('touchstart', 'handleTouchstart', this.view, this) }, Jb.ext('twaver.controls.SplitPaneTouchInteraction', Object, { handleTouchstart: function(a) { if (Wb.preventDefault(a), this.splitPane.isExpandable()) { var b, c, d = this.splitPane._dividerWidth; if (a.target === this.splitPane._expandCvs1) return void (this.splitPane._orientation === 'horizontal' ? (b = this.view.clientWidth, d > b && (d = b), this.splitPane.lastDividerLocation === this.splitPane.getPosition() ? this.splitPane.setPosition(0) : this.splitPane.lastDividerLocation < this.splitPane.getPosition() && (this.splitPane.setPosition(this.splitPane.lastDividerLocation), this.splitPane.lastDividerLocation = this.splitPane.getPosition())) : (c = this.view.clientHeight, d > c && (d = c), this.splitPane.lastDividerLocation === this.splitPane.getPosition() ? this.splitPane.setPosition(0) : this.splitPane.lastDividerLocation < this.splitPane.getPosition() && (this.splitPane.setPosition(this.splitPane.lastDividerLocation), this.splitPane.lastDividerLocation = this.splitPane.getPosition()))); if (a.target === this.splitPane._expandCvs2) return void (this.splitPane._orientation === 'horizontal' ? (b = this.view.clientWidth, d > b && (d = b), this.splitPane.lastDividerLocation === this.splitPane.getPosition() ? this.splitPane.setPosition(1) : this.splitPane.lastDividerLocation > this.splitPane.getPosition() && (this.splitPane.setPosition(this.splitPane.lastDividerLocation), this.splitPane.lastDividerLocation = this.splitPane.getPosition())) : (c = this.view.clientHeight, d > c && (d = c), this.splitPane.lastDividerLocation === this.splitPane.getPosition() ? this.splitPane.setPosition(1) : this.splitPane.lastDividerLocation > this.splitPane.getPosition() && (this.splitPane.setPosition(this.splitPane.lastDividerLocation), this.splitPane.lastDividerLocation = this.splitPane.getPosition()))) } if (this.resizeDiv) this.clear(a); else if (a.target === this.dividerDiv || a.target === this.splitPane._coverDiv) { this.resizeDiv = Wb.createDiv(); var e = this.resizeDiv.style; e.left = this.dividerDiv.style.left, e.top = this.dividerDiv.style.top, e.width = this.dividerDiv.style.width, e.height = this.dividerDiv.style.height, e.opacity = this.splitPane.getDividerOpacity(), e.background = this.splitPane.getDividerBackground(); var f = a.changedTouches[0]; this.resizeDiv.lastPosition = this.splitPane._orientation === 'horizontal' ? f.clientX : f.clientY, this.resizeDiv.maskDiv = Wb.createDiv(); var e = this.resizeDiv.maskDiv.style; e.left = '0px', e.top = '0px', e.width = this.view.clientWidth + 'px', e.height = this.view.clientHeight + 'px', e.background = this.splitPane.getMaskBackground(), this.view.appendChild(this.resizeDiv.maskDiv), this.view.appendChild(this.resizeDiv) }Wb.addEventListener('touchmove', 'handleTouchmove', this.view, this), Wb.addEventListener('touchend', 'handleTouchend', this.view, this) }, handleTouchmove: function(a) { if (Wb.preventDefault(a), !this.splitPane.isExpandable() || a.target !== this.splitPane._expandCvs1 && a.target !== this.splitPane._expandCvs2) if (this.resizeDiv) { var b = a.changedTouches[0]; this.splitPane._orientation === 'horizontal' ? this.resizeDiv.style.left = this.dividerDiv.position + b.clientX - this.resizeDiv.lastPosition + 'px' : this.resizeDiv.style.top = this.dividerDiv.position + b.clientY - this.resizeDiv.lastPosition + 'px' } else; }, handleTouchend: function(a) { (!this.splitPane.isExpandable() || a.target !== this.splitPane._expandCvs1 && a.target !== this.splitPane._expandCvs2) && (Wb.removeEventListener('touchmove', this.view, this), Wb.removeEventListener('touchend', this.view, this), this.clear(a)) }, clear: function(a) { var b = a.changedTouches[0]; if (this.resizeDiv) { var c = this.splitPane._dividerWidth; if (this.splitPane._orientation === 'horizontal') { var d = this.view.clientWidth; c > d && (c = d); var e = this.dividerDiv.position + b.clientX - this.resizeDiv.lastPosition; this.splitPane.setPosition(e / (d - c)) } else { var f = this.view.clientHeight; c > f && (c = f); var e = this.dividerDiv.position + b.clientY - this.resizeDiv.lastPosition; this.splitPane.setPosition(e / (f - c)) } this.splitPane.lastDividerLocation = this.splitPane.getPosition(), this.view.removeChild(this.resizeDiv.maskDiv), this.view.removeChild(this.resizeDiv), delete this.resizeDiv } } }), Ib.controls.TabPane = function() { Ib.controls.TabPane.superClass.constructor.apply(this, arguments), this._tabBox = new Ib.TabBox(), this._tabBox.addDataBoxChangeListener(this.handleTabChange, this), this._tabBox.addDataPropertyChangeListener(this.handleTabChange, this), this._tabBox.addHierarchyChangeListener(this.handleTabChange, this), this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange, this), this._view = Wb.createView('hidden', !0), this._tabDiv = Wb.createDiv(), this._tabDiv.onmousedown = Wb.preventDefault, this._tabDiv.onkeydown = Wb.preventDefault, this._contentDiv = Wb.createDiv(), this._view.appendChild(this._tabDiv), this._view.appendChild(this._contentDiv), this._divPool = new Ib.Pool('div'), this._iconPool = new Ib.Pool('img'), this._closePool = new Ib.Pool('img'), this._textPool = new Ib.Pool('span'), this._resizePool = new Ib.Pool('div'), this._pools.add(this._divPool), this._pools.add(this._iconPool), this._pools.add(this._closePool), this._pools.add(this._textPool), this._pools.add(this._resizePool), this.invalidateTab(), Qb.isTouchable && new Ib.controls.TabPaneTouchInteraction(this), new Ib.controls.TabPaneInteraction(this) }, Jb.ext('twaver.controls.TabPane', Ib.controls.ControlBase, { __accessor: ['tabGap', 'tabRadius', 'tabHeight', 'horizontalAlign', 'tabOrientation', 'resizeTolerance', 'tabBackground', 'selectBackground', 'moveBackground', 'insertBackground', 'closeIcon', 'disabledColor'], __bool: ['selectNextOnClose', 'selectNextOnInVisible'], _tabGap: Ed.TABPANE_TAB_GAP, _tabRadius: Ed.TABPANE_TAB_RADIUS, _tabHeight: Ed.TABPANE_TAB_HEIGHT, _resizeTolerance: Ed.TABPANE_RESIZE_TOLERANCE, _tabOrientation: Ed.TABPANE_TAB_ORIENTATION, _tabBackground: Ed.TABPANE_TAB_BACKGROUND, _disabledColor: Ed.TABPANE_DISABLED_COLOR, _selectBackground: Ed.TABPANE_SELECT_BACKGROUND, _moveBackground: Ed.TABPANE_MOVE_BACKGROUND, _insertBackground: Ed.TABPANE_INSERT_BACKGROUND, _horizontalAlign: Ed.TABPANE_HORIZONTAL_ALIGN, _closeIcon: Ed.TABPANE_CLOSE_ICON, _selectNextOnClose: Ed.TABPANE_SELECT_NEXT_ON_CLOSE, _selectNextOnInVisible: Ed.TABPANE_SELECT_NEXT_ON_INVISIBLE, onPropertyChanged: function(a) { this.invalidateTab() }, getTabBox: function() { return this._tabBox }, getTabDiv: function() { return this._tabDiv }, getContentDiv: function() { return this._contentDiv }, handleTabChange: function(a) { if (this._selectNextOnInVisible && a.property === 'visible' && !a.newValue && this._tabBox.getSelectionModel().contains(a.source)) { for (var b, c, d = a.source, e = this._tabBox.getRoots().indexOf(d), f = this._tabBox.getRoots(), g = f.size(), h = e; g - 1 > h;) if (b = f.get(++h), b.isVisible() && !b.isDisabled()) { c = b; break } if (!c) for (h = e; h > 0;) if (b = f.get(--h), b.isVisible() && !b.isDisabled()) { c = b; break } this._tabBox.getSelectionModel().setSelection(c) } this.invalidateTab() }, invalidateTab: function(a) { this._invalidateTab || (this._invalidateTab = !0, this.invalidate(a)) }, validateImpl: function() { this._invalidateTab && (this._invalidateTab = !1, this.validateTab()); var a, b = this._view.offsetWidth, c = this._view.offsetHeight; this._tabOrientation === 'top' ? (this._tabDiv.style.top = '0px', a = { x: 0, y: this._tabHeight, width: b, height: Math.max(0, c - this._tabHeight) }) : (this._tabDiv.style.top = c - this._tabHeight + 'px', a = { x: 0, y: 0, width: b, height: Math.max(0, c - this._tabHeight) }), this._currentView && Jb.setViewBounds(this._currentView, a) }, getCurrentTab: function() { return this._currentTab }, getCurrentView: function() { return this._currentView }, onViewRemoved: function(a) {}, onViewAdded: function(a) {}, validateTab: function() { this._currentTab = this._tabBox.getSelectionModel().getLastData(); var a = this._currentTab ? this._currentTab.getView() : null; if (a !== this._currentView) { var b, c; this._currentView && (b = this._currentView.getView ? this._currentView.getView() : this._currentView, b.style.visibility = 'hidden', this.onViewRemoved(this._currentView)), a && (c = a.getView ? a.getView() : a, c.style.visibility = 'inherit', c.parentNode || this._contentDiv.appendChild(c), this.onViewAdded(a)), this._currentView = a }Wb.release(this._tabDiv); for (var d = this._tabBox.getRoots(), e = this._tabHeight + 'px', f = this._tabHeight - 2 + 'px', g = this._tabRadius + 'px', h = d.size(), i = 0, j = 0; h > j; j++) { var k = d.get(j); if (k.isVisible()) { var l = this._currentTab === k, m = k.getWidth(); m < 0 && (m = 0); var n = Math.min(this._tabGap, m), o = this._divPool.get(); o._tab = k; var p = o.style; p.position = 'absolute', p.whiteSpace = 'nowrap', p.lineHeight = f, p.overflow = 'hidden', p.textOverflow = 'ellipsis', p.background = l ? this._selectBackground : this._tabBackground, p.textAlign = this._horizontalAlign, this._tabOrientation === 'top' ? (p.borderTopLeftRadius = g, p.borderTopRightRadius = g, p.borderBottomLeftRadius = '0px', p.borderBottomRightRadius = '0px') : (p.borderTopLeftRadius = '0px', p.borderTopRightRadius = '0px', p.borderBottomLeftRadius = g, p.borderBottomRightRadius = g), p.left = i + 'px', p.width = m - n + 'px', p.height = e, o._x = i, o._width = m - n, this.renderTab(o, k), this.onTabRendered(o, k), this._tabDiv.insertBefore(o, this._tabDiv.firstChild), i += m, k.isResizable() && (o = this._resizePool.get(), o._resizeTab = k, p = o.style, p.position = 'absolute', p.backgroundColor = 'white', p.opacity = 0, p.left = i - n - this._resizeTolerance + 'px', p.width = n + 2 * this._resizeTolerance + 'px', p.height = e, this._tabDiv.appendChild(o)) } } this._tabDiv.style.left = '0px', this._tabDiv.style.width = i + 'px', this._tabDiv.style.height = this._tabHeight + 'px', this._pools.forEach(function(a) { a.clear() }) }, renderTab: function(a, b) { if (b.renderTab)b.renderTab(a); else { var c = b.getIcon(); if (c) { var d = this._iconPool.get(); d.setAttribute('src', Jb.getImageSrc(c)), d.style.paddingLeft = '4px', d.style.verticalAlign = 'middle', a.appendChild(d) } var e = b.getName(); if (e) { var f = this._textPool.get(); f.style.whiteSpace = 'nowrap', f.style.verticalAlign = 'middle', f.style.padding = '2px 4px', f.innerHTML = e, a.appendChild(f) } if (Qb.isOpera) { var g = a.cloneNode(!1); g.style.left = '0px', g.style.top = '0px', g.style.opacity = 0, a.appendChild(g) } } if (b.isClosable()) { var h = this._tabRadius / 4 + 2, d = this._closePool.get(); d._closeTab = b, d.setAttribute('src', Jb.getImageSrc(this._closeIcon)), d.style.position = 'absolute', d.style.top = h + 'px', d.style.right = h + 'px', a.appendChild(d) }a.style.color = b.isDisabled() ? this.getDisabledColor() : '' }, onTabRendered: function(a, b) {} }), Ib.controls.TabPaneInteraction = function(a) { this.tabPane = a, this.view = a.getTabDiv(); var b = this; this.view.addEventListener('mousedown', function(a) { b.handleMouseDown(a) }, !1), this.view.addEventListener('mousemove', function(a) { b.handleMouseMove(a) }, !1) }, Jb.ext('twaver.controls.TabPaneInteraction', Object, { handleMouseDown: function(a) { if (a.button === 0) { if (this.movableDiv) return void this.handleMouseUp(a); this.resizeTab = a.target._resizeTab, this.resizeTab || (this.movableDiv = this.getMovableDivAt(a)), this.changeCursor(a), this.lastX = this.getX(a), this._startClient = Wb.getClientPoint(a), this._startLogicalX = this.lastX, Wb.handle_mousedown(this, a) } }, changeCursor: function(a) { var b = ''; if (a.target._resizeTab)b = 'ew-resize'; else { var c = this.getTabAt(a); !c || c.isDisabled() && !c.isMovable() || (b = 'pointer') } this.view.style.cursor = b }, handleMouseMove: function(a) { if (this.lastX == null) return void this.changeCursor(a); if (Wb.target === this) { var b = this._startLogicalX + a.clientX - this._startClient.x; if (this.resizeTab) { if (this.stopX != null) { if (b < this.stopX) return; delete this.stopX } var c = this.resizeTab.getWidth() + (b - this.lastX); c < 10 && (c = 10, this.stopX = b), this.resizeTab.setWidth(c), this.lastX = b } else if (this.movableDiv) { var d = b - this.lastX; if (!this.cloneDiv) { if (Math.abs(d) < 3) return; this.cloneDiv = this.movableDiv.cloneNode(!0), this.cloneDiv._x = this.movableDiv._x, this.cloneDiv.style.background = this.tabPane.getMoveBackground(), this.insertDiv = Wb.createDiv(), this.insertDiv.style.width = '1px', this.insertDiv.style.height = this.cloneDiv.style.height, this.insertDiv.style.background = this.tabPane.getInsertBackground(), this.movableDiv.parentNode.appendChild(this.cloneDiv), this.movableDiv.parentNode.appendChild(this.insertDiv) } var e = this.cloneDiv._x + d; this.cloneDiv.style.left = e + 'px', this.cloneDiv._x = e, this.lastX = b, this.tabInfo = this.getTabInfoAt(a), this.tabInfo && (this.insertDiv.style.left = this.tabInfo.position) } } }, handleMouseUp: function(a) { if (a.button === 0) { if (this.resizeTab);else if (this.movableDiv && this.tabInfo) { var b = this.movableDiv._tab, c = this.tabInfo.index; this.tabPane.getTabBox().moveTo(b, c) } else { var d = this.tabPane.getTabBox(), b = a.target._closeTab; if (b) if (this.tabPane.isSelectNextOnClose() && this.tabPane.getCurrentTab() === b) { var e = d.getRoots(), c = e.indexOf(b); d.remove(b), e.size() > 0 && (c >= e.size() && (c = e.size() - 1), d.getSelectionModel().setSelection(e.get(c))) } else d.remove(b); else { var b = this.getTabAt(a); b && !b.isDisabled() && d.getSelectionModel().setSelection(b) } } this.clear() } }, clear: function() { this.view.style.cursor = '', this.cloneDiv && this.movableDiv && this.movableDiv.parentNode.removeChild(this.cloneDiv), this.insertDiv && this.movableDiv && this.movableDiv.parentNode.removeChild(this.insertDiv), delete this.movableDiv, delete this.tabInfo, delete this.insertDiv, delete this.cloneDiv, delete this.resizeTab, delete this.stopX, delete this.lastX, delete this._startLogicalX, delete this._startClient }, getTabAt: function(a) { a = a.target; for (var b; a && a !== this.view && !(b = a._tab);)a = a.parentNode; return b }, getMovableDivAt: function(a) { a = a.target; for (var b; a && a !== this.view && !(b = a._tab);)a = a.parentNode; return b && b.isMovable() ? a : null }, getX: function(a) { var b = Wb.getLogicalPoint(this.view, a); return b ? b.x : null }, getTabInfoAt: function(a) { for (var b = this._startLogicalX + a.clientX - this._startClient.x, c = this.tabPane.getTabBox().getRoots(), d = c.size(), e = 0, f = !1, g = 0; d > g; g++) { var h = c.get(g); if (h === this.movableDiv._tab && (f = !0), h.isVisible()) { var i = h.getWidth(); if (i <= 0) continue; if (b >= e && e + i >= b) { var j = e + i / 2 > b; !f || h === this.movableDiv._tab && j || g--; var k = j ? Math.max(0, g) : Math.min(g + 1, d), l = j ? e : e + i; return l = Math.max(0, l - 1), { index: k, tab: h, position: l + 'px' } }e += i } } return this.tabInfo } }), Ib.controls.TabPaneTouchInteraction = function(a) { this.tabPane = a, this.view = a.getTabDiv(), Wb.addEventListener('touchstart', 'handleTouchstart', this.view, this) }, Jb.ext('twaver.controls.TabPaneTouchInteraction', Object, { handleTouchstart: function(a) { return Wb.preventDefault(a), this.movableDiv ? void this.handleTouchend(a) : (this.resizeTab = a.target._resizeTab, this.resizeTab || (this.movableDiv = this.getMovableDivAt(a)), this.lastX = this.getX(a), Wb.addEventListener('touchmove', 'handleTouchmove', this.view, this), void Wb.addEventListener('touchend', 'handleTouchend', this.view, this)) }, handleTouchmove: function(a) { if (this.lastX != null) if (this.resizeTab) { var b = this.getX(a); if (this.stopX != null) { if (b < this.stopX) return; delete this.stopX } var c = this.resizeTab.getWidth() + (b - this.lastX); c < 0 && (c = 0, this.stopX = b), this.resizeTab.setWidth(c), this.lastX = b } else if (this.movableDiv) { var b = this.getX(a), d = b - this.lastX; if (!this.cloneDiv) { if (Math.abs(d) < 3) return; this.cloneDiv = this.movableDiv.cloneNode(!0), this.cloneDiv._x = this.movableDiv._x, this.cloneDiv.style.background = this.tabPane.getMoveBackground(), this.insertDiv = Wb.createDiv(), this.insertDiv.style.width = '1px', this.insertDiv.style.height = this.cloneDiv.style.height, this.insertDiv.style.background = this.tabPane.getInsertBackground(), this.movableDiv.parentNode.appendChild(this.cloneDiv), this.movableDiv.parentNode.appendChild(this.insertDiv) } var e = this.cloneDiv._x + d; this.cloneDiv.style.left = e + 'px', this.cloneDiv._x = e, this.lastX = b, this.tabInfo = this.getTabInfoAt(a), this.tabInfo && (this.insertDiv.style.left = this.tabInfo.position) } }, handleTouchend: function(a) { if (this.resizeTab);else if (this.movableDiv && this.tabInfo) { var b = this.movableDiv._tab, c = this.tabInfo.index; this.tabPane.getTabBox().moveTo(b, c) } else { var d = this.tabPane.getTabBox(), b = a.target._closeTab; if (b) if (this.tabPane.isSelectNextOnClose() && this.tabPane.getCurrentTab() === b) { var e = d.getRoots(), c = e.indexOf(b); d.remove(b), e.size() > 0 && (c >= e.size() && (c = e.size() - 1), d.getSelectionModel().setSelection(e.get(c))) } else d.remove(b); else { var b = this.getTabAt(a); b && !b.isDisabled() && d.getSelectionModel().setSelection(b) } } this.clear(), Wb.removeEventListener('touchmove', this.view, this), Wb.removeEventListener('touchend', this.view, this) }, clear: function() { this.cloneDiv && this.movableDiv && this.movableDiv.parentNode.removeChild(this.cloneDiv), this.insertDiv && this.movableDiv && this.movableDiv.parentNode.removeChild(this.insertDiv), delete this.movableDiv, delete this.tabInfo, delete this.insertDiv, delete this.cloneDiv, delete this.resizeTab, delete this.stopX, delete this.lastX }, getTabAt: function(a) { a = a.target; for (var b; a && a !== this.view && !(b = a._tab);)a = a.parentNode; return b }, getMovableDivAt: function(a) { a = a.target; for (var b; a && a !== this.view && !(b = a._tab);)a = a.parentNode; return b && b.isMovable() ? a : null }, getX: function(a) { var b = Wb.getLogicalPoint(this.view, a); return b ? b.x : null }, getTabInfoAt: function(a) { for (var b = this.getX(a), c = this.tabPane.getTabBox().getRoots(), d = c.size(), e = 0, f = !1, g = 0; d > g; g++) { var h = c.get(g); if (h === this.movableDiv._tab && (f = !0), h.isVisible()) { var i = h.getWidth(); if (i <= 0) continue; if (b >= e && e + i >= b) { var j = e + i / 2 > b; !f || h === this.movableDiv._tab && j || g--; var k = j ? Math.max(0, g) : Math.min(g + 1, d), l = j ? e : e + i; return l = Math.max(0, l - 1), { index: k, tab: h, position: l + 'px' } }e += i } } return this.tabInfo } }), Ib.controls.TitlePane = function(a, b, c) { Ib.controls.TitlePane.superClass.constructor.apply(this, arguments), this.invalidate(), this._titleDiv = Wb.createDiv(), this._titleDiv.tabIndex = -1, this._titleDiv.style.verticalAlign = 'middle', this._titleDiv.style.fontWeight = 'bold', this._titleDiv.style.textOverflow = 'ellipsis', this._titleDiv.style.overflow = 'hidden', this._titleDiv.style.whiteSpace = 'nowrap', this._titleDiv.onmousedown = Wb.preventDefault, this._span = Ob.createElement('span'), this._span.style.verticalAlign = 'middle', this._span.style.paddingLeft = '4px', this._span.style.paddingRight = '4px', this._img = Ob.createElement('img'), this._img.style.verticalAlign = 'middle', this._img.style.paddingLeft = '4px', this._view = Wb.createView('hidden', !0), this._view.tabIndex = -1, this._view.appendChild(this._titleDiv), b && this.setTitle(b), a && this.setContent(a), c && this.setIcon(c) }, Jb.ext('twaver.controls.TitlePane', Ib.controls.ControlBase, { __accessor: ['icon', 'title', 'titleHeight', 'titleHorizontalAlign', 'titleBackground'], _titleHeight: Ed.TITLEPANE_TITLE_HEIGHT, _titleBackground: Ed.TITLEPANE_TITLE_BACKGROUND, _titleHorizontalAlign: Ed.TITLEPANE_TITLE_HORIZONTAL_ALIGN, onPropertyChanged: function(a) { this.invalidate() }, getTitleDiv: function() { return this._titleDiv }, getContent: function() { return this._content }, setContent: function(a) { if (this._content !== a) { var b = this._content; b && this._view.removeChild(b.getView ? b.getView() : b), this._content = a, a && this._view.appendChild(a.getView ? a.getView() : a), this.firePropertyChange('content', b, a) } }, validateImpl: function() { var a = this._view.offsetWidth, b = this._view.offsetHeight, c = this._titleDiv.style; c.textAlign = this._titleHorizontalAlign, c.lineHeight = this._titleHeight - 2 + 'px', c.background = this._titleBackground, Wb.clear(this._titleDiv), this._icon && (this._img.setAttribute('src', Jb.getImageSrc(this._icon)), this._titleDiv.appendChild(this._img)), this._title && (this._span.innerHTML = this._title, this._span.setAttribute('title', this._title), this._titleDiv.appendChild(this._span)); var c = this._titleDiv.style; c.left = '0px', c.top = '0px', c.width = a + 'px', c.height = this._titleHeight + 'px', Jb.setViewBounds(this._content, { x: 0, y: this._titleHeight, width: a, height: Math.max(b - this._titleHeight, 0) }) } }), Ib.controls.Accordion = function() { Ib.controls.Accordion.superClass.constructor.apply(this, arguments), this._titleMap = {}, this._titleList = new nd(), this._currentTitle = null, this._currentView = null, this._view = Wb.createView('hidden', !0), this.invalidate(); var a = this; this._view.addEventListener('mousedown', function(b) { a.handleMouseDown(b) }, !1) }, Jb.ext('twaver.controls.Accordion', Ib.controls.ControlBase, { __accessor: ['expandIcon', 'collapseIcon', 'titleHeight', 'titleBackground', 'borderBottomColor', 'iconPosition'], _expandIcon: Ed.ACCORDION_EXPAND_ICON, _collapseIcon: Ed.ACCORDION_COLLAPSE_ICON, _titleHeight: Ed.ACCORDION_TITLE_HEIGHT, _titleBackground: Ed.ACCORDION_TITLE_BACKGROUND, _borderBottomColor: Ed.ACCORDION_BORDER_BOTTOM_COLOR, _iconPosition: Ed.ACCORDION_ICON_POSITION, onPropertyChanged: function(a) { this.invalidate() }, handleMouseDown: function(a) { if (a.button === 0) { var b = a.target._title; b || (b = a.target.parentNode._title), b && (this._currentTitle === b ? this.collapse() : this.expand(b)) } }, getTitles: function() { return this._titleList }, getCurrentTitle: function() { return this._currentTitle }, add: function(a, b) { if (this._titleMap[a]) throw "Title ' + title + ' already exists"; var c = Wb.createDiv(); c._title = a, c.onmousedown = Wb.preventDefault, c.style.cursor = 'pointer', c.style.textAlign = 'left', c.style.textOverflow = 'ellipsis', c.style.whiteSpace = 'nowrap', c.style.overflow = 'hidden', c.style.borderBottomWidth = '1px', c.style.borderBottomStyle = 'solid'; var d = Ob.createElement('img'); d.style.verticalAlign = 'middle', d.style.paddingLeft = '4px'; var e = Ob.createElement('span'); if (e.style.verticalAlign = 'middle', e.style.paddingLeft = '4px', e.innerHTML = a, e.setAttribute('title', a), this._view.appendChild(c), c.appendChild(d), c.appendChild(e), this._iconPosition == 'right') { var f = d.style, g = (this._titleHeight - 8) / 2; f.marginTop = g + 'px', f.right = '15px', f.position = 'absolute' } this._titleMap[a] = { content: b, titleDiv: c, span: e, img: d }, this._titleList.add(a), this.invalidate() }, remove: function(a) { var b = this._titleMap[a]; b && this._view.removeChild(b.titleDiv), delete this._titleMap[a], this._titleList.remove(a), this.invalidate() }, clear: function() { var a = this; Object.keys(a._titleMap).forEach(function(b) { a._view.removeChild(a._titleMap[b].titleDiv) }), a._titleMap = {}, a._titleList.clear(), a.invalidate() }, expand: function(a) { this._titleMap[a] && this._currentTitle !== a && (this._currentTitle = a, this.onExpanded(a), this.invalidate()) }, onExpanded: function(a) {}, collapse: function() { this._currentTitle && (this.onCollapsed(this._currentTitle), this._currentTitle = null, this.invalidate()) }, onCollapsed: function(a) {}, validateImpl: function() { var a = this._currentView; this._currentView = null; for (var b = this._view.offsetWidth, c = this._view.offsetHeight, d = this._titleList.size(), e = 0, f = 0; d > f; f++) { var g = this._titleList.get(f), h = this._titleMap[g], i = h.titleDiv.style; i.lineHeight = this._titleHeight - 3 + 'px', i.background = this._titleBackground, i.borderBottomColor = this._borderBottomColor, i.left = '0px', i.top = e + 'px', i.width = b + 'px', i.height = this._titleHeight - 1 + 'px'; var j = this._currentTitle === g, k = j ? this._expandIcon : this._collapseIcon; if (h.img.setAttribute('src', Jb.getImageSrc(k)), j) { var l = Math.max(0, c - d * this._titleHeight); h.content && (this._currentView = h.content.getView ? h.content.getView() : h.content, Jb.setViewBounds(h.content, { x: 0, y: e + this._titleHeight, width: b, height: l }), h.content.style.overflowY = 'auto'), e += this._titleHeight + l } else e += this._titleHeight } this._currentView && this._currentView !== a && this._view.appendChild(this._currentView), a && a !== this._currentView && this._view.removeChild(a) } }), Ib.controls.BorderPane = function(a, b, c, d, e) { Ib.controls.BorderPane.superClass.constructor.apply(this, arguments), this.invalidate(), this._view = Wb.createView('hidden', !0), this._view.tabIndex = -1, a && this.setCenter(a), b && this.setTop(b), c && this.setRight(c), d && this.setBottom(d), e && this.setLeft(e) }, Jb.ext('twaver.controls.BorderPane', Ib.controls.ControlBase, { __accessor: ['hGap', 'vGap', 'topHeight', 'bottomHeight', 'leftWidth', 'rightWidth'], _hGap: Ed.BORDERPANE_HGAP, _vGap: Ed.BORDERPANE_VGAP, _topHeight: 0, _bottomHeight: 0, _leftWidth: 0, _rightWidth: 0, onPropertyChanged: function(a) { this.invalidate() }, getCenter: function() { return this._center }, setCenter: function(a) { this._setContent('center', a) }, getTop: function() { return this._top }, setTop: function(a) { this._setContent('top', a) }, getRight: function() { return this._right }, setRight: function(a) { this._setContent('right', a) }, getBottom: function() { return this._bottom }, setBottom: function(a) { this._setContent('bottom', a) }, getLeft: function() { return this._left }, setLeft: function(a) { this._setContent('left', a) }, _setContent: function(a, b) { var c = this['_' + a]; if (c !== b) { if (c) { var d = c.getView ? c.getView() : c; this._view.contains(d) && this._view.removeChild(d) } this['_' + a] = b, b && this._view.appendChild(b.getView ? b.getView() : b), this.firePropertyChange(a, c, b) } }, validateImpl: function() { var a = this._view.offsetWidth, b = this._view.offsetHeight, c = 0, d = 0, e = a, f = b, g = 0, h = 0, i = 0, j = 0; this._top && (g = this._topHeight || (this._top.getView ? this._top.getView().offsetHeight : this._top.offsetHeight), d = g + this._vGap), this._bottom && (h = this._bottomHeight || (this._bottom.getView ? this._bottom.getView().offsetHeight : this._bottom.offsetHeight), f = b - h - this._vGap), this._left && (i = this._leftWidth || (this._left.getView ? this._left.getView().offsetWidth : this._left.offsetWidth), c = i + this._hGap), this._right && (j = this._rightWidth || (this._right.getView ? this._right.getView().offsetWidth : this._right.offsetWidth), e = a - j - this._hGap); var k = Math.max(0, e - c), l = Math.max(0, f - d); this._top && Jb.setViewBounds(this._top, { x: 0, y: 0, width: a, height: g }), this._bottom && Jb.setViewBounds(this._bottom, { x: 0, y: f, width: a, height: h }), this._left && Jb.setViewBounds(this._left, { x: 0, y: d, width: i, height: l }), this._right && Jb.setViewBounds(this._right, { x: e, y: d, width: j, height: l }), this._center && Jb.setViewBounds(this._center, { x: c, y: d, width: k, height: l }) } }), Ib.controls.PopupMenu = function(a) { this._view = Wb.createDiv(), this._view.style.zIndex = 100001, this._items = [], this._itemsMap = {}, this.setContextView(a); var b = this._view, c = this; b.addEventListener('mouseover', function(a) { c._mouseOver = !0 }, !1), b.addEventListener('mouseout', function(a) { c._mouseOver = !1 }, !1), b.oncontextmenu = function(a) { a.preventDefault() }, Wb.addEventListener('mousedown', '_handleClick', b, this) }, Jb.ext('twaver.controls.PopupMenu', Object, { _width: 200, _xOffset: 0, _yOffset: 0, _menuItemHeight: 25, _background: '#F9F9F9', _border: '2px outset white', _disabledColor: '#BABBBC', _focusColor: 'white', _focusBackground: '#C2CFF1', _color: 'black', _subMenuEnableIcon: Ed.POPUPMENU_SUBNENU_ENABLE_ICON, _subMenuDisableIcon: Ed.POPUPMENU_SUBNENU_DISABLE_ICON, _checkboxSelectedIcon: Ed.POPUPMENU_CHECKBOX_SELECTED_ICON, _checkboxUnselectedIcon: Ed.POPUPMENU_CHECKBOX_UNSELECTED_ICON, _radiobuttonSelectedIcon: Ed.POPUPMENU_RADIOBUTTON_SELECTED_ICON, _radiobuttonUnselectedIcon: Ed.POPUPMENU_RADIOBUTTON_UNSELECTED_ICON, getView: function() { return this._view }, getContextView: function() { return this._contextView }, setContextView: function(a) {
    if (this._removeContextmenuListener(), this._contextView = a, a) {
      var b = a.getView ? a.getView() : a; Qb.isTouchable ? (b.addEventListener('touchstart', this._getTouchStartListener(), !1), b.addEventListener('touchmove', this._getTouchMoveListener(), !1), b.addEventListener('touchend', this._getTouchEndListener(), !1)) : Wb.addEventListener('contextmenu', '_handleContextmenu', b, this)
    }
  }, getMenuItems: function() { return this._items }, setMenuItems: function(a) { if (this._items = [], this._itemsMap = {}, a) for (var b = 0, c = a.length; c > b; b++) this.addMenuItem(a[b]) }, addMenuItem: function(a) { a.separator !== !0 && (this._itemsMap[a.id || a.label] = a), this._items.push(a) }, getMenuItem: function(a) { return this._itemsMap[a] }, addSeparator: function() { this.addMenuItem({ separator: !0 }) }, getMenuItemById: function(a) { return this._itemsMap[a] }, isVisible: function(a) { return a.visible !== !1 }, isEnabled: function(a) { return a.enabled !== !1 }, show: function(a) { this.hide(); var b, c, d = this._view, e = this._view.style; if (Qb.isTouchable ? (b = a.changedTouches[0].clientX, c = a.changedTouches[0].clientY) : (b = a.clientX, c = a.clientY), Wb.clear(d), this.renderMenu(d, this._items), this._height !== 0) { Wb.addEventListener(Qb.isTouchable ? 'touchstart' : 'mousedown', '_handleBodyClicked', Ob.body, this); var f = Wb.windowWidth() - this._width - 10, g = Wb.windowHeight() - this._height - 10; b = b > f ? f : b, c = c > g ? g : c, b = b < 0 ? 0 : b, c = c < 0 ? 0 : c, e.left = b + zc.scrollLeft() + this._xOffset + 'px', e.top = c + zc.scrollTop() + this._yOffset + 'px', Ob.body.appendChild(d) } }, _showMenuItem: function(a, b) { this._hideMenuItem(b); var c = Ob.createElement('div'); b.menuItem.childrenDiv = c; var d = c.style; d.color = '#000000', d.position = 'absolute'; var e = this._width, f = b.offsetTop, g = b.menuItem.items; if (this._itemsShow = !0, b.appendChild(c), Wb.clear(c), this.renderMenu(c, g), this._height !== 0) { var h = Wb.windowWidth() - this._width - 10, i = Wb.windowHeight() - 10, j = this._getPosition(this._view); e = j.left + this._width > h ? -this._width : e, f = j.top + f + g.length * this._menuItemHeight > i ? f - (g.length - 1) * this._menuItemHeight : f, d.left = e + 'px', d.top = f + 'px', b.appendChild(c) } }, hide: function() { Ob.body.contains(this._view) && Ob.body.removeChild(this._view), delete this._mouseOver, delete this._itemsShow, Wb.removeEventListener(Qb.isTouchable ? 'touchstart' : 'mousedown', Ob.body, this) }, _hideMenuItem: function(a) { var b = a.menuItem.childrenDiv; b && a.contains(b) && a.removeChild(b), this._itemsShow = !1 }, dispose: function() { this._removeContextmenuListener(), this.hide() }, onMenuShowing: function(a) { return !0 }, onAction: function(a) {}, renderMenu: function(a, b) { var c = a.style; c.background = this._background, c.border = this._border, c.width = this._width + 'px', this._height = 0, delete this._separator; for (var d, e = 0, f = b.length; f > e; e++) if (d = b[e], this.isVisible(d)) if (d.separator === !0) this._separator = !0; else { var g = Ob.createElement('div'); this.isEnabled(d) && this._addMouseoverListener(g, d), g.menuItem = d, a.appendChild(g), this.renderMenuItem(g, d), this.onMenuItemRendered(g, d), this._separator = !1, this._height += this._menuItemHeight } }, renderMenuItem: function(a, b) { var c = a.style; c.height = this._menuItemHeight + 'px', this._separator && (c.borderTop = '1px solid gray'), this.isEnabled(b) || (c.color = this._disabledColor); var d = Ob.createElement('span'); c = d.style, c.position = 'absolute', c.width = '25px', c.height = this._menuItemHeight + 'px', c.lineHeight = this._menuItemHeight + 'px', c.textAlign = 'center', a.appendChild(d); var e; if (b.type === 'check' ? e = b.selected ? this._checkboxSelectedIcon : this._checkboxUnselectedIcon : b.type === 'radio' ? e = b.selected ? this._radiobuttonSelectedIcon : this._radiobuttonUnselectedIcon : b.icon && (e = b.icon), e) { var f = new Pb(); f.src = Jb.getImageSrc(e), f.style.verticalAlign = 'middle', d.appendChild(f) } var g = Ob.createElement('label'); if (Jb.setText(g, b.label, !0), c = g.style, c.position = 'absolute', c.height = this._menuItemHeight + 'px', c.lineHeight = this._menuItemHeight + 'px', c.left = '25px', a.appendChild(g), b.items && a.parentNode === this._view) { var h = Ob.createElement('img'); c = h.style, this.isEnabled(b) ? h.setAttribute('src', Jb.getImageSrc(this._subMenuEnableIcon)) : h.setAttribute('src', Jb.getImageSrc(this._subMenuDisableIcon)); var i = (this._menuItemHeight - 8) / 2; c.marginTop = i + 'px', c.right = '5px', c.position = 'absolute', a.appendChild(h) } }, onMenuItemRendered: function(a, b) {}, _addMouseoverListener: function(a, b) { var c = this; a.addEventListener(Qb.isTouchable ? 'touchstart' : 'mouseover', function(d) { a.style.background = c._focusBackground, a.style.color = c._focusColor, this === d.relatedTarget || this.contains(d.relatedTarget) || b.items && !c._itemsShow && a.parentNode == c._view && c._showMenuItem(d, a) }, !1), a.addEventListener(Qb.isTouchable ? 'touchend' : 'mouseout', function(d) { if (a.style.background = c._background, a.style.color = c._color, this !== d.relatedTarget && !this.contains(d.relatedTarget) && b.items && a.parentNode === c._view) { var e = d.clientX, f = d.clientY, g = b.childrenDiv, h = c._getPosition(g); (e < h.left + 2 || e > h.left + g.offsetWidth - 2 || f < h.top + 2 || f > h.top + g.offsetHeight - 2) && c._hideMenuItem(a) } }, !1) }, _getPosition: function(a) { for (var b = 0, c = 0; a;)c += a.offsetLeft, b += a.offsetTop, a = a.offsetParent; return { left: c, top: b } }, _removeContextmenuListener: function() { var a = this._contextView; a && (a = a.getView ? a.getView() : a, Qb.isTouchable ? (a.removeEventListener('touchstart', this._getTouchStartListener(), !1), a.removeEventListener('touchmove', this._getTouchMoveListener(), !1), a.removeEventListener('touchend', this._getTouchEndListener(), !1)) : Wb.removeEventListener('contextmenu', a, this)) }, _handleContextmenu: function(a) { this.onMenuShowing(a) === !0 && this.show(a), a.preventDefault() }, _handleBodyClicked: function(a) { if (Qb.isTouchable) { for (var b = a.target; b && b !== this._view;)b = b.parentElement; b !== this._view && this.hide() } else this._mouseOver || this.hide() }, _handleClick: function(a) { if (a.button === 0) { for (var b = a.target; !b.menuItem && b.parentElement;)b = b.parentElement; var c = b ? b.menuItem : null; c && this.isEnabled(c) && (c.type === 'check' && (c.selected = !c.selected), c.type === 'radio' && (c.groupName ? (c.selected = !0, this._items.forEach(function(a) { c !== a && a.groupName === c.groupName && (a.selected = !1), a.items && a.items.forEach(function(a) { c !== a && a.groupName === c.groupName && (a.selected = !1) }) })) : c.selected = !c.selected), c.action && c.action(c), this.onAction(c), c.items && c.items.length > 0 || this.hide()) } }, _getTouchStartListener: function() { if (!this._touchStartListener) { var a = this; this._touchStartListener = function(b) { a._touchMoved = !1, a._lastTouch = new Date() } } return this._touchStartListener }, _getTouchMoveListener: function() { if (!this._touchMoveListener) { var a = this; this._touchMoveListener = function(b) { a._touchMoved = !0 } } return this._touchMoveListener }, _getTouchEndListener: function() { if (!this._touchEndListener) { var a = this; this._touchEndListener = function(b) { !a._touchMoved && (new Date()).getTime() - a._lastTouch.getTime() > 1e3 && a._handleContextmenu(b) } } return this._touchEndListener }, getWidth: function() { return this._width }, setWidth: function(a) { this._width = a }, getMenuItemHeight: function() { return this._menuItemHeight }, setMenuItemHeight: function(a) { this._menuItemHeight = a }, getBackground: function() { return this._background }, setBackground: function(a) { this._background = a }, getBorder: function() { return this._border }, setBorder: function(a) { this._border = a }, getDisabledColor: function() { return this._disabledColor }, setDisabledColor: function(a) { this._disabledColor = a }, getFocusColor: function() { return this._focusColor }, setFocusColor: function(a) { this._focusColor = a }, getFocusBackground: function() { return this._focusBackground }, setFocusBackground: function(a) { this._focusBackground = a }, getColor: function() { return this._color }, setColor: function(a) { this._color = a }, getSubMenuEnableIcon: function() { return this._subMenuEnableIcon }, setSubMenuEnableIcon: function(a) { this._subMenuEnableIcon = a }, getSubMenuDisableIcon: function() { return this._subMenuDisableIcon }, setSubMenuDisableIcon: function(a) { this._subMenuDisableIcon = a }, getCheckboxSelectedIcon: function() { return this._checkboxSelectedIcon }, setCheckboxSelectedIcon: function(a) { this._checkboxSelectedIcon = a }, getCheckboxUnselectedIcon: function() { return this._checkboxUnselectedIcon }, setCheckboxUnselectedIcon: function(a) { this._checkboxUnselectedIcon = a }, getRadiobuttonSelectedIcon: function() { return this._radiobuttonSelectedIcon }, setRadiobuttonSelectedIcon: function(a) { this._radiobuttonSelectedIcon = a }, getRadiobuttonUnselectedIcon: function() { return this._radiobuttonUnselectedIcon }, setRadiobuttonUnselectedIcon: function(a) { this._radiobuttonUnselectedIcon = a }, getXOffset: function() { return this._xOffset }, setXOffset: function(a) { this._xOffset = a }, getYOffset: function() { return this._yOffset }, setYOffset: function(a) { this._yOffset = a } }), Ib.charts.IS_INVALIDATE_PROPERTY = { xZoom: 1, xTranslate: 1, yZoom: 1, yTranslate: 1 }, Ib.charts.ChartBase = function(a) { Ib.charts.ChartBase.superClass.constructor.apply(this, arguments), this._uniqueColors = {}, this._nonDataColors = {}, this._publishedDatas = new nd(), this._view = Wb.createView('hidden'), this._canvas = Wb.createCanvas(), this._view.appendChild(this._canvas), this.setDataBox(a || new Ib.ElementBox()), this.invalidate(), Qb.isTouchable ? Qb.isMSTouchable ? new Ib.charts.ChartMSTouchInteraction(this) : (new Ib.charts.ChartTouchInteraction(this), new Ib.charts.ChartInteraction(this)) : new Ib.charts.ChartInteraction(this), this.setToolTipEnabled(Ed.CHART_TOOLTIP_ENABLED) }, Jb.ext('twaver.charts.ChartBase', Ib.controls.ViewBase, { __accessor: ['xGap', 'yGap', 'xTranslate', 'yTranslate', 'valueVisible', 'sortFunction', 'visibleFunction', 'xTranslateEnabled', 'yTranslateEnabled', 'xZoomEnabled', 'yZoomEnabled', 'selectTolerance', 'backgroundVisible', 'backgroundFill', 'backgroundFillColor', 'backgroundOutlineWidth', 'backgroundOutlineColor', 'backgroundGradient', 'backgroundGradientColor', 'outerZoom'], __bool: ['doubleClickToReset', 'focusOnClick'], _backgroundVisible: Ed.CHART_BACKGROUND_VISIBLE, _backgroundFill: Ed.CHART_BACKGROUND_FILL, _backgroundFillColor: Ed.CHART_BACKGROUND_FILL_COLOR, _backgroundOutlineWidth: Ed.CHART_BACKGROUND_OUTLINE_WIDTH, _backgroundOutlineColor: Ed.CHART_BACKGROUND_OUTLINE_COLOR, _backgroundGradient: Ed.CHART_BACKGROUND_GRADIENT, _backgroundGradientColor: Ed.CHART_BACKGROUND_GRADIENT_COLOR, _selectTolerance: Ed.CHART_SELECT_TOLERANCE, _doubleClickToReset: Ed.CHART_DOUBLE_CLICK_TO_RESET, _focusOnClick: Ed.FOCUS_ON_CLICK, _sortFunction: null, _visibleFunction: null, _canvasWidth: 0, _canvasHeight: 0, _outerZoomL: 1, _xGap: Ed.CHART_XGAP, _yGap: Ed.CHART_YGAP, _xTranslate: 0, _yTranslate: 0, _xTranslateEnabled: Ed.CHART_XTRANSLATE_ENABLED, _yTranslateEnabled: Ed.CHART_YTRANSLATE_ENABLED, _xZoom: 1, _yZoom: 1, _maxZoom: Ed.ZOOM_MAX, _minZoom: Ed.ZOOM_MIN, _xZoomEnabled: Ed.CHART_XZOOM_ENABLED, _yZoomEnabled: Ed.CHART_YZOOM_ENABLED, _valueVisible: Ed.CHART_VALUE_VISIBLE, _valueFont: Ed.CHART_VALUE_FONT, isToolTipEnabled: function() { return this._toolTipListener ? !0 : !1 }, setToolTipEnabled: function(a) { if (a) { if (!this._toolTipListener) { var b = this; this._toolTipListener = function(a) { Bc.showToolTip(a, b.getToolTip(a)) }, this._canvas.addEventListener('mousemove', this._toolTipListener, !0), this.firePropertyChange('toolTipEnabled', !1, !0) } } else this._toolTipListener && (Bc.hideToolTip(), this._canvas.removeEventListener('mousemove', this._toolTipListener, !0), delete this._toolTipListener, this.firePropertyChange('toolTipEnabled', !0, !1)) }, getToolTip: function(a) { if (this._toolTipInfos) { var b = this.getLogicalPoint(a); b.x -= this._xTranslate, b.y -= this._yTranslate; for (var c = this._toolTipInfos.size(), d = c - 1; d >= 0; d--) { var e = this._toolTipInfos.get(d); if (e.rect && Tb.containsPoint(e.rect, b)) return this.getToolTipByData(e.data, e) } } else { var f = this.tryGetDataAt(a); if (f) return this.getToolTipByData(f, { value: this.getValue(f) }) } return null }, getToolTipByData: function(a, c) { return c.value !== b ? this.formatValueText(c.value, a) : null }, addToolTipInfo: function(a, b, c, d, e, f, g) { this._toolTipInfos && this._toolTipInfos.add({ data: f, rect: { x: a, y: b, width: c, height: d }, value: e, index: g }) }, getLogicalPoint: function(a) { return Wb.getLogicalPoint(this._canvas, a, this._outerZoom) }, getTextSize: function(a, b) { var c = Xb.getTextSize(a, b); return c.width && (c.width += 4), c }, getUniqueColor: function(a, c) { if (a == null) return null; var d; if (!c && (d = this._nonDataColors[a])) return d; var e = Xb.getColorArray(a); if (!c) return d = e[3] != 255 ? a : 'rgba(' + e[0] + ',' + e[1] + ',' + e[2] + ',0.99)', this._nonDataColors[a] = d, d; var f = 'rgb(' + e[0] + ',' + e[1] + ',' + e[2] + ')'; if (this._uniqueColors[f] === b || this._uniqueColors[f] === c);else { var g = 1, h = -1, i = 1; for (Qb.isOpera && (e = [e[0], e[1], e[2]]); ;) { if (e[0] += g, e[0] >= 255 ? (e[0] = 255, g = -1) : e[0] <= 0 && (e[0] = 0, g = 1), f = 'rgb(' + e[0] + ',' + e[1] + ',' + e[2] + ')', this._uniqueColors[f] === b || this._uniqueColors[f] === c) break; if (e[1] += h, e[1] >= 255 ? (e[1] = 255, h = -1) : e[1] <= 0 && (e[1] = 0, h = 1), f = 'rgb(' + e[0] + ',' + e[1] + ',' + e[2] + ')', this._uniqueColors[f] === b || this._uniqueColors[f] === c) break; if (e[2] += i, e[2] >= 255 ? (e[2] = 255, i = -1) : e[2] <= 0 && (e[2] = 0, i = 1), f = 'rgb(' + e[0] + ',' + e[1] + ',' + e[2] + ')', this._uniqueColors[f] === b || this._uniqueColors[f] === c) break } } return this._uniqueColors[f] = c, f }, tryGetDataAt: function(a, b) { if ((b == null || b < 0) && (b = this._selectTolerance), a.target && (a = Wb.getLogicalPoint(this._canvas, arguments[0], this._outerZoom)), !a) return null; var c = a.x - b, d = a.y - b, e = 2 * b + 1, f = 2 * b + 1; try { for (var g = this._canvas.getContext('2d').getImageData(c, d, e, f).data, h = 0, i = g.length; i > h; h += 4) if (g[h + 3] === 255) { var j = 'rgb(' + g[h] + ',' + g[h + 1] + ',' + g[h + 2] + ')', k = this._uniqueColors[j]; if (k) return k } } catch (l) {} return null }, _getPoint: function() { var a, b; if (arguments.length === 2)a = arguments[0], b = arguments[1]; else if (arguments[0].target) { var c = Wb.getLogicalPoint(this._canvas, arguments[0], this._outerZoom); if (!c) return null; a = c.x, b = c.y } else a = arguments[0].x, b = arguments[0].y; return { x: a, y: b } }, getDataAt: function() { var a = this._getPoint.apply(this, arguments), b = a.x, c = a.y; if (b < 0 || c < 0 || b > this._canvasWidth || c > this._canvasHeight) return null; try { var d = this._canvas.getContext('2d').getImageData(b, c, 1, 1).data; if (d[3] === 255) { var e = 'rgb(' + d[0] + ',' + d[1] + ',' + d[2] + ')', f = this._uniqueColors[e]; if (f) return f } } catch (g) {} return null }, getBackgroundRect: function() { return this._backgroundRect }, drawBackground: function(a, b) { this._backgroundRect = Jb.clone(b), b != null && b.width > 0 && b.height > 0 && this._backgroundVisible && (this._backgroundFill && Xb.fill(a, this.getUniqueColor(this._backgroundFillColor), this._backgroundGradient, this.getUniqueColor(this._backgroundGradientColor), b), this._backgroundOutlineWidth > 0 && (a.lineWidth = this._backgroundOutlineWidth, a.strokeStyle = this._backgroundOutlineColor), a.beginPath(), a.rect(b.x, b.y, b.width, b.height), a.closePath(), this._backgroundFill && a.fill(), this._backgroundOutlineWidth > 0 && a.stroke()) }, getName: function(a) { return a.getName() }, getColor: function(a) { return a.getStyle ? a.getStyle('chart.color') : a.getClient('chart.color') }, getValue: function(a) { return a.getStyle ? a.getStyle('chart.value') : 0 }, getValueColor: function(a) { return a.getStyle ? a.getStyle('chart.value.color') : Ib.Styles.getStyle('chart.value.color') }, setValueFont: function(a) { if (a !== this._valueFont) { var b = a; this._valueFont = a, this.firePropertyChange('valueFont', b, a) } }, getValueFont: function(a) { if (a) { var b = a.getStyle ? a.getStyle('chart.value.font') : Ib.Styles.getStyle('chart.value.font'); if (b) return b } return this._valueFont }, formatValueText: function(a, b) { return a }, getCanvasWidth: function() { return this._canvasWidth }, getCanvasHeight: function() { return this.canvasHeight }, getCanvas: function() { return this._canvas }, isVisible: function(a) { return this._internalVisibleFunction && !this._internalVisibleFunction(a) ? !1 : this._visibleFunction ? this._visibleFunction(a) : !0 }, onPropertyChanged: function(a) { Ib.charts.IS_INVALIDATE_PROPERTY[a.property] ? this.invalidate() : this.invalidateModel() }, getDataBox: function() { return this._box }, setDataBox: function(a) { if (!a) throw 'DataBox can not be null'; if (this._box !== a) { var b = this._box; b && (b.removeDataBoxChangeListener(this.handleDataBoxChange, this), b.removeDataPropertyChangeListener(this.handlePropertyChange, this), b.removeHierarchyChangeListener(this.handleHierarchyChange, this), this._selectionModel || b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)), this._box = a, this._box.addDataBoxChangeListener(this.handleDataBoxChange, this), this._box.addDataPropertyChangeListener(this.handlePropertyChange, this), this._box.addHierarchyChangeListener(this.handleHierarchyChange, this), this._selectionModel ? this._selectionModel._setDataBox(a) : this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this), this.invalidateModel(), this.firePropertyChange('dataBox', b, this._box) } }, handleDataBoxChange: function(a) { this.invalidateModel() }, handlePropertyChange: function(a) { this.invalidateModel() }, handleHierarchyChange: function(a) { this.invalidateModel() }, handleSelectionChange: function(a) { this.invalidateModel() }, getUnfilteredDatas: function() { return this._unfilteredDatas ? this._unfilteredDatas : this._publishedDatas }, getPublishedDatas: function() { return this._publishedDatas }, createPublishedDatas: function() { return this._unfilteredDatas = new nd(), this._buildChildren(this._box.getRoots(), this._unfilteredDatas), this._sortFunction && this._unfilteredDatas.sort(this._sortFunction), this._unfilteredDatas.toList(this.isVisible, this) }, _buildChildren: function(a, b) { a.forEach(function(a) { b.add(a), this._buildChildren(a.getChildren(), b) }, this) }, invalidateModel: function() { this._invalidateModel || (this._invalidateModel = !0, this.invalidate()) }, validateImpl: function() { this._invalidateModel && (this._invalidateModel = !1, this._uniqueColors = {}, this._nonDataColors = {}, this._publishedDatas = this.createPublishedDatas(), this._publishedDatas.forEach(function(a) { a.IStyle ? a.getStyle('chart.color') || a.setStyle('chart.color', Jb.nextColor()) : a.getClient('chart.color') || a.setClient('chart.color', Jb.nextColor()) }), this.validateModel()); var a = this._canvas.getContext('2d'); this._canvasWidth = this._view.clientWidth, this._canvasHeight = this._view.clientHeight, this._canvas.setAttribute('width', this._canvasWidth), this._canvas.setAttribute('height', this._canvasHeight), a.clearRect(0, 0, this._canvasWidth, this._canvasHeight), this._canvasWidth > 0 && this._canvasHeight > 0 && (a.translate(this._xTranslate, this._yTranslate), this._valueTexts = this._valueVisible ? new nd() : null, this.validateDisplay(a, this._canvasWidth * this._xZoom, this._canvasHeight * this._yZoom), delete this._valueTexts, a.translate(-this._xTranslate, -this._yTranslate)) }, adjustBounds: function(a) { Ib.charts.ChartBase.superClass.adjustBounds.apply(this, arguments), typeof Ib.gis === 'undefined' && Ib.Util.makeHighRes(this._canvas) }, validateModel: function() {}, validateDisplay: function(a, b, c) {}, drawLine: function(a, b, c, d, e, f, g) { c > 0 && (a.lineWidth = c, a.strokeStyle = this.getUniqueColor(b), a.beginPath(), a.moveTo(d, e), a.lineTo(f, g), a.stroke()) }, drawValueTexts: function(a) { this._valueTexts && this._valueTexts.forEach(function(b) { Xb.drawText(a, b.text, b, b.font, b.color) }) }, drawVerticalText: function(a, b, c, d, e) { e = this.getUniqueColor(e), a.translate(c.x, c.y), a.rotate(-Math.PI / 2), Xb.drawText(a, b, null, d, e), a.rotate(Math.PI / 2), a.translate(-c.x, -c.y) }, _getValueTextInfo: function(a, b) { if (this._valueTexts) { var c = this.formatValueText(b, a); if (c && c !== '') { var d = this.getValueColor(a), e = { text: c, font: this.getValueFont(a), color: this.getUniqueColor(d, a) }; return this._valueTexts.add(e), e } } return null }, getMaxZoom: function() { return this._maxZoom }, setMaxZoom: function(a) { if (!(a < 0)) { var b = this._maxZoom; this._maxZoom = a, this.firePropertyChange('maxZoom', b, a), this.getXZoom() > a && this.setXZoom(a, !1), this.getYZoom() > a && this.setYZoom(a, !1) } }, getMinZoom: function() { return this._minZoom }, setMinZoom: function(a) { if (!(a < 0)) { var b = this._minZoom; this._minZoom = a, this.firePropertyChange('minZoom', b, a), this.getXZoom() < a && this.setXZoom(a), this.getYZoom() < a && this.setYZoom(a) } }, zoomIn: function(a) { a == null && (a = Ed.ZOOM_ANIMATE), a ? Ib.animate.AnimateManager.start(new Ib.animate.AnimateXYZoom(this, this._xZoom * Ed.ZOOM_INCREMENT, this._yZoom * Ed.ZOOM_INCREMENT)) : (this.xZoomIn(!1), this.yZoomIn(!1)) }, zoomOut: function(a) { a == null && (a = Ed.ZOOM_ANIMATE), a ? Ib.animate.AnimateManager.start(new Ib.animate.AnimateXYZoom(this, this._xZoom / Ed.ZOOM_INCREMENT, this._yZoom / Ed.ZOOM_INCREMENT)) : (this.xZoomOut(!1), this.yZoomOut(!1)) }, zoomReset: function(a) { a == null && (a = Ed.ZOOM_ANIMATE), a ? Ib.animate.AnimateManager.start(new Ib.animate.AnimateXYZoom(this, 1, 1)) : (this.xZoomReset(!1), this.yZoomReset(!1)) }, getXZoom: function() { return this._xZoom }, onXZoomChanged: function(a, b) {}, xZoomIn: function(a) { this.setXZoom(this._xZoom * Ed.ZOOM_INCREMENT, a) }, xZoomOut: function(a) { this.setXZoom(this._xZoom / Ed.ZOOM_INCREMENT, a) }, xZoomReset: function(a) { this.setXZoom(1, a) }, setXZoom: function(a, b) { if (Jb.num(a) && !(a <= 0) && (a < this._minZoom && (a = this._minZoom), a > this._maxZoom && (a = this._maxZoom), a !== this.xZoom)) if (b == null && (b = Ed.ZOOM_ANIMATE), b)Ib.animate.AnimateManager.start(new Ib.animate.AnimateXZoom(this, a)); else { var c = this._xZoom, d = this._xTranslate - (this._canvasWidth / 2 - this._xTranslate) / c * (a - c); this._xZoom = a, this.firePropertyChange('xZoom', c, a), this.onXZoomChanged(c, a), this.setXTranslate(d) } }, getYZoom: function() { return this._yZoom }, onYZoomChanged: function(a, b) {}, yZoomIn: function(a) { this.setYZoom(this._yZoom * Ed.ZOOM_INCREMENT, a) }, yZoomOut: function(a) { this.setYZoom(this._yZoom / Ed.ZOOM_INCREMENT, a) }, yZoomReset: function(a) { this.setYZoom(1, a) }, setYZoom: function(a, b) { if (Jb.num(a) && !(a <= 0) && (a < this._minZoom && (a = this._minZoom), a > this._maxZoom && (a = this._maxZoom), a !== this.YZoom)) if (b == null && (b = Ed.ZOOM_ANIMATE), b)Ib.animate.AnimateManager.start(new Ib.animate.AnimateYZoom(this, a)); else { var c = this._yZoom, d = this._yTranslate - (this._canvasHeight / 2 - this._yTranslate) / c * (a - c); this._yZoom = a, this.firePropertyChange('yZoom', c, a), this.onYZoomChanged(c, a), this.setYTranslate(d) } } }), Ib.charts.ScaleChart = function(a) { Ib.charts.ScaleChart.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.charts.ScaleChart', Ib.charts.ChartBase, { __accessor: ['upperLimit', 'lowerLimit', 'xAxisText', 'xAxisLineColor', 'xAxisLineWidth', 'xAxisTextColor', 'xAxisTextFont', 'yAxisText', 'yAxisLineColor', 'yAxisLineWidth', 'yAxisTextColor', 'yAxisTextFont', 'xScaleTexts', 'xScaleTextFont', 'xScaleTextColor', 'xScaleTextOrientation', 'yScaleTextVisible', 'yScaleTextColor', 'yScaleTextFont', 'yScaleLineColor', 'yScaleLineWidth', 'yScaleValueGap', 'yScalePixelGap', 'yScaleMinTextVisible', 'valueSpanCount'], _reset: function() { this._map = {}, this._max = 0, this._min = 0, this._columnCount = this._xScaleTexts ? this._xScaleTexts.size() : 0, this._upperLimit != null && (this._max = this._upperLimit), this._lowerLimit != null && (this._min = this._lowerLimit) }, getMin: function() { return this._min }, getMax: function() { return this._max }, getRange: function() { return this._range }, getColumnCount: function() { return this._columnCount }, getColumnWidth: function() { return this._columnWidth }, getValues: function(a) { return a.getStyle ? a.getStyle('chart.values') : null }, formatYScaleText: function(a) { return a.toFixed(2) }, _initRange: function() { this._lowerLimit == null && (this._min >= this._max && (this._min = this._max - 0.1 * Math.abs(this._max)), this._min = this._min - 0.1 * (this._max - this._min)), this._range = this._max - this._min }, _initValuesProportion: function() { this._publishedDatas.forEach(function(a) { var b = this._map[a.getId()]; b.values.forEach(function(a) { b.proportions.add(a == null ? null : this._range == 0 ? 0 : a / this._range) }, this) }, this) }, _commonValidateModel: function() { this._publishedDatas.forEach(function(a) { var b = new nd(this.getValues(a)); b.size() > this._columnCount && (this._columnCount = b.size()); var c = { data: a, values: b, proportions: new nd(), color: this.getUniqueColor(this.getColor(a), a) }; this._initInfo && this._initInfo(a, c), this._map[a.getId()] = c, (this._upperLimit == null || this._lowerLimit == null) && b.forEach(function(a) { a != null && (this._upperLimit == null && a > this._max && (this._max = a), this._lowerLimit == null && a < this._min && (this._min = a)) }, this) }, this), this._initRange(), this._initValuesProportion() }, validateDisplay: function(a, b, c) { var d = 0; this._xAxisText && (d = this.getTextSize(this._xAxisTextFont, this._xAxisText).height); var e = 0; this._xScaleTexts && this._xScaleTexts.forEach(function(a) { var b = this.getTextSize(this._xScaleTextFont, a), c = this._xScaleTextOrientation === 'vertical' ? b.width : b.height; c > e && (e = c) }, this); var f = c - this._yGap - d - e, g = f - this._yGap, h = this._upperLimit == null ? 0.9 * g : g, i = 0; this._yAxisText && (i = this.getTextSize(this._yAxisTextFont, this._yAxisText).height); var j, k; this._yScaleValueGap > 0 ? (j = Math.max(this._yScaleValueGap / this._range * h, 1), k = this._yScaleValueGap) : (j = Math.max(this._yScalePixelGap, 1), k = this._range * (j / h)); var l, m, n = 0, o = new nd(); if (this._yScaleTextVisible) { l = this._yScaleMinTextVisible ? 0 : j; for (var p = this._min + (this._yScaleMinTextVisible ? 0 : k); g + 1 >= l;) { if (m = this.formatYScaleText(p)) { var q = this.getTextSize(this._yScaleTextFont, m); q.width > n && (n = q.width), o.add({ text: m, size: q, cursor: l }) }l += j, p += k } } var r = { x: this._xGap + i + n, y: this._yGap, width: b - this._xGap - i - n - this._xGap, height: c - this._yGap - e - d - this._yGap }; if (this.drawBackground(a, r), this._columnWidth = this._columnCount > 0 ? r.width / (3 * this._columnCount + 1) * 2 : r.width / 2, this._columnWidth === 0 && (this._columnWidth = 1), this._yScaleLineWidth > 0) for (l = 0; g + 1 >= l;) this.drawLine(a, this._yScaleLineColor, this._yScaleLineWidth, r.x, f - l, r.x + r.width, f - l), l += j; this._xAxisText && Xb.drawText(a, this._xAxisText, { x: r.x + r.width / 2, y: f + e + d / 2 }, this._xAxisTextFont, this.getUniqueColor(this._xAxisTextColor)), this._yAxisText && this.drawVerticalText(a, this._yAxisText, { x: this._xGap + i / 2, y: g / 2 + this._yGap }, this._yAxisTextFont, this.getUniqueColor(this._yAxisTextColor)), this.drawLine(a, this._yAxisLineColor, this._yAxisLineWidth, r.x, r.y + r.height, r.x, r.y); var s = this.getUniqueColor(this._yScaleTextColor); o.forEach(function(b) { var c = { x: this._xGap + i + n - b.size.width / 2, y: f - b.cursor }; Xb.drawText(a, b.text, c, this._yScaleTextFont, s) }, this); var t = r.y + r.height + e / 2; s = this.getUniqueColor(this._xScaleTextColor); for (var u = this._xScaleLineWidth > 0 ? this.getUniqueColor(this._xScaleLineColor) : null, v = 0; v < this._columnCount; v++) { var w = r.x + this._columnWidth * (1 + 1.5 * v); if (this._xScaleTexts && v < this._xScaleTexts.size() && (m = this._xScaleTexts.get(v))) { var x = { x: w, y: t }; this._xScaleTextOrientation === 'vertical' ? this.drawVerticalText(a, m, x, this._yScaleTextFont, s) : this._valueSpanCount ? v % this._valueSpanCount == 0 && Xb.drawText(a, m, x, this._xScaleTextFont, s) : Xb.drawText(a, m, x, this._xScaleTextFont, s) } this._type !== 'default' && u && (this._valueSpanCount ? v % this._valueSpanCount == 0 && this.drawLine(a, u, this._xScaleLineWidth, w, r.y + r.height, w, r.y) : this.drawLine(a, u, this._xScaleLineWidth, w, r.y + r.height, w, r.y)) } var y = f + this._min / k * j; this._publishedDatas.size() > 0 && this._columnCount > 0 && this.drawContent(a, r, h, y), this.drawLine(a, this._xAxisLineColor, this._xAxisLineWidth, r.x, r.y + r.height, r.x + r.width, r.y + r.height) } }), Ib.charts.PieChart = function(a) { this._sum = 0, this._map = {}, Ib.charts.PieChart.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.charts.PieChart', Ib.charts.ChartBase, { __accessor: ['type', 'selectOffset', 'startAngle', 'shadowColor', 'shadowOffset', 'lineRate', 'donutRate', 'valuePosition'], _type: Ed.PIECHART_TYPE, _lineRate: Ed.PIECHART_LINE_RATE, _donutRate: Ed.PIECHART_DONUT_RATE, _startAngle: Ed.PIECHART_START_ANGLE, _shadowColor: Ed.PIECHART_SHADOW_COLOR, _shadowOffset: Ed.PIECHART_SHADOW_OFFSET, _selectOffset: Ed.PIECHART_SELECT_OFFSET, _valuePosition: Ed.PIECHART_VALUE_POSITION, getSum: function() { return this._sum }, validateModel: function() { this._sum = 0, this._map = {}, this._publishedDatas.forEach(function(a) { var b = this.getValue(a); this._map[a.getId()] = { data: a, value: b, color: this.getUniqueColor(this.getColor(a), a) }, this._sum += b }, this); var a = this._startAngle; this._publishedDatas.forEach(function(b) { var c = this._map[b.getId()]; c.proportion = this._sum === 0 ? 0 : c.value / this._sum, this._type !== 'line' && (c.startAngle = a, c.arc = c.proportion * Math.PI * 2, a += c.arc) }, this) }, validateDisplay: function(a, b, c) { var d = { x: this._xGap, y: this._yGap, width: b - 2 * this._xGap, height: c - 2 * this._yGap }; if (this.drawBackground(a, d), Tb.grow(d, -4, -4), !(d.width <= 0 || d.height <= 0)) { var e = this._shadowOffset; if (e > 0 && (a.shadowOffsetX = e, a.shadowOffsetY = e, a.shadowBlur = 1.5 * e, a.shadowColor = this._shadowColor), this._type === 'oval' || this._type === 'circle') { var f = d.x + d.width / 2, g = d.y + d.height / 2, h = d.width / 2, i = d.height / 2; this._type === 'circle' && (h = i = Math.min(h, i)), this._publishedDatas.forEach(function(b) { var c = this._map[b.getId()]; if (c.arc !== 0) { var d = 0, e = 0; if (this.isSelected(b)) { var j = c.startAngle + c.arc / 2; d = Math.cos(j) * this._selectOffset, e = Math.sin(j) * this._selectOffset * i / h }a.fillStyle = c.color, a.beginPath(), a.moveTo(f + d, g - e), Xb.drawArc(a, f + d, g - e, c.startAngle, c.arc, h, i, !0), a.closePath(), a.fill(); var k = this._getValueTextInfo(b, c.value); if (k) { var j = c.startAngle + c.arc / 2; k.x = f + d + Math.cos(j) * h * this._valuePosition, k.y = g - e - Math.sin(j) * i * this._valuePosition } } }, this) } else if (this._type === 'donut' || this._type === 'ovalDonut') { var f = d.x + d.width / 2, g = d.y + d.height / 2, h = d.width / 2, i = d.height / 2; this._type === 'donut' && (h = i = Math.min(h, i)), this._publishedDatas.forEach(function(b) { var c = this._map[b.getId()]; if (c.arc !== 0) { var d = 0, e = 0; if (this.isSelected(b)) { var j = c.startAngle + c.arc / 2; d = Math.cos(j) * this._selectOffset, e = Math.sin(j) * this._selectOffset * i / h } var k = f + Math.cos(c.startAngle) * h * this._donutRate, l = g - Math.sin(c.startAngle) * i * this._donutRate, m = f + Math.cos(c.startAngle + c.arc) * h * this._donutRate, n = g - Math.sin(c.startAngle + c.arc) * i * this._donutRate; a.fillStyle = c.color, a.beginPath(), a.moveTo(k + d, l - e), Xb.drawArc(a, f + d, g - e, c.startAngle, c.arc, h, i, !0), a.lineTo(m + d, n - e), Xb.drawArc(a, f + d, g - e, c.startAngle + c.arc, -c.arc, h * this._donutRate, i * this._donutRate, !0), a.closePath(), a.fill(); var o = this._getValueTextInfo(b, c.value); if (o) { var j = c.startAngle + c.arc / 2, p = this._donutRate + (1 - this._donutRate) * this._valuePosition; o.x = f + d + Math.cos(j) * h * p, o.y = g - e - Math.sin(j) * i * p } } }, this) } else if (this._type === 'line') { var j = d.height * this._lineRate; d.y = d.y + d.height / 2 - j / 2, d.height = j; var k = d.x; this._publishedDatas.forEach(function(b) { var c = this._map[b.getId()], e = d.width * c.proportion; if (e !== 0) { a.beginPath(), a.fillStyle = c.color; var f = this.isSelected(b) ? -this._selectOffset : 0; a.rect(k, d.y + f, e, d.height), a.closePath(), a.fill(); var g = this._getValueTextInfo(b, c.value); g && (g.x = k + e / 2, g.y = d.y + d.height + f - d.height * this._valuePosition), k += e } }, this) } this._shadowOffset > 0 && (a.shadowOffsetX = 0, a.shadowOffsetY = 0, a.shadowBlur = 0), this.drawValueTexts(a) } } }), Ib.charts.BarChart = function(a) { Ib.charts.BarChart.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.charts.BarChart', Ib.charts.ScaleChart, { __accessor: ['type'], _upperLimit: Ed.BARCHART_UPPER_LIMIT, _lowerLimit: Ed.BARCHART_LOWER_LIMIT, _type: Ed.BARCHART_TYPE, _xAxisText: null, _xAxisTextColor: Ed.BARCHART_XAXIS_TEXT_COLOR, _xAxisTextFont: Ed.BARCHART_XAXIS_TEXT_FONT, _xAxisLineColor: Ed.BARCHART_XAXIS_LINE_COLOR, _xAxisLineWidth: Ed.BARCHART_XAXIS_LINE_WIDTH, _yAxisText: null, _yAxisTextColor: Ed.BARCHART_YAXIS_TEXT_COLOR, _yAxisTextFont: Ed.BARCHART_YAXIS_TEXT_FONT, _yAxisLineColor: Ed.BARCHART_YAXIS_LINE_COLOR, _yAxisLineWidth: Ed.BARCHART_YAXIS_LINE_WIDTH, _xScaleTexts: null, _xScaleTextFont: Ed.BARCHART_XSCALE_TEXT_FONT, _xScaleTextColor: Ed.BARCHART_XSCALE_TEXT_COLOR, _xScaleTextOrientation: Ed.BARCHART_XSCALE_TEXT_ORIENTATION, _yScaleTextVisible: Ed.BARCHART_YSCALE_TEXT_VISIBLE, _yScaleTextColor: Ed.BARCHART_YSCALE_TEXT_COLOR, _yScaleTextFont: Ed.BARCHART_YSCALE_TEXT_FONT, _yScaleLineColor: Ed.BARCHART_YSCALE_LINE_COLOR, _yScaleLineWidth: Ed.BARCHART_YSCALE_LINE_WIDTH, _yScaleValueGap: Ed.BARCHART_YSCALE_VALUE_GAP, _yScalePixelGap: Ed.BARCHART_YSCALE_PIXEL_GAP, _yScaleMinTextVisible: Ed.BARCHART_YSCALE_MIN_TEXT_VISIBLE, validateModel: function() { var a = this._type + 'ValidateModel'; this[a] && (this._reset(), this[a]()) }, defaultValidateModel: function() { this._columnCount = this._publishedDatas.size(), this._publishedDatas.forEach(function(a) { var b = this.getValue(a); this._upperLimit == null && b > this._max && (this._max = b), this._lowerLimit == null && b < this._min && (this._min = b), this._map[a.getId()] = { data: a, value: b, color: this.getUniqueColor(this.getColor(a), a) } }, this), this._initRange(), this._publishedDatas.forEach(function(a) { var b = this._map[a.getId()]; b.proportion = this._range == 0 ? 0 : b.value / this._range }, this) }, layerValidateModel: function() { this._commonValidateModel() }, groupValidateModel: function() { this._commonValidateModel() }, stackValidateModel: function() { if (this._publishedDatas.forEach(function(a) { var b = new nd(this.getValues(a)); b.size() > this._columnCount && (this._columnCount = b.size()); var c = { data: a, values: b, proportions: new nd(), color: this.getUniqueColor(this.getColor(a), a) }; this._map[a.getId()] = c }, this), this._upperLimit == null || this._lowerLimit == null) for (var a = 0; a < this._columnCount; a++) { var b = 0, c = 0; this._publishedDatas.forEach(function(d) { var e = this._map[d.getId()]; if (e.values.size() > a) { var f = e.values.get(a); f != null && (f >= 0 ? b += f : c += f) } }, this), this._upperLimit == null && b > this._max && (this._max = b), this._lowerLimit == null && c < this._min && (this._min = c) } this._initRange(), this._initValuesProportion() }, percentValidateModel: function() {
    this._publishedDatas.forEach(function(a) {
      var b = new nd(this.getValues(a)); b.size() > this._columnCount && (this._columnCount = b.size()); var c = { data: a, values: b, proportions: new nd(), color: this.getUniqueColor(this.getColor(a), a) }; this._map[a.getId()] = c
    }, this); for (var a = new nd(), b = 0; b < this._columnCount; b++) { var c = 0; this._publishedDatas.forEach(function(a) { var d = this._map[a.getId()]; if (d.values.size() > b) { var e = d.values.get(b); e != null && (c += e) } }, this), a.add(c) } for (var b = 0; b < this._columnCount; b++) this._publishedDatas.forEach(function(c) { var d = this._map[c.getId()], e = a.get(b); if (e !== 0 && d.values.size() > b) { var f = d.values.get(b); if (f != null) return void d.proportions.add(f / e) }d.proportions.add(null) }, this); this._min = 0, this._max = 1, this._range = 1
  }, drawRect: function(a, b, c, d, e, f, g) { a.fillStyle = b, c && this._selectInfos.add({ x: d, y: e, w: f, h: g, color: this.getUniqueColor(Xb.darker(b)) }), a.beginPath(), a.rect(d, e, f, g), a.closePath(), a.fill() }, drawContent: function(a, b, c, d) { this._selectInfos = new nd(), this._toolTipInfos = this.isToolTipEnabled() ? new nd() : null, this._type === 'default' ? this.drawDefaultContent(a, b, c, d) : this._type === 'group' ? this.drawGroupContent(a, b, c, d) : this._type === 'percent' ? this.drawPercentContent(a, b, c, d) : this._type === 'stack' ? this.drawStackContent(a, b, c, d) : this._type === 'layer' && this.drawLayerContent(a, b, c, d), this.drawValueTexts(a), this._selectInfos.forEach(function(b) { a.lineWidth = 2, a.strokeStyle = b.color, a.beginPath(), a.rect(b.x, b.y, b.w, b.h), a.closePath(), a.stroke() }, this), delete this._selectInfos }, drawDefaultContent: function(a, b, c, d) { for (var e = this._publishedDatas.size(), f = this._columnWidth, g = 0; e > g; g++) { var h = this._publishedDatas.get(g), i = this._map[h.getId()], j = b.x + f * (0.5 + 1.5 * g), k = Math.abs(c * i.proportion), l = i.proportion > 0 ? d - k : d; this.drawRect(a, i.color, this.isSelected(h), j, l, f, k), this.addToolTipInfo(j, l, f, k, i.value, h); var m = this._getValueTextInfo(h, i.value); if (m) { var n = this.getTextSize(m.font, m.text); m.x = j + f / 2, m.y = l - n.height / 2 + 1 } } }, drawPercentContent: function(a, b, c, d) { this.drawStackContent(a, b, c, d) }, drawStackContent: function(a, b, c, d) { for (var e = this._columnCount, f = this._columnWidth, g = 0; e > g; g++) { var h = d, i = b.x + f * (0.5 + 1.5 * g); this._publishedDatas.forEach(function(b) { var d = this._map[b.getId()]; if (g < d.proportions.size()) { var e = d.proportions.get(g); if (e != null) { var j = c * e; h -= j, this.drawRect(a, d.color, this.isSelected(b), i, h, f, j), this.addToolTipInfo(i, h, f, j, d.values.get(g), b); var k = this._getValueTextInfo(b, d.values.get(g)); k && (k.x = i + f / 2, k.y = h + j / 2) } } }, this) } }, drawLayerContent: function(a, b, c, d) { for (var e = this._publishedDatas.size(), f = this._columnCount, g = this._columnWidth, h = 3 * g / 8 / e, i = 0; f > i; i++) { var j = b.x + g * (0.5 + 1.5 * i), k = 0; this._publishedDatas.forEach(function(b) { var f = this._map[b.getId()]; if (i < f.proportions.size()) { var l = f.proportions.get(i); if (l != null) { var m = c * l, n = d - m, o = j + g / 2 - g / 8 - h * (e - k), p = 2 * (g / 8 + h * (e - k)); this.drawRect(a, f.color, this.isSelected(b), o, n, p, m), this.addToolTipInfo(o, n, p, m, f.values.get(i), b); var q = this._getValueTextInfo(b, f.values.get(i)); if (q) { var r = this.getTextSize(q.font, q.text); q.x = o + p / 2, q.y = n - r.height / 2 + 1 } } }k++ }, this) } }, drawGroupContent: function(a, b, c, d) { for (var e = this._publishedDatas.size(), f = this._columnCount, g = this._columnWidth, h = g / e, i = 0; f > i; i++) { var j = b.x + g * (0.5 + 1.5 * i), k = 0; this._publishedDatas.forEach(function(b) { var e = this._map[b.getId()]; if (i < e.proportions.size()) { var f = e.proportions.get(i); if (f != null) { var g = c * f, l = d - g; this.drawRect(a, e.color, this.isSelected(b), j + h * k, l, h, g), this.addToolTipInfo(j + h * k, l, h, g, e.values.get(i), b); var m = this._getValueTextInfo(b, e.values.get(i)); if (m) { var n = this.getTextSize(m.font, m.text); m.x = j + h * k + h / 2, m.y = l - n.height / 2 + 1 } } }k++ }, this) } } }), Ib.charts.LineChart = function(a) { Ib.charts.LineChart.superClass.constructor.apply(this, arguments), this._selectTolerance = 2 }, Jb.ext('twaver.charts.LineChart', Ib.charts.ScaleChart, { __accessor: ['xScaleLineColor', 'xScaleLineWidth', 'interruptable'], _interruptable: Ed.LINECHART_INTERRUPTABLE, _upperLimit: Ed.LINECHART_UPPER_LIMIT, _lowerLimit: Ed.LINECHART_LOWER_LIMIT, _xAxisText: null, _xAxisTextColor: Ed.LINECHART_XAXIS_TEXT_COLOR, _xAxisTextFont: Ed.LINECHART_XAXIS_TEXT_FONT, _xAxisLineColor: Ed.LINECHART_XAXIS_LINE_COLOR, _xAxisLineWidth: Ed.LINECHART_XAXIS_LINE_WIDTH, _yAxisText: null, _yAxisTextColor: Ed.LINECHART_YAXIS_TEXT_COLOR, _yAxisTextFont: Ed.LINECHART_YAXIS_TEXT_FONT, _yAxisLineColor: Ed.LINECHART_YAXIS_LINE_COLOR, _yAxisLineWidth: Ed.LINECHART_YAXIS_LINE_WIDTH, _xScaleTexts: null, _xScaleTextFont: Ed.LINECHART_XSCALE_TEXT_FONT, _xScaleTextColor: Ed.LINECHART_XSCALE_TEXT_COLOR, _xScaleTextOrientation: Ed.LINECHART_XSCALE_TEXT_ORIENTATION, _xScaleLineColor: Ed.LINECHART_XSCALE_LINE_COLOR, _xScaleLineWidth: Ed.LINECHART_XSCALE_LINE_WIDTH, _valueSpanCount: Ed.LINECHART_VALUESPANCOUNT, _yScaleTextVisible: Ed.LINECHART_YSCALE_TEXT_VISIBLE, _yScaleTextColor: Ed.LINECHART_YSCALE_TEXT_COLOR, _yScaleTextFont: Ed.LINECHART_YSCALE_TEXT_FONT, _yScaleLineColor: Ed.LINECHART_YSCALE_LINE_COLOR, _yScaleLineWidth: Ed.LINECHART_YSCALE_LINE_WIDTH, _yScaleValueGap: Ed.LINECHART_YSCALE_VALUE_GAP, _yScalePixelGap: Ed.LINECHART_YSCALE_PIXEL_GAP, _yScaleMinTextVisible: Ed.LINECHART_YSCALE_MIN_TEXT_VISIBLE, getLineWidth: function(a) { return a.getStyle ? a.getStyle('chart.line.width') : Ib.Styles.getStyle('chart.line.width') }, getMarkerShape: function(a) { return a.getStyle ? a.getStyle('chart.marker.shape') : Ib.Styles.getStyle('chart.marker.shape') }, getMarkerSize: function(a) { return a.getStyle ? a.getStyle('chart.marker.size') : Ib.Styles.getStyle('chart.marker.size') }, _initInfo: function(a, b) { b.markerShape = this.getMarkerShape(a), b.markerSize = this.getMarkerSize(a), b.lineWidth = this.getLineWidth(a), this.isSelected(a) && (b.lineWidth += 2) }, validateModel: function() { this._reset(), this._commonValidateModel() }, getPointIndexAt: function() { var a = this._getPoint.apply(this, arguments), b = this.tryGetDataAt(a); if (!b) return -1; for (var c, d = this._map[b.getId()], e = d.points, f = d.markerSize, g = 0, h = e.size(); h > g; g++) if (c = e.get(g), c && Tb.getDistance(a, c) <= f) return g; return -1 }, drawContent: function(a, b, c, d) { this._toolTipInfos = this.isToolTipEnabled() ? new nd() : null, this._publishedDatas.forEach(function(e) { var f = this._map[e.getId()], g = f.markerSize > 0 ? new nd() : null; a.strokeStyle = f.color, a.lineWidth = f.lineWidth, a.beginPath(); var h = f.proportions, i = null, j = h.size(), k = new nd(); f.points = k; for (var l = 0; j > l; l++) { var m = h.get(l); if (m != null) { var n = { x: b.x + this._columnWidth * (1 + 1.5 * l), y: d - c * m }; k.add(n), i == null ? a.moveTo(n.x, n.y) : a.lineTo(n.x, n.y); var o = f.values.get(l), p = this._getValueTextInfo(e, o); if (p) { var q = this.getTextSize(p.font, p.text); p.x = n.x, p.y = n.y - q.height / 2 + 2 }g && g.add({ point: n, value: o, data: e, index: l }), i = n } else this._interruptable && (i = null, k.add(null)) } if (a.stroke(), g) { var r = f.markerSize / 2; g.forEach(function(b) { a.fillStyle = f.color; var c = b.point.x - r, d = b.point.y - r, e = f.markerSize, g = f.markerSize; Xb.drawVector(a, f.markerShape, null, c, d, e, g), a.fill(), this.addToolTipInfo(c, d, e, g, b.value, b.data, b.index) }, this) } }, this), this.drawValueTexts(a) } }), Ib.charts.BubbleChart = function(a) { Ib.charts.BubbleChart.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.charts.BubbleChart', Ib.charts.ScaleChart, { __accessor: ['xAxisUpperLimit', 'xAxisLowerLimit', 'xScaleLineColor', 'xScaleLineWidth', 'selectShadowColor', 'selectShadowOffset'], _upperLimit: Ed.BUBBLECHART_UPPER_LIMIT, _lowerLimit: Ed.BUBBLECHART_LOWER_LIMIT, _xAxisUpperLimit: Ed.BUBBLECHART_XAXIS_UPPER_LIMIT, _xAxisLowerLimit: Ed.BUBBLECHART_XAXIS_LOWER_LIMIT, _xAxisText: null, _xAxisTextColor: Ed.BUBBLECHART_XAXIS_TEXT_COLOR, _xAxisTextFont: Ed.BUBBLECHART_XAXIS_TEXT_FONT, _xAxisLineColor: Ed.BUBBLECHART_XAXIS_LINE_COLOR, _xAxisLineWidth: Ed.BUBBLECHART_XAXIS_LINE_WIDTH, _yAxisText: null, _yAxisTextColor: Ed.BUBBLECHART_YAXIS_TEXT_COLOR, _yAxisTextFont: Ed.BUBBLECHART_YAXIS_TEXT_FONT, _yAxisLineColor: Ed.BUBBLECHART_YAXIS_LINE_COLOR, _yAxisLineWidth: Ed.BUBBLECHART_YAXIS_LINE_WIDTH, _xScaleTexts: null, _xScaleTextFont: Ed.BUBBLECHART_XSCALE_TEXT_FONT, _xScaleTextColor: Ed.BUBBLECHART_XSCALE_TEXT_COLOR, _xScaleTextOrientation: Ed.BUBBLECHART_XSCALE_TEXT_ORIENTATION, _xScaleLineColor: Ed.BUBBLECHART_XSCALE_LINE_COLOR, _xScaleLineWidth: Ed.BUBBLECHART_XSCALE_LINE_WIDTH, _yScaleTextVisible: Ed.BUBBLECHART_YSCALE_TEXT_VISIBLE, _yScaleTextColor: Ed.BUBBLECHART_YSCALE_TEXT_COLOR, _yScaleTextFont: Ed.BUBBLECHART_YSCALE_TEXT_FONT, _yScaleLineColor: Ed.BUBBLECHART_YSCALE_LINE_COLOR, _yScaleLineWidth: Ed.BUBBLECHART_YSCALE_LINE_WIDTH, _yScaleValueGap: Ed.BUBBLECHART_YSCALE_VALUE_GAP, _yScalePixelGap: Ed.BUBBLECHART_YSCALE_PIXEL_GAP, _yScaleMinTextVisible: Ed.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE, _selectShadowColor: Ed.BUBBLECHART_SELECT_SHADOW_COLOR, _selectShadowOffset: Ed.BUBBLECHART_SELECT_SHADOW_OFFSET, _resetX: function() { this._xMax = 0, this._xMin = 0, this._xAxisUpperLimit != null && (this._xMax = this._xAxisUpperLimit), this._xAxisLowerLimit != null && (this._xMin = this._xAxisLowerLimit) }, getXMin: function() { return this._xMin }, getXMax: function() { return this._xMax }, getXRange: function() { return this._xRange }, getShape: function(a) { return a.getStyle ? a.getStyle('chart.bubble.shape') : Ib.Styles.getStyle('chart.bubble.shape') }, getSize: function(a, b) { return b }, getNames: function(a) { return a.getStyle ? a.getStyle('chart.names') : Ib.Styles.getStyle('chart.names') }, getXAxisValues: function(a) { return a.getStyle ? a.getStyle('chart.xaxis.values') : Ib.Styles.getStyle('chart.xaxis.values') }, getYAxisValues: function(a) { return a.getStyle ? a.getStyle('chart.yaxis.values') : Ib.Styles.getStyle('chart.yaxis.values') }, _initXRange: function() { this._xAxisLowerLimit == null && (this._xMin >= this._xMax && (this._xMin = this._xMax - 0.1 * Math.abs(this._xMax)), this._xMin = this._xMin - 0.1 * (this._xMax - this._xMin)), this._xRange = this._xMax - this._xMin }, _initXYValuesProportion: function() { this._publishedDatas.forEach(function(a) { var b = this._map[a.getId()]; b.xAxisValues.forEach(function(a) { b.xAxisProportions.add(a == null ? null : this._xRange == 0 ? 0 : a / this._xRange) }, this), b.yAxisValues.forEach(function(a) { b.yAxisProportions.add(a == null ? null : this._range == 0 ? 0 : a / this._range) }, this) }, this) }, validateModel: function() { this._reset(), this._resetX(), this._columnCount = this._xScaleTexts == null ? 0 : this._xScaleTexts.size(), this._publishedDatas.forEach(function(a) { var b = new nd(this.getYAxisValues(a)), c = new nd(this.getXAxisValues(a)), d = new nd(this.getValues(a)); d.size() > this._columnCount && (this._columnCount = d.size()); var e = { data: a, values: d, yAxisValues: b, xAxisValues: c, yAxisProportions: new nd(), xAxisProportions: new nd(), color: this.getUniqueColor(this.getColor(a), a), anchorShape: this.getShape(a) }; this._map[a.getId()] = e, (this._upperLimit == null || this._lowerLimit == null) && b.forEach(function(a) { a != null && (this._upperLimit == null && a > this._max && (this._max = a), this._lowerLimit == null && a < this._min && (this._min = a)) }, this), (this._upperLimit == null || this._lowerLimit == null) && c.forEach(function(a) { a != null && (this._xAxisUpperLimit == null && a > this._xMax && (this._xMax = a), this._xAxisLowerLimit == null && a < this._xMin && (this._xMin = a)) }, this) }, this), this._initRange(), this._initXRange(), this._initXYValuesProportion() }, drawContent: function(a, b, c, d) { this._toolTipInfos = this.isToolTipEnabled() ? new nd() : null, this._publishedDatas.forEach(function(e) { var f = this._map[e.getId()], g = f.yAxisProportions, h = f.xAxisProportions, i = f.values, j = f.yAxisProportions.size(), k = this._selectShadowOffset; this.isSelected(e) && k > 0 ? (a.shadowOffsetX = k, a.shadowOffsetY = k, a.shadowBlur = 2 * k, a.shadowColor = this._selectShadowColor) : (a.shadowOffsetX = 0, a.shadowOffsetY = 0, a.shadowBlur = 0, a.shadowColor = f.color), a.fillStyle = f.color; for (var l = 0; j > l; l++) { var m = g.get(l), n = h.get(l); if (m != null) { var o = { x: b.x + b.width * n, y: d - c * m }, p = i.get(l), q = this.getSize(e, p), k = q / 2, r = o.x - k, s = o.y - k, t = q, u = q; Xb.drawVector(a, f.anchorShape, null, r, s, t, u), a.fill(), this.addToolTipInfo(r, s, t, u, p, e, l); var v = this._getValueTextInfo(e, p); if (v) { var q = this.getTextSize(v.font, v.text); v.x = o.x, v.y = o.y } } } }, this), this.drawValueTexts(a) } }), Ib.charts.DialChart = function(a) { Ib.charts.DialChart.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.charts.DialChart', Ib.charts.ChartBase, { __accessor: ['upperLimit', 'lowerLimit', 'startAngle', 'endAngle', 'innerRadius', 'colorRangeFillColor', 'outlineWidth', 'outlineColor', 'majorScaleCount', 'majorScaleLineWidth', 'majorScaleLineLength', 'majorScaleLineColor', 'minorScaleCount', 'minorScaleLineWidth', 'minorScaleLineLength', 'minorScaleLineColor', 'scaleTextVisible', 'scaleUpperLimitTextVisible', 'scaleLowerLimitTextVisible', 'scaleTextFont', 'scaleTextColor', 'pivotRadius', 'pivotFillColor', 'pivotOutlineWidth', 'pivotOutlineColor', 'pivotGradient', 'pivotGradientColor', 'valuePosition', 'colorRangeList', 'innerDarkerRadius', 'outerBrighterRadius', 'selectShadowColor', 'selectShadowOffset'], __bool: ['scaleInside', 'pivotFill'], _upperLimit: Ed.DIALCHART_UPPER_LIMIT, _lowerLimit: Ed.DIALCHART_LOWER_LIMIT, _startAngle: Ed.DIALCHART_START_ANGLE, _endAngle: Ed.DIALCHART_END_ANGLE, _innerRadius: Ed.DIALCHART_INNER_RADIUS, _colorRangeFillColor: Ed.DIALCHART_COLOR_RANGE_FILL_COLOR, _outlineWidth: Ed.DIALCHART_OUTLINE_WIDTH, _outlineColor: Ed.DIALCHART_OUTLINE_COLOR, _scaleInside: Ed.DIALCHART_SCALE_INSIDE, _majorScaleCount: Ed.DIALCHART_MAJOR_SCALE_COUNT, _majorScaleLineWidth: Ed.DIALCHART_MAJOR_SCALE_LINE_WIDTH, _majorScaleLineLength: Ed.DIALCHART_MAJOR_SCALE_LINE_LENGTH, _majorScaleLineColor: Ed.DIALCHART_MAJOR_SCALE_LINE_COLOR, _minorScaleCount: Ed.DIALCHART_MINOR_SCALE_COUNT, _minorScaleLineWidth: Ed.DIALCHART_MINOR_SCALE_LINE_WIDTH, _minorScaleLineLength: Ed.DIALCHART_MINOR_SCALE_LINE_LENGTH, _minorScaleLineColor: Ed.DIALCHART_MINOR_SCALE_LINE_COLOR, _scaleTextVisible: Ed.DIALCHART_SCALE_TEXT_VISIBLE, _scaleUpperLimitTextVisible: Ed.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE, _scaleLowerLimitTextVisible: Ed.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE, _scaleTextFont: Ed.DIALCHART_SCALE_TEXT_FONT, _scaleTextColor: Ed.DIALCHART_SCALE_TEXT_COLOR, _pivotRadius: Ed.DIALCHART_PIVOT_RADIUS, _pivotFill: Ed.DIALCHART_PIVOT_FILL, _pivotFillColor: Ed.DIALCHART_PIVOT_FILL_COLOR, _pivotOutlineWidth: Ed.DIALCHART_PIVOT_OUTLINE_WIDTH, _pivotOutlineColor: Ed.DIALCHART_PIVOT_OUTLINE_COLOR, _pivotGradient: Ed.DIALCHART_PIVOT_GRADIENT, _pivotGradientColor: Ed.DIALCHART_PIVOT_GRADIENT_COLOR, _valuePosition: Ed.DIALCHART_VALUE_POSITION, _innerDarkerRadius: Ed.DIALCHART_INNER_DARKER_RADIUS, _outerBrighterRadius: Ed.DIALCHART_OUTER_BRIGHTER_RADIUS, _selectShadowColor: Ed.DIALCHART_SELECT_SHADOW_COLOR, _selectShadowOffset: Ed.DIALCHART_SELECT_SHADOW_OFFSET, formatScaleText: function(a) { return a.toFixed(2) }, validateModel: function() { this._map = {}, this._valueRange = this._upperLimit - this._lowerLimit; var a = this._startAngle; a != 0 && (a = (a % 360 + 360) % 360, a == 0 && (a = 360)), this._positiveStartAngle = a; var b = this._endAngle; b != 0 && (b = (b % 360 + 360) % 360, b == 0 && (b = 360)), this._positiveEndAngle = b, this._whole = Math.abs(a - b) == 360, this._startAngleByRadian = a * Math.PI / 180, this._endAngleByRadian = b * Math.PI / 180, this._clockwise = this._startAngleByRadian > this._endAngleByRadian, this._angleRange = Math.abs(this._startAngleByRadian - this._endAngleByRadian), this._publishedDatas.forEach(function(a) { var b = this.getValue(a); this._map[a.getId()] = { data: a, value: b, color: this.getUniqueColor(this.getColor(a), a), angle: this._startAngleByRadian + (this._clockwise ? -1 : 1) * b / this._valueRange * this._angleRange } }, this) }, validateDisplay: function(a, b, c) { var d = { x: this._xGap, y: this._yGap, width: b - 2 * this._xGap, height: c - 2 * this._yGap }; if (this.drawBackground(a, d), this._startAngleByRadian != this._endAngleByRadian) { var e, f, g = this._lowerLimit, h = this._majorScaleCount > 1 ? this._valueRange / (this._majorScaleCount - 1) : 0, i = 0, j = 0, k = null, l = null; if (this._scaleTextVisible) for (k = new nd(), e = 0; e < this._majorScaleCount; e++)e == 0 && !this._scaleLowerLimitTextVisible || e == this._majorScaleCount - 1 && !this._scaleUpperLimitTextVisible ? (f = null, k.add({ text: '', size: { width: 0, height: 0 }})) : (l = this.formatScaleText(g), f = this.getTextSize(this._scaleTextFont, l), k.add({ text: l, size: f })), this._scaleInside || f == null || (f.width > i && (i = f.width), f.height > j && (j = f.height)), g += h; if (this._angleRange <= Math.PI && (i = Math.max(i, this._pivotRadius), j = Math.max(j, this._pivotRadius)), Tb.grow(d, -i, -j), this._calcluateCenterAndRadius(d), a.lineWidth = 0, this._colorRangeList == null || this._colorRangeList.size() == 0) this._drawArcGroup(a, this._startAngleByRadian, this._endAngleByRadian, this.getUniqueColor(this._colorRangeFillColor)), this._drawArcOutLine(a, this._startAngleByRadian, this._endAngleByRadian, !0, !0); else { var m = this._angleRange / this._colorRangeList.size(), n = this._startAngleByRadian; for (e = 0; e < this._colorRangeList.size(); e++) { var o = this.getUniqueColor(this._colorRangeList.get(e)), p = n + (this._clockwise ? -1 : 1) * m; this._drawArcGroup(a, n, p, o), this._drawArcOutLine(a, n, n + (this._clockwise ? -1 : 1) * m, e == 0, e == this._colorRangeList.size() - 1), n += (this._clockwise ? -1 : 1) * m } } var q, r, s, t, u, v, w, x, y = this._startAngleByRadian, z = this._majorScaleCount > 1 ? this._angleRange / (this._majorScaleCount - 1) : 0; for (v = this._scaleInside ? this._innerRadiusByPixel : this._outerRadius, w = v + this._majorScaleLineLength * (this._scaleInside ? 1 : -1), x = v + this._minorScaleLineLength * (this._scaleInside ? 1 : -1), e = 0; e < this._majorScaleCount; e++) { if (r = this._center.x + Math.cos(y) * v, s = this._center.y + Math.sin(-y) * v, t = this._center.x + Math.cos(y) * w, u = this._center.y + Math.sin(-y) * w, a.lineWidth = this._majorScaleLineWidth, a.strokeStyle = this.getUniqueColor(this._majorScaleLineColor), a.beginPath(), a.moveTo(r, s), a.lineTo(t, u), a.closePath(), a.stroke(), this._scaleTextVisible) if (e == 0 && !this._scaleLowerLimitTextVisible || e == this._majorScaleCount - 1 && !this._scaleUpperLimitTextVisible);else { var A = k.get(e); if (A) { var B = this.getScaleTextPosition(y / Math.PI * 180, r, s, A.size.width, A.size.height); A.x = B.x, A.y = B.y } } if (this._whole || !this._whole && e < this._majorScaleCount - 1) { var C = y, D = this._minorScaleCount > 0 ? z / (this._minorScaleCount + 1) : 0; for (q = 0; q < this._minorScaleCount; q++)C += (this._clockwise ? -1 : 1) * D, r = this._center.x + Math.cos(C) * v, s = this._center.y + Math.sin(-C) * v, t = this._center.x + Math.cos(C) * x, u = this._center.y + Math.sin(-C) * x, a.lineWidth = this._minorScaleLineWidth, a.strokeStyle = this.getUniqueColor(this._minorScaleLineColor), a.beginPath(), a.moveTo(r, s), a.lineTo(t, u), a.closePath(), a.stroke() }y += (this._clockwise ? -1 : 1) * z } this._pivotFill && Xb.fill(a, this.getUniqueColor(this._pivotFillColor), this._pivotGradient, this._pivotGradientColor, this._center.x - this._pivotRadius, this._center.y - this._pivotRadius, 2 * this._pivotRadius, 2 * this._pivotRadius), a.lineWidth = this._pivotOutlineWidth, a.strokeStyle = this.getUniqueColor(this._pivotOutlineColor), a.beginPath(), a.arc(this._center.x, this._center.y, this._pivotRadius, 0, 2 * Math.PI, !0), a.closePath(), this._pivotFill && a.fill(), k && k.forEach(function(b) { b && Xb.drawText(a, b.text, b, this._scaleTextFont, this._scaleTextColor) }, this), this._publishedDatas.forEach(function(b) { var c = this._map[b.getId()], d = this._getDataStyle('dialchart.rear.extension', b), e = this._getDataStyle('dialchart.base.width', b), f = this._getDataStyle('dialchart.top.width', b), g = this._getDataStyle('dialchart.radius', b); g >= -1 && g <= 1 && (g *= this._innerRadiusByPixel), a.fillStyle = c.color, a.lineWidth = 0; var h = Tb.createMatrix(-c.angle, this._center.x, this._center.y), i = h.transform(this._center.x + g, this._center.y + f / 2), j = h.transform(this._center.x + g, this._center.y - f / 2), k = h.transform(this._center.x - d, this._center.y - e / 2), l = h.transform(this._center.x - d, this._center.y + e / 2), m = this._selectShadowOffset; this.isSelected(b) && m > 0 ? (a.shadowOffsetX = m, a.shadowOffsetY = m, a.shadowBlur = 2 * m, a.shadowColor = this._selectShadowColor) : (a.shadowOffsetX = 0, a.shadowOffsetY = 0, a.shadowBlur = 0, a.shadowColor = c.color), a.beginPath(), a.moveTo(i.x, i.y), a.lineTo(j.x, j.y), a.lineTo(k.x, k.y), a.lineTo(l.x, l.y), a.lineTo(i.x, i.y), a.closePath(), a.fill(); var n = this._getValueTextInfo(b, c.value); if (n) { var o = h.transform(this._center.x + g * this._valuePosition, this._center.y); n.x = o.x, n.y = o.y } }, this), this.drawValueTexts(a) } }, _getDataStyle: function(a, b) { return b.getStyle ? b.getStyle(a) : b.getClient(a) }, _calcluateCenterAndRadius: function(a) { { var b = this._clockwise ? this._positiveEndAngle : this._positiveStartAngle, c = this._clockwise ? this._positiveStartAngle : this._positiveEndAngle; Math.abs(this._positiveEndAngle - this._positiveStartAngle) }b >= 0 && b < 90 ? c >= 0 && c <= 90 ? (this._outerRadius = Math.min(a.width, a.height), this._center = { x: a.x + (a.width - this._outerRadius) / 2, y: a.y + (a.height + this._outerRadius) / 2 }) : c > 90 && c <= 180 ? (this._outerRadius = Math.min(a.width / 2, a.height), this._center = { x: a.x + a.width / 2, y: a.y + (a.height + this._outerRadius) / 2 }) : (this._center = { x: a.x + a.width / 2, y: a.y + a.height / 2 }, this._outerRadius = Math.min(a.width, a.height) / 2) : b >= 90 && b < 180 ? c >= 90 && c <= 180 ? (this._outerRadius = Math.min(a.width, a.height), this._center = { x: a.x + (a.width + this._outerRadius) / 2, y: a.y + (a.height + this._outerRadius) / 2 }) : c > 180 && c <= 270 ? (this._outerRadius = Math.min(a.width, a.height / 2), this._center = { x: a.x + (a.width + this._outerRadius) / 2, y: a.y + a.height / 2 }) : (this._center = { x: a.x + a.width / 2, y: a.y + a.height / 2 }, this._outerRadius = Math.min(a.width, a.height) / 2) : b >= 180 && b < 270 ? c >= 180 && c <= 270 ? (this._outerRadius = Math.min(a.width, a.height), this._center = { x: a.x + (a.width + this._outerRadius) / 2, y: a.y + (a.height - this._outerRadius) / 2 }) : (this._outerRadius = Math.min(a.width / 2, a.height), this._center = { x: a.x + a.width / 2, y: a.y + (a.height - this._outerRadius) / 2 }) : (this._outerRadius = Math.min(a.width, a.height), this._center = { x: a.x + (a.width - this._outerRadius) / 2, y: a.y + (a.height - this._outerRadius) / 2 }), this._innerRadiusByPixel = this._innerRadius > 1 ? this._innerRadius : this._outerRadius * this._innerRadius, this._innerDarkerRadiusByPixel = this._innerDarkerRadius > 1 ? this._innerDarkerRadius : this._outerRadius * this._innerDarkerRadius, this._outerBrighterRadiusByPixel = this._outerBrighterRadius > 1 ? this._outerBrighterRadius : this._outerRadius * this._outerBrighterRadius }, _drawArcOutLine: function(a, b, c, d, e) { if (!(this._outlineWidth <= 0)) { var f = Math.abs(b - c), g = this._center.x + Math.cos(b) * this._innerRadiusByPixel, h = this._center.y + Math.sin(-b) * this._innerRadiusByPixel, i = this._center.x + Math.cos(b) * this._outerRadius, j = this._center.y + Math.sin(-b) * this._outerRadius, k = this._center.x + Math.cos(c) * this._innerRadiusByPixel, l = this._center.y + Math.sin(-c) * this._innerRadiusByPixel, m = this._center.x + Math.cos(c) * this._outerRadius, n = this._center.y + Math.sin(-c) * this._outerRadius; this._clockwise ? (a.lineWidth = this._outlineWidth, a.strokeStyle = this.getUniqueColor(this._outlineColor), a.beginPath(), a.moveTo(this._center.x, this._center.y), Xb.drawArc(a, this._center.x, this._center.y, c, f, this._outerRadius, this._outerRadius, !1), a.stroke(), !this._whole && d ? (a.lineWidth = this._outlineWidth, a.strokeStyle = this.getUniqueColor(this._outlineColor)) : a.lineWidth = 0, a.lineTo(g, h), a.stroke(), a.beginPath(), a.lineWidth = this._outlineWidth, a.strokeStyle = this.getUniqueColor(this._outlineColor), a.moveTo(this._center.x, this._center.y), Xb.drawArc(a, this._center.x, this._center.y, b, -f, this._innerRadiusByPixel, this._innerRadiusByPixel, !1), a.stroke(), !this._whole && e ? (a.lineWidth = this._outlineWidth, a.strokeStyle = this.getUniqueColor(this._outlineColor)) : a.lineWidth = 0, a.lineTo(m, n), a.stroke()) : (a.lineWidth = this._outlineWidth, a.strokeStyle = this.getUniqueColor(this._outlineColor), a.beginPath(), a.moveTo(this._center.x, this._center.y), Xb.drawArc(a, this._center.x, this._center.y, b, f, this._outerRadius, this._outerRadius, !1), a.stroke(), !this._whole && e ? (a.lineWidth = this._outlineWidth, a.strokeStyle = this.getUniqueColor(this._outlineColor)) : a.lineWidth = 0, a.lineTo(k, l), a.stroke(), a.lineWidth = this._outlineWidth, a.strokeStyle = this.getUniqueColor(this._outlineColor), a.beginPath(), a.moveTo(this._center.x, this._center.y), Xb.drawArc(a, this._center.x, this._center.y, c, -f, this._innerRadiusByPixel, this._innerRadiusByPixel, !1), a.stroke(), !this._whole && d ? (a.lineWidth = this._outlineWidth, a.strokeStyle = this.getUniqueColor(this._outlineColor)) : a.lineWidth = 0, a.lineTo(i, j), a.stroke()) } }, _drawArcGroup: function(a, b, c, d) { this._outerBrighterRadiusByPixel != 0 && this._drawArc(a, b, c, this._outerRadius - this._outerBrighterRadiusByPixel, this._outerRadius, Xb.brighter(d)), this._drawArc(a, b, c, this._innerRadiusByPixel + this._innerDarkerRadiusByPixel, this._outerRadius - this._outerBrighterRadiusByPixel, d), this._innerDarkerRadiusByPixel != 0 && this._drawArc(a, b, c, this._innerRadiusByPixel, this._innerRadiusByPixel + this._innerDarkerRadiusByPixel, Xb.darker(d, 20)) }, _drawArc: function(a, b, c, d, e, f) { var g = Math.abs(b - c); a.lineWidth = 0, a.fillStyle = f; { var h = this._center.x + Math.cos(b) * d, i = this._center.y + Math.sin(-b) * d, j = (this._center.x + Math.cos(b) * e, this._center.y + Math.sin(-b) * e, this._center.x + Math.cos(c) * d), k = this._center.y + Math.sin(-c) * d; this._center.x + Math.cos(c) * e, this._center.y + Math.sin(-c) * e }a.beginPath(), this._clockwise ? (a.moveTo(j, k), Xb.drawArc(a, this._center.x, this._center.y, c, g, e, e, !0), a.lineTo(h, i), Xb.drawArc(a, this._center.x, this._center.y, b, -g, d, d, !0), a.closePath()) : (a.moveTo(h, i), Xb.drawArc(a, this._center.x, this._center.y, b, g, e, e, !0), a.lineTo(j, k), Xb.drawArc(a, this._center.x, this._center.y, c, -g, d, d, !0), a.closePath()), a.fill() }, getScaleTextPosition: function(a, b, c, d, e) { a = (a % 360 + 360) % 360; var f = { x: b, y: c }; return a == 0 && (f = this._scaleInside ? { x: b - d / 2, y: c } : { x: b + d / 2, y: c }), a == 180 && (f = this._scaleInside ? { x: b + d / 2, y: c } : { x: b - d / 2, y: c }), a == 90 && (f = this._scaleInside ? { x: b, y: c + e / 2 } : { x: b, y: c - e / 2 }), a == 270 && (f = this._scaleInside ? { x: b, y: c - e / 2 } : { x: b, y: c + e / 2 }), a > 270 && a < 360 && (f = this._scaleInside ? { x: b - d / 2, y: c - e / 2 } : { x: b + d / 2, y: c + e / 2 }), a > 180 && a < 270 && (f = this._scaleInside ? { x: b + d / 2, y: c - e / 2 } : { x: b - d / 2, y: c + e / 2 }), a > 90 && a < 180 && (f = this._scaleInside ? { x: b + d / 2, y: c + e / 2 } : { x: b - d / 2, y: c - e / 2 }), a > 0 && a < 90 && (f = this._scaleInside ? { x: b - d / 2, y: c + e / 2 } : { x: b + d / 2, y: c - e / 2 }), f } }), Ib.charts.RadarChart = function(a) { Ib.charts.RadarChart.superClass.constructor.apply(this, arguments), this._selectTolerance = 2 }, Jb.ext('twaver.charts.RadarChart', Ib.charts.ChartBase, { __accessor: ['axisTextVisible', 'axisTextFont', 'axisTextColor', 'scaleTextVisible', 'scaleTextFont', 'scaleTextColor', 'axisVisible', 'axisLineColor', 'axisLineWidth', 'axisStartAngle', 'ringVisible', 'ringType', 'ringLineColor', 'ringLineWidth', 'scaleCount', 'scaleMaxValue', 'scaleMinValue', 'anchorVisible', 'areaFillAlpha', 'areaSelectFillAlpha', 'axisList'], __bool: ['areaFill'], _axisTextVisible: Ed.RADARCHART_AXIS_TEXT_VISIBLE, _axisTextFont: Ed.RADARCHART_AXIS_TEXT_FONT, _axisTextColor: Ed.RADARCHART_AXIS_TEXT_COLOR, _scaleTextVisible: Ed.RADARCHART_SCALE_TEXT_VISIBLE, _scaleTextFont: Ed.RADARCHART_SCALE_TEXT_FONT, _scaleTextColor: Ed.RADARCHART_SCALE_TEXT_COLOR, _axisVisible: Ed.RADARCHART_AXIS_VISIBLE, _axisLineColor: Ed.RADARCHART_AXIS_LINE_COLOR, _axisLineWidth: Ed.RADARCHART_AXIS_LINE_WIDTH, _axisStartAngle: Ed.RADARCHART_AXIS_START_ANGLE, _ringVisible: Ed.RADARCHART_RING_VISIBLE, _ringType: Ed.RADARCHART_RING_TYPE, _ringLineColor: Ed.RADARCHART_RING_LINE_COLOR, _ringLineWidth: Ed.RADARCHART_RING_LINE_WIDTH, _scaleCount: Ed.RADARCHART_SCALE_COUNT, _scaleMaxValue: Ed.RADARCHART_SCALE_MAXVALUE, _scaleMinValue: Ed.RADARCHART_SCALE_MINVALUE, _anchorVisible: Ed.RADARCHART_ANCHOR_VISIBLE, _areaFill: Ed.RADARCHART_AREA_FILL, _areaFillAlpha: Ed.RADARCHART_AREA_FILL_ALPHA, _areaSelectFillAlpha: Ed.RADARCHART_AREA_SELECT_FILL_ALPHA, getAxisCount: function() { return this._axisCount }, formatScaleText: function(a, b) { return a.toFixed(2) }, getAnchorSize: function(a) { return a.getStyle ? a.getStyle('chart.marker.size') : Ib.Styles.getStyle('chart.marker.size') }, getAnchorShape: function(a) { return a.getStyle ? a.getStyle('chart.marker.shape') : Ib.Styles.getStyle('chart.marker.shape') }, getLineWidth: function(a) { return a.getStyle ? a.getStyle('chart.line.width') : Ib.Styles.getStyle('chart.line.width') }, getValues: function(a) { return a.getStyle ? a.getStyle('chart.values') : null }, tryGetDataAt: function(a, b) { if ((b == null || b < 0) && (b = this._selectTolerance), a.target && (a = Wb.getLogicalPoint(this._canvas, arguments[0], 1)), !a) return null; if (!this._areaFill) { var c = a.x - b, d = a.y - b, e = 2 * b + 1, f = 2 * b + 1; try { for (var g = this._canvas.getContext('2d').getImageData(c, d, e, f).data, h = 0, i = g.length; i > h; h += 4) if (g[h + 3] === 255) { var j = 'rgb(' + g[h] + ',' + g[h + 1] + ',' + g[h + 2] + ')', k = this._uniqueColors[j]; if (k) return k } } catch (l) {} return null } if (!this._center) return null; a = { x: a.x - this._xTranslate, y: a.y - this._yTranslate }; for (var h = this._publishedDatas.size() - 1; h >= 0; h--) { var k = this._publishedDatas.get(h), m = this._map[k.getId()], n = Tb.isPointInPolygon(m.points, a); if (n) return k } return null }, getDataAt: function() { var a, b; if (arguments.length === 2)a = arguments[0], b = arguments[1]; else if (arguments[0].target) { var c = Wb.getLogicalPoint(this._canvas, arguments[0], 1); if (!c) return; a = c.x, b = c.y } else a = arguments[0].x, b = arguments[0].y; if (a < 0 || b < 0 || a > this._canvasWidth || b > this._canvasHeight) return null; if (!this._areaFill) { try { var d = this._canvas.getContext('2d').getImageData(a, b, 1, 1).data; if (d[3] === 255) { var e = 'rgb(' + d[0] + ',' + d[1] + ',' + d[2] + ')', f = this._uniqueColors[e]; if (f) return f } } catch (g) {} return null } for (var h = this._publishedDatas.size() - 1; h >= 0; h--) { var f = this._publishedDatas.get(h), i = this._map[f.getId()], j = Tb.isPointInPolygon(i.points, { x: a - this._xTranslate, y: b - this._yTranslate }); if (j) return f } return null }, validateModel: function() { if (this._map = {}, this._axisTexts = new nd(), this._axisMaxValues = new nd(), this._axisMinValues = new nd(), this._axisRangeValues = new nd(), this._axisCount = this._axisList == null ? 0 : this._axisList.size(), this._axisCount != 0) { this._averageAngleByRadian = 2 * Math.PI / this._axisCount, this._averageAngle = 360 / this._axisCount, this._axisList.forEach(function(a) { if (typeof a === 'string') this._axisTexts.add(a), this._axisMaxValues.add(this._scaleMaxValue), this._axisMinValues.add(this._scaleMinValue), this._axisRangeValues.add(this._scaleMaxValue - this._scaleMinValue); else { this._axisTexts.add(a.text); var b = isNaN(a.max) ? this._scaleMaxValue : a.max, c = isNaN(a.min) ? this._scaleMinValue : a.min; this._axisMaxValues.add(b), this._axisMinValues.add(c), this._axisRangeValues.add(b - c) } }, this), this._publishedDatas.forEach(function(a) { var b = new nd(this.getValues(a)), c = { data: a, values: b, proportions: new nd(), color: this.getUniqueColor(this.getColor(a), a), anchorShape: this.getAnchorShape(a), anchorSize: this.getAnchorSize(a), lineWidth: this.getLineWidth(a), points: new nd() }; this.isSelected(a) && (c.lineWidth += 2), this._map[a.getId()] = c }, this); for (var a = 0; a < this._axisCount; a++) this._publishedDatas.forEach(function(b) { var c = this._map[b.getId()], d = 0; if (c.values.size() > a) { var e = c.values.get(a), f = this._axisMinValues.get(a), g = this._axisRangeValues.get(a); g > 0 && (d = (e - f) / g) }c.proportions.add(d) }, this) } }, validateDisplay: function(a, b, c) {
    var d = { x: this._xGap, y: this._yGap, width: b - 2 * this._xGap, height: c - 2 * this._yGap }; if (this.drawBackground(a, d), !(d.width <= 0 || d.height <= 0 || this._axisCount < 3)) {
      var e = 0, f = 0, g = 0, h = null, i = null, j = null, k = null; if (this._axisTextVisible) for (k = new nd(), g = 0; g < this._axisCount; g++)j = this._axisTexts.get(g), h = this.getTextSize(this._axisTextFont, j), k.add({ text: j, size: h }), h.width > e && (e = h.width), h.height > f && (f = h.height); var l = d.width / 2 - e > d.height / 2 - f ? d.height / 2 - 2 * f : d.width / 2 - e, m = { x: d.x + d.width / 2, y: d.y + d.height / 2 }; this._center = { x: m.x + this._xTranslate, y: m.y + this._yTranslate }; var n = null; this._scaleTextVisible && (n = new nd()); var o = this._axisStartAngle / 180 * Math.PI; for (g = 0; g < this._axisCount; g++) { var p = 180 * o / Math.PI, q = m.x + Math.cos(o) * l, r = m.y + Math.sin(-o) * l, s = null; n && (s = new nd(), n.add(s)), this._ringVisible && this._ringLineWidth > 0 && (a.lineWidth = this._ringLineWidth, a.strokeStyle = this._ringLineColor); for (var t = 1; t <= this._scaleCount; t++) { var u = t / this._scaleCount, v = l * u, w = m.x + Math.cos(o) * v, x = m.y + Math.sin(-o) * v; if (this._ringVisible && this._ringLineWidth > 0) { var y = m.x + Math.cos(o + this._averageAngleByRadian) * v, z = m.y + Math.sin(-o - this._averageAngleByRadian) * v; this._ringType == 'line' ? this.drawLine(a, this._ringLineColor, this._ringLineWidth, w, x, y, z) : this._ringType == 'arc' && (a.beginPath(), a.moveTo(m.x, m.y), Xb.drawArc(a, m.x, m.y, o, this._averageAngleByRadian, v, v, !0), a.closePath(), a.stroke()) }s && (j = this.formatScaleText(this._axisMinValues.get(g) + this._axisRangeValues.get(g) * u, g), h = this.getTextSize(this._scaleTextFont, j), i = this.getScaleTextPosition(p, w, x, h.width, h.height), s.add({ text: j, x: i.x, y: i.y })) } if (this._axisVisible && this.drawLine(a, this._axisLineColor, this._axisLineWidth, m.x, m.y, q, r), k) { var A = k.get(g); i = this.getAxisTextPosition(p, q, r, A.size.width, A.size.height), A.x = i.x, A.y = i.y }o += this._averageAngleByRadian } this._publishedDatas.forEach(function(b) {
        var c = this._map[b.getId()]; c.points.clear(); var d = c.anchorSize > 0 ? new nd() : null, e = c.proportions; if (a.lineWidth = 0, a.globalAlpha = this.isSelected(b) ? this._areaSelectFillAlpha : this._areaFillAlpha, this._areaFill && (a.fillStyle = c.color), this._drawItem(a, e, m, l, d, c), this._areaFill && a.fill(), a.lineWidth = c.lineWidth, a.strokeStyle = c.color,
          a.globalAlpha = 1, this._drawItem(a, e, m, l), a.lineWidth = 0, d != null && d.size() > 0) { var f = c.anchorSize / 2; d.forEach(function(b) { a.fillStyle = c.color, Xb.drawVector(a, c.anchorShape, null, b.x - f, b.y - f, c.anchorSize, c.anchorSize), a.fill() }) }
      }, this), n && n.forEach(function(b) { b.forEach(function(b) { Xb.drawText(a, b.text, b, this._scaleTextFont, this._scaleTextColor) }, this) }, this), k && k.forEach(function(b) { Xb.drawText(a, b.text, b, this._axisTextFont, this._axisTextColor) }, this)
    }
  }, _drawItem: function(a, b, c, d, e, f) { var g = this._axisStartAngle / 180 * Math.PI, h = null; a.beginPath(); for (var i = 0; i < this._axisCount; i++) { var j = b.get(i), k = { x: c.x + Math.cos(g) * d * j, y: c.y + Math.sin(-g) * d * j }; h == null ? a.moveTo(k.x, k.y) : a.lineTo(k.x, k.y), e != null && this._anchorVisible && e.add(k), f && f.points.add(k), i == 0 && (h = k), g += this._averageAngleByRadian }h != null && a.lineTo(h.x, h.y), a.closePath(), a.stroke() }, getAxisTextPosition: function(a, b, c, d, e) { a = (a % 360 + 360) % 360; var f = { x: b, y: c }; return a == 0 && (f = { x: b + d / 2, y: c }), a == 180 && (f = { x: b - d / 2, y: c }), a == 90 && (f = { x: b, y: c - e / 2 }), a == 270 && (f = { x: b, y: c + e / 2 }), a > 270 && a < 360 && (f = { x: b + d / 2, y: c + e / 2 }), a > 180 && a < 270 && (f = { x: b - d / 2, y: c + e / 2 }), a > 90 && a < 180 && (f = { x: b - d / 2, y: c - e / 2 }), a > 0 && a < 90 && (f = { x: b + d / 2, y: c - e / 2 }), f }, getScaleTextPosition: function(a, b, c, d, e) { a = (a % 360 + 360) % 360; var f = { x: b, y: c }; return a == 0 && (f = { x: b, y: c + e / 2 }), a == 180 && (f = { x: b - d / 2, y: c + e / 2 }), a == 90 && (f = { x: b + d / 2, y: c }), a == 270 && (f = { x: b + d / 2, y: c }), a > 270 && a < 360 && (f = { x: b + d / 2, y: c - e / 2 }), a > 180 && a < 270 && (f = { x: b - d / 2, y: c - e / 2 }), a > 90 && a < 180 && (f = { x: b - d / 2, y: c + e / 2 }), a > 0 && a < 90 && (f = { x: b + d / 2, y: c + e / 2 }), f } }), Ib.charts.LegendPane = function(a) { Ib.charts.LegendPane.superClass.constructor.apply(this, arguments), this._divPool = new Ib.Pool('div'), this._iconPool = new Ib.Pool('div'), this._textPool = new Ib.Pool('span'), this._pools.add(this._divPool), this._pools.add(this._iconPool), this._pools.add(this._textPool), this._chart = a, this._chart.addViewListener(this.handleViewChange, this), this._view = Wb.createView('hidden'), this._view.style.verticalAlign = 'middle', this._legendDiv = Wb.createDiv(), this._legendDiv.style.whiteSpace = 'nowrap', this._legendDiv.style.verticalAlign = 'middle', this._legendDiv.style.position = '', this._view.appendChild(this._legendDiv), this._hiddenMap = {}; var b = this; this._chart._internalVisibleFunction = function(a) { return !b.isHidden(a) }, Qb.isTouchable && new Ib.charts.LegendPaneTouchInteraction(this), new Ib.charts.LegendPaneInteraction(this) }, Jb.ext('twaver.charts.LegendPane', Ib.controls.ControlBase, { __accessor: ['iconWidth', 'iconHeight', 'iconRadius', 'rowHeight', 'orientation', 'hiddenColor', 'selectBackgroundColor', 'selectForegroundColor'], _iconWidth: Ed.LEGENDPANE_ICON_WIDTH, _iconHeight: Ed.LEGENDPANE_ICON_HEIGHT, _iconRadius: Ed.LEGENDPANE_ICON_RADIUS, _rowHeight: Ed.LEGENDPANE_ROW_HEIGHT, _orientation: Ed.LEGENDPANE_ORIENTATION, _hiddenColor: Ed.LEGENDPANE_HIDDEN_COLOR, _selectBackgroundColor: Ed.LEGENDPANE_SELECT_BACKGROUND_COLOR, _selectForegroundColor: Ed.LEGENDPANE_SELECT_FOREGROUND_COLOR, onPropertyChanged: function(a) { this.invalidate() }, getChart: function() { return this._chart }, isHidden: function(a) { return this._hiddenMap[a.getId()] != null }, handleViewChange: function(a) { a.kind === 'validateEnd' && (this._invalidate = !0, this.validate()) }, validate: function() { if (this._invalidate) { this._invalidate = !1, Wb.release(this._legendDiv), Jb.keys(this._hiddenMap).forEach(function(a) { this._chart.getDataBox().containsById(a) || delete this._hiddenMap[a] }, this); for (var a = new nd(this._chart.getUnfilteredDatas()), b = 0; b < a.size(); b++) { var c = a.get(b); this._chart.isVisible(c) || this.isHidden(c) || (a.removeAt(b), b--) } var d = a.size(), e = this._view.style, f = this._orientation === 'horizontal'; for (f ? (e.textAlign = 'center', e.height = this._rowHeight + 'px') : (e.textAlign = '', e.height = this._rowHeight * d + 'px'), e.lineHeight = this._rowHeight - 2 + 'px', b = 0; d > b; b++) { var c = a.get(b), g = this._divPool.get(); g._data = c, g.style.cursor = 'pointer', g.style.height = this._rowHeight + 'px', g.style.display = f ? 'inline-block' : 'block', this._legendDiv.appendChild(g), this.renderLegend(g, c), this.onLegendRendered(g, c) } this._pools.forEach(function(a) { a.clear() }) } }, renderLegend: function(a, b) { var c = !this.isHidden(b), d = this._chart.isSelected(b), e = this._iconPool.get(), f = e.style; f.display = 'inline-block', f.verticalAlign = 'middle', f.marginLeft = '4px', f.width = this.getIconWidth() + 'px', f.height = this.getIconHeight() + 'px', f.backgroundColor = c ? this._chart.getColor(b) : this.getHiddenColor(), a.appendChild(e); var g = this._textPool.get(); f = g.style, f.paddingLeft = '2px', f.paddingRight = '4px', f.display = 'inline-block', f.verticalAlign = 'middle', f.color = c ? d ? this._selectForegroundColor : '' : this.getHiddenColor(), g.innerHTML = this._chart.getName(b), a.appendChild(g), a.style.backgroundColor = c && d ? this._selectBackgroundColor : '' }, onLegendRendered: function(a, b) {} }), Ib.charts.ChartPane = function(a, b, c, d) { Ib.charts.ChartPane.superClass.constructor.apply(this, arguments), this.invalidate(), this._chart = a, this._legendPane = new Ib.charts.LegendPane(a), this._titleDiv = Wb.createDiv(), this._titleDiv.style.verticalAlign = 'middle', this._titleDiv.style.whiteSpace = 'nowrap', this._view = Wb.createView('hidden'), this._view.appendChild(this._titleDiv), this._view.appendChild(this._legendPane.getView()), this._view.appendChild(this._chart.getView()); var e = this; this._legendPane.addPropertyChangeListener(function(a) { (a.property === 'rowHeight' || a.porperty === 'orientation') && e.invalidate() }), arguments.length > 1 && this.setTitle(b), arguments.length > 2 && this.setLegendOrientation(c), arguments.length > 3 && this.setLegendWidth(d) }, Jb.ext('twaver.charts.ChartPane', Ib.controls.ControlBase, { __accessor: ['title', 'titleHorizontalAlign', 'titleHeight', 'legendWidth'], _title: null, _titleHeight: Ed.CHARTPANE_TITLE_HEIGHT, _titleHorizontalAlign: Ed.CHARTPANE_TITLE_HORIZONTAL_ALIGN, _legendOrientation: Ed.CHARTPANE_LEGEND_ORIENTATION, _legendWidth: Ed.CHARTPANE_LEGEND_WIDTH, getLegendOrientation: function() { return this._legendOrientation }, setLegendOrientation: function(a) { if (this._legendOrientation !== a) { var b = this._legendOrientation; this._legendOrientation = a, this.firePropertyChange('orientation', b, a), this._adjustLegendOrientation() } }, _adjustLegendOrientation: function() { this._legendPane.setOrientation(this._legendOrientation === 'left' || this._legendOrientation === 'right' ? 'vertical' : 'horizontal') }, onPropertyChanged: function(a) { this.invalidate() }, getTitleDiv: function() { return this._titleDiv }, getChart: function() { return this._chart }, getLegendPane: function() { return this._legendPane }, validateImpl: function() { this._adjustLegendOrientation(); var a, b = this._view.offsetWidth, c = this._view.offsetHeight, d = this._legendPane.getRowHeight(); this._title && this._title !== '' ? (a = this._titleHeight, this._titleDiv.innerHTML = this._title) : (a = 0, this._titleDiv.innerHTML = ''), this._titleDiv.innerHTML = this._title ? this._title : '', this._titleDiv.style.textAlign = this._titleHorizontalAlign, this._titleDiv.style.lineHeight = this._titleHeight - 2 + 'px'; var e = this._titleDiv.style; e.left = '0px', e.top = '0px', e.width = b + 'px', e.height = a + 'px'; var f, g; this._legendOrientation === 'bottom' ? (f = { x: 0, y: a, width: b, height: Math.max(c - a - d, 0) }, g = { x: 0, y: Math.max(c - d, 0), width: b, height: d }) : this._legendOrientation === 'right' ? (f = { x: 0, y: a, width: Math.max(b - this._legendWidth, 0), height: Math.max(c - a, 0) }, g = { x: Math.max(b - this._legendWidth, 0), y: a, width: this._legendWidth, height: Math.max(c - a, 0) }) : this._legendOrientation === 'top' ? (f = { x: 0, y: a + d, width: b, height: Math.max(c - a - d, 0) }, g = { x: 0, y: a, width: b, height: d }) : this._legendOrientation === 'left' && (f = { x: this._legendWidth, y: a, width: Math.max(b - this._legendWidth, 0), height: Math.max(c - a, 0) }, g = { x: 0, y: a, width: this._legendWidth, height: Math.max(c - a, 0) }), f && this._chart.adjustBounds(f), g && this._legendPane.adjustBounds(g) } }), Ib.charts.ChartInteraction = function(a) { this.chart = a, this.canvas = a._canvas; var b = this; this.canvas.addEventListener('mousedown', function(a) { a.button === 0 && b.handleMouseDown(a), a.preventDefault() }, !1); var c = Qb.isFirefox ? 'DOMMouseScroll' : 'mousewheel'; this.canvas.addEventListener(c, function(a) { b.handleMouseWheel(a) }, !1) }, Jb.ext('twaver.charts.ChartInteraction', Object, { handleMouseDown: function(a) { this.chart.isFocusOnClick() && Ib.Util.setFocus(this.canvas), this.lastPoint = this.chart.getLogicalPoint(a); var b = this.chart.tryGetDataAt(a); a.detail === 2 && b == null ? this.chart.isDoubleClickToReset() && (this.chart.zoomReset(!1), this.chart.setXTranslate(0), this.chart.setYTranslate(0)) : (this._startLogical = this.lastPoint, this._startClient = Wb.getClientPoint(a), Wb.handle_mousedown(this, a)) }, handleMouseMove: function(a) { if (this.lastPoint) { var b = { x: this._startLogical.x + a.clientX - this._startClient.x, y: this._startLogical.y + a.clientY - this._startClient.y }; !this.startPan && Tb.getDistance(this.lastPoint, b) > 3 && (this.startPan = !0, this.lastPoint = b), this.startPan && (this.chart.isXTranslateEnabled() && this.chart.setXTranslate(this.chart.getXTranslate() + b.x - this.lastPoint.x), this.chart.isYTranslateEnabled() && this.chart.setYTranslate(this.chart.getYTranslate() + b.y - this.lastPoint.y), this.lastPoint = b) } }, handleMouseUp: function(a) { if (!this.startPan && a.detail === 1) { var b = this.chart.tryGetDataAt(a), c = this.chart.getSelectionModel(); b ? Jb.isCtrlDown(a) ? c.contains(b) ? c.removeSelection(b) : c.appendSelection(b) : c.contains(b) || c.setSelection(b) : Jb.isCtrlDown(a) || c.clearSelection() } delete this.lastPoint, delete this.startPan, delete this._startClient, delete this._startLogical }, handleMouseWheel: function(a) { Wb.preventDefault(a); var b = Qb.isFirefox ? -a.detail : a.wheelDelta; b > 0 ? (this.chart.isXZoomEnabled() && this.chart.setXZoom(1.1 * this.chart.getXZoom(), !1), this.chart.isYZoomEnabled() && this.chart.setYZoom(1.1 * this.chart.getYZoom(), !1)) : b < 0 && (this.chart.isXZoomEnabled() && this.chart.setXZoom(this.chart.getXZoom() / 1.1, !1), this.chart.isYZoomEnabled() && this.chart.setYZoom(this.chart.getYZoom() / 1.1, !1)) } }), Ib.charts.ChartTouchInteraction = function(a) { this.chart = a, this.canvas = a._canvas, Wb.addEventListener('touchstart', 'handleTouchstart', this.canvas, this) }, Jb.ext('twaver.charts.ChartTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a), this.chart.isFocusOnClick() && Ib.Util.setFocus(this.canvas), this.endPoint = this.chart.getLogicalPoint(a), zc.isMultiTouch(a) && (this.distance = zc.getDistance(a), this.xZoom = this.chart.getXZoom(), this.yZoom = this.chart.getYZoom()), Wb.addEventListener('touchmove', 'handleTouchmove', this.canvas, this), Wb.addEventListener('touchend', 'handleTouchend', this.canvas, this) }, handleTouchmove: function(a) { if (Wb.preventDefault(a), this.endPoint) { var b = this.chart.getLogicalPoint(a); if (!this.moved && Tb.getDistance(this.endPoint, b) > 10 && (this.moved = !0, this.lastPoint = b), this.moved) if (zc.isSingleTouch(a)) this.endPoint && (this.chart.isXTranslateEnabled() && this.chart.setXTranslate(this.chart.getXTranslate() + b.x - this.endPoint.x), this.chart.isYTranslateEnabled() && this.chart.setYTranslate(this.chart.getYTranslate() + b.y - this.endPoint.y), this.endPoint = b); else if (this.distance) { var c = zc.getDistance(a) / this.distance, d = this.xZoom * c, e = this.yZoom * c; this.chart.isXZoomEnabled() && this.chart.setXZoom(d, !1), this.chart.isYZoomEnabled() && this.chart.setYZoom(e, !1) } } }, handleTouchend: function(a) { if (Wb.preventDefault(a), !this.moved) { this.endPoint = this.chart.getLogicalPoint(a); var b = this.lastPoint && this.lastTouchStartTime && (new Date()).getTime() - this.lastTouchStartTime.getTime() <= 300 && Math.abs(this.endPoint.x - this.lastPoint.x) <= 10 && Math.abs(this.endPoint.y - this.lastPoint.y) <= 10; b ? (this.lastPoint = null, this.lastTouchStartTime = null) : (this.lastPoint = this.endPoint, this.lastTouchStartTime = new Date()); var c = this.chart.tryGetDataAt(a); if (b && c == null) this.chart.isDoubleClickToReset() && (this.chart.zoomReset(!1), this.chart.setXTranslate(0), this.chart.setYTranslate(0)); else { var d = this.chart.getSelectionModel(); c ? d.contains(c) || d.setSelection(c) : d.clearSelection() } } delete this.endPoint, delete this.distance, delete this.xZoom, delete this.yZoom, delete this.moved, Wb.removeEventListener('touchmove', this.canvas, this), Wb.removeEventListener('touchend', this.canvas, this) } }), Ib.charts.ChartMSTouchInteraction = function(a) { this.chart = a, this.canvas = a._canvas, this._pointerMap = {}, this._pointerIdArray = [], Wb.addEventListener('MSPointerDown', 'handleTouchstart', this.canvas, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', this.canvas, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', this.canvas, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', this.canvas, this); var b = Qb.isFirefox ? 'DOMMouseScroll' : 'mousewheel'; this.canvas.addEventListener(b, function(a) { self.handleMouseWheel(a) }, !1) }, Jb.ext('twaver.charts.ChartMSTouchInteraction', Object, { handleTouchstart: function(a) { this.chart.isFocusOnClick() && Ib.Util.setFocus(this.canvas); var b = this.chart.getLogicalPoint(a); a.isPrimary && this._pointerIdArray.length > 0 && (this._pointerMap = {}, this._pointerIdArray = []), !this._pointerMap[a.pointerId] && b && (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a); var c = this.chart.tryGetDataAt(a); if (this._pointerIdArray.length == 1 && b) { var d = this._startTouchPoint && this._startTouchTime && (new Date()).getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, b) <= 10; d && c == null ? this.chart.isDoubleClickToReset() && (this.chart.zoomReset(!1), this.chart.setXTranslate(0), this.chart.setYTranslate(0), this._startTouchPoint = null, this._startTouchTime = null, this._startClientPoint = null) : (this._startTouchPoint = b, this._startTouchTime = new Date(), this._startClientPoint = { x: a.clientX, y: a.clientY }, Wb.handle_mousedown(this, a)) } else this._pointerIdArray.length == 2 && (this.xZoom = this.chart.getXZoom(), this.yZoom = this.chart.getYZoom(), this._distance = this._getDistance()) }, handleTouchmove: function(a) { if (this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 3) && (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2)) { var b = this._getDistance() / this._distance, c = this.xZoom * b, d = this.yZoom * b; this.chart.isXZoomEnabled() && this.chart.setXZoom(c, !1), this.chart.isYZoomEnabled() && this.chart.setYZoom(d, !1) } }, handleTouchend: function(a) { var b = this.chart.getLogicalPoint(a); if (this._pointerIdArray.length == 1 && b && !this.moved) { var c = this.chart.tryGetDataAt(a), d = this._startTouchPoint && this._startTouchTime && (new Date()).getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, b) <= 10, e = this.chart.getSelectionModel(); c && d ? Jb.isCtrlDown(a) ? e.contains(c) ? e.removeSelection(c) : e.appendSelection(c) : e.contains(c) || e.setSelection(c) : Jb.isCtrlDown(a) || e.clearSelection() } this.moved = !1, this._pointerMap = {}, this._pointerIdArray = [] }, handleMouseWheel: function(a) { Wb.preventDefault(a); var b = Qb.isFirefox ? -a.detail : a.wheelDelta; b > 0 ? (this.chart.isXZoomEnabled() && this.chart.setXZoom(1.1 * this.chart.getXZoom(), !1), this.chart.isYZoomEnabled() && this.chart.setYZoom(1.1 * this.chart.getYZoom(), !1)) : b < 0 && (this.chart.isXZoomEnabled() && this.chart.setXZoom(this.chart.getXZoom() / 1.1, !1), this.chart.isYZoomEnabled() && this.chart.setYZoom(this.chart.getYZoom() / 1.1, !1)) }, handle_mousemove: function(a) { if (this._pointerIdArray.length == 1 && this._startTouchPoint && this._startClientPoint) { var b = { x: this._startTouchPoint.x + (a.clientX - this._startClientPoint.x) / this.chart.getXZoom(), y: this._startTouchPoint.y + (a.clientY - this._startClientPoint.y) / this.chart.getYZoom() }; Tb.getDistance(this._startTouchPoint, b) > 3 && (this.moved = !0, this.chart.isXTranslateEnabled() && this.chart.setXTranslate(this.chart.getXTranslate() + b.x - this._startTouchPoint.x), this.chart.isYTranslateEnabled() && this.chart.setYTranslate(this.chart.getYTranslate() + b.y - this._startTouchPoint.y), this._startClientPoint.x = a.clientX, this._startClientPoint.y = a.clientY) } }, handle_mouseup: function(a) { this.handleTouchend(a) }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) } }), Ib.charts.LegendPaneInteraction = function(a) { this.legendPane = a; var b = this; this.legendPane._legendDiv.addEventListener('mousedown', function(a) { b.handleMouseDown(a) }, !1) }, Jb.ext('twaver.charts.LegendPaneInteraction', Object, { handleMouseDown: function(a) { if (a.button === 0) { var b = a.target._data; b || (b = a.target.parentNode._data), b && (this.legendPane._hiddenMap[b.getId()] ? delete this.legendPane._hiddenMap[b.getId()] : this.legendPane._hiddenMap[b.getId()] = b, this.legendPane._chart.invalidateModel()) } } }), Ib.charts.LegendPaneTouchInteraction = function(a) { this.legendPane = a, Wb.addEventListener('touchstart', 'handleTouchstart', this.legendPane._legendDiv, this) }, Jb.ext('twaver.charts.LegendPaneTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a); var b = a.target._data; b || (b = a.target.parentNode._data), b && (this.legendPane._hiddenMap[b.getId()] ? delete this.legendPane._hiddenMap[b.getId()] : this.legendPane._hiddenMap[b.getId()] = b, this.legendPane._chart.invalidateModel()) } }), Ib.network.Network = function(a) { Ib.network.Network.superClass.constructor.apply(this, arguments), this._elementUIMap = {}, this._layerMap = {}, this._layerList = new nd(), this._view = Wb.createView('auto'), this._rootDiv = Wb.createDiv(), this._topDiv = Wb.createDiv(), this._attachmentDiv = Wb.createDiv(), this._layersDiv = Wb.createDiv(), this._bottomDiv = Wb.createDiv(), this._rootDiv.appendChild(this._bottomDiv), this._rootDiv.appendChild(this._layersDiv), this._rootDiv.appendChild(this._attachmentDiv), this._rootDiv.appendChild(this._topDiv), this._view.appendChild(this._rootDiv), this.setElementBox(a || new Ib.ElementBox()), Qb.isTouchable ? Qb.isMSTouchable ? this.setMSTouchInteractions() : this.setTouchInteractions() : this.setDefaultInteractions(!1); var b = this; this._flowLink = function() { if (!(b.isMovingElement() || b.isSelectingElement() || b.isEditingElement() || b._box._layoutMovingElements)) { b._flowLinkQuickFinder || (b._flowLinkQuickFinder = new Ib.QuickFinder(b._box, 'link.flow', 'style')); var a = b._flowLinkQuickFinder.find(!0); a.forEach(function(a) { a._styleMap['link.flow.offset'] = b.getLinkFlowOffset(a); var c = b.getElementUI(a); c.drawBody() }) } }, this.setToolTipEnabled(Ed.NETWORK_TOOLTIP_ENABLED), this._view.addEventListener('scroll', function(a) { oc.twm(b) }), this.addPropertyChangeListener(function(a) { a.property === 'zoom' && oc.twm(b) }), Ib.imageUtil.addEventListener(this.invalidateElementUIs, this) }, Jb.ext('twaver.network.Network', Ib.controls.View, { __accessor: ['selectMode', 'makeVisibleOnSelected', 'movableFunction', 'editPointSize', 'editPointFillColor', 'editPointOutlineWidth', 'editPointOutlineColor', 'editLineColor', 'editLineWidth', 'resizePointSize', 'resizePointFillColor', 'resizePointOutlineWidth', 'resizePointOutlineColor', 'resizeLineColor', 'resizeLineWidth', 'rotatePointSize', 'rotatePointFillColor', 'rotatePointOffset', 'rotatePointOutlineWidth', 'rotatePointOutlineColor', 'rotateScaleFillColor', 'rotateScaleFontColor', 'rotateScaleWidth', 'rotateScaleHeight', 'selectOutlineColor', 'selectOutlineWidth', 'selectFillColor', 'lazyMoveOutlineColor', 'lazyMoveOutlineWidth', 'lazyMoveFillColor', 'rectSelectFilter', 'selectionTolerance'], __bool: ['doubleClickToUpSubNetwork', 'doubleClickToSubNetwork', 'doubleClickToEmptySubNetwork', 'doubleClickToLinkBundle', 'doubleClickToGroupExpand', 'subNetworkAnimate', 'lazyMoveAnimate', 'resizeAnimate', 'noAgentLinkVisible', 'keyboardRemoveEnabled', 'keyboardSelectEnabled', 'sendToTopOnSelected', 'lazyMoveFill', 'editingElement', 'rotatingElement', 'movingElement', 'selectingElement', 'rectSelectEnabled', 'limitElementInPositiveLocation', 'showRotateScale', 'transparentSelectionEnable'], _viewRect: { x: 0, y: 0, width: 0, height: 0 }, _currentSubNetwork: null, _selectMode: Ed.NETWORK_SELECT_MODE, _noAgentLinkVisible: Ed.NETWORK_NO_AGENT_LINK_VISIBLE, _makeVisibleOnSelected: Ed.NETWORK_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: Ed.NETWORK_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: Ed.NETWORK_KEYBOARD_SELECT_ENABLED, _rectSelectEnabled: Ed.NETWORK_RECT_SELECT_ENABLED, _rectSelectFilter: null, _subNetworkAnimate: Ed.NETWORK_SUBNETWORK_ANIMATE, _transparentSelectable: Ed.NETWORK_TRANSPARENT_SELECTABLE, _removeElementUIOnInvisible: Ed.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE, _elementUIFunction: Ed.ELEMENTUI_FUNCTION, _doubleClickToUpSubNetwork: Ed.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK, _doubleClickToSubNetwork: Ed.NETWORK_DOUBLECLICK_TO_SUBNETWORK, _doubleClickToEmptySubNetwork: Ed.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK, _doubleClickToLinkBundle: Ed.NETWORK_DOUBLECLICK_TO_LINKBUNDLE, _doubleClickToGroupExpand: Ed.NETWORK_DOUBLECLICK_TO_GROUPEXPAND, _sendToTopOnSelected: Ed.NETWORK_SENDTOTOP_ON_SELECTED, _selectOutlineColor: Ed.NETWORK_SELECT_OUTLINE_COLOR, _selectOutlineWidth: Ed.NETWORK_SELECT_OUTLINE_WIDTH, _selectFillColor: Ed.NETWORK_SELECT_FILL_COLOR, _lazyMoveOutlineColor: Ed.NETWORK_LAZYMOVE_OUTLINE_COLOR, _lazyMoveOutlineWidth: Ed.NETWORK_LAZYMOVE_OUTLINE_WIDTH, _lazyMoveFillColor: Ed.NETWORK_LAZYMOVE_FILL_COLOR, _lazyMoveFill: Ed.NETWORK_LAZYMOVE_FILL, _lazyMoveAnimate: Ed.NETWORK_LAZYMOVE_ANIMATE, _editPointSize: Ed.NETWORK_EDIT_POINT_SIZE, _editPointFillColor: Ed.NETWORK_EDIT_POINT_FILL_COLOR, _editPointOutlineColor: Ed.NETWORK_EDIT_POINT_OUTLINE_COLOR, _editPointOutlineWidth: Ed.NETWORK_EDIT_POINT_OUTLINE_WIDTH, _editLineColor: Ed.NETWORK_EDIT_LINE_COLOR, _editLineWidth: Ed.NETWORK_EDIT_LINE_WIDTH, _resizePointSize: Ed.NETWORK_RESIZE_POINT_SIZE, _resizePointFillColor: Ed.NETWORK_RESIZE_POINT_FILL_COLOR, _resizePointOutlineColor: Ed.NETWORK_RESIZE_POINT_OUTLINE_COLOR, _resizePointOutlineWidth: Ed.NETWORK_RESIZE_POINT_OUTLINE_WIDTH, _resizeLineColor: Ed.NETWORK_RESIZE_LINE_COLOR, _resizeLineWidth: Ed.NETWORK_RESIZE_LINE_WIDTH, _resizeAnimate: Ed.NETWORK_RESIZE_ANIMATE, _rotatePointSize: Ed.NETWORK_ROTATE_POINT_SIZE, _rotatePointFillColor: Ed.NETWORK_ROTATE_POINT_FILL_COLOR, _rotatePointOffset: Ed.NETWORK_ROTATE_POINT_OFFSET, _rotatePointOutlineWidth: Ed.NETWORK_ROTATE_POINT_OUTLINE_WIDTH, _rotatePointOutlineColor: Ed.NETWORK_ROTATE_POINT_OUTLINE_COLOR, _rotateScaleWidth: Ed.NETWORK_ROTATE_SCALE_WIDTH, _rotateScaleHeight: Ed.NETWORK_ROTATE_SCALE_HEIGHT, _rotateScaleFillColor: Ed.NETWORK_ROTATE_SCALE_FILL_COLOR, _rotateScaleFontColor: Ed.NETWORK_ROTATE_SCALE_FONT_COLOR, _limitElementInPositiveLocation: Ed.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION, _linkFlowInterval: Ed.NETWORK_LINK_FLOW_INTERVAL, _selectionTolerance: Ed.NETWORK_SELECTION_TOLERANCE, _invalidate: !1, _invalidateElementVisibility: !1, _invalidateElementIndex: !1, _isEditingElement: !1, _isRotatingElement: !1, _isMovingElement: !1, _isSelectingElement: !1, _hasEditInteraction: !1, _showRotateScale: !0, _transparentSelectionEnable: Ib.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE, getLabel: function(a) { return a.getStyle('network.label') || a.getName() }, isToolTipEnabled: function() { return this._toolTipEnabled ? !0 : !1 }, setToolTipEnabled: function(a) { if (this._toolTipEnabled = a, a) { if (!this._toolTipListener) { var b = this; this._toolTipListener = function(a) { var c = b.getElementAt(a); if (b._preElement !== c) if (b._preElement = c, c) { var d = b.getToolTip(c); Bc.showToolTip({ x: a.pageX, y: a.pageY }, d); var e = Bc.getToolTipDiv(); if (e.children.length > 0) { var f = b._view.getBoundingClientRect(), g = e.getBoundingClientRect(); g.width + g.left > f.width + f.left && (e.style.left = f.width + f.left - g.width + (Ob.documentElement.scrollLeft || Ob.body.scrollLeft) + 'px'), g.height + g.top > f.height + f.top && (e.style.top = f.height + f.top - g.height + (Ob.documentElement.scrollTop || Ob.body.scrollTop) + 'px') } } else Bc.hideToolTip() }, this._view.addEventListener('mousemove', this._toolTipListener, !0), this.firePropertyChange('toolTipEnabled', !1, !0) } } else this._toolTipListener && (Bc.hideToolTip(), this._view.removeEventListener('mousemove', this._toolTipListener, !0), delete this._toolTipListener, this.firePropertyChange('toolTipEnabled', !0, !1)) }, isLinkFlowEnabled: function() { return this._linkFlowEnabled ? !0 : !1 }, setLinkFlowEnabled: function(a) { a ? (this._linkFlowEnabled || (this._linkFlowEnabled = !0, this.firePropertyChange('linkFlowEnabled', !1, !0)), clearInterval(this._linkFlowTimerId), this._linkFlowTimerId = setInterval(this._flowLink, this._linkFlowInterval)) : (this._linkFlowEnabled && (this._linkFlowEnabled = !1, this.firePropertyChange('linkFlowEnabled', !0, !1)), clearInterval(this._linkFlowTimerId), delete this._linkFlowTimerId) }, getLinkFlowInterval: function() { return this._linkFlowInterval }, setLinkFlowInterval: function(a) { var b = this._linkFlowInterval; this._linkFlowInterval = a, this.firePropertyChange('linkFlowInterval', b, a), clearInterval(this._linkFlowTimerId), this.isLinkFlowEnabled() && (this._linkFlowTimerId = setInterval(this._flowLink, this._linkFlowInterval)) }, getTopDiv: function() { return this._topDiv }, getAttachmentDiv: function() { return this._attachmentDiv }, getLayersDiv: function() { return this._layersDiv }, getBottomDiv: function() { return this._bottomDiv }, validateImpl: function() { if (oc.twm(this), this.__lics__) { var a = 0, b = null, c = null, d = null, e = this._invalidateElementVisibility; if (this._invalidateElementVisibility && (this._invalidateElementVisibility = !1, this._removeElementUIOnInvisible && (this._invalidateElementIndex = !0), this.forEachElementUI(function(e) { e.validate(); var f = e.getElement(); if (e.setVisible(this.isVisible(f)), this._removeElementUIOnInvisible) { if (b = this.getLayerDivByElement(f), e.isVisible()) { if (e.getView().parentNode !== b) for (b.appendChild(e.getView()), c = e.getAttachments(), a = 0; a < c.size(); a++)d = c.get(a), d.isShowInAttachmentDiv() && this._attachmentDiv.appendChild(d.getView()) } else if (e.getView().parentNode === b) for (b.removeChild(e.getView()), c = e.getAttachments(), a = 0; a < c.size(); a++)d = c.get(a), d.isShowInAttachmentDiv() && this._attachmentDiv.removeChild(d.getView()) } else if (!e.getView().parentNode) for (b = this.getLayerDivByElement(f), b.appendChild(e.getView()), c = e.getAttachments(), a = 0; a < c.size(); a++)d = c.get(a), d.isShowInAttachmentDiv() && this._attachmentDiv.appendChild(d.getView()) }, null, this)), this._invalidateElementIndex) { this._invalidateElementIndex = !1; var f, g = this; this._box.getLayerBox().forEachByDepthFirst(function(a) { var b, c = g._layerMap[a.getId()]; g._box.forEachByLayer(function(a) { var d = g._elementUIMap[a.getId()]; if (d && d.getView().parentNode === c) { b = Wb.insertAfter(d.getView(), b); for (var e = d.getAttachments(), h = 0; h < e.size(); h++) { var i = e.get(h); i.getView().parentNode === g._attachmentDiv && (f = Wb.insertAfter(i.getView(), f)) } } }, a) }) } if (e && !this._invalidateElementVisibility) { var h; for (var i in this._elementUIMap) { var j = this._elementUIMap[i]; j.isVisible() && (h = Tb.unionRect(h, j.getViewRect())) } if (h = h ? { x: 0, y: 0, width: h.x + h.width, height: h.y + h.height } : { x: 0, y: 0, width: 0, height: 0 }, h.x !== this._viewRect.x || h.y !== this._viewRect.y || h.width !== this._viewRect.width || h.height !== this._viewRect.height) { var k = this._viewRect; this._viewRect = h, this._rootDiv.style.left = '0px', this._rootDiv.style.top = '0px', this._rootDiv.style.width = h.width + 'px', this._rootDiv.style.height = h.height + 'px', this.firePropertyChange('viewRect', k, h) } } } }, setInteractions: function(a) { var b = this._interactions; b && b.forEach(function(a) { a.tearDown() }), this._interactions = a, a && a.forEach(function(a) { a.setUp() }), this.invalidateSelectedElementUIs(!0), this.firePropertyChange('interactions', b, a) }, getInteractions: function() { return this._interactions }, upSubNetwork: function(a, b) { this._currentSubNetwork && this.setCurrentSubNetwork(vc.getSubNetwork(this._currentSubNetwork), a, b) }, sendToTop: function(a) { if (this.isVisible(a)) { for (var b = a; this.isVisible(b.getParent()) && (b = b.getParent()););b !== a && this._box.adjustElementIndex(b), this._box.adjustElementIndex(a) } }, invalidateElementIndex: function() { this._invalidateElementIndex || (this._invalidateElementIndex = !0, this.invalidate()) }, invalidateElementVisibility: function() { this._invalidateElementVisibility || (this._invalidateElementVisibility = !0, this.invalidate()) }, updateLayers: function() { Wb.clear(this._layersDiv), Wb.clear(this._attachmentDiv), this._layerMap = {}, this._layerList.clear(); var a = this; this._box.getLayerBox().forEachByDepthFirst(function(b) { var c = Wb.createDiv(); Wb.setVisible(c, b.isVisible()), a._layerMap[b.getId()] = c, a._layersDiv.appendChild(c), a._layerList.add(b) }), this._box.forEach(this.createElementUI, this) }, getCurrentSubNetwork: function() { return this._currentSubNetwork }, setCurrentSubNetwork: function(a, b, c) { var d = Ib.animate.AnimateManager; if (d.endAnimate(), b) { if (this._currentSubNetwork === a) return; if (a && !this._box.contains(a)) throw a + " is not contained in this network's elementBox"; d.start(new Ib.animate.AnimateSubNetwork(this, a, c)) } else this._setCurrentSubNetwork(a), c && c() }, _setCurrentSubNetwork: function(a) { if (this._currentSubNetwork !== a) { if (a && !this._box.contains(a)) throw a + " is not contained in this network's elementBox"; var b = this._currentSubNetwork; this._currentSubNetwork = a, this.firePropertyChange('currentSubNetwork', b, a), this.invalidateElementVisibility() } }, isVisible: function(a) { if (!this._box.contains(a)) return !1; if (!a.isVisible()) return !1; if (this._visibleFunction && !this._visibleFunction(a)) return !1; if (!this._box.getLayerBox().getLayerByElement(a).isVisible()) return !1; if (vc.getSubNetwork(a) !== this._currentSubNetwork) return !1; if (a instanceof Ib.Link) { if (!this.isNoAgentLinkVisible()) { if (!a.getFromAgent() || !a.getToAgent()) return !1; if (!this.isVisible(a.getFromAgent()) || !this.isVisible(a.getToAgent())) return !1 } if (a.getBundleIndex() > 0 && a.getBundleCount() > 1 && !a.getStyle('link.bundle.expanded')) return !1 } else for (var b = a.getParent(); b && !b.ISubNetwork;) { if (b instanceof Nd && (!b.isExpanded() || !this.isVisible(b))) return !1; b = b.getParent() } return a.IDummy ? !1 : !0 }, isMovable: function(a) { return this._box.contains(a) ? a instanceof Ib.Link ? !1 : this._movableFunction && !this._movableFunction(a) ? !1 : this._box.getLayerBox().getLayerByElement(a).isMovable() : !1 }, isEditable: function(a) { return this._box.contains(a) ? this._editableFunction && !this._editableFunction(a) ? !1 : this._box.getLayerBox().getLayerByElement(a).isEditable() : !1 }, isRotatable: function(a) { return this._rotatableFunction && !this._rotatableFunction(a) ? !1 : !0 }, getVisibleFunction: function() { return this._visibleFunction }, setVisibleFunction: function(a) { var b = this._visibleFunction; this._visibleFunction = a, this.firePropertyChange('visibleFunction', b, a), this.invalidateElementVisibility() }, getEditableFunction: function() { return this._editableFunction }, setEditableFunction: function(a) { var b = this._editableFunction; this._editableFunction = a, this.firePropertyChange('editableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, getRotatableFunction: function() { return this._rotatableFunction }, setRotatableFunction: function(a) { var b = this._rotatableFunction; this._rotatableFunction = a, this.firePropertyChange('rotatableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, isLinkable: function(a) { return this._linkableFunction == null || this._linkableFunction(a) }, getLinkableFunction: function() { return this._linkableFunction }, setLinkableFunction: function(a) { var b = this._linkableFunction; this._linkableFunction = a, this.firePropertyChange('linkableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, onShareSelectionModelChanged: function() { this.invalidateElementUIs() }, getElementBox: function() { return this._box }, setElementBox: function(a) {
    if (!a) throw 'ElementBox can not be null'; if (this._box !== a) {
      var b = this._box; b && (b.removeDataBoxChangeListener(this.handleElementBoxChange, this), b.removeDataPropertyChangeListener(this.handleElementPropertyChange, this), b.removePropertyChangeListener(this.handleElementBoxPropertyChange, this), b.removeIndexChangeListener(this.handleIndexChange, this), b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange, this), b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange, this), b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange, this), this._selectionModel || b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)), this._box = a, this._box.addDataBoxChangeListener(this.handleElementBoxChange, this), this._box.addDataPropertyChangeListener(this.handleElementPropertyChange, this), this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange, this), this._box.addIndexChangeListener(this.handleIndexChange, this), this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange, this), this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange, this), this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange, this), this._flowLinkQuickFinder && (this._flowLinkQuickFinder.dispose(),
        this._flowLinkQuickFinder = new Ib.QuickFinder(this._box, 'link.flow', 'style')), this._selectionModel ? this._selectionModel._setDataBox(a) : this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this), this._elementUIMap = {}, this.updateLayers(), this.invalidateElementVisibility(), this.firePropertyChange('elementBox', b, this._box)
    }
  }, invalidateElementUI: function(a, b) { var c = this.getElementUI(a); c && c.invalidate(b) }, invalidateElementUIs: function(a) { for (var b in this._elementUIMap) { var c = this._elementUIMap[b]; c.invalidate(a) } }, invalidateSelectedElementUIs: function(a) { this.getSelectionModel().getSelection().forEach(function(b) { this.invalidateElementUI(b, a) }, this) }, getElementUI: function(a) { return a ? this._elementUIMap[a.getId()] : null }, getLayerDivByElement: function(a) { var b = this._box.getLayerBox().getLayerByElement(a); return b ? this._layerMap[b.getId()] : null }, createElementUI: function(a) { var b = this._elementUIMap[a.getId()]; if (b || (b = this._elementUIFunction(this, a), b && (this._elementUIMap[a.getId()] = b)), b) { var c = this.getLayerDivByElement(a); b.getView().parentNode !== c && (c.appendChild(b.getView()), b.getAttachments().forEach(function(a) { a.isShowInAttachmentDiv() && a.getView().parentNode !== this._attachmentDiv && this._attachmentDiv.appendChild(a.getView()) }, this)), this.invalidateElementIndex() } }, invalidateBundleLink: function(a) { if (a instanceof Ib.Link && a._bundleLinks) { var b = this._elementUIMap; a._bundleLinks.forEachSiblingLink(function(c) { if (c !== a) { var d = b[c._id]; d && d.invalidate(!1) } }, this) } }, handleLayerBoxChange: function(a) { this.updateLayers(), this.invalidateElementVisibility() }, handleLayerPropertyChange: function(a) { var b = a.source; if (a.property === 'visible') { var c = this._layerMap[b.getId()]; Wb.setVisible(c, b.isVisible()) } else a.property === 'editable' && this.invalidateSelectedElementUIs(!0); this.invalidateElementVisibility() }, handleLayerHierarchyChange: function(a) { var b; this._layerList.clear(), this._box.getLayerBox().forEachByDepthFirst(function(a) { var c = this._layerMap[a.getId()]; b = Wb.insertAfter(c, b), this._layerList.add(a) }, null, this), this.invalidateElementVisibility() }, handleSelectionChange: function(a) { a.datas.forEach(function(b) { var c = this.getElementUI(b); c && c.handleSelectionChange(a) }, this), this.invalidateElementVisibility(); var b = this.getSelectionModel().getLastData(); b && (a.kind === 'append' || a.kind === 'set') && (this.isMakeVisibleOnSelected() && this.makeVisible(b), this.isSendToTopOnSelected() && this.sendToTop(b)) }, makeVisible: function(a) { var b = this.getElementUI(a); if (b) { var c = vc.getSubNetwork(a); if (c !== this._currentSubNetwork) { var d = this; return void this.setCurrentSubNetwork(c, this.isSubNetworkAnimate(), function() { Jb.callLater(d.makeVisible, d, [a]) }) } for (var e = a; (e = e.getParent()) && e !== c;)e instanceof Nd && e.setExpanded(!0); var f = b.getUnionBodyBounds(); if (f) { var g = { x: this._view.scrollLeft / this._zoom, y: this._view.scrollTop / this._zoom, width: this._view.clientWidth / this._zoom, height: this._view.clientHeight / this._zoom }; Tb.intersects(g, f) || this.isVisible(a) && Jb.callLater(this.centerByLogicalPoint, this, [f.x + f.width / 2, f.y + f.height / 2]) } } }, handleElementBoxChange: function(a) { var b = a.data; if (a.kind === 'add') this.createElementUI(b), this.invalidateBundleLink(b); else if (a.kind === 'remove') { var c = this.getElementUI(b); if (c) { var d = this._box.getLayerBox().getLayerByElement(b), e = this._layerMap[d.getId()]; c.getView().parentNode === e && e.removeChild(c.getView()), c.dispose(), delete this._elementUIMap[b.getId()] }b === this._currentSubNetwork && this._currentSubNetwork != null && this._setCurrentSubNetwork(null) } else a.kind === 'clear' && (this.forEachElementUI(function(a) { a.dispose() }), this._elementUIMap = {}, this.updateLayers(), this._currentSubNetwork != null && this._setCurrentSubNetwork(null)); this.invalidateElementVisibility() }, handleElementPropertyChange: function(a) { var b = a.source, c = this.getElementUI(b); if (c && (c.handlePropertyChange(a), a.property === 'layerId')) { var d = this._box.getLayerBox().getLayerByElement(b), e = this._layerMap[d.getId()]; c.getView().parentNode !== e && (e.appendChild(c.getView()), this.invalidateElementIndex()) } this.invalidateBundleLink(b), this.invalidateElementVisibility() }, handleElementBoxPropertyChange: function(a) { this.invalidateElementVisibility() }, handleIndexChange: function(a) { this.invalidateElementIndex() }, getElementUIFunction: function() { return this._elementUIFunction }, setElementUIFunction: function(a) { if (!a) throw 'ElementUIFunction can not be null'; if (this._elementUIFunction !== a) { var b = this._elementUIFunction; this._elementUIFunction = a, this.firePropertyChange('elementUIFunction', b, a), this._box.isEmpty() || this.updateLayers() } }, getIconsNames: function(a) { return a.getStyle('icons.names') }, getIconsColors: function(a) { return a.getStyle('icons.colors') }, getLinkHandlerLabel: function(a) { return a.isBundleAgent() ? '+(' + a.getBundleCount() + ')' : null }, getSelectColor: function(a) { return a.getStyle('select.color') }, getShadowColor: function(a) { var b = a.getStyle('shadow.color'); return !b && this.isSelected(a) && a.getStyle('select.style') === 'shadow' ? a.getStyle('select.color') : b }, getAlarmLabel: function(a) { var b = a.getAlarmState().getHighestNewAlarmSeverity(); if (b) { var c = a.getAlarmState().getNewAlarmCount(b) + b.nickName; return a.getAlarmState().hasLessSevereNewAlarms() && (c += '+'), c } return null }, isRemoveElementUIOnInvisible: function() { return this._removeElementUIOnInvisible }, setRemoveElementUIOnInvisible: function(a) { var b = this._removeElementUIOnInvisible; this._removeElementUIOnInvisible = a, this.firePropertyChange('removeElementUIOnInvisible', b, a), this.invalidateElementVisibility() }, setDefaultInteractions: function(a, b) { var c = [new Ib.network.interaction.SelectInteraction(this), new Ib.network.interaction.MoveInteraction(this, a), new Ib.network.interaction.DefaultInteraction(this)]; b && c.push(new Ib.network.interaction.MoveLinkInteraction(this, a)), this.setInteractions(c) }, setPanInteractions: function() { this.setInteractions([new Ib.network.interaction.PanInteraction(this), new Ib.network.interaction.DefaultInteraction(this)]) }, setEditInteractions: function(a, b) { var c = [new Ib.network.interaction.SelectInteraction(this), new Ib.network.interaction.EditInteraction(this, a), new Ib.network.interaction.MoveInteraction(this, a), new Ib.network.interaction.DefaultInteraction(this)]; b && c.push(new Ib.network.interaction.MoveLinkInteraction(this, a)), this.setInteractions(c) }, setCreateElementInteractions: function(a) { this.setInteractions([new Ib.network.interaction.CreateElementInteraction(this, a), new Ib.network.interaction.DefaultInteraction(this)]) }, setCreateLinkInteractions: function(a) { this.setInteractions([new Ib.network.interaction.CreateLinkInteraction(this, a), new Ib.network.interaction.DefaultInteraction(this)]) }, setCreateShapeLinkInteractions: function(a) { this.setInteractions([new Ib.network.interaction.CreateShapeLinkInteraction(this, a), new Ib.network.interaction.DefaultInteraction(this)]) }, setCreateShapeNodeInteractions: function(a) { this.setInteractions([new Ib.network.interaction.CreateShapeNodeInteraction(this, a), new Ib.network.interaction.DefaultInteraction(this)]) }, setTouchInteractions: function() { var a = [new Ib.network.interaction.SelectInteraction(this), new Ib.network.interaction.MoveInteraction(this, !1), new Ib.network.interaction.DefaultInteraction(this), new Ib.network.interaction.TouchInteraction(this)]; this.setInteractions(a) }, setMSTouchInteractions: function() { this.setInteractions([new Ib.network.interaction.MSTouchInteraction(this)]) }, setMagnifyInteractions: function() { this.setInteractions([new Ib.network.interaction.SelectInteraction(this), new Ib.network.interaction.MoveInteraction(this), new Ib.network.interaction.DefaultInteraction(this), new Ib.network.interaction.MagnifyInteraction(this)]) }, hasEditInteraction: function() { return this._hasEditInteraction }, setHasEditInteraction: function(a) { var b = this._hasEditInteraction; this._hasEditInteraction = a, this.firePropertyChange('hasEditInteraction', b, a) }, moveSelectedElements: function(a, b, c, d) { if (a !== 0 || b !== 0) { var e = this.getMovableSelectedElementsRect(); e != null && (this._limitElementInPositiveLocation && (e.x + a < 0 && (a = -e.x), e.y + b < 0 && (b = -e.y)), Ib.Util.moveElements(this.getMovableSelectedElements(), a, b, c, d, this)) } }, getMovableSelectedElements: function() { return this.getSelectionModel().toSelection(function(a) { return this.isMovable(a) }, this) }, hasMovableSelectedElements: function() { for (var a = this.getSelectionModel().getSelection(), b = 0; b < a.size(); b++) { var c = a.get(b); if (this.isMovable(c)) return !0 } return !1 }, getMovableSelectedElementsRect: function() { var a = this.getMovableSelectedElements(); if (a.size() === 0) return null; for (var b = null, c = 0, d = a.size(); d > c; c++) { var e = a.get(c); if (e instanceof Ld) { var f = this.getElementUI(e); f && (b = Tb.unionRect(b, f.getViewRect())) } } return b }, getLayerByElement: function(a) { return this._box.getLayerBox().getLayerByElement(a) }, getPosition: function(a, b, c, d, e) { var f, g = b instanceof Ib.network.ElementUI ? b : this.getElementUI(b); if (g) if (a === 'from' || a === 'to') { if (g.getFromPosition && (f = a === 'from' ? g.getFromPosition(d, e) : g.getToPosition(d, e))) return { x: f.x - c.width / 2, y: f.y - c.height / 2 } } else f = a === 'hotspot' ? g.getHotSpot() : Vb.get(a, g.getBodyRect(), c); if (!f && b.getRect && (f = Vb.get(a, b.getRect(), c)), f) return { x: f.x + d, y: f.y + e }; throw "position '" + a + "' object '" + b + "'" }, getViewRect: function() { return this._viewRect ? Jb.clone(this._viewRect) : { x: 0, y: 0, width: 0, height: 0 } }, forEachElementUI: function(a, b, c) { b ? this._box.forEachReverse(function(d) { if (this.getLayerByElement(d) === b) { var e = this.getElementUI(d); e && (c ? a.call(c, e) : a(e)) } }, this) : this._layerList.forEachReverse(function(b) { this.forEachElementUI(a, b, c) }, this) }, findFirstElement: function(a, b) { for (var c = this._layerList.size() - 1, d = this._box.size() - 1, e = c; e >= 0; e--) for (var f = this._layerList.get(e), g = d; g >= 0; g--) { var h = this._box.getDataAt(g); if (this.getLayerByElement(h) === f) if (b) { if (a.call(b, h) === !0) return h } else if (a(h) === !0) return h } return null }, getElementAt: function(a, b) { if (arguments.length === 1 && (b = !0), !this.isValidEvent(a)) return null; a = this._getPoint(a), a || console.log('null'); var c = a.x, d = a.y, e = this._selectionTolerance; if (e && e > 0) { var f = { x: c, y: d, width: 0, height: 0 }; Tb.grow(f, e, e) } return this.findFirstElement(function(a) { if (b && !this.isSelectable(a)) return !1; var e = this.getElementUI(a); return e ? f ? !!e.intersectsTest(f) : !!e.hitTest(c, d) : !1 }, this) }, _getPoint: function(a) { return a ? a.target ? this.getLogicalPoint(a) : a : null }, getElementsAtRect: function(a, c, d, e) { var f = new nd(); return e = e === b ? !0 : e, this.forEachElementUI(function(b) { b.isVisible() && (!d || d(b._element)) && (e && this.isSelectable(b._element) || !e) && (c ? b.intersectsTest(a) && f.add(b._element) : Tb.contains(a, b.getViewRect()) && f.add(b._element)) }, null, this), f }, hitTest: function(a) { var b = this.getElementAt(a); if (!b) return null; var c = this.getElementUI(b); return c ? (a = this._getPoint(a), c.hitTest(a.x, a.y)) : null }, addElementByInteraction: function(a) { a.getParent() || a.setParent(this._currentSubNetwork), this._box.add(a), this.getSelectionModel().setSelection(a), this.fireInteractionEvent({ kind: 'createElement', element: a }) }, getLinkFlowStepping: function(a) { var b = parseInt(a.getStyle('link.flow.stepping')); return b || (b = Ed.NETWORK_LINK_FLOW_STEPPING), b }, getLinkFlowOffset: function(a) { var b = a.getStyle('link.flow.offset'); return isNaN(b) && (b = 0), b + this.getLinkFlowStepping(a) }, toCanvas: function(a, b, c) { c || (c = Wb.createCanvas()), c.setAttribute('width', a), c.setAttribute('height', b), c._viewRect ? (c._viewRect.width = a, c._viewRect.height = b) : c._viewRect = { x: 0, y: 0, width: a, height: b }; var d = c.getContext('2d'); if (d.clearRect(0, 0, a, b), this._view.clientWidth === 0 || this._view.clientHeight === 0) return c; var e = a / this._view.scrollWidth * this._zoom, f = b / this._view.scrollHeight * this._zoom; return d.scale(e, f), Wb.forEach(this._view, function(a) { if ((a.tagName === 'CANVAS' || a.tagName === 'IMG') && !a._isIgnored) { var b = a._viewRect; if (b) try { d.drawImage(a, b.x, b.y, b.width, b.height) } catch (a) {} } }), c }, toCanvasByRegion: function(a, b, c) { c || (c = Wb.createCanvas()); var d = a.width * b, e = a.height * b; c.setAttribute('width', d), c.setAttribute('height', e); var f = c.getContext('2d'); return f.clearRect(0, 0, d, e), this._view.clientWidth === 0 || this._view.clientHeight === 0 ? c : (f.save(), f.scale(b, b), Wb.forEach(this._view, function(b) { if ((b.tagName === 'CANVAS' || b.tagName === 'IMG') && !b._isIgnored) { var c = b._viewRect; if (c && Tb.intersects(c, a)) try { f.drawImage(b, c.x - a.x, c.y - a.y, c.width, c.height) } catch (b) {} } }), f.restore(), c) }, getGroupChildrenRects: function(a) { var b = new nd(); return a.getChildren().forEach(function(a) { if (a instanceof Ld) { var c = this.getElementUI(a); if (c) { var d = c.getViewRect(); d && b.add(d) } } }, this), b }, getLinkPathFunction: function() { return this._linkPathFunction }, setLinkPathFunction: function(a) { var b = this._linkPathFunction; this._linkPathFunction = a, this.firePropertyChange('linkPathFunction', b, a), this.invalidateElementUIs() }, onClickElement: function(a, b) {}, onClickBackground: function(a) {}, onDoubleClickElement: function(a, b) {}, onDoubleClickBackground: function(a) {}, onLongClickElement: function(a, b) {}, onLongClickBackground: function(a) {}, onMouseMove: function(a, b) {}, onMouseEnter: function(a, b) {}, onMouseLeave: function(a, b) {}, setMovingElement: function(a) { if (a != this._movingElement) { var b = this._movingElement; this._movingElement = a, this.firePropertyChange('movingElement', b, a), this._box._undoManager._enabled && (a ? this._box._undoManager.startBatch() : this._box._undoManager.endBatch()) } }, setEditingElement: function(a) { if (a != this._editingElement) { var b = this._editingElement; this._editingElement = a, this.firePropertyChange('editingElement', b, a), this._box._undoManager._enabled && (a ? this._box._undoManager.startBatch() : this._box._undoManager.endBatch()) } }, dispose: function() { Ib.imageUtil.removeEventListener(this.invalidateElementUIs, this) } }), Ib.network.Overview = function(a) { Ib.network.Overview.superClass.constructor.apply(this, arguments), this._view = Wb.createView(), this._rootDiv = Wb.createDiv(), this._imageCanvas = Wb.createCanvas(), this._imageDiv = Wb.createDiv(), this._maskCanvas = Wb.createCanvas(), this._selectDiv = Wb.createDiv(), this._isNetworkDirty = !1, this._isMaskDirty = !1, Wb.setVisible(this._selectDiv, !1), this._view.appendChild(this._rootDiv), this._rootDiv.appendChild(this._imageDiv), this._rootDiv.appendChild(this._maskCanvas), this._rootDiv.appendChild(this._selectDiv), this._imageDiv.appendChild(this._imageCanvas), this.setNetwork(a), Qb.isTouchable ? Qb.isMSTouchable ? new Ib.network.OverviewMSTouchInteraction(this) : (new Ib.network.OverviewTouchInteraction(this), new Ib.network.OverviewInteraction(this)) : new Ib.network.OverviewInteraction(this) }, Jb.ext('twaver.network.Overview', Ib.controls.ControlBase, { __accessor: ['fillColor', 'outlineColor', 'outlineWidth', 'selectColor', 'selectWidth', 'padding', 'maxPackingWidth', 'maxPackingHeight'], __bool: ['animate'], _fillColor: Ed.OVERVIEW_FILL_COLOR, _outlineColor: Ed.OVERVIEW_OUTLINE_COLOR, _outlineWidth: Ed.OVERVIEW_OUTLINE_WIDTH, _selectColor: Ed.OVERVIEW_SELECT_COLOR, _selectWidth: Ed.OVERVIEW_SELECT_WIDTH, _padding: Ed.OVERVIEW_PADDING, _animate: Ed.OVERVIEW_ANIMATE, _maxPackingWidth: Ed.OVERVIEW_MAX_PACKING_WIDTH, _maxPackingHeight: Ed.OVERVIEW_MAX_PACKING_HEIGHT, getNetwork: function() { return this._network }, onPropertyChanged: function(a) { this._invalidateMask() }, setNetwork: function(a) { a !== this._network && (this._network && (this._network.removePropertyChangeListener(this._handleNetworkPropertyChange, this), this._network.removeViewListener(this._handleNetworkViewChange, this), Wb.removeEventListener('scroll', '_handleScrollChange', this._network.getView(), this)), this._network = a, this._network && (this._network.addPropertyChangeListener(this._handleNetworkPropertyChange, this), this._network.addViewListener(this._handleNetworkViewChange, this), Wb.addEventListener('scroll', '_handleScrollChange', this._network.getView(), this)), this.invalidate()) }, _handleNetworkPropertyChange: function(a) { (a.property === 'zoom' || a.property === 'currentSubNetwork' || a.property === 'elementBox' || a.property === 'dataBox') && this.invalidate() }, _handleNetworkViewChange: function(a) { a.kind === 'validateEnd' && this.invalidate() }, _handleScrollChange: function() { this._invalidateMask() }, invalidate: function(a) { this._isNetworkDirty && this._isMaskDirty || (this._isNetworkDirty || (this._isNetworkDirty = !0), this._isMaskDirty || (this._isMaskDirty = !0), Jb.callLater(this.validate, this, null, a)) }, _invalidateMask: function() { this._isMaskDirty || (this._isMaskDirty = !0, Jb.callLater(this.validate, this, [], 100)) }, validate: function() { if ((this._isMaskDirty || this._isNetworkDirty) && this._network && (this._maxPackingWidth > 0 && this._maxPackingHeight > 0 || this._view.clientWidth > 0 && this._view.clientHeight > 0) && this._network._view.clientWidth !== 0 && this._network._view.clientHeight !== 0) { var a, b = this._maxPackingWidth > 0 && this._maxPackingHeight > 0; a = b ? { x: 0, y: 0, width: this._maxPackingWidth, height: this._maxPackingHeight } : { x: 0, y: 0, width: this._view.clientWidth, height: this._view.clientHeight }, Tb.grow(a, -this._padding, -this._padding); var c = Math.min(a.width / this._network._view.scrollWidth, a.height / this._network._view.scrollHeight); b && (Wb.setDiv(this._view, { x: 0, y: 0, width: this._imageDiv._viewRect.width, height: this._imageDiv._viewRect.height }, null, 0, null), a.width = this._imageDiv._viewRect.width, a.height = this._imageDiv._viewRect.height); var d = this._network._view.scrollWidth * c, e = this._network._view.scrollHeight * c, f = a.x + (a.width - d) / 2, g = a.y + (a.height - e) / 2; if (this._isNetworkDirty) { var h = { x: f, y: g, width: d, height: e }; this._network.toCanvas(h.width, h.height, this._imageCanvas), Wb.setDiv(this._imageDiv, h, null, 0, null), this._network.getElementBox && (this._imageDiv.style.backgroundColor = (this._network.getCurrentSubNetwork() || this._network.getElementBox()).getStyle('background.color') || ''), this._isNetworkDirty = !1 } if (this._isMaskDirty) { var i = { x: this._network._view.scrollLeft * c, y: this._network._view.scrollTop * c, width: d * this._network._view.clientWidth / this._network._view.scrollWidth, height: e * this._network._view.clientHeight / this._network._view.scrollHeight }, j = Wb.setCanvas(this._maskCanvas, f, g, d, e); j.lineWidth = 0, j.fillStyle = this._fillColor, j.beginPath(), Xb.drawVector(j, 'rectangle', null, f, g, d, e), j.fill(), j.clearRect(f + i.x, g + i.y, i.width, i.height); var k = this._outlineWidth < 0 ? 0 : this._outlineWidth; j.lineWidth = k, j.strokeStyle = this._outlineColor, j.beginPath(), Xb.drawVector(j, 'rectangle', null, f + i.x + k, g + i.y + k, i.width - 2 * k, i.height - 2 * k), k >= 0 && j.stroke(), this._isMaskDirty = !1 } } else this._isNetworkDirty = !1, this._isMaskDirty = !1 }, getLogicalPoint: function(a) { return Wb.getLogicalPoint(this._view, a, 1, this._rootDiv) }, centerNetwork: function(a, b) { var c = this._imageDiv._viewRect; Tb.containsPoint(c, a) && (this._network.centerByLogicalPoint((a.x - c.x) / c.width * this._network._view.scrollWidth / this._network.getZoom(), (a.y - c.y) / c.height * this._network._view.scrollHeight / this._network.getZoom(), b), this._invalidateMask()) } }), Ib.network.OverviewTouchInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, Wb.addEventListener('touchstart', 'handleTouchstart', this.view, this) }, Jb.ext('twaver.network.OverviewTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a), this.clear(), this.endPoint = this.overview.getLogicalPoint(a), zc.isMultiTouch(a) && (this.distance = zc.getDistance(a), this.zoom = this.network.getZoom()), Wb.addEventListener('touchmove', 'handleTouchmove', this.view, this), Wb.addEventListener('touchend', 'handleTouchend', this.view, this) }, handleTouchmove: function(a) { if (Wb.preventDefault(a), this.moved || (this.moved = !0), this.endPoint = this.overview.getLogicalPoint(a), zc.isSingleTouch(a)) this.overview.centerNetwork(this.endPoint, !1); else if (this.distance) { var b = zc.getDistance(a) / this.distance; this.network.setZoom(this.zoom * b, !1) } }, handleTouchend: function(a) { if (!this.moved) { this.endPoint = this.overview.getLogicalPoint(a); var b = this.lastPoint && this.lastTouchStartTime && (new Date()).getTime() - this.lastTouchStartTime.getTime() <= 300 && Math.abs(this.endPoint.x - this.lastPoint.x) <= 10 && Math.abs(this.endPoint.y - this.lastPoint.y) <= 10; b ? (this.lastPoint = null, this.lastTouchStartTime = null) : (this.lastPoint = this.endPoint, this.lastTouchStartTime = new Date()), b ? Jb.callLater(this.network.zoomReset, this.network, [this.overview._animate]) : this.overview.centerNetwork(this.endPoint, this.overview._animate) } this.clear() }, clear: function() { this.endPoint && (this.endPoint = null, Wb.removeEventListener('touchmove', this.view, this), Wb.removeEventListener('touchend', this.view, this)), this.moved = !1 } }), Ib.network.OverviewInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, Wb.addEventListener('mousedown', 'handleMousedown', this.view, this) }, Jb.ext('twaver.network.OverviewInteraction', Object, { handleMousedown: function(a) { a.button === 0 && (this.clear(), this.endPoint = this.overview.getLogicalPoint(a), Jb.isCtrlDown(a) && (this.startPoint = this.endPoint, Wb.setVisible(this.overview._selectDiv, !0)), Wb.addEventListener('mousemove', 'handleMousemove', this.view, this), Wb.addEventListener('mouseup', 'handleMouseup', this.view, this)) }, handleMouseup: function(a) { if (this.endPoint = this.overview.getLogicalPoint(a), 'detail' in a && a.detail === 2)Jb.callLater(this.network.zoomReset, this.network, [this.overview._animate]); else if (Wb.isVisible(this.overview._selectDiv) && this.startPoint) { var b = this.overview._imageDiv._viewRect, c = this.overview._selectDiv._viewRect.x, d = this.overview._selectDiv._viewRect.y, e = b.width / this.overview._selectDiv._viewRect.width, f = b.height / this.overview._selectDiv._viewRect.height, g = Math.min(e, f), h = this.network._view.scrollWidth / this.network.getZoom() * ((c - b.x + this.overview._selectDiv._viewRect.width / 2) / b.width), i = this.network._view.scrollHeight / this.network.getZoom() * ((d - b.y + this.overview._selectDiv._viewRect.height / 2) / b.height); this.network.setZoom(g * Math.min(this.network._view.clientWidth / this.network._view.scrollWidth, this.network._view.clientHeight / this.network._view.scrollHeight) * this.network.getZoom(), !1), Jb.callLater(this.network.centerByLogicalPoint, this.network, [h, i, this.overview._animate]), Wb.setVisible(this.overview._selectDiv, !1), Wb.setDiv(this.overview._selectDiv, { x: 0, y: 0, width: 0, height: 0 }, null, 0, null), this.startPoint = null } else this.overview.centerNetwork(this.endPoint, this.overview._animate); this.clear() }, handleMousemove: function(a) { var b = this.overview.getLogicalPoint(a); if (this.endPoint = b, Wb.isVisible(this.overview._selectDiv) && this.startPoint) { var c = b.x > this.startPoint.x ? this.startPoint.x : b.x, d = b.x > this.startPoint.x ? this.startPoint.y : b.y; b.x > this.startPoint.x && b.y < this.startPoint.y && (d = b.y), b.x < this.startPoint.x && b.y > this.startPoint.y && (d = this.startPoint.y); var e = this.overview._imageDiv._viewRect; c < e.x && (c = e.x), c > e.x + e.width && (c = e.x + e.width), d < e.y && (d = e.y), d > e.y + e.height && (d = e.y + e.height); var f = Math.abs(b.x - this.startPoint.x), g = Math.abs(b.y - this.startPoint.y); c + f > e.x + e.width && (f = e.x + e.width - c), d + g > e.y + e.height && (g = e.y + e.height - d), Wb.setDiv(this.overview._selectDiv, { x: c, y: d, width: f, height: g }, null, this.overview._selectWidth, this.overview._selectColor) } else this.overview.centerNetwork(b, !1) }, clear: function() { this.endPoint && (this.endPoint = null, Wb.removeEventListener('mousemove', this.view, this), Wb.removeEventListener('mouseup', this.view, this)) } }), Ib.network.OverviewMSTouchInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, this._pointerMap = {}, this._pointerIdArray = [], Wb.addEventListener('MSPointerDown', 'handleTouchstart', this.view, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', this.view, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', this.view, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', this.view, this) }, Jb.ext('twaver.network.OverviewMSTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a), a.isPrimary && this._pointerIdArray.length > 0 && (this._pointerMap = {}, this._pointerIdArray = []), !this._pointerMap[a.pointerId] && this.overview.getLogicalPoint(a) && (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a), this._pointerIdArray.length == 1 ? (this._startTouchPoint = this.overview.getLogicalPoint(a), this._startTouchTime = new Date()) : this._pointerIdArray.length == 2 && (this._distance = this._getDistance(), this._zoom = this.network.getZoom()) }, handleTouchmove: function(a) { if (this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 10)) if (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2) { var b = this._getDistance() / this._distance; this.network.setZoom(this._zoom * b, !1) } else if (this._pointerIdArray.length == 1 && this._startTouchPoint) { var c = this.overview.getLogicalPoint(a); if (c == null) return; this._startTouchPoint = c, this.overview.centerNetwork(this._startTouchPoint, !1) } }, handleTouchend: function(a) { var b = this.overview.getLogicalPoint(a); if (this._pointerIdArray.length == 1 && b) { var c = this._endTouchPoint && this._endTouchTime && (new Date()).getTime() - this._endTouchTime.getTime() <= 500 && Tb.getDistance(this._endTouchPoint, b) <= 10; c ? (this._endTouchPoint = null, this._endTouchTime = null) : (this._endTouchPoint = b, this._endTouchTime = new Date()), c ? Jb.callLater(this.network.zoomReset, this.network, [this.overview._animate]) : this.overview.centerNetwork(this._endTouchPoint, this.overview._animate) } this._pointerMap = {}, this._pointerIdArray = [] }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) } }), Ib.network.ElementUI = function(a, b) { this._view = Wb.createDiv(), this._bodyView = Wb.createDiv(), this._view.appendChild(this._bodyView), this._network = a, this._element = b, this._attachments = new nd(), this._bodyBounds = new nd(), this.invalidate(!0) }, Jb.ext('twaver.network.ElementUI', Object, { _invalidateFlag: !1, _invalidateAttachmentsFlag: !1, getElement: function() { return this._element }, getNetwork: function() { return this._network }, getAttachments: function() { return this._attachments }, getStyle: function(a) { return this._element.getStyle(a) }, getFont: function(a) { var b = this._element.getStyle(a); return b || Ed.FONT }, getDyeColor: function(a) { return this._innerColor ? this._innerColor : this.getStyle(a) }, getInnerColor: function() { return this._innerColor }, getOuterColor: function() { return this._outerColor }, getShadowColor: function() { return this._shadowColor }, getLabelAttachment: function() { return this._labelAttachment }, getAlarmAttachment: function() { return this._alarmAttachment }, getIconsAttachment: function() { return this._iconsAttachment }, getEditAttachment: function() { return this._editAttachment }, getHotSpot: function() { return this._hotSpot ? Jb.clone(this._hotSpot) : { x: 0, y: 0 } }, setHotSpot: function(a) { this._hotSpot = a }, getUnionBodyBounds: function() { return Jb.clone(this._unionBodyBounds) }, getBodyRect: function() { return this._bodyRect || (this._bodyRect = this.createBodyRect()), Jb.clone(this._bodyRect) }, invalidate: function(a) { a === b && (a = !0), a && (this._invalidateAttachmentsFlag = !0), this._invalidateFlag || (this._bodyRect = null, this._invalidateFlag = !0, this._network.invalidateElementVisibility()) }, updateMeasure: function() {}, validate: function() { if (this._invalidateFlag) { this._invalidateAttachmentsFlag && (this._invalidateAttachmentsFlag = !1, this.checkAttachments()), this._invalidateFlag = !1, this._bodyBounds.clear(), Wb.clear(this._bodyView), this._innerColor = this._network.getInnerColor(this._element), this._outerColor = this._network.getOuterColor(this._element), this._shadowColor = this._network.getShadowColor(this._element), this._shadowXOffset = this._element.getStyle('shadow.xoffset'), this._shadowYOffset = this._element.getStyle('shadow.yoffset'), this._shadowBlur = this._element.getStyle('shadow.blur'), this.updateMeasure(); var a = this._element.getStyle('whole.alpha'); this._view.style.opacity = a, this._attachments.forEach(function(b) { b.updateMeasure(); var c = b.getAlpha(); b._view.style.opacity = b.isShowInAttachmentDiv() ? c * a : c }); var b; this._bodyBounds.forEach(function(a) { b = Tb.unionRect(b, a) }), this._unionBodyBounds = Jb.clone(b), this._attachments.forEach(function(a) { b = Tb.unionRect(b, a.getViewRect()) }), this._viewRect = b } }, cleanUp: function(a) { for (var b = a.length, c = 0; b > c; c++) { var d = a[c], e = this[d]; e && !e.parentNode && (this[d] = null) } }, setVisible: function(a) { this.isVisible() !== a && (Wb.setVisible(this._view, a), this._attachments.forEach(function(b) { b.isShowInAttachmentDiv() && Wb.setVisible(b._view, a) }), this.invalidate(!0)) }, isVisible: function() { return Wb.isVisible(this._view) }, checkAttachments: function() { this.checkLabelAttachment(), this.checkAlarmAttachment(), this.checkIconsAttachment(), this.checkEditAttachment() }, checkLabelAttachment: function() { var a = this._network.getLabel(this._element); a != null && a !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.network.LabelAttachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkAlarmAttachment: function() { var a = this._network.getAlarmLabel(this._element); a != null && a !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.network.AlarmAttachment(this, Ed.SHOW_ALARM_IN_ATTACHMENT_DIV), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) }, checkIconsAttachment: function() { var a = this._network.getIconsNames(this._element); a && a.length > 0 ? this._iconsAttachment || (this._iconsAttachment = new Ib.network.IconsAttachment(this), this.addAttachment(this._iconsAttachment)) : this._iconsAttachment && (this.removeAttachment(this._iconsAttachment), this._iconsAttachment = null) }, checkEditAttachment: function() { this.isEditable() && this._network.hasEditInteraction() && this._network.isSelected(this._element) && this._network.isEditable(this._element) ? this._editAttachment || (this._editAttachment = new Ib.network.EditAttachment(this), this.addAttachment(this._editAttachment)) : this._editAttachment && (this.removeAttachment(this._editAttachment), this._editAttachment = null) }, isEditable: function() { return !0 }, handlePropertyChange: function(a) { this.invalidate(!0) }, handleSelectionChange: function(a) { this.invalidate(!0) }, dispose: function() { this._attachments.forEach(function(a) { a.getView().parentNode && a.getView().parentNode.removeChild(a.getView()), a.dispose() }), this._attachments.clear() }, addAttachment: function(a) { this._attachments.add(a), a.isShowInAttachmentDiv() ? this._network.getAttachmentDiv().appendChild(a.getView()) : this._view.appendChild(a.getView()), this.invalidate(!1) }, removeAttachment: function(a) { this._attachments.remove(a), a.getView().parentNode && a.getView().parentNode.removeChild(a.getView()), a.dispose(), this.invalidate(!1) }, addBodyBounds: function(a) { a && this._bodyBounds.add(a) }, addComponent: function(a) { this._bodyView.appendChild(a) }, getBodyView: function() { return this._bodyView }, getView: function() { return this._view }, getViewRect: function() { return Jb.clone(this._viewRect) }, setShadow: function(a, b, c) { var d = a.isShadowable() && this._shadowColor && !this._editAttachment; d && (this._shadowXOffset > 0 ? c.width += this._shadowXOffset : (c.x += this._shadowXOffset, c.width += -this._shadowXOffset), this._shadowYOffset > 0 ? c.height += this._shadowYOffset : (c.y += this._shadowYOffset, c.height += -this._shadowYOffset), Tb.grow(c, this._shadowBlur, this._shadowBlur)); var e = Wb.setCanvas(b, c); return d && (e.shadowOffsetX = this._shadowXOffset, e.shadowOffsetY = this._shadowYOffset, e.shadowBlur = this._shadowBlur, e.shadowColor = this._shadowColor), e }, isShadowable: function() { return this._shadowColor && this._network.isSelected(this._element) && this._element.getStyle('select.style') === 'shadow' ? !0 : !1 }, hit: function(a, b) { return !1 }, hitCanvas: function(a, b, c) { for (var d = c.length, e = 0; d > e; e++) { var f = c[e], g = this[f]; if (Xb.hit(g, a, b, this._network.getSelectionTolerance())) return !0 } return !1 }, hitComponent: function(a, b, c) { for (var d = c.length, e = 0; d > e; e++) { var f = c[e], g = this[f]; if (g && Tb.containsPoint(g._viewRect, a, b)) return !0 } return !1 }, hitTest: function(a, b) {
    if (!this.isVisible() || !Tb.containsPoint(this._viewRect, a, b)) return null; var c, d, e = this._attachments.size(); for (c = e - 1; c >= 0; c--) if (d = this._attachments.get(c), d.isShowInAttachmentDiv() && d.hit(a, b)) return d; for (c = e - 1; c >= 0; c--) if (d = this._attachments.get(c), !d.isShowInAttachmentDiv() && d.hit(a, b)) return d; return Tb.containsPoint(this._unionBodyBounds, a, b) && this.hit(a, b) ? this : null
  }, intersects: function(a) { return !1 }, intersectsComponent: function(a, b) { for (var c = b.length, d = 0; c > d; d++) { var e = b[d], f = this[e]; if (f && Tb.intersects(f._viewRect, a)) return !0 } return !1 }, intersectsCanvas: function(a, b) { for (var c = b.length, d = 0; c > d; d++) { var e = b[d], f = this[e]; if (Xb.intersects(f, a)) return !0 } return !1 }, intersectsTest: function(a) { if (!this.isVisible() || !Tb.intersects(this._viewRect, a)) return null; var b, c, d = this._attachments.size(); for (b = d - 1; b >= 0; b--) if (c = this._attachments.get(b), c.isShowInAttachmentDiv() && c.intersects(a)) return c; for (b = d - 1; b >= 0; b--) if (c = this._attachments.get(b), !c.isShowInAttachmentDiv() && c.intersects(a)) return c; return Tb.intersects(this._unionBodyBounds, a) && this.intersects(a) ? this : null } }), Ib.network.Attachment = function(a, b) { this._view = Wb.createDiv(), this._ui = a, this._element = this._ui.getElement(), this._network = a.getNetwork(), this._isShowInAttachmentDiv = b === !0, this._isShowInAttachmentDiv && Wb.setVisible(this._view, a.isVisible()) }, Jb.ext('twaver.network.Attachment', Object, { getElement: function() { return this._element }, getElementUI: function() { return this._ui }, getNetwork: function() { return this._network }, getStyle: function(a) { return this._ui.getStyle(a) }, getFont: function(a) { return this._ui.getFont(a) }, isShowInAttachmentDiv: function() { return this._isShowInAttachmentDiv }, getView: function() { return this._view }, getViewRect: function() { return Jb.clone(this._viewRect) }, getAlpha: function() { return 1 }, updateMeasure: function() {}, dispose: function() {}, hit: function(a, b) { return Tb.containsPoint(this._viewRect, a, b) }, intersects: function(a) { return Tb.intersects(this._viewRect, a) } }), Ib.network.BasicAttachment = function(a, b) { Ib.network.BasicAttachment.superClass.constructor.call(this, a, b), this._roundRect = { x: 0, y: 0, width: 0, height: 0 }, this._contentRect = { x: 0, y: 0, width: 0, height: 0 }, this._attachmentCanvas = Wb.createCanvas(), this._view.insertBefore(this._attachmentCanvas, this._view.firstChild) }, Jb.ext('twaver.network.BasicAttachment', Ib.network.Attachment, { calculateMeasure: function() { var a = this.getContentWidth(), b = this.getContentHeight(), c = this.getCornerRadius(), d = this.getPointerLength(), e = this.getPointerWidth(), f = this.getPosition(), g = this.getXOffset(), h = this.getYOffset(), i = this._roundRect; i.width = a + 2 * c, i.height = b; var j; if (d > 0) { var k = this.getDirection(); j = this._network.getPosition(f, this._ui, null, g, h); var l; if (k === 'aboveleft')i.y = j.y - d - i.height, i.x = j.x - (i.width - c), l = Math.max(j.x - e, i.x + c / 2), this._pointers = [j, { x: j.x, y: j.y - d }, { x: l, y: j.y - d }]; else if (k === 'aboveright')i.y = j.y - d - i.height, i.x = j.x - c, l = Math.min(j.x + e, i.x + i.width - c / 2), this._pointers = [j, { x: j.x, y: j.y - d }, { x: l, y: j.y - d }]; else if (k === 'belowleft')i.y = j.y + d, i.x = j.x - (i.width - c), l = Math.max(j.x - e, i.x + c / 2), this._pointers = [j, { x: j.x, y: j.y + d }, { x: l, y: j.y + d }]; else if (k === 'belowright')i.y = j.y + d, i.x = j.x - c, l = Math.min(j.x + e, i.x + i.width - c / 2), this._pointers = [j, { x: j.x, y: j.y + d }, { x: l, y: j.y + d }]; else if (k === 'leftabove')i.y = j.y + c - i.height, i.x = j.x - d - i.width, l = Math.max(j.y - e, i.y + c / 2), this._pointers = [j, { x: j.x - d, y: j.y }, { x: j.x - d, y: l }]; else if (k === 'leftbelow')i.y = j.y - c, i.x = j.x - d - i.width, l = Math.min(j.y + e, i.y + i.height - c / 2), this._pointers = [j, { x: j.x - d, y: j.y }, { x: j.x - d, y: l }]; else if (k === 'rightabove')i.y = j.y + c - i.height, i.x = j.x + d, l = Math.max(j.y - e, i.y + c / 2), this._pointers = [j, { x: j.x + d, y: j.y }, { x: j.x + d, y: l }]; else if (k === 'rightbelow')i.y = j.y - c, i.x = j.x + d, l = Math.min(j.y + e, i.y + i.height - c / 2), this._pointers = [j, { x: j.x + d, y: j.y }, { x: j.x + d, y: l }]; else if (k === 'above')i.y = j.y - d - i.height, i.x = j.x - i.width / 2, l = Math.min(a / 2, e / 2), this._pointers = [j, { x: j.x - l, y: j.y - d }, { x: j.x + l, y: j.y - d }]; else if (k === 'below')i.y = j.y + d, i.x = j.x - i.width / 2, l = Math.min(a / 2, e / 2), this._pointers = [j, { x: j.x - l, y: j.y + d }, { x: j.x + l, y: j.y + d }]; else if (k === 'left')i.y = j.y - i.height / 2, i.x = j.x - d - i.width, l = Math.min(b / 2, e / 2), this._pointers = [j, { x: j.x - d, y: j.y + l }, { x: j.x - d, y: j.y - l }]; else { if (k !== 'right') throw "Can not resolve '" + k + "' attachment direction"; i.y = j.y - i.height / 2, i.x = j.x + d, l = Math.min(b / 2, e / 2), this._pointers = [j, { x: j.x + d, y: j.y + l }, { x: j.x + d, y: j.y - l }] } } else j = this._network.getPosition(f, this._ui, { width: i.width, height: i.height }, g, h), i.x = j.x, i.y = j.y, this._pointers = null; this._contentRect.x = i.x + (i.width - a) / 2, this._contentRect.y = i.y + (i.height - b) / 2, this._contentRect.width = a, this._contentRect.height = b; var m = this.getPadding(); m != 0 && Tb.grow(i, m, m), m = this.getPaddingLeft(), m != 0 && (i.x -= m, i.width += m), m = this.getPaddingRight(), m != 0 && (i.width += m), m = this.getPaddingTop(), m != 0 && (i.y -= m, i.height += m), m = this.getPaddingBottom(), m != 0 && (i.height += m), i.width < 0 && (i.width = i.width, i.x -= i.width), i.height < 0 && (i.height = -i.height, i.y -= i.height) }, updateMeasure: function() { Ib.network.BasicAttachment.superClass.updateMeasure.call(this), this.calculateMeasure(); var a = this.isFill(), b = this.getOutlineWidth(); this._viewRect = Tb.getRect(this._pointers), this._viewRect = Tb.unionRect(this._viewRect, this._roundRect), b > 0 && Tb.grow(this._viewRect, b / 2, b / 2); var c = this._ui.setShadow(this, this._attachmentCanvas, this._viewRect); if ((b > 0 || a) && (c.beginPath(), Xb.drawRoundRect(c, this._roundRect.x, this._roundRect.y, this._roundRect.width, this._roundRect.height, this.getCornerRadius()), this._pointers && (c.moveTo(this._pointers[0].x, this._pointers[0].y), c.lineTo(this._pointers[1].x, this._pointers[1].y), c.lineTo(this._pointers[2].x, this._pointers[2].y)), c.closePath(), b > 0 && (c.lineWidth = b, c.strokeStyle = this.getOutlineColor(), c.lineCap = this.getCap(), c.lineJoin = this.getJoin(), c.stroke()), a)) { var d = this.getFillColor(), e = this.getGradient(); e ? Xb.fill(c, d, e, this.getGradientColor(), this._viewRect) : c.fillStyle = d, c.fill() } return c }, getRoundRect: function() { return Jb.clone(this._roundRect) }, getContentRect: function() { return Jb.clone(this._contentRect) }, getContent: function() { return this._content }, setContent: function(a) { this._content !== a && (this._content && this._view.removeChild(this._content), this._content = a, a && this._view.appendChild(a)) }, getContentWidth: function() { return Ed.ATTACHMENT_CONTENT_WIDTH }, getContentHeight: function() { return Ed.ATTACHMENT_CONTENT_HEIGHT }, getCornerRadius: function() { return Ed.ATTACHMENT_CORNER_RADIUS }, getPointerLength: function() { return Ed.ATTACHMENT_POINTER_LENGTH }, getPointerWidth: function() { return Ed.ATTACHMENT_POINTER_WIDTH }, getPosition: function() { return Ed.ATTACHMENT_POSITION }, getXOffset: function() { return Ed.ATTACHMENT_XOFFSET }, getYOffset: function() { return Ed.ATTACHMENT_YOFFSET }, getPadding: function() { return Ed.ATTACHMENT_PADDING }, getPaddingLeft: function() { return Ed.ATTACHMENT_PADDING_LEFT }, getPaddingRight: function() { return Ed.ATTACHMENT_PADDING_RIGHT }, getPaddingTop: function() { return Ed.ATTACHMENT_PADDING_TOP }, getPaddingBottom: function() { return Ed.ATTACHMENT_PADDING_BOTTOM }, getDirection: function() { return Ed.ATTACHMENT_DIRECTION }, isFill: function() { return Ed.ATTACHMENT_FILL }, getFillColor: function() { return Ed.ATTACHMENT_FILL_COLOR }, getGradient: function() { return Ed.ATTACHMENT_GRADIENT }, getGradientColor: function() { return Ed.ATTACHMENT_GRADIENT_COLOR }, getOutlineWidth: function() { return Ed.ATTACHMENT_OUTLINE_WIDTH }, getOutlineColor: function() { return Ed.ATTACHMENT_OUTLINE_COLOR }, getCap: function() { return Ed.ATTACHMENT_CAP }, getJoin: function() { return Ed.ATTACHMENT_JOIN }, isShadowable: function() { return Ed.ATTACHMENT_SHADOWABLE }, hit: function(a, b) { return Tb.containsPoint(this._viewRect, a, b) ? Tb.containsPoint(this._contentRect, a, b) ? !0 : Xb.hit(this._attachmentCanvas, a, b) : !1 }, intersects: function(a) { return Tb.intersects(this._viewRect, a) ? Tb.intersects(this._contentRect, a) ? !0 : Xb.intersects(this._attachmentCanvas, a) : !1 } }), Ib.network.LabelAttachment = function(a, b) { Ib.network.LabelAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.LabelAttachment', Ib.network.BasicAttachment, { updateMeasure: function() { var a, b = this.getFont('label.font'), c = this.getLabel(), d = Jb.g.getTextSize(b, c), e = this.getMaxLength(); e !== 0 && d.width > e ? (a = Jb.g.getCollapseTextInLength(b, c, e), this._textSize = Jb.g.getTextSize(b, a)) : (a = c, this._textSize = d); var f = Ib.network.LabelAttachment.superClass.updateMeasure.call(this), g = this._element.getStyle('label.align'); Xb.drawText(f, a, this._contentRect, b, this.getStyle('label.color'), g) }, getLabel: function() { return this._network.getLabel(this._element) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('label.corner.radius') }, getPointerLength: function() { return this.getStyle('label.pointer.length') }, getPointerWidth: function() { return this.getStyle('label.pointer.width') }, getPosition: function() { return this.getStyle('label.position') }, getXOffset: function() { return this.getStyle('label.xoffset') }, getYOffset: function() { return this.getStyle('label.yoffset') }, getPadding: function() { return this.getStyle('label.padding') }, getPaddingLeft: function() { return this.getStyle('label.padding.left') }, getPaddingRight: function() { return this.getStyle('label.padding.right') }, getPaddingTop: function() { return this.getStyle('label.padding.top') }, getPaddingBottom: function() { return this.getStyle('label.padding.bottom') }, getDirection: function() { return this.getStyle('label.direction') }, isFill: function() { return this.getStyle('label.fill') }, getFillColor: function() { return this.getStyle('label.fill.color') }, getGradient: function() { return this.getStyle('label.gradient') }, getGradientColor: function() { return this.getStyle('label.gradient.color') }, getOutlineWidth: function() { return this.getStyle('label.outline.width') }, getOutlineColor: function() { return this.getStyle('label.outline.color') }, getCap: function() { return this.getStyle('label.cap') }, getJoin: function() { return this.getStyle('label.join') }, getAlpha: function() { return this.getStyle('label.alpha') }, getMaxLength: function() { return this.getStyle('label.maxlength') }, isShadowable: function() { return this.getStyle('label.shadowable') } }), Ib.network.AlarmAttachment = function(a, b) { Ib.network.AlarmAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.AlarmAttachment', Ib.network.BasicAttachment, { updateMeasure: function() { var a = this.getFont('alarm.font'), b = this._network.getAlarmLabel(this._element); this._textSize = Xb.getTextSize(a, b), this._fillColor = this._network.getAlarmFillColor(this._element); var c = Ib.network.AlarmAttachment.superClass.updateMeasure.call(this); Xb.drawText(c, b, this._contentRect, a, this.getStyle('alarm.color')) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('alarm.corner.radius') }, getPointerLength: function() { return this.getStyle('alarm.pointer.length') }, getPointerWidth: function() { return this.getStyle('alarm.pointer.width') }, getPosition: function() { return this.getStyle('alarm.position') }, getXOffset: function() { return this.getStyle('alarm.xoffset') }, getYOffset: function() { return this.getStyle('alarm.yoffset') }, getPadding: function() { return this.getStyle('alarm.padding') }, getPaddingLeft: function() { return this.getStyle('alarm.padding.left') }, getPaddingRight: function() { return this.getStyle('alarm.padding.right') }, getPaddingTop: function() { return this.getStyle('alarm.padding.top') }, getPaddingBottom: function() { return this.getStyle('alarm.padding.bottom') }, getDirection: function() { return this.getStyle('alarm.direction') }, isFill: function() { return this._fillColor != null }, getFillColor: function() { return this._fillColor }, getGradient: function() { return this.getStyle('alarm.gradient') }, getGradientColor: function() { return this.getStyle('alarm.gradient.color') }, getOutlineWidth: function() { return this.getStyle('alarm.outline.width') }, getOutlineColor: function() { return this.getStyle('alarm.outline.color') }, getCap: function() { return this.getStyle('alarm.cap') }, getJoin: function() { return this.getStyle('alarm.join') }, getAlpha: function() { return this.getStyle('alarm.alpha') }, isShadowable: function() { return this.getStyle('alarm.shadowable') } }), Ib.network.LinkHandlerAttachment = function(a, b) { Ib.network.LinkHandlerAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.LinkHandlerAttachment', Ib.network.BasicAttachment, { updateMeasure: function() { var a = this.getFont('link.handler.font'), b = this._network.getLinkHandlerLabel(this._element); this._textSize = Xb.getTextSize(a, b); var c = Ib.network.LabelAttachment.superClass.updateMeasure.call(this); Xb.drawText(c, b, this._contentRect, a, this.getStyle('link.handler.color')) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('link.handler.corner.radius') }, getPointerLength: function() { return this.getStyle('link.handler.pointer.length') }, getPointerWidth: function() { return this.getStyle('link.handler.pointer.width') }, getPosition: function() { return this.getStyle('link.handler.position') }, getXOffset: function() { return this.getStyle('link.handler.xoffset') }, getYOffset: function() { return this.getStyle('link.handler.yoffset') }, getPadding: function() { return this.getStyle('link.handler.padding') }, getPaddingLeft: function() { return this.getStyle('link.handler.padding.left') }, getPaddingRight: function() { return this.getStyle('link.handler.padding.right') }, getPaddingTop: function() { return this.getStyle('link.handler.padding.top') }, getPaddingBottom: function() { return this.getStyle('link.handler.padding.bottom') }, getDirection: function() { return this.getStyle('link.handler.direction') }, isFill: function() { return this.getStyle('link.handler.fill') }, getFillColor: function() { return this.getStyle('link.handler.fill.color') }, getGradient: function() { return this.getStyle('link.handler.gradient') }, getGradientColor: function() { return this.getStyle('link.handler.gradient.color') }, getOutlineWidth: function() { return this.getStyle('link.handler.outline.width') }, getOutlineColor: function() { return this.getStyle('link.handler.outline.color') }, getCap: function() { return this.getStyle('link.handler.cap') }, getJoin: function() { return this.getStyle('link.handler.join') }, getAlpha: function() { return this.getStyle('link.handler.alpha') }, isShadowable: function() { return this.getStyle('link.handler.shadowable') } }), Ib.network.EditAttachment = function(a, b) { Ib.network.EditAttachment.superClass.constructor.call(this, a, b), this._attachmentDiv = Wb.createDiv(), this._view.appendChild(this._attachmentDiv) }, Jb.ext('twaver.network.EditAttachment', Ib.network.Attachment, { updateMeasure: function() { Ib.network.EditAttachment.superClass.updateMeasure.call(this), this._viewRect = null, this._element instanceof Ld && this._addResizingPoint(this._element), !(this._network.isRotatable(this._element) && this._element instanceof Ld) || this._element instanceof Ib.ShapeNode || this._element instanceof Ib.Grid || this._element instanceof Ib.Group || this._addRotatePoint(this._element), this._element instanceof Ib.ShapeNode && (this._addResizingPoint(this._element), this._addShapeNodePoint(this._element)), this._ui instanceof Ib.network.ShapeLinkUI && this._addShapeLinkPoints(this._ui), this._ui instanceof Ib.network.LinkUI && this._addLinkControlPoint(this._ui) }, _addRotatePoint: function(a) { var b = this._network.getRotatePointSize(); if (!(b <= 0)) { var c = a.getOriginalRect(); if (!this._rotateDiv) { var d = Wb.createDiv(); this._attachmentDiv.appendChild(d), this._rotateDiv = d } var e, f = this._network.getRotatePointOutlineWidth(), g = this._network.getRotatePointOutlineColor(), h = this._network.getRotatePointFillColor(), b = this._network.getRotatePointSize(), i = 2 * b, j = { x: c.x + c.width / 2 - b, y: c.y - this._network.getRotatePointOffset() - i, width: i, height: i }; e = a.angle == 0 ? j : this._getRotateRect(j, a.getAngle(), { x: c.x + c.width / 2, y: c.y + c.height / 2 }); var k = Tb.unionRect(a.getRect(), e); this._viewRect = Tb.unionRect(k, this._viewRect), Wb.setDiv(this._rotateDiv, j, h, f, g), this._rotateDiv._viewRect = e, Wb.setBorderRaidus(this._rotateDiv, i + 'px'), this._rotateAttachments(this._rotateDiv, i / 2, f) } }, _addResizingPoint: function(a) { var b = this._network.getResizePointSize(); if (!(b <= 0)) { var c = a.getOriginalRect(), d = new nd([{ x: c.x, y: c.y }, { x: c.x + c.width / 2, y: c.y }, { x: c.x + c.width, y: c.y }, { x: c.x, y: c.y + c.height / 2 }, { x: c.x + c.width, y: c.y + c.height / 2 }, { x: c.x, y: c.y + c.height }, { x: c.x + c.width / 2, y: c.y + c.height }, { x: c.x + c.width, y: c.y + c.height }]); if (!this._resizeDivs) { this._resizeDivs = new Array(); for (var e = 0; e < 8; e++) { var f = Wb.createDiv(); this._attachmentDiv.appendChild(f), this._resizeDivs[e] = f } } if (this._resizeDivs) { this._resizeRects = new Array(); for (var e = 0; e < 8; e++) { var g, h = d.get(e), i = { x: h.x - b, y: h.y - b, width: 2 * b, height: 2 * b }; g = a.getAngle() == 0 ? i : this._getRotateRect(i, a.getAngle(), { x: c.x + c.width / 2, y: c.y + c.height / 2 }), this._resizeRects[e] = g } } var j = this._network.getResizePointOutlineWidth(), k = this._network.getResizePointOutlineColor(), l = this._network.getResizePointFillColor(); this._addPoints(a.getRect(), d, j, k, l, !0) } }, _addPoints: function(a, b, c, d, e, f) { var g = f ? this._network.getResizePointSize() : this._network.getEditPointSize(); if (!(g <= 0)) { var h = g + c; Tb.grow(a, h, h), this._viewRect = Tb.unionRect(a, this._viewRect); var i, j, k, l, m = 2 * g, n = new nd(); for (i = 0, j = b.size(); j > i; i++)k = b.get(i), l = { x: k.x - g, y: k.y - g, width: m, height: m }, n.add(l); var o; if (f)o = this._resizeDivs; else { if (this._controlDivs || (this._controlDivs = new Array()), this._controlDivs.length < j) for (i = this._controlDivs.length; j > i; i++) { var p = Wb.createDiv(); this._attachmentDiv.appendChild(p), this._controlDivs[i] = p } else if (this._controlDivs.length > j) { for (i = j; i < this._controlDivs.length; i++) this._attachmentDiv.removeChild(this._controlDivs[i]); this._controlDivs.splice(j) }o = this._controlDivs } for (i = 0, j = n.size(); j > i; i++)l = n.get(i), Wb.setDiv(o[i], l, e, c, d), Wb.setBorderRaidus(o[i], (f ? '0' : m) + 'px'), this._rotateAttachments(o[i], m / 2, c, b.get(i)) } }, _rotateAttachments: function(a, b, c, d) { if (this._element instanceof Ld) { var e = this._element.getAngle(); if (e == 0) return; { var f = this._element.getOriginalRect(), g = a.style.left.split('px')[0], h = a.style.top.split('px')[0]; f.x + f.width / 2, f.y + f.height / 2 }d || (d = { x: parseFloat(g) + b + c, y: parseFloat(h) + b + c }); var i = Tb.createMatrix(e * Math.PI / 180, f.x + f.width / 2, f.y + f.height / 2), j = i.transform(d); a.style.webkitTransform = 'rotate(' + e + 'deg)', a.style.mozTransform = 'rotate(' + e + 'deg)', a.style.OTransform = 'rotate(' + e + 'deg)', a.style.msTransform = 'rotate(' + e + 'deg)', a.style.transform = 'rotate(' + e + 'deg)', a.style.left = j.x - b - c + 'px', a.style.top = j.y - b - c + 'px' } }, _addShapeLinkPoints: function(a) { this._addEditPoints(a._element.getPoints()) }, _addShapeNodePoint: function(a) { this._addEditPoints(a.getPoints()) }, _addLinkControlPoint: function(a) { if (xc.isOrthogonalLink(a._element)) { var b = a.getControlPoint(); if (b) { var c = new nd(); c.add(b), this._addEditPoints(c) } } }, _addEditPoints: function(a) { var b = Tb.getRect(a); if (b) { var c = this._network.getEditPointOutlineWidth(), d = this._network.getEditPointOutlineColor(), e = this._network.getEditPointFillColor(); this._addPoints(b, a, c, d, e, !1) } }, hit: function(a, b) { if (!Tb.containsPoint(this._viewRect, a, b)) return !1; var c; if (this._resizeDivs) for (c = this._resizeDivs.length - 1; c >= 0; c--) if (Tb.containsPoint(this._resizeRects[c], a, b)) return !0; if (this._rotateDiv && Tb.containsPoint(this._rotateDiv._viewRect, a, b)) return !0; if (this._controlDivs) for (c = this._controlDivs.length - 1; c >= 0; c--) if (Tb.containsPoint(this._controlDivs[c]._viewRect, a, b)) return !0; return !1 }, intersects: function(a) { if (!Tb.intersects(this._viewRect, a)) return !1; var b; if (this._resizeDivs) for (b = this._resizeDivs.length - 1; b >= 0; b--) if (Tb.intersects(this._resizeRects[b], a)) return !0; if (this._rotateDiv && Tb.containsPoint(this._rotateDiv._viewRect, a)) return !0; if (this._controlDivs) for (b = this._controlDivs.length - 1; b >= 0; b--) if (Tb.intersects(this._controlDivs[b]._viewRect, a)) return !0; return Tb.intersects(this._viewRect, a) ? !1 : !1 }, _getRotateRect: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x, c.y), e = { x: a.x + a.width / 2, y: a.y + a.height / 2 }, f = d.transform(e), g = new Ib.List([{ x: f.x - a.width / 2, y: f.y - a.height / 2 }, { x: f.x + a.width / 2, y: f.y - a.height / 2 }, { x: f.x + a.width / 2, y: f.y + a.height / 2 }, { x: f.x - a.width / 2, y: f.y + a.height / 2 }]); return Tb.getRect(g) } }), Ib.network.IconsAttachment = function(a, b) { Ib.network.IconsAttachment.superClass.constructor.call(this, a, b), this._iconsCanvas = null }, Jb.ext('twaver.network.IconsAttachment', Ib.network.Attachment, { isShadowable: function() { return Ed.ATTACHMENT_SHADOWABLE }, updateMeasure: function() { Ib.network.IconsAttachment.superClass.updateMeasure.call(this); var a = this._network.getIconsNames(this._element); if (a && a.length != 0) { var b = this._network.getIconsColors(this._element), c = this._element.getStyle('icons.orientation'), d = this._element.getStyle('icons.position'), e = this._element.getStyle('icons.xoffset'); e = e instanceof Array ? e[0] : e; var f = this._element.getStyle('icons.yoffset'); f = f instanceof Array ? f[0] : f; var g = this._element.getStyle('icons.xgap'); g = g instanceof Array ? g[0] : g; var h = this._element.getStyle('icons.ygap'); h = h instanceof Array ? h[0] : h; var i = this._getIconsSize(a, c, g, h); if (i) { var j = this._network.getPosition(d, this._ui, i, e, f); this._viewRect = { x: j.x, y: j.y, width: i.width, height: i.height }, c === 'top' ? j.y += i.height : c === 'left' && (j.x += i.width), this._iconsCanvas || (this._iconsCanvas = Wb.createCanvas(), this._view.appendChild(this._iconsCanvas)); var k = this._ui.setShadow(this, this._iconsCanvas, Jb.clone(this._viewRect)), l = j.x, m = j.y, n = 0; for (var o in a) { var p = null, q = null; b && b.length > n && (q = b[n++]); var r = Jb.getImageAsset(a[o]); if (r != null) { if (c === 'right')p = { x: l, y: m, width: r.getWidth(), height: r.getHeight() }, l += p.width + g; else if (c === 'left')p = { x: l - r.getWidth(), y: m, width: r.getWidth(), height: r.getHeight() }, l -= p.width + g; else if (c === 'top')p = { x: l, y: m - r.getHeight(), width: r.getWidth(), height: r.getHeight() }, m -= p.height + h; else { if (c !== 'bottom') throw "Can not resolve '" + c + "' orientation"; p = { x: l, y: m, width: r.getWidth(), height: r.getHeight() }, m += p.height + h }Nc(k, r.getImage(q, p.width, p.height), q, p, this._element, this._network) } } } } }, _getIconsSize: function(a, b, c, d) { var e = 0, f = 0, g = null, h = null, i = null; for (var j in a) if (h = Jb.getImageAsset(a[j])) { if (b === 'right')g = { x: e, y: f, width: h.getWidth(), height: h.getHeight() }, e += g.width + c; else if (b === 'left')g = { x: e - h.getWidth(), y: f, width: h.getWidth(), height: h.getHeight() }, e -= g.width + c; else if (b === 'top')g = { x: e, y: f - h.getHeight(), width: h.getWidth(), height: h.getHeight() }, f -= g.height + d; else { if (b !== 'bottom') throw "Can not resolve '" + b + "' orientation"; g = { x: e, y: f, width: h.getWidth(), height: h.getHeight() }, f += g.height + d }i = i == null ? Jb.clone(g) : Tb.unionRect(i, g) } return i ? { width: Math.abs(i.width), height: Math.abs(i.height) } : null } }), Ib.network.HTMLBasicAttachment = function(a, b) { function c(a, b, c, d, e, f, g) { c || (c = this._origin.x), d || (d = this._origin.y), e || (e = this._location.x), f || (f = this._location.y), a = a - c - e, b = b - d - f; var h = Ib.Util.transformPoint({ x: c + e, y: d + f }, g ? this._radian : -this._radian, a, b).point; return h }Ib.network.HTMLBasicAttachment.superClass.constructor.call(this, a, b), this._roundRect = { x: 0, y: 0, width: 0, height: 0 }, this._contentRect = { x: 0, y: 0, width: 0, height: 0 }, this._triangleDiv = Ib.Util.createDiv(), this._roundDiv = Ib.Util.createDiv(), this._contentDiv = Ib.Util.createDiv(), Ib.Util.setCSSStyle(this._triangleDiv, 'border-style', 'solid'), Ib.Util.setCSSStyle(this._contentDiv, 'white-space', 'nowrap'); var d = this; this.hit = function(a, b) { if (this._radian && this._origin) { var e = c.call(d, a, b); a = e.x, b = e.y } return Ib.Util.containsPoint(this._roundRect, a, b) || Ib.Util.containsPoint(this._pointerRect, a, b) }, this.intersects = function(a) { var b = { x: a.x, y: a.y }, e = { x: a.x + a.width, y: a.y }, f = { x: a.x, y: a.y + a.height }, g = { x: a.x + a.width, y: a.y + a.height }; if (this._radian && this._origin) { if (a.width * a.height > 50) return !1; b = c.call(d, b.x, b.y), e = c.call(d, e.x, e.y), f = c.call(d, f.x, f.y), g = c.call(d, g.x, g.y) } return a = Ib.Util.getRect([b, e, f, g]), Ib.Util.intersects(this._roundRect, a) || Ib.Util.intersects(this._pointerRect, a) }, this.getContentWidth = function() { return this._contentDiv.scrollWidth || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'width')) }, this.getContentHeight = function() { return this._contentDiv.scrollHeight || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'height')) }, this._view.appendChild(this._roundDiv), this._roundDiv.appendChild(this._contentDiv) }, Ib.Util.ext('twaver.network.HTMLBasicAttachment', Ib.network.BasicAttachment, { calculateMeasure: function() { var a = this.getContentWidth(), b = this.getContentHeight(), c = Math.min(this.getCornerRadius(), b / 2), d = this.getPointerLength(), e = this.getPointerWidth(), f = this.getPosition(), g = this.getXOffset(), h = this.getYOffset(); this._contentRect.width = a, this._contentRect.height = b, this._contentRect.x = c; var i = this._roundRect; i.width = a + 2 * c, i.height = b; var j; if (d > 0) { var k = this.getDirection(); j = this._network.getPosition(f, this._ui, null, g, h); if (k === 'aboveleft') { i.y = j.y - d - i.height, i.x = j.x - (i.width - c), this._pointers = [j, { x: j.x, y: j.y - d }, { x: j.x - Math.min(e, a), y: j.y - d }]; var l = d / 2, m = Math.min(e, a) / 2, n = this.getFillColor(); this._triangleBorderWidthStyle = l + 'px ' + m + 'px ' + l + 'px ' + m + 'px', this._triangleBorderColorStyle = n + ' ' + n + ' transparent transparent', this._triangleDivLocation = this._pointers[2] } else if (k === 'aboveright') { i.y = j.y - d - i.height, i.x = j.x - c, this._pointers = [j, { x: j.x, y: j.y - d }, { x: j.x + Math.min(e, a), y: j.y - d }]; var l = d / 2, m = Math.min(e, a) / 2, n = this.getFillColor(); this._triangleBorderWidthStyle = l + 'px ' + m + 'px ' + l + 'px ' + m + 'px', this._triangleBorderColorStyle = n + ' transparent transparent ' + n, this._triangleDivLocation = this._pointers[1] } else if (k === 'belowleft') { i.y = j.y + d, i.x = j.x - (i.width - c), this._pointers = [j, { x: j.x, y: j.y + d }, { x: j.x - Math.min(e, a), y: j.y + d }]; var l = d / 2, m = Math.min(e, a) / 2, n = this.getFillColor(); this._triangleBorderWidthStyle = l + 'px ' + m + 'px ' + l + 'px ' + m + 'px', this._triangleBorderColorStyle = ' transparent ' + n + ' ' + n + ' transparent', this._triangleDivLocation = { x: this._pointers[2].x, y: j.y } } else if (k === 'belowright') { i.y = j.y + d, i.x = j.x - c, this._pointers = [j, { x: j.x, y: j.y + d }, { x: j.x + Math.min(e, a), y: j.y + d }]; var l = d / 2, m = Math.min(e, a) / 2, n = this.getFillColor(); this._triangleBorderWidthStyle = l + 'px ' + m + 'px ' + l + 'px ' + m + 'px', this._triangleBorderColorStyle = 'transparent transparent ' + n + ' ' + n, this._triangleDivLocation = this._pointers[0] } else if (k === 'above') { i.y = j.y - d - i.height, i.x = j.x - i.width / 2, this._pointers = [j, { x: j.x - Math.min(e, a) / 2, y: j.y - d }, { x: j.x + Math.min(e, a) / 2, y: j.y - d }]; var l = d, m = Math.min(e, a) / 2, n = this.getFillColor(); this._triangleBorderWidthStyle = l + 'px ' + m + 'px 0px ' + m + 'px', this._triangleBorderColorStyle = n + ' transparent transparent transparent', this._triangleDivLocation = this._pointers[1] } else if (k === 'below') { i.y = j.y + d, i.x = j.x - i.width / 2, this._pointers = [j, { x: j.x - Math.min(e, a) / 2, y: j.y + d }, { x: j.x + Math.min(e, a) / 2, y: j.y + d }]; var l = d, m = Math.min(e, a) / 2, n = this.getFillColor(); this._triangleBorderWidthStyle = '0px ' + m + 'px ' + l + 'px ' + m + 'px', this._triangleBorderColorStyle = 'transparent transparent ' + n + ' transparent ', this._triangleDivLocation = { x: this._pointers[1].x, y: j.y } } else if (k === 'left') { i.y = j.y - i.height / 2, i.x = j.x - i.width - d, this._pointers = [j, { x: j.x - d, y: j.y - Math.min(e, b) / 2 }, { x: j.x - d, y: j.y + Math.min(e, b) / 2 }]; var l = Math.min(e, b) / 2, m = d, n = this.getFillColor(); this._triangleBorderWidthStyle = l + 'px 0px ' + l + 'px ' + m + 'px', this._triangleBorderColorStyle = 'transparent transparent  transparent ' + n, this._triangleDivLocation = this._pointers[1] } else { if (k !== 'right') throw "Can not resolve '" + k + "' attachment direction"; i.y = j.y - i.height / 2, i.x = j.x + d, this._pointers = [j, { x: j.x + d, y: j.y - Math.min(e, b) / 2 }, { x: j.x + d, y: j.y + Math.min(e, b) / 2 }]; var l = Math.min(e, b) / 2, m = d, n = this.getFillColor(); this._triangleBorderWidthStyle = l + 'px ' + m + 'px ' + l + 'px 0px', this._triangleBorderColorStyle = 'transparent ' + n + ' transparent  transparent ', this._triangleDivLocation = { x: j.x, y: this._pointers[1].y } } } else j = this._network.getPosition(f, this._ui, { width: i.width, height: i.height }, g, h), i.x = j.x, i.y = j.y, this._pointers = null; this._location = j }, updateMeasure: function() { if (this.calculateMeasure(), this._ui.isShadowable() && this.isShadowable() ? Ib.Util.setCSSStyle(this._roundDiv, 'text-shadow', this._ui._shadowXOffset + 'px ' + this._ui._shadowYOffset + 'px ' + this._ui._shadowBlur + 'px ' + this._ui._shadowColor) : Ib.Util.removeCSSStyle(this._roundDiv, 'text-shadow'), this._pointerRect = Ib.Util.getRect(this._pointers), this._viewRect = Ib.Util.unionRect(this._pointerRect, this._roundRect), Ib.Util.setCSSStyle(this._contentDiv, 'left', this._contentRect.x + 'px'), Ib.Util.setCSSStyle(this._contentDiv, 'top', this._contentRect.y + 'px'), Ib.Util.setCSSStyle(this._roundDiv, 'left', this._roundRect.x + 'px'), Ib.Util.setCSSStyle(this._roundDiv, 'top', this._roundRect.y + 'px'), Ib.Util.setCSSStyle(this._roundDiv, 'width', this._roundRect.width + 'px'), Ib.Util.setCSSStyle(this._roundDiv, 'height', this._roundRect.height + 'px'), Ib.Util.setCSSStyle(this._roundDiv, 'background', this.isFill() ? this.getFillColor() : null), Ib.Util.setCSSStyle(this._roundDiv, '-webkit-border-radius', this.getCornerRadius() + 'px'), Ib.Util.setCSSStyle(this._roundDiv, '-moz-border-radius', this.getCornerRadius() + 'px'), Ib.Util.setCSSStyle(this._roundDiv, 'border-radius', this.getCornerRadius() + 'px'), this._pointers ? (Ib.Util.setCSSStyle(this._triangleDiv, 'left', this._triangleDivLocation.x + 'px'), Ib.Util.setCSSStyle(this._triangleDiv, 'top', this._triangleDivLocation.y + 'px'), Ib.Util.setCSSStyle(this._triangleDiv, 'border-width', this._triangleBorderWidthStyle), Ib.Util.setCSSStyle(this._triangleDiv, 'border-color', this._triangleBorderColorStyle), this._view.appendChild(this._triangleDiv)) : this._triangleDiv.parentNode == this._view && this._view.removeChild(this._triangleDiv), this._element.getStyle('label.rotatable') && this.label) { var a = this._ui.getFromPoint(), b = this._ui.getToPoint(), c = this._ui.getLinkPoints(); c.size() % 2 == 0 && (a = c.get(c.size() / 2 - 1), b = c.get(c.size() / 2)), this._radian = a.x > b.x ? Ib.Util.getRadiansBetweenLines(b, a) : Ib.Util.getRadiansBetweenLines(a, b), this._origin = { x: this._contentRect.width / 2, y: 0 }; var d = 'rotate(' + Ib.Util.toDegrees(this._radian) + 'deg)', e = this._origin.x + 'px ' + this._origin.y + 'px'; Ib.Util.isChrome || Ib.Util.isSafari ? (Ib.Util.setCSSStyle(this._roundDiv, '-webkit-transform', d), Ib.Util.setCSSStyle(this._roundDiv, '-webkit-transform-origin', e)) : Ib.Util.isIE ? (Ib.Util.setCSSStyle(this._roundDiv, '-ms-transform', d), Ib.Util.setCSSStyle(this._roundDiv, '-ms-transform-origin', e)) : (Ib.Util.setCSSStyle(this._roundDiv, 'transform', d), Ib.Util.setCSSStyle(this._roundDiv, 'transform-origin', e)) } else Ib.Util.removeCSSStyle(this._roundDiv, '-webkit-transform'), Ib.Util.removeCSSStyle(this._roundDiv, '-webkit-transform-origin'), Ib.Util.removeCSSStyle(this._roundDiv, '-ms-transform'), Ib.Util.removeCSSStyle(this._roundDiv, '-ms-transform-origin'), Ib.Util.removeCSSStyle(this._roundDiv, 'transform'), Ib.Util.removeCSSStyle(this._roundDiv, 'transform-origin'), delete this._origin, delete this._radian } }), Ib.network.HTMLLabelAttachment = function(a, b) { Ib.network.HTMLBasicAttachment.call(this, a, b), this.label = !0 }, Ib.Util.ext('twaver.network.HTMLLabelAttachment', Ib.network.LabelAttachment, { updateMeasure: function() { var a = this.getFont('label.font'), b = this.getLabel(); this._contentDiv.innerHTML = b, Ib.Util.setCSSStyle(this._contentDiv, 'font', a), Ib.network.HTMLBasicAttachment.prototype.updateMeasure.call(this), Ib.Util.removeCSSStyle(this._contentDiv, 'font') }, calculateMeasure: Ib.network.HTMLBasicAttachment.prototype.calculateMeasure }), Ib.network.HTMLAlarmAttachment = function(a, b) { Ib.network.HTMLBasicAttachment.call(this, a, b), this.alarm = !0 }, Ib.Util.ext('twaver.network.HTMLAlarmAttachment', Ib.network.AlarmAttachment, { updateMeasure: function() { var a = this.getFont('alarm.font'); this._contentDiv.innerHTML = this._network.getAlarmLabel(this._element), Ib.Util.setCSSStyle(this._contentDiv, 'font', a), this._fillColor = this._network.getAlarmFillColor(this._element), Ib.network.HTMLBasicAttachment.prototype.updateMeasure.call(this), Ib.Util.removeCSSStyle(this._contentDiv, 'font') }, calculateMeasure: Ib.network.HTMLBasicAttachment.prototype.calculateMeasure }), Ib.network.NodeUI = function(a, b) { Ib.network.NodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.NodeUI', Ib.network.ElementUI, { createBodyRect: function() { return this._element.getRect() }, invalidate: function(a) { Ib.network.NodeUI.superClass.invalidate.call(this, a); var b = this._element.getAgentLinks(); b && b.forEach(function(a) { this._network.invalidateElementUI(a, !1) }, this) }, updateMeasure: function() {
    Ib.network.NodeUI.superClass.updateMeasure.call(this); var a = this.getStyle('vector.shape'), b = this.getBodyRect(); this._hotSpot = Tb.getHotSpot(b.x, b.y, b.width, b.height, a), this.drawBody(), this._outerColor && this.drawOuterBorder(),
    !this._editAttachment && this.getStyle('select.style') === 'border' && this._network.isSelected(this._element) && this.drawSelectBorder(), this.cleanUp(['_selectCanvas', '_nodeCanvas', '_nodeImage', '_nodeComponent', '_vectorCanvas', '_outerCanvas']); var c = this._element.getParent(); c instanceof Nd && this._network.invalidateElementUI(c, !1)
  }, drawBody: function() { var a = this.getStyle('body.type'); a === 'default' ? this.drawDefaultBody() : a === 'vector' ? this.drawVectorBody() : a === 'default.vector' ? (this.drawVectorBody(), this.drawDefaultBody()) : a === 'vector.default' ? (this.drawDefaultBody(), this.drawVectorBody()) : this.addBodyBounds({ x: this._element.getX(), y: this._element.getY(), width: 0, height: 0 }) }, drawOuterBorder: function() { var a = this._element, b = a.getStyle('outer.width'); if (b > 0) { var c = this.getBodyRect(); Tb.addPadding(c, a, 'outer.padding', 1), this._outerCanvas || (this._outerCanvas = Wb.createCanvas()); var d = Jb.clone(c); Tb.grow(d, b / 2, b / 2); var e = Wb.setCanvas(this._outerCanvas, d); e.lineWidth = b, e.lineCap = a.getStyle('outer.cap'), e.lineJoin = a.getStyle('outer.join'), e.strokeStyle = this._outerColor, Xb.drawVector(e, a.getStyle('outer.shape'), null, c), e.stroke(), this.addComponent(this._outerCanvas), this.addBodyBounds(d) } }, drawSelectBorder: function() { var a = this._element, b = a.getStyle('select.width'); if (b > 0) { var c = this.getBodyRect(); c = Jb.clone(c); var d = a.getStyle('select.physicalZoom') ? 1 : this._network.getGraphicsZoom(); Tb.addPadding(c, a, 'select.padding', 1 / d), this._selectCanvas || (this._selectCanvas = Wb.createCanvas()), Tb.grow(c, b / 2 / d, b / 2 / d); var e = Wb.setCanvas(this._selectCanvas, bounds); e.lineWidth = b / d, e.lineCap = a.getStyle('select.cap'), e.lineJoin = a.getStyle('select.join'), e.strokeStyle = a.getStyle('select.color'), Xb.drawVector(e, a.getStyle('select.shape'), null, c), e.stroke(), this.addComponent(this._selectCanvas), this.addBodyBounds(bounds) } }, drawDefaultBody: function() { var a = this._element, b = Jb.getImageAsset(a.getImage()), c = this.getBodyRect(); if (!b) return this.addBodyBounds(c), void (this._currentImageAsset = null); if (Tb.addPadding(c, this._element, 'image.padding', 1), b.getImage()) { this._nodeCanvas || (this._nodeCanvas = Wb.createCanvas()); var d = Jb.clone(c), e = this.setShadow(this, this._nodeCanvas, d); a.getAngle() != 0 && (c = a.getOriginalRect(), Ib.Util.rotateCanvas(e, c, a.getAngle())), Nc(e, a.getImage(), this.getInnerColor(), c, a, this._network), c = d, this.addComponent(this._nodeCanvas) } else if (b.getSrc()) this._nodeImage || (this._nodeImage = Wb.createImg()), Wb.setImg(this._nodeImage, b.getSrc(), c), this.addComponent(this._nodeImage); else { if (!b.getFunction()) throw "ImageAsset '" + a.getImage() + " ' is empty"; this._nodeComponent = this._currentImageAsset !== b ? b.getFunction()(this, c) : b.getFunction()(this, c, this._nodeComponent), this.addComponent(this._nodeComponent), this._nodeComponent._viewRect = Jb.clone(c) } this.addBodyBounds(c), this._currentImageAsset = b }, hit: function(a, b) { if (this._network._transparentSelectionEnable) { var c = this.getBodyRect(); if (Jb.math.containsPoint(c, a, b)) return !0 } return this.hitCanvas(a, b, ['_nodeCanvas', '_outerCanvas', '_vectorCanvas']) ? !0 : this.hitComponent(a, b, ['_nodeImage', '_nodeComponent']) }, intersects: function(a) { if (this._network._transparentSelectionEnable) { var b = this.getBodyRect(); if (Jb.math.intersects(b, a)) return !0 } return this.intersectsCanvas(a, ['_nodeCanvas', '_outerCanvas', '_vectorCanvas']) ? !0 : this.intersectsComponent(a, ['_nodeImage', '_nodeComponent']) }, drawVectorBody: function() { this._vectorCanvas || (this._vectorCanvas = Wb.createCanvas()); var a = Xb.drawPath(this, this._vectorCanvas, 'vector', !0, this._element.getStyle('vector.outline.pattern')), b = this.getStyle('vector.deep'), c = this._vectorCanvas.getContext('2d'), d = this.getBodyRect(), e = this.getStyle('vector.fill.color'); if (b !== 0 && e) { var f = this._element.getAngle(); f != 0 && (d = this._element.getOriginalRect(), Ib.Util.rotateCanvas(c, d, -f), Ib.Util.rotateCanvas(c, d, f)), this.getStyle('vector.shape') === 'rectangle' && Xb.draw3DRect(c, e, b, d) } this.addBodyBounds(a), this.addComponent(this._vectorCanvas) } }), Ib.network.LinkUI = function(a, b) { Ib.network.LinkUI.superClass.constructor.call(this, a, b), this._linkCanvas = Wb.createCanvas() }, Jb.ext('twaver.network.LinkUI', Ib.network.ElementUI, { isEditable: function() { return xc.isOrthogonalLink(this._element) && this.getControlPoint() ? !0 : !1 }, createBodyRect: function() { var a = this.getHotSpot(); return a ? { x: a.x - 1, y: a.y - 1, width: 2, height: 2 } : null }, hit: function(a, b) { return this.hitCanvas(a, b, ['_linkCanvas']) }, intersects: function(a) { return this.intersectsCanvas(a, ['_linkCanvas']) }, checkAttachments: function() { Ib.network.LinkUI.superClass.checkAttachments.call(this), this.checkLinkHandlerAttachment() }, checkLinkHandlerAttachment: function() { var a = this._network.getLinkHandlerLabel(this._element); a != null && a !== '' ? this._linkHandlerAttachment || (this._linkHandlerAttachment = new Ib.network.LinkHandlerAttachment(this), this.addAttachment(this._linkHandlerAttachment)) : this._linkHandlerAttachment && (this.removeAttachment(this._linkHandlerAttachment), this._linkHandlerAttachment = null) }, getLinkHandlerAttachment: function() { return this._linkHandlerAttachment }, getLinkPoints: function() { return this._linkPoints || (this._linkPoints = this.createLinkPoints(), this._lineLength = Tb.calculateLineLength(this._linkPoints)), this._linkPoints }, invalidate: function(a) { this._linkPoints = null, this._fromPoint = null, this._toPoint = null, Ib.network.LinkUI.superClass.invalidate.call(this, a) }, getFromPosition: function(a, b) { var c = this.getFromPoint(); return c ? { x: c.x + a, y: c.y + b } : null }, getToPosition: function(a, b) { var c = this.getToPoint(); return c ? { x: c.x + a, y: c.y + b } : null }, getFromPoint: function() { return this._fromPoint || (this._fromPoint = xc.createFromPoint(this)), this._fromPoint }, getToPoint: function() { return this._toPoint || (this._toPoint = xc.createToPoint(this)), this._toPoint }, updateMeasure: function() { Ib.network.LinkUI.superClass.updateMeasure.call(this), this.drawBody() }, createLinkPoints: function() { var a = this.getFromPoint(), b = this.getToPoint(), c = this.getStyle('link.type'), d = new nd(); if (xc.isOrthogonalOrFlexionalLink(this._element))d = xc.orthogonalAndFlexional(this, c); else if (this._element.isLooped()) { var e = this._network.getElementUI(this._element.getFromAgent()); e != null && (this._hotSpot = xc.fillLoopedPoints(this, e.getBodyRect(), d)) } else { if (c !== 'arc' && c !== 'triangle' && c !== 'parallel') throw "Can not resolve link type '" + c + "'"; this._hotSpot = xc.fillBundlePoints(this, c, a, b, d) } if (this._network._linkPathFunction) { var f = this._network._linkPathFunction(this, d); f && (d = f) } return d }, drawLinePoints: function(a, b, c, d, e) { if (a.lineWidth = c, a.strokeStyle = d, this._element.getStyle('link.flow') === !0 && e && e.length > 1) { var f = new uc(a, e[0], e[1]), g = this._element.getStyle('link.flow.offset'); this._element.getStyle('link.flow.converse') ? g < e[0] ? f.overflow = e[0] - g : g >= e[0] && g <= e[0] + e[1] ? (f.overflow = e[1] - (g - e[0]), f.overflow && (f.isLine = !1)) : (g -= e[0] + e[1], f.overflow = e[0] - g) : g <= e[1] ? (f.overflow = g, g && (f.isLine = !1)) : g > e[1] && g <= e[0] + e[1] ? f.overflow = g - e[1] : (g -= e[0] + e[1], g && (f.isLine = !1), f.overflow = g), this._element._styleMap['link.flow.offset'] = g, a.beginPath(), Xb._drawLine(b, a), a.stroke(), a.shadowColor = 'transparent', a.beginPath(); var h = this._element.getStyle('link.flow.color'); h = h || Ed.NETWORK_LINK_FLOW_COLOR, a.strokeStyle = h, Xb._drawLine(b, f), a.stroke(), a.shadowColor = this._shadowColor } else a.beginPath(), Xb.drawLinePoints(a, b, e), a.stroke() }, drawBody: function() { var a = this.getLinkPoints(); if (a && !(a.size() < 2)) { var b = this._element, c = Tb.getLineRect(a), d = b.getStyle('link.width'), e = d; if (this._outerColor) { var f = b.getStyle('outer.width'); e += 2 * f } var g = !this._editAttachment && b.getStyle('select.style') === 'border' && this._network.isSelected(this._element); if (g) { var h = b.getStyle('select.width'); e += 2 * h }Tb.grow(c, e / 2, e / 2), b.getStyle('arrow.from') && (c = Tb.unionRect(c, od.getArrowRect(a, !0, b.getStyle('arrow.from.shape'), b.getStyle('arrow.from.width'), b.getStyle('arrow.from.height'), b.getStyle('arrow.from.xoffset'), b.getStyle('arrow.from.yoffset')))), b.getStyle('arrow.to') && (c = Tb.unionRect(c, od.getArrowRect(a, !1, b.getStyle('arrow.to.shape'), b.getStyle('arrow.to.width'), b.getStyle('arrow.to.height'), b.getStyle('arrow.to.xoffset'), b.getStyle('arrow.to.yoffset')))); var i = this.setShadow(this, this._linkCanvas, c); i.lineCap = b.getStyle('link.cap'), i.lineJoin = b.getStyle('link.join'); var j = b.getStyle('link.pattern'); g && this.drawLinePoints(i, a, e, b.getStyle('select.color'), j), this._outerColor && this.drawLinePoints(i, a, d + 2 * f, this._outerColor, j), this.drawLinePoints(i, a, d, this._innerColor || b.getStyle('link.color'), j), this.addBodyBounds(c), this.addComponent(this._linkCanvas), od.drawLinkArrow(this, i, a) } }, getControlPoint: function() { return xc.getControlPoint(this._element, this) }, setControlPoint: function(a) { if (a) { var b = this.getStyle('link.type'); if (xc.hasControlPoint(b)) { var c = xc.getLinkSourceBounds(this), d = xc.getLinkTargetBounds(this); xc.setParamsByControlPoint(a, c, d, b, this._element) } } }, getLineLength: function() { return this._lineLength } }), Ib.network.HTMLLinkUI = function(a, b) { Ib.network.HTMLLinkUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.HTMLLinkUI', Ib.network.LinkUI, { checkAttachments: function() { Ib.network.LinkUI.prototype.checkAttachments.call(this) }, checkLabelAttachment: function() { var a = this._element.getStyle('attachment.label.style'); if (a && a === 'none') return void Ib.network.HTMLLinkUI.superClass.checkLabelAttachment.call(this); var b = this._network.getLabel(this._element); b != null && b !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.network.HTMLLabelAttachment(this), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkAlarmAttachment: function() { var a = this._element.getStyle('attachment.alarm.style'); if (a && a === 'none') return void Ib.network.HTMLLinkUI.superClass.checkAlarmAttachment.call(this); var b = this._network.getAlarmLabel(this._element); b != null && b !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.network.HTMLAlarmAttachment(this, !1), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) } }), Ib.network.GroupUI = function(a, b) { Ib.network.GroupUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.GroupUI', Ib.network.NodeUI, { isEditable: function() { return !this._element.isExpanded() }, drawBody: function() { this.getBodyRect(); this._shapeRect ? this.drawExpandedGroup() : Ib.network.GroupUI.superClass.drawBody.call(this) }, drawExpandedGroup: function() { this._nodeCanvas || (this._nodeCanvas = Wb.createCanvas()); var a = Xb.drawPath(this, this._nodeCanvas, 'group', !1, this._element.getStyle('vector.outline.pattern')), b = this.getStyle('group.deep'), c = this.getStyle('group.fill.color'); b !== 0 && c && this.getStyle('group.shape') === 'rectangle' && Xb.draw3DRect(this._nodeCanvas.getContext('2d'), c, b, this._bodyRect), this.addBodyBounds(a), this.addComponent(this._nodeCanvas) }, getChildrenRects: function() { return this._network.getGroupChildrenRects(this._element) }, createBodyRect: function() { this._shapeRect = null; var a = this._element; if (a.isExpanded()) { var b = this.getChildrenRects(); if (!b.isEmpty()) { var c = a.getStyle('group.shape'), d = Ub[c]; if (!d) throw "Can not resolve group shape '" + c + "'"; this._shapeRect = d(b) } } return this._shapeRect ? (Tb.addPadding(this._shapeRect, a, 'group.padding', 1), this._shapeRect) : Ib.network.GroupUI.superClass.createBodyRect.call(this) } }), Ib.network.GridUI = function(a, b) { Ib.network.GridUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.GridUI', Ib.network.NodeUI, { drawDefaultBody: function() { this._element.getImage() ? Ib.network.GridUI.superClass.drawDefaultBody.call(this) : this.drawGridBody() }, drawGridBody: function() { var a = this.getStyle('grid.fill'), b = this.getStyle('grid.deep'), c = this.getStyle('grid.cell.deep'); if (a || b !== 0 || c !== 0) { var d = this.getBodyRect(), e = this.getDyeColor('grid.fill.color'); this._nodeCanvas || (this._nodeCanvas = Wb.createCanvas()); var f = Jb.clone(d), g = this.setShadow(this, this._nodeCanvas, f); if (g.rect(d.x, d.y, d.width, d.height), this.addComponent(this._nodeCanvas), a && (g.fillStyle = e, g.fill()), b != 0 && Xb.draw3DRect(g, e, b, d.x, d.y, d.width, d.height), c != 0) for (var h = this.getStyle('grid.row.count'), i = this.getStyle('grid.column.count'), j = 0; h > j; j++) for (var k = 0; i > k; k++) { var l = this._element.getCellRect(j, k); l != null && Xb.draw3DRect(g, e, c, l.x, l.y, l.width, l.height) } this.addBodyBounds(f) } } }), Ib.network.ShapeNodeUI = function(a, b) { Ib.network.ShapeNodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.ShapeNodeUI', Ib.network.NodeUI, { drawDefaultBody: function() { if (this._element._points.size() < 2) return void this.addBodyBounds({ x: this._element.getX(), y: this._element.getY(), width: 0, height: 0 }); this._nodeCanvas || (this._nodeCanvas = Wb.createCanvas()); var a = Xb.drawPath(this, this._nodeCanvas, 'vector', !0, this._element.getStyle('vector.outline.pattern'), this._element._points, this._element._segments, this._element.getStyle('shapenode.closed')); this.addBodyBounds(a), this.addComponent(this._nodeCanvas), od.drawLinkArrow(this, this._nodeCanvas.getContext('2d'), Tb.getPointObject(this._element._points, this._element._segments)) }, drawSelectBorder: function() { var a = this._element, b = a.getStyle('select.width'); if (b > 0) { var c = this.getBodyRect(); c = Jb.clone(c); var d = a.getStyle('select.physicalZoom') ? 1 : this._network.getGraphicsZoom(); Tb.addPadding(c, a, 'select.padding', 1 / d); var e = a.getStyle('vector.outline.width'); e > 0 && Tb.grow(c, e / 2, e / 2), this._selectCanvas || (this._selectCanvas = Wb.createCanvas()), Tb.grow(c, b / 2 / d, b / 2 / d); var f = Wb.setCanvas(this._selectCanvas, c); f.lineWidth = b / d, f.lineCap = a.getStyle('select.cap'), f.lineJoin = a.getStyle('select.join'), f.strokeStyle = a.getStyle('select.color'), Xb.drawVector(f, a.getStyle('select.shape'), null, c), f.stroke(), this.addComponent(this._selectCanvas), this.addBodyBounds(bounds) } } }), Ib.network.ShapeLinkUI = function(a, b) { Ib.network.ShapeLinkUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.ShapeLinkUI', Ib.network.LinkUI, { isEditable: function() { return !0 }, createLinkPoints: function() { var a = this.getFromPoint(), b = this.getToPoint(), c = new nd(), d = this.getStyle('shapelink.type'); c.add(a), this._element._points != null && c.addAll(this._element._points), c.add(b); var e = c.size(), f = Math.floor(e / 2); if (e % 2 === 0) { var g = c.get(f), h = c.get(f - 1); this._hotSpot = { x: (g.x + h.x) / 2, y: (g.y + h.y) / 2 } } else this._hotSpot = Jb.clone(c.get(f)); var i, j, k; if (d === 'lineto');else if (d === 'quadto') { for (i = new nd(c.get(0)), j = 1, e = c.size(); e > j; j++)i.add(e - 1 > j ? new nd([c.get(j++), c.get(j)]) : c.get(j)); c = i } else if (d === 'cubicto') { for (i = new nd(c.get(0)), j = 1, e = c.size(); e > j; j++)i.add(e - 2 > j ? new nd([c.get(j++), c.get(j++), c.get(j)]) : e - 1 > j ? new nd([c.get(j++), c.get(j)]) : c.get(j)); c = i } else { if (d !== 'orthogonalto') throw "Can not resolve shapelink type '" + d + "'"; for (k = c.get(0), i = new nd(k), j = 1, e = c.size(); e > j; j++) if (e - 1 > j) { var l = Jb.clone(c.get(j)), m = l.x, n = l.y, o = m - k.x, p = n - k.y; Math.abs(o) > Math.abs(p) ? (l.x = m, l.y = k.y) : (l.x = k.x, l.y = n), k = l, i.add(k) } else i.add(c.get(j)); c = i } return c } }), Ib.network.RotatableNodeUI = function(a, b) { Ib.network.RotatableNodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.network.RotatableNodeUI', Ib.network.NodeUI, { isEditable: function() { return !1 }, drawDefaultBody: function() { var a = this._element, b = Jb.getImageAsset(a.getImage()), c = this.getBodyRect(); if (!b) return this.addBodyBounds(c), void (this._currentImageAsset = null); if (Tb.addPadding(c, this._element, 'image.padding', 1), b.getImage()) { this._nodeCanvas || (this._nodeCanvas = Wb.createCanvas()); var d = Jb.clone(c), e = this.setShadow(this, this._nodeCanvas, d), f = this._element._getOrignalWidth(), g = this._element._getOrignalHeight(), h = this._element._getRotateRect(); e.save(), e.translate(c.x - h.x + f / 2, c.y - h.y + g / 2), e.rotate(this._element._angle * Math.PI / 180); var c = { x: -f / 2, y: -g / 2, width: f, height: g }; Nc(e, b.getImage(this._innerColor, c.width, c.height), this._innerColor, c, a, this._network), e.restore(), this.addComponent(this._nodeCanvas) } else if (b.getSrc());else if (!b.getFunction()) throw "ImageAsset '" + a.getImage() + " ' is empty"; this.addBodyBounds(c), this._currentImageAsset = b } }), Ib.network.HTMLNodeUI = function(a, b) { Ib.network.HTMLNodeUI.superClass.constructor.call(this, a, b) }, Ib.Util.ext('twaver.network.HTMLNodeUI', Ib.network.NodeUI, { checkAttachments: function() { Ib.network.NodeUI.prototype.checkAttachments.call(this) }, checkLabelAttachment: function() { var a = this._element.getStyle('attachment.label.style'); if (a && a === 'none') return void Ib.network.HTMLNodeUI.superClass.checkLabelAttachment.call(this); var b = this._network.getLabel(this._element); b != null && b !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.network.HTMLLabelAttachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkAlarmAttachment: function() { var a = this._element.getStyle('attachment.alarm.style'); if (a && a === 'none') return void Ib.network.HTMLNodeUI.superClass.checkAlarmAttachment.call(this); var b = this._network.getAlarmLabel(this._element); b != null && b !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.network.HTMLAlarmAttachment(this, !1), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) } }), Ib.network.interaction.BaseInteraction = function(a) { this.network = a }, Jb.ext('twaver.network.interaction.BaseInteraction', Object, { setUp: function() {}, tearDown: function() {}, addListener: function() { for (var a = 0; a < arguments.length; a++) { var b = arguments[a]; Wb.addEventListener(b, 'handle_' + b, this.network.getView(), this) } }, removeListener: function() { for (var a = 0; a < arguments.length; a++)Wb.removeEventListener(arguments[a], this.network.getView(), this) }, _handle_mousedown: function(a) { a.button === 0 && (this._startLogical = this.network.getLogicalPoint(a), this._startClient = Wb.getClientPoint(a), this._startLogical && Wb.handle_mousedown(this, a)) }, _handle_mousemove: function(a) { this._endLogical = { x: this._startLogical.x + (a.clientX - this._startClient.x) / this.network.getZoom(), y: this._startLogical.y + (a.clientY - this._startClient.y) / this.network.getZoom() } }, _handle_mouseup: function(a) { delete this._startClient, delete this._startLogical, delete this._endLogical } }), Ib.network.interaction.SelectInteraction = function(a) { Ib.network.interaction.SelectInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.network.interaction.SelectInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown') }, tearDown: function() { this.removeListener('mousedown'), this.end() }, handle_mousedown: function(a) { if (this._button = a.button, this.network.isValidEvent(a) && !this.network.isMovingElement() && !this.network.isEditingElement() && !a.shiftKey) { var b = this.network.getElementAt(a), c = this.network.getSelectionModel(); b ? Jb.isCtrlDown(a) ? c.contains(b) ? c.removeSelection(b) : c.appendSelection(b) : c.contains(b) || c.setSelection(b) : (Jb.isCtrlDown(a) || c.clearSelection(), this.end(a), this.network.getLogicalPoint(a) && this.network.isRectSelectEnabled() && this._handle_mousedown(a)) } }, handle_mouseup: function(a) { this.end(a) }, handle_mousemove: function(a) { if (this._button !== 0 || this.network.isMovingElement() || this.network.isEditingElement()) return void this.end(a); this._handle_mousemove(a), this.mark ? this.network.fireInteractionEvent({ kind: 'selectBetween', event: a }) : (this.mark = Wb.createDiv(), this.network.getTopDiv().appendChild(this.mark), this.network.setSelectingElement(!0), this.network.fireInteractionEvent({ kind: 'selectStart', event: a })); var b = Tb.getRect([this._startLogical, this._endLogical]); Wb.setDiv(this.mark, b, this.getIntersectMode() ? this.network.getSelectFillColor() : null, this.network.getSelectOutlineWidth(), this.network.getSelectOutlineColor()) }, end: function(a) { if (this._startLogical) { if (this.mark) { if (this._endLogical && this._startLogical.x !== this._endLogical.x && this._startLogical.y !== this._endLogical.y) { var b = this.network.getElementsAtRect(this.mark._viewRect, this.getIntersectMode(), this.network.getRectSelectFilter()); if (b && b.size() > 0) { var c = this.network.getSelectionModel(), d = c.toSelection(); b.forEach(function(a) { c.contains(a) ? d.remove(a) : d.add(a) }, this), c.setSelection(d) } this.network.fireInteractionEvent({ kind: 'selectEnd', event: a }) } var e = this; setTimeout(function() { e.mark && (e.network.getTopDiv().removeChild(e.mark), e.mark = null) }, 0), this.network.setSelectingElement(!1) } this._handle_mouseup(a) } }, getIntersectMode: function() { return this.network.getSelectMode() === 'intersect' ? !0 : this.network.getSelectMode() === 'contain' ? !1 : this._startLogical.x > this._endLogical.x && this._startLogical.y > this._endLogical.y } }), Ib.network.interaction.MoveInteraction = function(a, b) { this.lazyMode = b, this.xoffset = 0, this.yoffset = 0, Ib.network.interaction.MoveInteraction.superClass.constructor.call(this, a), this.currentKeyEvent = null }, Jb.ext('twaver.network.interaction.MoveInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'keydown', 'mouseleave') }, tearDown: function() { this.removeListener('mousedown', 'keydown', 'mouseleave'), this.end() }, handle_keydown: function(a) { this.currentKeyEvent = a, this.addListener('keyup') }, handle_keyup: function(a) { this.currentKeyEvent = null, this.removeListener('keyup') }, handle_mouseleave: function(a) { this.end(a) }, isParenting: function() { return this._startLogical && this.currentKeyEvent != null && this.currentKeyEvent.keyCode === 80 }, parentProcess: function(a, b) { var c = null; this.parent != null && (c = this.network.getElementUI(this.parent).getViewRect(), this.parent = null); var d = this; if (a = this.network.getLogicalPoint(a), !b && this.isParenting()) { var e = {}; e.x = a.x - 1, e.y = a.y - 1, e.width = 2, e.height = 2; var f = this.network.getElementsAtRect(e, !0); if (f && f.size() > 0) for (var g = f.size(), h = 0; g > h; h++) { var i = f.get(h); if (!d.network.getElementBox().getSelectionModel().contains(i)) { d.parent = i; break } } } this.parent != null && (c = this.network.getElementUI(this.parent).getViewRect()), c == null || b ? this.parentMark && (this.network.getTopDiv().removeChild(this.parentMark), this.parentMark = null) : (this.parentMark || (this.parentMark = Jb.html.createDiv(), this.network.getTopDiv().appendChild(this.parentMark)), Jb.html.setDiv(this.parentMark, c, this.network.isLazyMoveFill() ? this.network.getLazyMoveFillColor() : null, this.network.getLazyMoveOutlineWidth(), this.network.getLazyMoveOutlineColor())) }, handle_mousedown: function(a) { if (a.button === 0 && !this.network.isSelectingElement() && !this.network.isEditingElement()) { var b = this.network.getElementAt(a); this.network.isMovable(b) && (this.end(a), this._handle_mousedown(a)) } }, handle_mouseup: function(a) { this.end(a) }, handle_mousemove: function(a) { if (this.network.isSelectingElement() || this.network.isEditingElement() || !this.network.hasMovableSelectedElements() || !this._startLogical) return void this.end(a); if (this._handle_mousemove(a), this.xoffset = this._endLogical.x - this._startLogical.x, this.yoffset = this._endLogical.y - this._startLogical.y, this.lazyMode) { if (this.mark) this.network.fireInteractionEvent({ kind: 'lazyMoveBetween', event: a }); else { this.mark = Wb.createDiv(); var b; this.network.getMovableSelectedElements().forEach(function(a) { var c = this.getElementUI(a); c && (b = Tb.unionRect(b, c.getViewRect())) }, this.network), this.network.getTopDiv().appendChild(this.mark), this.network.setMovingElement(!0), Wb.setDiv(this.mark, b, this.network.isLazyMoveFill() ? this.network.getLazyMoveFillColor() : null, this.network.getLazyMoveOutlineWidth(), this.network.getLazyMoveOutlineColor()), this.network.fireInteractionEvent({ kind: 'lazyMoveStart', event: a }) } this.mark.style.left = this.xoffset + this.mark._viewRect.x + 'px', this.mark.style.top = this.yoffset + this.mark._viewRect.y + 'px' } else this._startLogical = this._endLogical, this._startClient = Wb.getClientPoint(a), this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a })), this.network.moveSelectedElements(this.xoffset, this.yoffset); this.parentProcess(a, !1) }, end: function(a) { if (this._startLogical) { if (this.lazyMode) { if (this.mark) { var b = this, c = function() { b.network.fireInteractionEvent({ kind: 'lazyMoveEnd', event: a }), b.mark && (b.network.getTopDiv().removeChild(b.mark), b.mark = null, b.network.setMovingElement(!1)) }; this.network.moveSelectedElements(this.xoffset, this.yoffset, this.network.isLazyMoveAnimate(), c) } } else this.network.isMovingElement() && (this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: a })); if (this.isParenting()) { this.parent == null && (this.parent = this.network.getCurrentSubNetwork()); var b = this; this.network.getMovableSelectedElements().forEach(function(a) { a.setParent(b.parent) }, this.network) } this.parentProcess(a, !0), this._handle_mouseup(a) } } }), Ib.network.interaction.DefaultInteraction = function(a) { Ib.network.interaction.DefaultInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.network.interaction.DefaultInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove', 'keydown') }, tearDown: function() { this.removeListener('mousedown', 'mousemove', 'keydown') }, handle_mousedown: function(a) { if (this.network.isValidEvent(a)) { this.network.isFocusOnClick() && Ib.Util.setFocus(this.network.getView()); var b = this.network.getElementAt(a); a.detail === 2 ? this.handleDoubleClicked(a, b) : this.handleClicked(a, b) } }, handleClicked: function(a, b) { Cc.handleClicked(this.network, a, b) }, handleDoubleClicked: function(a, b) { Cc.handleDoubleClicked(this.network, a, b) }, handle_keydown: function(a) { Cc.handleKeyDown(this.network, a) }, handle_mousemove: function(a) { var b = this.network.getElementAt(a), c = this._preElement, d = Dc(c), e = Dc(b); c !== b && (c && (d && d.onMouseLeave && d.onMouseLeave(c, this.network), this.network.onMouseLeave(c, a)), b && (e && e.onMouseEnter && e.onMouseEnter(b, this.network), this.network.onMouseEnter(b, a))), b && e && e.onMouseMove && e.onMouseMove(b, this.network), this.network.onMouseMove(b, a), this._preElement = b } }), Ib.network.interaction.PanInteraction = function(a) { Ib.network.interaction.PanInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.network.interaction.PanInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown'), this._oldCursor = this.network.getView().style.cursor }, tearDown: function() { this.removeListener('mousedown') }, handle_mousedown: function(a) { this._startLogical = this.network.getLogicalPoint(a), this._startLogical && (this._handle_mousedown(a), this.network.getView().style.cursor = 'pointer') }, handle_mouseup: function(a) { this._clear() }, handle_mousemove: function(a) { if (this._startLogical) { this._handle_mousemove(a); { var b = this._startLogical.x - this._endLogical.x, c = this._startLogical.y - this._endLogical.y; this.network.panByOffset(b, c) } this._startLogical = this._endLogical, this._startClient = Wb.getClientPoint(a) } }, _clear: function(a) { this._startLogical && (this._handle_mouseup(a), this.network.getView().style.cursor = this._oldCursor) } }), Ib.network.interaction.EditInteraction = function(a, b) { this.lazyMode = b, this.pointIndex = -1, Ib.network.interaction.EditInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.network.interaction.EditInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove'), this.oldCursor = this.network.getView().style.cursor, this.network.setHasEditInteraction(!0) }, tearDown: function() { this.removeListener('mousedown', 'mousemove'), this.network.getView().style.cursor = this.oldCursor, this.network.setHasEditInteraction(!1), this.clear() }, clear: function() { this.network.setEditingElement(!1), this.network.setRotatingElement(!1), this.isStart = !1, this.isStartRotate = !1, this.node = null, this.shapeNode = null, this.shapeLink = null, this.linkUI = null, this.resizingRect = null, this.resizeDirection = null, this.pointIndex = -1, this._removeCursor(), this.oldCursor = null, this.mouseMoved = !1, this.horizontal = !1, this.vertical = !1, this.mark && (this.network.getTopDiv().removeChild(this.mark), this.mark = null), this.rotateScale && this.network.getTopDiv().contains(this.rotateScale) && (this.network.getTopDiv().removeChild(this.rotateScale), this.rotateScale = null) }, _removeCursor: function() { this.cursorID && (this.network.getView().style.cursor = this.oldCursor || 'default', this.cursorID = null), this.resizeDirection = null, this.isCrossCursor = !1 }, _setCrossCursor: function() { this.isCrossCursor || (this._removeCursor(), this._setCursor('crosshair'), this.isCrossCursor = !0) }, _setCursor: function(a) { this.cursorID = a, this.network.getView().style.cursor !== this.cursorID && (this.network.getView().style.cursor = this.cursorID) }, handle_mousedown: function(a) { if (a.button === 0) if (!Jb.isAltDown(a) || this.network.isEditingElement())!this.network.isEditingElement() || this.isStart || this.isStartRotate || (this.node && this.resizeDirection ? (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: this.lazyMode ? 'lazyResizeStart' : 'liveResizeStart', event: a, element: this.node, resizeDirection: this.resizeDirection })) : this.shapeNode && this.pointIndex >= 0 ? Jb.isAltDown(a) ? (this.shapeNode.removeAt(this.pointIndex), this.network.fireInteractionEvent({ kind: 'removePoint', event: a, element: this.shapeNode })) : (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.shapeNode, pointIndex: this.pointIndex })) : this.shapeLink && this.pointIndex >= 0 ? Jb.isAltDown(a) ? (this.shapeLink.removeAt(this.pointIndex), this.network.fireInteractionEvent({ kind: 'removePoint', event: a, element: this.shapeLink })) : (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.shapeLink, pointIndex: this.pointIndex })) : this.linkUI ? (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.linkUI._element })) : this.node && (this.isStartRotate = !0, this._handle_mousedown(a))); else { var b = this.network.getElementAt(a), c = this.network.getLogicalPoint(a); if (b instanceof Ib.ShapeNode) { var d = this.getPointIndex(b.getPoints(), c, !0); d > 0 && (this._handle_mousedown(a), this.pointIndex = d, this.shapeNode = b, b.addPoint(c, d), this._setCrossCursor(), this.network.setEditingElement(!0), this.isStart = !0, this.network.fireInteractionEvent({ kind: 'addPoint', event: a, element: b, pointIndex: d }), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: b, pointIndex: d })) } if (b instanceof Ib.ShapeLink) { var e = new Ib.List(b.getPoints()), f = this.network.getElementUI(b); e.add(f.getFromPoint(), 0), e.add(f.getToPoint()); var d = this.getPointIndex(e, c) - 1; d > 0 && (this._handle_mousedown(a), this.pointIndex = d, this.shapeLink = b, b.addPoint(c, d), this._setCrossCursor(), this.network.setEditingElement(!0), this.isStart = !0, this.network.fireInteractionEvent({ kind: 'addPoint', event: a, element: b, pointIndex: d }), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: b, pointIndex: d })) } } }, handle_mouseup: function(a) {
    if (this.isStart) {
      var b = Jb.clone(this._endLogical); if (this.resizingRect) if (this.lazyMode) if (this.network.isResizeAnimate()) { var c = this, d = new Ib.animate.AnimateBounds(this.node, this.resizingRect, function() { c.network.fireInteractionEvent({ kind: 'lazyResizeEnd', event: a, element: c.node, resizeDirection: c.resizeDirection }), c.clear() }); Ib.animate.AnimateManager.start(d) } else this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.network.fireInteractionEvent({ kind: 'lazyResizeEnd', event: a, element: this.node, resizeDirection: this.resizeDirection }); else this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.network.fireInteractionEvent({ kind: 'liveResizeEnd', event: a, element: this.node, resizeDirection: this.resizeDirection }); else if (this.shapeNode && this.pointIndex >= 0 && b) { var e = this.shapeNode.getPoints().get(this.pointIndex); this.horizontal && (b.y = e.y), this.vertical && (b.x = e.x), this.shapeNode.setPoint(this.pointIndex, b), this.network.fireInteractionEvent({ kind: 'liveMovePointEnd', event: a, element: this.shapeNode, pointIndex: this.pointIndex }) } else if (this.shapeLink && this.pointIndex >= 0 && b) {
        var e = this.shapeLink.getPoints().get(this.pointIndex); this.horizontal && (b.y = e.y), this.vertical && (b.x = e.x), this.shapeLink.setPoint(this.pointIndex, b), this.network.fireInteractionEvent({
          kind: 'liveMovePointEnd', event: a, element: this.shapeLink, pointIndex: this.pointIndex })
      } else this.linkUI && b && (this.linkUI.setControlPoint(b), this.network.fireInteractionEvent({ kind: 'liveMovePointEnd', event: a, element: this.linkUI._element }))
    } this._handle_mouseup(a), this.lazyMode || this.clear()
  }, handle_mousemove: function(a) { if (this.isStartRotate && this.node) return this._handleRotateElement(a, this.node), void (this.network.isShowRotateScale() && this.showRotateScale()); if (this.isStart) { if (this.shapeNode && this.pointIndex >= 0) return void this._handleMovingShapeNodePoint(a); if (this.shapeLink && this.pointIndex >= 0) return void this._handleMovingShapeLinkPoint(a); if (this.node && this.resizeDirection) return void this._handleResizing(a); if (this.linkUI) return void this._handleMovingLinkControlPoint(a) } else if (this.network.isValidEvent(a)) { if (this.network.isSelectingElement() || this.network.isMovingElement() || this.network.getSelectionModel().size() === 0) return void this.clear(); var b = this.network.getElementAt(a), c = this.network.getElementUI(b); if (!c || !c.getEditAttachment()) return void this.clear(); var d = this.network.getLogicalPoint(a); if (b instanceof Ld) { if (this.node = b, this._isEditingShapeNode(d) || this._isResizingNode(d)) return void this.network.setEditingElement(!0); if (this._isRotatingElement(d)) return this.network.setRotatingElement(!0), void this.network.setEditingElement(!0) } else if (b instanceof Ib.ShapeLink) { if (this.shapeLink = b, this._isEditingShapeLink(d)) return void this.network.setEditingElement(!0) } else if (c instanceof Ib.network.LinkUI) { var e = this.network.getEditPointSize(); if (xc.isOrthogonalLink(c._element)) { this.linkUI = c; var f = this.linkUI.getControlPoint(); return void (f && this._contains(d, f, e) && (this._setCrossCursor(), this.network.setEditingElement(!0))) } } this.clear() } }, _isRotatingElement: function(a) { var b = this.network.getRotatePointSize(); if (b <= 0) return !1; var c = this.node.getOriginalRect(), d = this.node.getAngle(); return this._isRotating(a, 'crosshair', c, d) }, _isRotating: function(a, b, c, d) { var e = this.network.getRotatePointSize(), f = { x: c.x + c.width / 2, y: c.y - this.network.getRotatePointOffset() - e }, g = this._rotatePoint(f, d, c), h = { x: g.x - e, y: g.y - e, width: 2 * e, height: 2 * e }; return Tb.containsPoint(h, a) ? (this._removeCursor(), this._setCursor(b), !0) : !1 }, _handleRotateElement: function(a, b) { this._handle_mousemove(a); var c = this._calculateAngle(this.network.getLogicalPoint(a), b); b.setAngle(c) }, _calculateAngle: function(a, b) { var c = b.getCenterLocation(); return Math.round(180 * Math.atan2(c.x - a.x, a.y - c.y) / Math.PI + 180) }, _handleMovingShapeNodePoint: function(a) { if (this._handle_mousemove(a), !this.mouseMoved && Jb.isCtrlDown(a)) { var b = this._endLogical.x - this._startLogical.x, c = this._endLogical.y - this._startLogical.y; this.horizontal = Math.abs(b) >= Math.abs(c), this.vertical = !this.horizontal, this.mouseMoved = !0 } var d = this.shapeNode.getPoints().get(this.pointIndex), e = Jb.clone(this._endLogical); this.horizontal && (e.y = d.y), this.vertical && (e.x = d.x), this.shapeNode.setPoint(this.pointIndex, e), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.shapeNode, pointIndex: this.pointIndex }) }, _handleMovingShapeLinkPoint: function(a) { if (this._handle_mousemove(a), !this.mouseMoved && Jb.isCtrlDown(a)) { var b = this._endLogical.x - this._startLogical.x, c = this._endLogical.y - this._startLogical.y; this.horizontal = Math.abs(b) >= Math.abs(c), this.vertical = !this.horizontal, this.mouseMoved = !0 } var d = this.shapeLink.getPoints().get(this.pointIndex), e = Jb.clone(this._endLogical); this.horizontal && (e.y = d.y), this.vertical && (e.x = d.x), this.shapeLink.setPoint(this.pointIndex, e), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.shapeLink, pointIndex: this.pointIndex }) }, _handleMovingLinkControlPoint: function(a) { this._handle_mousemove(a), this.linkUI.setControlPoint(Jb.clone(this._endLogical)), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.linkUI._element }) }, _handleResizing: function(a) { this._handle_mousemove(a); var b = this.node.getAngle(), c = this.node.getLocation(), d = this.node.getWidth() / 2, e = this.node.getHeight() / 2, f = { x: c.x + d, y: c.y + e }, g = { x: -d, y: -e }, h = { x: -d, y: e }, i = { x: d, y: e }, j = { x: d, y: -e }, k = { x: 0, y: -e }, l = { x: d, y: 0 }, m = { x: 0, y: e }, n = { x: -d, y: 0 }; if (this.resizeDirection === 'northwest' && (this._transformPoint(i, f, b), g.x = this._endLogical.x, g.y = this._endLogical.y, f.x = (g.x + i.x) / 2, f.y = (g.y + i.y) / 2, this._reversPoint(g, f, b), this._reversPoint(i, f, b), this.resizingRect = { x: g.x, y: g.y, width: i.x - g.x, height: i.y - g.y }), this.resizeDirection === 'north') { var o = { x: this._endLogical.x, y: this._endLogical.y }; this._reversPoint(o, f, b), k.y = o.y - f.y, this._transformPoint(k, f, b), this._transformPoint(m, f, b), f.x = (k.x + m.x) / 2, f.y = (k.y + m.y) / 2, this._reversPoint(k, f, b), this._reversPoint(m, f, b), this.resizingRect = { x: f.x - this.node.getWidth() / 2, y: f.y - (m.y - k.y) / 2, width: this.node.getWidth(), height: m.y - k.y } } if (this.resizeDirection === 'northeast' && (this._transformPoint(h, f, b), j.x = this._endLogical.x, j.y = this._endLogical.y, f.x = (h.x + j.x) / 2, f.y = (h.y + j.y) / 2, this._reversPoint(h, f, b), this._reversPoint(j, f, b), this.resizingRect = { x: h.x, y: j.y, width: j.x - h.x, height: h.y - j.y }), this.resizeDirection === 'west') { var o = { x: this._endLogical.x, y: this._endLogical.y }; this._reversPoint(o, f, b), n.x = o.x - f.x, this._transformPoint(l, f, b), this._transformPoint(n, f, b), f.x = (l.x + n.x) / 2, f.y = (l.y + n.y) / 2, this._reversPoint(l, f, b), this._reversPoint(n, f, b), this.resizingRect = { x: f.x - (l.x - n.x) / 2, y: f.y - this.node.getHeight() / 2, width: l.x - n.x, height: this.node.getHeight() } } if (this.resizeDirection === 'east') { var o = { x: this._endLogical.x, y: this._endLogical.y }; this._reversPoint(o, f, b), l.x = o.x - f.x, this._transformPoint(l, f, b), this._transformPoint(n, f, b), f.x = (l.x + n.x) / 2, f.y = (l.y + n.y) / 2, this._reversPoint(l, f, b), this._reversPoint(n, f, b), this.resizingRect = { x: f.x - (l.x - n.x) / 2, y: f.y - this.node.getHeight() / 2, width: l.x - n.x, height: this.node.getHeight() } } if (this.resizeDirection === 'southwest' && (this._transformPoint(j, f, b), h.x = this._endLogical.x, h.y = this._endLogical.y, f.x = (h.x + j.x) / 2, f.y = (h.y + j.y) / 2, this._reversPoint(h, f, b), this._reversPoint(j, f, b), this.resizingRect = { x: h.x, y: j.y, width: j.x - h.x, height: h.y - j.y }), this.resizeDirection === 'south') { var o = { x: this._endLogical.x, y: this._endLogical.y }; this._reversPoint(o, f, b), m.y = o.y - f.y, this._transformPoint(k, f, b), this._transformPoint(m, f, b), f.x = (k.x + m.x) / 2, f.y = (k.y + m.y) / 2, this._reversPoint(k, f, b), this._reversPoint(m, f, b), this.resizingRect = { x: f.x - this.node.getWidth() / 2, y: f.y - (m.y - k.y) / 2, width: this.node.getWidth(), height: m.y - k.y } } this.resizeDirection === 'southeast' && (this._transformPoint(g, f, b), i.x = this._endLogical.x, i.y = this._endLogical.y, f.x = (g.x + i.x) / 2, f.y = (g.y + i.y) / 2, this._reversPoint(g, f, b), this._reversPoint(i, f, b), this.resizingRect = { x: g.x, y: g.y, width: i.x - g.x, height: i.y - g.y }), this.lazyMode ? (this.mark || (this.mark = Wb.createDiv(), this.mark.style.webkitTransform = 'rotate(' + b + 'deg)', this.mark.style.mozTransform = 'rotate(' + b + 'deg)', this.mark.style.OTransform = 'rotate(' + b + 'deg)', this.mark.style.msTransform = 'rotate(' + b + 'deg)', this.mark.style.transform = 'rotate(' + b + 'deg)', this.network.getTopDiv().appendChild(this.mark)), Wb.setDiv(this.mark, this.resizingRect, null, this.network.getResizeLineWidth(), this.network.getResizeLineColor()), this.network.fireInteractionEvent({ kind: 'lazyResizeBetween', event: a, element: this.node, resizeDirection: this.resizeDirection })) : (this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.network.fireInteractionEvent({ kind: 'liveResizeBetween', event: a, element: this.node, resizeDirection: this.resizeDirection })) }, _isEditingShapeNode: function(a) { var b = this.network.getEditPointSize(); if (this.node instanceof Ib.ShapeNode) { this.shapeNode = this.node; for (var c = this.shapeNode.getPoints(), d = 0, e = c.size(); e > d; d++) { var f = c.get(d); if (this._contains(a, f, b)) return this._setCrossCursor(), this.pointIndex = d, !0 } } return this.pointIndex = -1, !1 }, _isEditingShapeLink: function(a) { for (var b = this.shapeLink.getPoints(), c = this.network.getEditPointSize(), d = 0, e = b.size(); e > d; d++) { var f = b.get(d); if (this._contains(a, f, c)) return this._setCrossCursor(), this.pointIndex = d, !0 } return this.pointIndex = -1, !1 }, _isResizingNode: function(a) { var b = this.network.getResizePointSize(); if (b <= 0) return !1; var c = this.node.getOriginalRect(), d = this.node.getAngle(), e = { x: c.x, y: c.y }, f = this._rotatePoint(e, d, c); return this._isResizing(a, f.x, f.y, 'northwest', 'nwse-resize') ? !0 : (e = { x: c.x + c.width / 2, y: c.y }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'north', 'ns-resize') ? !0 : (e = { x: c.x + c.width, y: c.y }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'northeast', 'nesw-resize') ? !0 : (e = { x: c.x, y: c.y + c.height / 2 }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'west', 'ew-resize') ? !0 : (e = { x: c.x + c.width, y: c.y + c.height / 2 }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'east', 'ew-resize') ? !0 : (e = { x: c.x, y: c.y + c.height }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'southwest', 'nesw-resize') ? !0 : (e = { x: c.x + c.width / 2, y: c.y + c.height }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'south', 'ns-resize') ? !0 : (e = { x: c.x + c.width, y: c.y + c.height }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'southeast', 'nwse-resize') ? !0 : !1))))))) }, _rotatePoint: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x + c.width / 2, c.y + c.height / 2), e = d.transform(a); return e }, _isResizing: function(a, b, c, d, e) { var f = this.network.getResizePointSize(); return this._contains(a, { x: b, y: c }, f) ? (this.resizeDirection !== d && (this._removeCursor(), e = this._changeCursorWithAngle(d, this.node.getAngle()), this._setCursor(e), this.resizeDirection = d), !0) : !1 }, _getRect: function(a, b, c, d) { var e = c > a ? a : c, f = d > b ? b : d, g = Math.abs(a - c), h = Math.abs(b - d); return { x: e, y: f, width: g, height: h } }, _contains: function(a, b, c) { var d = { x: b.x - c, y: b.y - c, width: 2 * c, height: 2 * c }; return Tb.containsPoint(d, a) }, getPointIndex: function(a, b, c) { if (a.size() < 2) return 0; for (var d, e = a.get(0), f = 1; f < a.size(); f++) { if (d = a.get(f), this.isPointOnLine(b, e, d, 6)) return f; e = d } return e = a.get(0), c && this.isPointOnLine(b, e, d, 6) ? a.size() : 0 }, showRotateScale: function() { this.rotateScale || (this.rotateScale = Jb.html.createCanvas()); var a, b, c, d, e, f = (new Ib.List(), this.network.getRotateScaleWidth()), g = this.network.getRotateScaleHeight(), h = this.network.getRotatePointSize(), i = this.node.getAngle(), j = this.node.getOriginalRect(), k = { x: j.x + j.width / 2, y: j.y - this.network.getRotatePointOffset() - h }, l = this._rotatePoint(k, i, j), m = '13px Arial', n = i + '°'; this.node.getAngle() >= 0 && this.node.getAngle() <= 180 ? (b = { x: l.x + h, y: l.y }, c = { x: b.x + f, y: b.y }, d = { x: c.x, y: c.y - g }, e = { x: b.x, y: d.y }) : this.node.getAngle() > 180 && this.node.getAngle() <= 360 && (b = { x: l.x - h, y: l.y }, c = { x: b.x - f, y: b.y }, d = { x: c.x, y: c.y - g }, e = { x: b.x, y: d.y }); var o = new Ib.List([b, c, d, e]), a = Jb.math.getRect(o), p = Jb.html.setCanvas(this.rotateScale, a); p.fillStyle = this.network.getRotateScaleFillColor(), p.fillRect(a.x, a.y, a.width, a.height), p.fillStyle = this.network.getRotateScaleFontColor(), p.textBaseline = 'middle', p.textAlign = 'center', p.font = m, p.fillText(n, a.x + a.width / 2, a.y + a.height / 2), this.network.getTopDiv().appendChild(this.rotateScale) }, isPointOnLine: function(a, b, c, d) { d < 0 && (d = 0); var e = this.getDistanceFromPointToLine(a, b, c); return d >= e && a.x >= Math.min(b.x, c.x) - d && a.x <= Math.max(b.x, c.x) + d && a.y >= Math.min(b.y, c.y) - d && a.y <= Math.max(b.y, c.y) + d }, getDistanceFromPointToLine: function(a, b, c) { if (b.x === c.x) return Math.abs(a.x - b.x); var d = (c.y - b.y) / (c.x - b.x), e = (c.x * b.y - b.x * c.y) / (c.x - b.x); return Math.abs(d * a.x - a.y + e) / Math.sqrt(d * d + 1) }, _transformPoint: function(a, b, c) { var d = Math.cos(c * Math.PI / 180), e = Math.sin(c * Math.PI / 180), f = a.x, g = a.y, h = f * d - g * e, i = f * e + g * d; a.x = h + b.x, a.y = i + b.y }, _reversPoint: function(a, b, c) { c *= -1; var d = Math.cos(c * Math.PI / 180), e = Math.sin(c * Math.PI / 180), f = a.x - b.x, g = a.y - b.y, h = f * d - g * e, i = f * e + g * d; a.x = h + b.x, a.y = i + b.y }, _changeCursorWithAngle: function(a, b) { var c, d = ['auto', 'nwse-resize', 'ns-resize', 'nesw-resize', 'ew-resize', 'nwse-resize', 'ns-resize', 'nesw-resize', 'ew-resize']; switch (a) { case 'northwest':c = 1; break; case 'north':c = 2; break; case 'northeast':c = 3; break; case 'east':c = 4; break; case 'southeast':c = 5; break; case 'south':c = 6; break; case 'southwest':c = 7; break; case 'west':c = 8; break; default:c = 0 } return (b >= 360 || b <= -360) && (b %= 360), b > 22.5 && b <= 67.5 && (c += 1), b < -22.5 && b >= -67.5 && (c -= 1), b > 67.5 && b <= 112.5 && (c += 2), b < -67.5 && b >= -112.5 && (c -= 2), b > 112.5 && b <= 157.5 && (c += 3), b < -112.5 && b >= -157.5 && (c -= 3), b > 157.5 && b <= 202.5 && (c += 4), b < -157.5 && b >= -202.5 && (c -= 4), b > 202.5 && b <= 247.5 && (c += 5), b < -202.5 && b >= -247.5 && (c -= 5), b > 247.5 && b <= 292.5 && (c += 6), b < -247.5 && b >= -292.5 && (c -= 6), b > 292.5 && b <= 337.5 && (c += 7), b < -292.5 && b >= -337.5 && (c -= 7), c > 8 && (c -= 8), c <= 0 && (c += 8), d[c] } }), Ib.network.interaction.CreateElementInteraction = function(a, b) { b || (b = Ld), this.elementFunction = Ib.Util.isTypeOf(b, Ld) ? function(a) { var c = new b(); return c instanceof Ld && c.setCenterLocation(a), c } : b, Ib.network.interaction.CreateElementInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.network.interaction.CreateElementInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown') }, tearDown: function() { this.removeListener('mousedown') }, handle_mousedown: function(a) { var b = this.network.getLogicalPoint(a); if (b) { var c = this.elementFunction(b); c && this.network.addElementByInteraction(c) } } }), Ib.network.interaction.CreateLinkInteraction = function(a, b) { b || (b = Ib.Link), this.linkFunction = Ib.Util.isTypeOf(b, Ib.Link) ? function(a, c) { var d = new b(); return d instanceof Ib.Link && (d.setFromNode(a), d.setToNode(c)), d } : b, Ib.network.interaction.CreateLinkInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.network.interaction.CreateLinkInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove') }, tearDown: function() { this.removeListener('mousedown', 'mousemove'), this.clear() }, clear: function() { var a = this; setTimeout(function() { a._fromRectangle && (a.network.getTopDiv().removeChild(a._fromRectangle), a._fromRectangle = null), a._currentRectangle && (a.network.getTopDiv().removeChild(a._currentRectangle), a._currentRectangle = null), a._line && (a.network.getTopDiv().removeChild(a._line), a._line = null) }), this.currentPoint = null, this.currentNode = null, this.fromNode = null, this.toNode = null }, createLink: function() { return this.linkFunction(this.fromNode, this.toNode) }, handle_mousedown: function(a) { if (this.network.isValidEvent(a)) if (this.fromNode) { if (this.toNode = this.currentNode, this.toNode) { var b = this.createLink(); b && this.network.addElementByInteraction(b) } this.clear() } else this.fromNode = this.currentNode, this.currentNode = null, this.currentPoint = null, this.updateMark() }, handle_mousemove: function(a) { var b = this.network.getLogicalPoint(a); if (b) { if (this.network.isMovingElement() || this.network.isEditingElement()) return void this.clear(); var c = null; this.fromNode ? (this.currentNode = this.getToNode(a), this.currentPoint = b, this.updateMark()) : (c = this.getFromNode(a), this.currentNode !== c && (this.currentNode = c, this.updateMark())) } }, getFromNode: function(a) { return this.getNode(a) }, getToNode: function(a) { return this.getNode(a) }, getNode: function(a) { var b = this.network.getElementAt(a); return b instanceof Ld && this.network.isLinkable(b) ? b : null }, updateMark: function() { var a; this.fromNode && !this._fromRectangle && this._currentRectangle && (this._fromRectangle = this._currentRectangle, this._currentRectangle = null), !this.fromNode && this._fromRectangle && (this.network.getTopDiv().removeChild(this._fromRectangle), this._fromRectangle = null), this.currentNode && !this._currentRectangle && (a = this.network.getElementUI(this.currentNode), this._currentRectangle = Wb.createDiv(), this.network.getTopDiv().appendChild(this._currentRectangle), Wb.setDiv(this._currentRectangle, a._viewRect, null, this.network.getEditLineWidth(), this.network.getEditLineColor())), !this.currentNode && this._currentRectangle && (this.network.getTopDiv().removeChild(this._currentRectangle), this._currentRectangle = null), this.updateLine() }, updateLine: function() { if (this.currentPoint) { var a = this.fromNode.getCenterLocation(), b = a.x, c = a.y, d = this.currentPoint.x, e = this.currentPoint.y; this._line || (this._line = Wb.createCanvas(), this.network.getTopDiv().appendChild(this._line)); var f = Wb.setCanvas(this._line, Math.min(b, d), Math.min(c, e), Math.abs(b - d), Math.abs(c - e)); f.lineWidth = this.network.getEditLineWidth(), f.strokeStyle = this.network.getEditLineColor(), f.beginPath(), f.moveTo(b, c), f.lineTo(d, e), f.stroke() } else this._line && (this.network.getTopDiv().removeChild(this._line), this._line = null) } }), Ib.network.interaction.CreateShapeNodeInteraction = function(a, b) { b || (b = Ib.ShapeNode), this.shapeNodeFunction = Ib.Util.isTypeOf(b, Ib.ShapeNode) ? function(a) { var c = new b(); return c instanceof Ib.ShapeNode && a && c.setPoints(a), c } : b, Ib.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this, a), this.timeStamp = -1 }, Jb.ext('twaver.network.interaction.CreateShapeNodeInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove') }, tearDown: function() { this.removeListener('mousedown', 'mousemove'), this.clear() }, clear: function() { this.network.setEditingElement(!1), this.points = null, this.currentPoint = null, this.lastPoint = null, this.horizontal = !1, this.vertical = !1, this.mark && (this.network.getTopDiv().removeChild(this.mark), this.mark = null) }, handle_mousedown: function(a) { if (a.button === 0) { var b = this.network.getLogicalPoint(a); if (b) { if (a.detail === 2 || a.timeStamp - this.timeStamp < 300) { if (this.points) { var c = this.shapeNodeFunction(this.points); this.network.addElementByInteraction(c), this.clear(); var d = this; setTimeout(function() { d.network.setEditingElement(!1) }, 0) } } else { if (this.network.isEditingElement() || this.network.setEditingElement(!0), this.points || (this.points = new nd()), this.points.size() > 0) { var e = this.points.get(this.points.size() - 1); if (e.x === b.x && e.y === b.y) return } this._handle_mousedown(a), this.points.size() > 0 && Jb.isCtrlDown(a) && (this.horizontal && (b.y = e.y), this.vertical && (b.x = e.x), this.horizontal = !1, this.vertical = !1), this.lastPoint = b, this.points.add(b), this.updateMark() } this.timeStamp = a.timeStamp } } }, handle_mousemove: function(a) { if (this.points) { if (this.currentPoint = this.network.getLogicalPoint(a), Jb.isCtrlDown(a)) { var b = this.currentPoint.x - this.lastPoint.x, c = this.currentPoint.y - this.lastPoint.y; this.horizontal = Math.abs(b) >= Math.abs(c), this.vertical = !this.horizontal } else this.horizontal = !1, this.vertical = !1; this.horizontal && (this.currentPoint.y = this.lastPoint.y), this.vertical && (this.currentPoint.x = this.lastPoint.x), this.updateMark() } }, updateMark: function(a) { if (this.points && this.points.size() > 0 && this.currentPoint) { this.mark || (this.mark = Wb.createCanvas(), this.network.getTopDiv().appendChild(this.mark)); var b = new nd(this.points); b.add(this.currentPoint); var c = Tb.getRect(b), d = this.network.getEditLineWidth(); Jb.math.grow(c, d, d); var e = Wb.setCanvas(this.mark, c); e.lineWidth = d, e.strokeStyle = this.network.getEditLineColor(), e.beginPath(), Xb.drawLinePoints(e, b), e.stroke() } } }), Ib.network.interaction.CreateShapeLinkInteraction = function(a, b) { Ib.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this, a), b || (b = Ib.ShapeLink), this.linkFunction = Ib.Util.isTypeOf(b, Ib.ShapeLink) ? function(a, c, d) { var e = new b(); return e instanceof Ib.ShapeLink && (e.setFromNode(a), e.setToNode(c), d && e.setPoints(d)), e } : b }, Jb.ext('twaver.network.interaction.CreateShapeLinkInteraction', Ib.network.interaction.CreateLinkInteraction, { clear: function() { this.network.setEditingElement(!1), this.points = null, this.polyline && (this.network.getTopDiv().removeChild(this.polyline), this.polyline = null), Ib.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this) }, createLink: function() { return this.linkFunction(this.fromNode, this.toNode, this.points) }, handle_mousedown: function(a) { if (a.button === 0) { var b = this.network.getLogicalPoint(a); if (b) if (this.fromNode) if (this.toNode = this.currentNode, this.toNode) { var c = this.createLink(); c && this.network.addElementByInteraction(c), this.clear() } else { if (this.points || (this.points = new nd()), this.points.size() > 0) { var d = this.points.get(this.points.size() - 1); if (d.x === b.x && d.y === b.y) return } this.points.add(b), this.updateMark() } else this.fromNode = this.currentNode, this.fromNode && (this.polyline || (this.polyline = Wb.createCanvas(), this.network.getTopDiv().appendChild(this.polyline))), this.points = null, this.currentNode = null, this.currentPoint = null, this.updateMark() } }, updateLine: function() { if (this.currentPoint && this.polyline) { var a = new nd(this.points); a.add(this.fromNode.getCenterLocation(), 0), a.add(this.currentPoint); var b = Tb.getRect(a), c = Wb.setCanvas(this.polyline, b); c.lineWidth = this.network.getEditLineWidth(), c.strokeStyle = this.network.getEditLineColor(), c.beginPath(), Xb.drawLinePoints(c, a), c.stroke() } } }), Ib.network.interaction.CreateOrthogonalLinkInteraction = function(a, b, c, d, e, f) { Ib.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this, a, b), this.linkType = c || 'orthogonal', this.isByControlPoint = d, this.splitPercent = e, this.isSplitByPercent = f, this.link = new Ib.Link(), this.link.setStyle('link.type', this.linkType), this.link.setStyle('link.split.by.percent', this.isSplitByPercent), xc.isFlexionalTypeLink(this.linkType) || xc.isExtendTypeLink(this.linkType) ? (this.splitPercent < 0 && (this.splitPercent = Ib.Styles.getStyle('link.extend')), this.link.setStyle('link.extend', this.splitPercent)) : xc.isSplitTypeLink(this.linkType) && (this.splitPercent < 0 && (this.splitPercent = Ib.Styles.getStyle(this.isSplitByPercent ? 'link.split.percent' : 'link.split.value')), this.isSplitByPercent ? this.link.setStyle('link.split.percent', this.splitPercent) : this.link.setStyle('link.split.value', this.splitPercent)) }, Jb.ext('twaver.network.interaction.CreateOrthogonalLinkInteraction', Ib.network.interaction.CreateLinkInteraction, { clear: function() { this.path && (this.network.getTopDiv().removeChild(this.path), this.path = null), Ib.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this) }, createLink: function() { var a = Ib.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this); if (a.setStyle('link.type', this.linkType), a.setStyle('link.split.by.percent', this.isSplitByPercent), this.isByControlPoint) { var b = xc.getControlPoint(a); if (b) return a.SetStyle('link.control.point', b), a } else xc.isFlexionalTypeLink(this.linkType) || xc.isExtendTypeLink(this.linkType) ? (this.splitPercent < 0 && (this.splitPercent = Ib.Styles.getStyle('link.extend')), a.setStyle('link.extend', this.splitPercent)) : xc.isSplitTypeLink(this.linkType) && (this.splitPercent < 0 && (this.splitPercent = Ib.Styles.getStyle(this.isSplitByPercent ? 'link.split.percent' : 'link.split.value')), this.isSplitByPercent ? a.setStyle('link.split.percent', this.splitPercent) : a.setStyle('link.split.value', this.splitPercent)); return a }, updateLine: function() { if (this.currentPoint) { if (!this.fromNode || this.currentNode === this.fromNode) return; var a, b = this.network.getElementUI(this.fromNode); if (!b) return; if (a = b.getBodyRect(), a == null) return; var c; if (this.currentNode && this.currentNode !== this.fromNode) { var d = this.network.getElementUI(this.currentNode); if (!d) return; c = d.getBodyRect() } else c = { x: this.currentPoint.x, y: this.currentPoint.y, width: 1, height: 1 }; if (!c) return; var e = xc.calculateOrthogonalAndFlexionalLinkPoints(this.linkType, a, c, this.link); if (xc.drawCorner(e, this.link), e.size() < 2) return; this.line || (this.line = Wb.createCanvas(), this.network.getTopDiv().appendChild(this.line)); var f = Wb.setCanvas(this.line, Tb.getLineRect(e)); f.lineWidth = this.network.getEditLineWidth(), f.strokeStyle = this.network.getEditLineColor(), f.beginPath(), Xb.drawLinePoints(f, e), f.stroke() } else this.line && (this.network.getTopDiv().removeChild(this.line), this.line = null) } }), Ib.network.interaction.MagnifyInteraction = function(a, b, c, d, e) { Ib.network.interaction.MagnifyInteraction.superClass.constructor.call(this, a), this.zoom = b || 2, this.xRadius = c || 100, this.yRadius = d || 100, this.shape = e || 'circle', this.borderColor = 'black', this.borderWidth = 1, this.backgroundColor = 'white', this.markCanvas = Wb.createCanvas(), this.markCanvas._isIgnored = !0 }, Jb.ext('twaver.network.interaction.MagnifyInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { this.addListener('mousemove') }, tearDown: function() { this.removeListener('mousemove'), this._clear() }, handle_mousemove: function(a) { var b = this.network.getLogicalPoint(a); b && (this.lastPoint || this.network.getView().appendChild(this.markCanvas), this.lastPoint = b, this.updateMark()) }, updateMark: function() { var a, b = this.network._zoom, c = this.zoom * b, d = this.lastPoint.x * b - this.xRadius, e = this.lastPoint.y * b - this.yRadius, f = 2 * this.xRadius, g = 2 * this.yRadius, h = { x: this.lastPoint.x - this.xRadius / c, y: this.lastPoint.y - this.yRadius / c, width: f / c, height: g / c }, i = this.borderWidth, j = Wb.createCanvas(); j.width = f, j.height = g, this.network.toCanvasByRegion(h, c, j), Wb.setCanvas(this.markCanvas, d, e, f, g), a = this.markCanvas.getContext('2d'), a.save(), a.beginPath(), Xb.drawVector(a, this.shape, null, d, e, f, g), a.clip(), a.fillStyle = this.backgroundColor, a.beginPath(), a.rect(d, e, f, g), a.fill(), a.drawImage(j, d, e), a.restore(), a.beginPath(), a.lineWidth = i, Xb.drawVector(a, this.shape, null, d + i / 2, e + i / 2, f - i, g - i), a.strokeStyle = this.borderColor, a.stroke() }, _clear: function(a) { this.lastPoint && (this.network.getView().removeChild(this.markCanvas), this.lastPoint = null) }, getZoom: function() { return this.zoom }, setZoom: function(a) { this.zoom = a, this.updateMark() }, getShape: function() { return this.shape }, setShape: function(a) { this.shape = a, this.updateMark() }, getXRadius: function() { return this.xRadius }, setXRadius: function(a) { this.xRadius = a, this.updateMark() }, getYRadius: function() { return this.yRadius }, setYRadius: function(a) { this.yRadius = a, this.updateMark() }, getBorderColor: function() { return this.borderColor }, setBorderColor: function(a) { this.borderColor = a, this.updateMark() }, getBorderWidth: function() { return this.borderWidth }, setBorderWidth: function(a) { this.borderWidth = a, this.updateMark() }, getBackgroundColor: function() { return this.backgroundColor }, setBackgroundColor: function(a) { this.backgroundColor = a, this.updateMark() } }), Ib.network.interaction.TouchInteraction = function(a) { Ib.network.interaction.TouchInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.network.interaction.TouchInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { var a = this.network.getView(); Wb.addEventListener('touchstart', 'handleTouchstart', a, this), Wb.addEventListener('touchmove', 'handleTouchmove', a, this), Wb.addEventListener('touchend', 'handleTouchend', a, this), Wb.addEventListener('touchcancel', 'handleTouchend', a, this) }, tearDown: function() { var a = this.network.getView(); Wb.removeEventListener('touchstart', a, this), Wb.removeEventListener('touchmove', a, this), Wb.removeEventListener('touchend', a, this), Wb.removeEventListener('touchcancel', a, this) }, handleTouchstart: function(a) { if (Wb.preventDefault(a), a.touches && a.touches.length == 1) { var b = this.network.getLogicalPoint(a), c = this.network.getElementAt(b); this._startTouchTime = new Date(), this._startTouchPoint = b; var d = this; c ? (this._haveElementUnderTouch = !0, this._startTouchElement = c) : (this._haveElementUnderTouch = !1, this._startTouchElement = null), this.timer = setTimeout(function() { Cc.handleLongClicked(d.network, a, c) }, 1e3) } else a.touches && a.touches.length == 2 && (this._distance = zc.getDistance(a), this._zoom = this.network.getZoom(), this._startTouchPoint = { x: a.touches[0].clientX, y: a.touches[0].clientY }); this._touchCount = a.touches.length }, handleTouchmove: function(a) { if (Wb.preventDefault(a), this._touchCount == 2 && a.touches && a.touches.length == 2) if (this.timer && clearTimeout(this.timer), Math.abs(this._distance - zc.getDistance(a)) >= Ed.TOUCH_ZOOM_THRESHOLD || this._zoomFlag) { this._zoomFlag = !0; var b = zc.getDistance(a) / this._distance; this.network.setTouchZoom(this._zoom * b, !1) } else { var c = a.touches[0], d = this._startTouchPoint.x - c.clientX, e = this._startTouchPoint.y - c.clientY, f = this.network.panByOffset(d, e); this._startTouchPoint.x -= d - f.x, this._startTouchPoint.y -= e - f.y } else if (this._touchCount == 1 && a.touches && a.touches.length == 1) if (this._haveElementUnderTouch || !this.network.isRectSelectEnabled()) { var g = this.network.getLogicalPoint(a), h = this.network.getElementAt(g); if (this.network.isMovingElement() || this._startTouchElement != null && this._startTouchElement == h && this.network.getMovableSelectedElements().contains(h)) { var d = g.x - this._startTouchPoint.x, e = g.y - this._startTouchPoint.y; (Math.abs(d) >= Ed.TOUCH_MOVE_THRESHOLD || Math.abs(e) >= Ed.TOUCH_MOVE_THRESHOLD) && (this._startTouchPoint = g, this.network.moveSelectedElements(d, e), this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a }), this.timer && clearTimeout(this.timer))) } else { var d = g.x - this._startTouchPoint.x, e = g.y - this._startTouchPoint.y; (Math.abs(d) >= Ed.TOUCH_MOVE_THRESHOLD || Math.abs(e) >= Ed.TOUCH_MOVE_THRESHOLD) && this.timer && clearTimeout(this.timer) } } else { this._moveTouchPoint = this.network.getLogicalPoint(a); var d = this._moveTouchPoint.x - this._startTouchPoint.x, e = this._moveTouchPoint.y - this._startTouchPoint.y; if (Math.abs(d) >= Ed.TOUCH_RECT_SELECT_THRESHOLD && Math.abs(e) >= Ed.TOUCH_RECT_SELECT_THRESHOLD) { this.mark ? this.network.fireInteractionEvent({ kind: 'selectBetween', event: a }) : (this.mark = Wb.createDiv(), this.network.getTopDiv().appendChild(this.mark), this.network.setSelectingElement(!0), this.network.fireInteractionEvent({ kind: 'selectStart', event: a }), this.timer && clearTimeout(this.timer)); var i = Tb.getRect([this._startTouchPoint, this._moveTouchPoint]); Wb.setDiv(this.mark, i, this.getIntersectMode() ? this.network.getSelectFillColor() : null, this.network.getSelectOutlineWidth(), this.network.getSelectOutlineColor()) } } }, handleTouchend: function(a) { if (Wb.preventDefault(a), this.network.isMovingElement()) this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: a }); else if (this.network.isSelectingElement()) { var b = this.network.getElementsAtRect(this.mark._viewRect, this.getIntersectMode(), this.network.getRectSelectFilter()); if (b && b.size() > 0) { var c = this.network.getSelectionModel(), d = c.toSelection(); b.forEach(function(a) { c.contains(a) ? d.remove(a) : d.add(a) }, this), c.setSelection(d) } this.network.fireInteractionEvent({ kind: 'selectEnd', event: a }), this.network.getTopDiv().removeChild(this.mark), this.mark = null, this.network.setSelectingElement(!1), this.timer && clearTimeout(this.timer) } else if (this._startTouchPoint) { this._zoomFlag = !1; var e = new Date(), f = this.network.getLogicalPoint(a), g = this.network.getElementAt(this._startTouchPoint); this._startTouchPoint && f && e.getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, f) <= 20 && (g ? this.network.getSelectionModel().contains(g) || this.network.getSelectionModel().setSelection(g) : this.network.getSelectionModel().clearSelection(), Cc.handleClicked(this.network, a, g), this.timer && clearTimeout(this.timer), this._endTouchTime && e.getTime() - this._endTouchTime.getTime() <= 500 && Tb.getDistance(this._endTouchPoint, f) <= 20 ? (delete this._endTouchTime, delete this._endTouchPoint, Cc.handleDoubleClicked(this.network, a, g), this.timer && clearTimeout(this.timer)) : (this._endTouchTime = e, this._endTouchPoint = f)) } }, getIntersectMode: function() { return this.network.getSelectMode() === 'intersect' ? !0 : this.network.getSelectMode() === 'contain' ? !1 : this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y } }), Ib.network.interaction.MSTouchInteraction = function(a) { Ib.network.interaction.MSTouchInteraction.superClass.constructor.call(this, a), this._pointerMap = {}, this._pointerIdArray = [] }, Jb.ext('twaver.network.interaction.MSTouchInteraction', Ib.network.interaction.BaseInteraction, { setUp: function() { var a = this.network.getView(); Wb.addEventListener('MSPointerDown', 'handleTouchstart', a, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', a, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', a, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', a, this) }, tearDown: function() { var a = this.network.getView(); Wb.removeEventListener('MSPointerDown', a, this), Wb.removeEventListener('MSPointerMove', a, this), Wb.removeEventListener('MSPointerUp', a, this), Wb.removeEventListener('MSPointerCancel', a, this) }, handleTouchstart: function(a) {
    if (this.network.isFocusOnClick() && Ib.Util.setFocus(this.network._view), !this.network.isSelectingElement() || a.pointerType != a.MSPOINTER_TYPE_MOUSE) {
      var b = this.network.getLogicalPoint(a), c = new Date()

      if (a.isPrimary && this._pointerIdArray.length > 0 && this.handle_mouseup(a), this._pointerMap[a.pointerId] || (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a), this._pointerIdArray.length == 1) { var d = this.network.getElementAt(b); this._startTouchElement = d, this._startClientPoint = { x: a.clientX, y: a.clientY }, Cc.handleClicked(this.network, a, d), this._startTouchTime && this._startTouchPoint && c.getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, b) <= 20 ? (Cc.handleDoubleClicked(this.network, a, d), this._doubleClick = !0) : (Wb.handle_mousedown(this, a), this._startTouchPoint = b, this._startTouchTime = c); var e = this.network.getSelectionModel(); d ? Jb.isCtrlDown(a) ? e.contains(d) ? e.removeSelection(d) : e.appendSelection(d) : e.contains(d) || e.setSelection(d) : Jb.isCtrlDown(a) || e.clearSelection() } else this._pointerIdArray.length == 2 && (this._distance = this._getDistance(), this._zoom = this.network.getZoom())
    }
  }, handleTouchmove: function(a) { if (this._startTouchPoint != null && this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 10) && (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2)) { var b = this._getDistance() / this._distance; this.network.setZoom(this._zoom * b, !1) } }, handleTouchend: function(a) { if (this.network.isMovingElement() && (this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: a })), this.network.isSelectingElement()) { var b = this.network.getElementsAtRect(this.mark._viewRect, this.getIntersectMode(), this.network.getRectSelectFilter()); if (b && b.size() > 0) { var c = this.network.getSelectionModel(), d = c.toSelection(); b.forEach(function(a) { c.contains(a) ? d.remove(a) : d.add(a) }, this), c.setSelection(d) } this.network.fireInteractionEvent({ kind: 'selectEnd', event: a }), this.network.getTopDiv().removeChild(this.mark), this.mark = null, this.network.setSelectingElement(!1) } this._doubleClick && (delete this._doubleClick, delete this._startTouchPoint, delete this._startTouchTime); for (var e = -1, f = 0; f < this._pointerIdArray.length; f++) if (this._pointerIdArray[f] == a.pointerId) { e = f; break }e >= 0 && this._pointerIdArray.splice(e, 1), delete this._pointerMap[a.pointerId] }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) }, getIntersectMode: function() { return this.network.getSelectMode() === 'intersect' ? !0 : this.network.getSelectMode() === 'contain' ? !1 : this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y }, handle_mousemove: function(a) { if (this._startTouchPoint && this._pointerIdArray.length == 1) { if (this._moveTouchPoint = { x: this._startTouchPoint.x + (a.clientX - this._startClientPoint.x) / this.network.getZoom(), y: this._startTouchPoint.y + (a.clientY - this._startClientPoint.y) / this.network.getZoom() }, Tb.getDistance(this._startTouchPoint, this._moveTouchPoint) < 3) return; if (this._startTouchElement == null && this.network.isRectSelectEnabled()) { this.mark ? this.network.fireInteractionEvent({ kind: 'selectBetween', event: a }) : (this.mark = Wb.createDiv(), this.network.getTopDiv().appendChild(this.mark), this.network.setSelectingElement(!0), this.network.fireInteractionEvent({ kind: 'selectStart', event: a })); var b = Tb.getRect([this._startTouchPoint, this._moveTouchPoint]); Wb.setDiv(this.mark, b, this.getIntersectMode() ? this.network.getSelectFillColor() : null, this.network.getSelectOutlineWidth(), this.network.getSelectOutlineColor()) } else { var c = this.network.getElementAt(this._moveTouchPoint), d = this._moveTouchPoint.x - this._startTouchPoint.x, e = this._moveTouchPoint.y - this._startTouchPoint.y; if (this._startTouchElement != null || this.network.isRectSelectEnabled())(this.network.isMovingElement() || this._startTouchElement != null && c == this._startTouchElement && this.network.getMovableSelectedElements().contains(c)) && (this.network.moveSelectedElements(d, e), this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a }))); else { this.network.panByOffset(-d, -e) } this._startClientPoint.x = a.clientX, this._startClientPoint.y = a.clientY } } }, handle_mouseup: function(a) { this.handleTouchend(a), this._pointerIdArray = [], this._pointerMap = {} } }); var Od = { _hitCanvas: null, getHitCanvas: function(a, b) { this._hitCanvas == null && (this._hitCanvas = Wb.createCanvas()), arguments.length == 0 && (a = 2, b = 2), this._hitCanvas.setAttribute('width', '' + a - 1), this._hitCanvas.setAttribute('height', '' + b - 1), this._hitCanvas.setAttribute('width', '' + a), this._hitCanvas.setAttribute('height', '' + b); var c = this.getCtx(this._hitCanvas); return c.clearRect(0, 0, a, b), this._hitCanvas }, disposeHitCanvas: function() { this._hitCanvas = null }, getCtx: function(a) { return a.getContext('2d') }, render: function(a, c, d) { c != b && (a.fillStyle = c, a.fill()), d != b && (a.strokeStyle = d, a.stroke()) }, text: function(a, b, c, d, e, f) { a.textAlign = 'center', a.textBaseline = 'middle', e != null && (a.fillStyle = e, a.fillText(b, c, d)), f && (a.strokeStyle = f, a.strokeText(b, c, d)) }, circle: function(a, b, c, d, e, f) { a.arc(b, c, d, 0, 2 * Math.PI, !0), a.closePath(), this.render(a, e, f) }, rect: function(a, b, c, d, e, f, g) { a.rect(b, c, d, e), a.closePath(), this.render(a, f, g) }, OUT_LEFT: 1, OUT_TOP: 2, OUT_RIGHT: 4, OUT_BOTTOM: 8, outcode: function(a, b, c, d, e, f) { var g = 0; return e <= 0 ? g |= this.OUT_LEFT | this.OUT_RIGHT : c > a ? g |= this.OUT_LEFT : a > c + e && (g |= this.OUT_RIGHT), f <= 0 ? g |= this.OUT_TOP | this.OUT_BOTTOM : d > b ? g |= this.OUT_TOP : b > d + f && (g |= this.OUT_BOTTOM), g }, intersectsLine: function(a, b, c, d, e, f, g, h) { var i, j; if ((j = this.outcode(c, d, e, f, g, h)) == 0) return !0; for (;(i = this.outcode(a, b, e, f, g, h)) != 0;) { if ((i & j) != 0) return !1; if ((i & (this.OUT_LEFT | this.OUT_RIGHT)) != 0) { var k = e; (i & this.OUT_RIGHT) != 0 && (k += g), b += (k - a) * (d - b) / (c - a), a = k } else { var l = f; (i & this.OUT_BOTTOM) != 0 && (l += h), a += (l - b) * (c - a) / (d - b), b = l } } return !0 } }; Ib.canvas = {}, Ib.canvas.interaction = {}, Ib.canvas.Network = function(a) { Ib.canvas.Network.superClass.constructor.apply(this, arguments), this._rootCanvas = Wb.createCanvas(), this._topCanvas = Wb.createCanvas(), this.realWidth = 0, this.realHeight = 0, this._unionBounds = { x: 0, y: 0, width: 0, height: 0 }, this._zoom = 1, this._elementUIMap = {}, this._visibleMap = {}, this.viewRect = { x: 0, y: 0, width: 0, height: 0 }, this.hScrollBarVisible = !1, this.vScrollBarVisible = !1, this.markerList = new Ib.List(), this._topAttachmentList = new Ib.List(), this.setElementBox(a || new Ib.ElementBox()), Mb || (this._view = Wb.createView('hidden'), this._view.appendChild(this._rootCanvas), this._view.appendChild(this._topCanvas), Qb.isTouchable ? Qb.isMSTouchable ? this.setMSTouchInteractions() : this.setTouchInteractions() : this.setDefaultInteractions(!1), this.setToolTipEnabled(Ib.Defaults.NETWORK_TOOLTIP_ENABLED)); var b = this; this._flowLink = function() { if (!(b.isMovingElement() || b.isSelectingElement() || b.isEditingElement() || b._box._layoutMovingElements)) { b._flowLinkQuickFinder || (b._flowLinkQuickFinder = new Ib.QuickFinder(b._box, 'link.flow', 'style')); var a = b._flowLinkQuickFinder.find(!0); a.forEach(function(a) { a._styleMap['link.flow.offset'] = b.getLinkFlowOffset(a); var c = b.getElementUI(a); c.invalidate(!1) }) } }, Ib.imageUtil.addEventListener(this.invalidateElementUIs, this) }, Jb.ext('twaver.canvas.Network', Ib.controls.View, { __accessor: ['selectMode', 'makeVisibleOnSelected', 'movableFunction', 'editPointSize', 'editPointFillColor', 'scrollBarWidth', 'editPointOutlineWidth', 'editPointOutlineColor', 'editLineColor', 'editLineWidth', 'resizePointSize', 'resizePointFillColor', 'resizePointOutlineWidth', 'resizePointOutlineColor', 'resizeLineColor', 'resizeLineWidth', 'rotatePointSize', 'rotatePointFillColor', 'rotatePointOffset', 'rotatePointOutlineWidth', 'rotatePointOutlineColor', 'rotateScaleFillColor', 'rotateScaleFontColor', 'rotateScaleWidth', 'rotateScaleHeight', 'selectOutlineColor', 'selectOutlineWidth', 'selectFillColor', 'lazyMoveOutlineColor', 'lazyMoveOutlineWidth', 'lazyMoveFillColor', 'rectSelectFilter', 'paddingRight', 'paddingBottom', 'selectionTolerance'], __bool: ['doubleClickToUpSubNetwork', 'doubleClickToSubNetwork', 'doubleClickToEmptySubNetwork', 'doubleClickToLinkBundle', 'doubleClickToGroupExpand', 'scrollBarVisible', 'limitViewInCanvas', 'autoValidateCanvasSize', 'subNetworkAnimate', 'lazyMoveAnimate', 'resizeAnimate', 'noAgentLinkVisible', 'keyboardRemoveEnabled', 'keyboardSelectEnabled', 'sendToTopOnSelected', 'lazyMoveFill', 'editingElement', 'rotatingElement', 'movingElement', 'selectingElement', 'rectSelectEnabled', 'limitElementInPositiveLocation', 'showRotateScale', 'transparentSelectionEnable', 'debug', 'showShadowInEdit'], _currentSubNetwork: null, _subNetworkAnimate: Ib.Defaults.NETWORK_SUBNETWORK_ANIMATE, _scrollBarWidth: 10, _scrollBarVisible: !0, _limitViewInCanvas: !0, _autoValidateCanvasSize: !0, _makeVisibleOnSelected: Ib.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: Ib.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: Ib.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED, _rectSelectEnabled: Ed.NETWORK_RECT_SELECT_ENABLED, _rectSelectFilter: null, _elementUIFunction: Ib.Defaults.CANVASUI_FUNCTION, _doubleClickToUpSubNetwork: Ib.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK, _doubleClickToSubNetwork: Ib.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK, _doubleClickToEmptySubNetwork: Ib.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK, _doubleClickToLinkBundle: Ib.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE, _doubleClickToGroupExpand: Ib.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND, _selectOutlineColor: Ib.Defaults.NETWORK_SELECT_OUTLINE_COLOR, _selectOutlineWidth: Ib.Defaults.NETWORK_SELECT_OUTLINE_WIDTH, _selectFillColor: Ib.Defaults.NETWORK_SELECT_FILL_COLOR, _sendToTopOnSelected: Ib.Defaults.NETWORK_SENDTOTOP_ON_SELECTED, _lazyMoveOutlineColor: Ib.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR, _lazyMoveOutlineWidth: Ib.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH, _lazyMoveFillColor: Ib.Defaults.NETWORK_LAZYMOVE_FILL_COLOR, _lazyMoveFill: Ib.Defaults.NETWORK_LAZYMOVE_FILL, _lazyMoveAnimate: Ib.Defaults.NETWORK_LAZYMOVE_ANIMATE, _resizePointSize: Ib.Defaults.NETWORK_RESIZE_POINT_SIZE, _resizePointFillColor: Ib.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR, _resizePointOutlineColor: Ib.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR, _resizePointOutlineWidth: Ib.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH, _resizeLineColor: Ib.Defaults.NETWORK_RESIZE_LINE_COLOR, _resizeLineWidth: Ib.Defaults.NETWORK_RESIZE_LINE_WIDTH, _resizeAnimate: Ib.Defaults.NETWORK_RESIZE_ANIMATE, _editPointSize: Ib.Defaults.NETWORK_EDIT_POINT_SIZE, _editPointFillColor: Ib.Defaults.NETWORK_EDIT_POINT_FILL_COLOR, _editPointOutlineColor: Ib.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR, _editPointOutlineWidth: Ib.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH, _editLineColor: Ib.Defaults.NETWORK_EDIT_LINE_COLOR, _editLineWidth: Ib.Defaults.NETWORK_EDIT_LINE_WIDTH, _rotatePointSize: Ib.Defaults.NETWORK_ROTATE_POINT_SIZE, _rotatePointFillColor: Ib.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR, _rotatePointOffset: Ib.Defaults.NETWORK_ROTATE_POINT_OFFSET, _rotatePointOutlineWidth: Ib.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH, _rotatePointOutlineColor: Ib.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR, _rotateScaleWidth: Ed.NETWORK_ROTATE_SCALE_WIDTH, _rotateScaleHeight: Ed.NETWORK_ROTATE_SCALE_HEIGHT, _rotateScaleFillColor: Ed.NETWORK_ROTATE_SCALE_FILL_COLOR, _rotateScaleFontColor: Ed.NETWORK_ROTATE_SCALE_FONT_COLOR, _limitElementInPositiveLocation: Ed.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION, _linkFlowInterval: Ed.NETWORK_LINK_FLOW_INTERVAL, _selectionTolerance: Ed.NETWORK_SELECTION_TOLERANCE, _invalidateElementVisibility: !1, _invalidateViewRectFlag: !1, _repaintTopFlag: !1, _invalidateCanvasSizeFlag: !1, _isEditingElement: !1, _isRotatingElement: !1, _isMovingElement: !1, _isSelectingElement: !1, _hasEditInteraction: !1, _showRotateScale: !0, _paddingRight: 0, _paddingBottom: 0, _transparentSelectionEnable: Ib.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE, _debug: !1, _showShadowInEdit: !1, adjustBounds: function(a) { if (Mb) this._rootCanvas = new Lb(a.width, a.height), this._topCanvas = new Lb(a.width, a.height), this.setViewRect(a.x, a.y, a.width, a.height); else { var b = !1, c = this._view.style; if (c.left == a.x + 'px' && c.top == a.y + 'px' && c.width == a.width + 'px' && c.height == a.height + 'px' && (b = !0), Ib.canvas.Network.superClass.adjustBounds.apply(this, arguments), b == 1) return; var d = this._view.offsetWidth, e = this._view.offsetHeight; this._rootCanvas.setAttribute('width', d), this._rootCanvas.setAttribute('height', e), this._topCanvas.setAttribute('width', d), this._topCanvas.setAttribute('height', e), this.setViewRect(this.viewRect.x, this.viewRect.y, d, e) } typeof Ib.gis === 'undefined' && (Ib.Util.makeHighRes(this._rootCanvas), Ib.Util.makeHighRes(this._topCanvas)), this.invalidateElementVisibility() }, getLabel: function(a) { return a.getStyle('network.label') || a.getName() }, getBackgroundImage: function() { return this._backgroundImage }, setBackgroundImage: function(a) { if (this._backgroundImage != a) { var b = this._backgroundImage; this._backgroundImage = a; var c = this._backgroundImage; if (c && !c._viewRect) if (c.width > 0)c._viewRect = { x: 0, y: 0, width: c.width, height: c.height }, this.validateCanvasSize(), this.firePropertyChange('backgroundImage', b, c); else { var d = this; c.onload = function() { c._viewRect = { x: 0, y: 0, width: c.width, height: c.height }, d.validateCanvasSize(), d.firePropertyChange('backgroundImage', b, c), c.onload = null } } else this.firePropertyChange('backgroundImage', b, c), this.validateCanvasSize() } }, getRootCanvas: function() { return this._rootCanvas }, getTopCanvas: function() { return this._topCanvas }, validateImpl: function() { if (!Mb && oc.twm(this), this._invalidateElementVisibility == 1) { this._invalidateElementVisibility = !1; var a, b, c, d = this.getElementBox().getDatas()._as, e = d.length, f = {}, g = this._visibleFunction, h = this._box._layerBox.size() === 1 ? this._box._layerBox._defaultLayer : null; for (a = 0; e > a; a++)b = d[a], f[b._id] = this.isVisible(b, g, h); if (this._visibleMap) for (a = 0; e > a; a++)b = d[a], f[b._id] !== this._visibleMap[b._id] && (c = this._elementUIMap[b._id], c && c.invalidate()); for (a = 0; e > a; a++)b = d[a], c = this._elementUIMap[b._id], c && c.validate(); this._visibleMap = f, this.paintRoot() } this.validateCanvasSize(), this._repaintTopFlag == 1 && (this._repaintTopFlag = !1, this.paintTopCanvas()) }, isLinkFlowEnabled: function() { return this._linkFlowEnabled ? !0 : !1 }, setLinkFlowEnabled: function(a) { a ? (this._linkFlowEnabled || (this._linkFlowEnabled = !0, this.firePropertyChange('linkFlowEnabled', !1, !0)), clearInterval(this._linkFlowTimerId), this._linkFlowTimerId = setInterval(this._flowLink, this._linkFlowInterval)) : (this._linkFlowEnabled && (this._linkFlowEnabled = !1, this.firePropertyChange('linkFlowEnabled', !0, !1)), clearInterval(this._linkFlowTimerId), delete this._linkFlowTimerId) }, getLinkFlowInterval: function() { return this._linkFlowInterval }, setLinkFlowInterval: function(a) { var b = this._linkFlowInterval; this._linkFlowInterval = a, this.firePropertyChange('linkFlowInterval', b, a), clearInterval(this._linkFlowTimerId), this.isLinkFlowEnabled() && (this._linkFlowTimerId = setInterval(this._flowLink, this._linkFlowInterval)) }, getElementBox: function() { return this._box }, setElementBox: function(a) { if (!a) throw 'ElementBox can not be null'; if (this._box !== a) { var b = this._box; b && (b.removeDataBoxChangeListener(this.handleElementBoxChange, this), b.removeDataPropertyChangeListener(this.handleElementPropertyChange, this), b.removePropertyChangeListener(this.handleElementBoxPropertyChange, this), b.removeIndexChangeListener(this.handleIndexChange, this), b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange, this), b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange, this), b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange, this), this._selectionModel || b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)), this._box = a, this._box.addDataBoxChangeListener(this.handleElementBoxChange, this), this._box.addDataPropertyChangeListener(this.handleElementPropertyChange, this), this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange, this), this._box.addIndexChangeListener(this.handleIndexChange, this), this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange, this), this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange, this), this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange, this), this._flowLinkQuickFinder && (this._flowLinkQuickFinder.dispose(), this._flowLinkQuickFinder = new Ib.QuickFinder(this._box, 'link.flow', 'style')), this._selectionModel ? this._selectionModel._setDataBox(a) : this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this), this._elementUIMap = {}, this._box.forEach(this.createElementUI, this), this.invalidateElementVisibility(), this.invalidateCanvasSize(), this.firePropertyChange('elementBox', b, this._box) } }, handleElementBoxChange: function(a) { var b = a.data; if (a.kind === 'add') this.createElementUI(b), this.invalidateBundleLink(b); else if (a.kind === 'remove') { var c = this.getElementUI(b); c && (c.dispose(), delete this._elementUIMap[b.getId()]), b === this._currentSubNetwork && this._currentSubNetwork != null && this._setCurrentSubNetwork(null) } else a.kind === 'clear' && (this._elementUIMap = {}, this._currentSubNetwork != null && this._setCurrentSubNetwork(null)); this.invalidateElementVisibility(), this.invalidateCanvasSize() }, handleElementPropertyChange: function(a) { var b = a.source, c = this.getElementUI(b); c && c.handlePropertyChange(a), this.invalidateBundleLink(b), this.invalidateElementVisibility(), this.invalidateCanvasSize() }, handleElementBoxPropertyChange: function() { this.invalidateElementVisibility() }, handleIndexChange: function(a) { this.invalidateElementVisibility() }, handleLayerBoxChange: function() { this.invalidateElementVisibility() }, handleLayerPropertyChange: function(a) { a.property === 'editable' && this.invalidateSelectedElementUIs(!0), this.invalidateElementVisibility() }, handleLayerHierarchyChange: function() { this.invalidateElementVisibility() }, handleSelectionChange: function(a) { a.datas.forEach(function(b) { var c = this.getElementUI(b); c && c.handleSelectionChange(a) }, this); var b = this.getSelectionModel().getLastData(); b && (a.kind === 'append' || a.kind === 'set') && (this.isMakeVisibleOnSelected() && this.makeVisible(b), this.isSendToTopOnSelected() && this.sendToTop(b)), this.invalidateElementVisibility() }, sendToTop: function(a) { if (this._box.contains(a)) { for (var b = a; b._parent && this.isVisible(b._parent) && (b = b._parent););b !== a && this._box.adjustElementIndex(b), this._box.adjustElementIndex(a) } }, getViewRect: function() { return this.viewRect ? Jb.clone(this.viewRect) : { x: 0, y: 0, width: 0, height: 0 } }, getCanvasSize: function() { return { width: this.realWidth, height: this.realHeight } }, setViewOffSet: function(a, b) { var c = this.viewRect.x, d = this.viewRect.y, e = this.viewRect.width, f = this.viewRect.height; this.setViewRect(c + a, d + b, e, f) }, setViewRect: function(a, b, c, d) { this.isLimitViewInCanvas() == 1 && (a < 0 && (a = 0), c > this.realWidth ? a = 0 : a + c > this.realWidth && (a = this.realWidth - c), b < 0 && (b = 0), d > this.realHeight ? b = 0 : b + d > this.realHeight && (b = this.realHeight - d)); var e = this.viewRect; (this.viewRect == null || a != this.viewRect.x || b != this.viewRect.y || c != this.viewRect.width || d != this.viewRect.height) && (this.viewRect = { x: a, y: b, width: c, height: d }, this.firePropertyChange('viewRect', e, this.viewRect), this.invalidateElementVisibility()) }, isHScrollBarVisible: function() { return this.hScrollBarVisible }, setHScrollBarVisible: function(a) { this.hScrollBarVisible = a }, isVScrollBarVisible: function() { return this.vScrollBarVisible }, setVScrollBarVisible: function(a) { this.vScrollBarVisible = a }, dispose: function() { Ib.imageUtil.removeEventListener(this.invalidateElementUIs, this); for (var a in this._elementUIMap) { var b = this._elementUIMap[a]; b.curInterval && clearTimeout(b.curInterval) } }, invalidateElementVisibility: function() { this._invalidateElementVisibility || (this._invalidateElementVisibility = !0, this.invalidate()) }, repaintTopCanvas: function() { this._repaintTopFlag || (this._repaintTopFlag = !0, this.invalidate()) }, invalidateCanvasSize: function(a) { this._invalidateCanvasSizeFlag || (this._invalidateCanvasSizeFlag = !0, this.invalidate()) }, validateCanvasSize: function() { this._invalidateCanvasSizeFlag != 0 && (this._invalidateCanvasSizeFlag = !1, this._validateCanvasSize()) }, _validateCanvasSize: function() { if (!this.isMovingElement()) { if (this.isAutoValidateCanvasSize() == 0) return this.realWidth = 0, this.realHeight = 0, void (this._unionBounds = { x: 0, y: 0, width: 0, height: 0 }); var a = this.getElementBox().getDatas(), b = a.size(); if (b > 0) { for (var c = { x: 0, y: 0, width: 0, height: 0 }, d = 0; b > d; d++) { var e = a.get(d); if (this._visibleMap[e._id]) { var f = this._elementUIMap[e._id]; f && (c = Tb.unionRect(c, f._viewRect)) } } var g = this.getBackgroundImage(); if (g && (c = Tb.unionRect(c, g._viewRect)), c.x < 0 && (c.width += c.x, c.x = 0), c.y < 0 && (c.height += c.y, c.y = 0), this.realWidth == (c.x + c.width) * this.getZoom() && this.realHeight == (c.y + c.height) * this.getZoom()) return; var h = this.getZoom(); this.realWidth = (c.x + c.width) * h + this._paddingRight, this.realHeight = (c.y + c.height) * h + this._paddingBottom, this._unionBounds = { x: c.x * h, y: c.y * h, width: c.width * h + this._paddingRight, height: c.height * h + this._paddingRight } } else this.realWidth = 0, this.realHeight = 0, this._unionBounds = { x: 0, y: 0, width: 0, height: 0 }; this.setViewRect(this.viewRect.x, this.viewRect.y, this.viewRect.width, this.viewRect.height), this.firePropertyChange('canvasSizeChange', null, this.viewRect) } }, getElementUI: function(a) { return a == null ? null : this._elementUIMap[a._id] }, createElementUI: function(a) { var b = this._elementUIMap[a.getId()]; b || (b = this._elementUIFunction(this, a), b && (this._elementUIMap[a.getId()] = b)) }, getElementUIFunction: function() { return this._elementUIFunction }, setElementUIFunction: function(a) { if (!a) throw 'ElementUIFunction can not be null'; if (this._elementUIFunction !== a) { var b = this._elementUIFunction; this._elementUIFunction = a, this.firePropertyChange('elementUIFunction', b, a), this._box.isEmpty() || (this._elementUIMap = {}, this._box.forEach(this.createElementUI, this), this.invalidateElementVisibility(), this.invalidateCanvasSize()) } }, invalidateElementUI: function(a, b) { var c = this.getElementUI(a); c && c.invalidate(b) }, invalidateElementUIs: function(a) { for (var b in this._elementUIMap) { var c = this._elementUIMap[b]; c.invalidate(a) } }, invalidateSelectedElementUIs: function(a) { this.getSelectionModel().getSelection().forEach(function(b) { this.invalidateElementUI(b, a) }, this) }, invalidateBundleLink: function(a) { if (a instanceof Ib.Link && a._bundleLinks) { var b = this._elementUIMap; a._bundleLinks.forEachSiblingLink(function(c) { if (c !== a) { var d = b[c._id]; d && d.invalidate(!1) } }, this) } }, paintRoot: function() { var a = this._rootCanvas.getContext('2d'); if (a.clearRect(0, 0, this._rootCanvas.width, this._rootCanvas.height), this.visibleList = new Ib.List(), this._topAttachmentList = new Ib.List(), this.getElementBox() != null) { ld.draw(a, this); var c = this.getElementBox().getDatas()._as, d = c.length; a.save(), a.scale(this.getZoom(), this.getZoom()), a.translate(-this.viewRect.x / this.getZoom(), -this.viewRect.y / this.getZoom()), this.paintBottom(a); var e = { x: this.viewRect.x / this.getZoom(), y: this.viewRect.y / this.getZoom(), width: this.viewRect.width / this.getZoom(), height: this.viewRect.height / this.getZoom() }, f = this.getBackgroundImage(), g = this.getBackgroundImageRect(); if (f instanceof Pb && (g ? a.drawImage(f, g.x, g.y, g.width, g.height) : a.drawImage(f, 0, 0, f.width, f.height), f._viewRect = { x: 0, y: 0, width: f.width, height: f.height }), typeof f === 'string') { var h = Jb.getImageAsset(f), i = { x: 0, y: 0, width: h.getWidth(), height: h.getHeight() }; Nc(a, f, null, i, null, this) } var j, k, l, m, n = this._box._layerBox; if (n.size() === 1) for (j = 0; d > j; j++)k = c[j], this._visibleMap[k._id] && (l = this._elementUIMap[k._id], l != null && this._isInView(l, e) ? (l.paint(a), l.setAttachmentVisible && l.setAttachmentVisible(!0), this.visibleList.add(k)) : l.setAttachmentVisible && l.setAttachmentVisible(!1)); else n.forEachByDepthFirst(function(b) { for (j = 0; d > j; j++)k = c[j], n.getLayerByElement(k) === b && this._visibleMap[k._id] && (l = this._elementUIMap[k._id], l != null && this._isInView(l, e) ? (l.paint(a), l.setAttachmentVisible && l.setAttachmentVisible(!0), this.visibleList.add(k)) : l.setAttachmentVisible && l.setAttachmentVisible(!1)) }, null, this); for (d = this._topAttachmentList.size(), j = 0; d > j; j++)m = this._topAttachmentList.get(j), m.getElementUI().paintAttachment(a, m); if (this._xyz) { var d, o = this._xyz, p = o.markText, q = o.type, r = (o.expired, o.innerHTML), s = 0, t = 0, u = this.viewRect; a.translate(this.viewRect.x / this.getZoom(), this.viewRect.y / this.getZoom()), a.scale(1 / this.getZoom(), 1 / this.getZoom()); { this.getZoom() }p != b && p != null && p != '' || q == '2' ? (a.font = '15px Arial sans-serif', d = Jb.g.getTextSize(a.font, r), a.fillStyle = 'red', s = u.width - d.width, t = u.height - 20) : (a.font = '10px Arial sans-serif', d = Jb.g.getTextSize(a.font, r), s = u.width / 2 - d.width / 2, t = u.height / 2), a.fillText(r, s, t) }a.restore() } }, paintBottom: function(a) {}, _isInView: function(a, b) { return Tb.intersects(b, a._viewRect) }, paintTopCanvas: function() { var a = this._topCanvas.getContext('2d'); a.clearRect(0, 0, this._topCanvas.width, this._topCanvas.height), this.paintMarker(a) }, paintMarker: function(a) { for (var b = this.markerList.size(), c = 0; b > c; c++) { var d = this.markerList.get(c); d.paint(a) } }, getLayerByElement: function(a) { return this._box.getLayerBox().getLayerByElement(a) }, getLogicalPoint: function(a) { var b; if (Qb.isTouchable && a.changedTouches && a.changedTouches.length > 0) { var c = this._view.getBoundingClientRect(), d = a.changedTouches[0], e = Qb.isAndroid ? 0 : zc.scrollLeft(), f = Qb.isAndroid ? 0 : zc.scrollTop(); return b = { x: (d.clientX + this.viewRect.x - c.left - e) / this._zoom, y: (d.clientY + this.viewRect.y - c.top - f) / this._zoom } } return b = Qb.isFirefox ? { x: (a.layerX + this.viewRect.x) / this.getZoom(), y: (a.layerY + this.viewRect.y) / this.getZoom() } : { x: (a.offsetX + this.viewRect.x) / this.getZoom(), y: (a.offsetY + this.viewRect.y) / this.getZoom() } }, getElementAt: function(a, b) { if (this.visibleList == null) return null; arguments.length === 1 && (b = !0); var c, d; if (a.target ? c = this.getLogicalPoint(a) : a.event ? a.event.target && (c = this.getLogicalPoint(a.event)) : c = a, this._topAttachmentList != null) for (var e = this._topAttachmentList.size(), f = e - 1; f >= 0; f--) { var g = this._topAttachmentList.get(f); if (d = g.getElement(), (!b || this.isSelectable(d)) && g.hit(c.x, c.y)) return d } if (this.visibleList != null) for (var h = this.visibleList.size(), i = h - 1; i >= 0; i--) { var j = this.visibleList.get(i), k = this.getElementUI(j); if ((!b || this.isSelectable(j)) && k && k.hit(c.x, c.y)) return j } return null }, hitTest: function(a) { var b = this.getElementAt(a); if (!b) return null; var c = this.getElementUI(b); if (!c) return null; var d; return d = a.target ? this.getLogicalPoint(a) : a, c.hitTest(d.x, d.y) }, getElementsAtRect: function(a, c, d, e) { var f = new Ib.List(); if (this.visibleList == null) return f; e = e === b ? !0 : e; for (var g = this.visibleList.size(), h = g - 1; h >= 0; h--) { var i = this.visibleList.get(h), j = this.getElementUI(i); j && (!d || d(j._element)) && (e && this.isSelectable(j._element) || !e) && (c ? j.intersects(a) && f.add(i) : Tb.contains(a, j.getViewRect()) && f.add(i)) } return f }, getPosition: function(a, b, c, d, e) { var f, g = b instanceof Ib.canvas.ElementUI ? b : this.getElementUI(b); if (g) if (a === 'from' || a === 'to') { if (g.getFromPosition && (f = a === 'from' ? g.getFromPosition(d, e) : g.getToPosition(d, e))) return c ? { x: f.x - c.width / 2, y: f.y - c.height / 2 } : f } else f = a === 'hotspot' ? g.getHotSpot() : Vb.get(a, g.getBodyRect(), c); if (!f && b.getRect && (f = Vb.get(a, b.getRect(), c)), f) return { x: f.x + d, y: f.y + e }; throw "position '" + a + "' object '" + b + "'" }, isValidEvent: function(a) { if (!a) return !1; var b, c; if (a.currentTarget === this._view) { if (Qb.isFirefox ? (b = a.layerX, c = a.layerY) : (b = a.offsetX, c = a.offsetY), this.isHScrollBarVisible() == 1 && c >= this.viewRect.height - this.getScrollBarWidth()) return !1; if (this.isVScrollBarVisible() == 1 && b >= this.viewRect.width - this.getScrollBarWidth()) return !1 } return !0 }, addMarker: function(a) { this.markerList.add(a), this.repaintTopCanvas() }, removeMarker: function(a) { this.markerList.remove(a), this.repaintTopCanvas() }, clearMarker: function() { this.markerList.clear(), this.repaintTopCanvas() }, isMovable: function(a) { return this._box.contains(a) ? a instanceof Ib.Link ? !1 : this._movableFunction && !this._movableFunction(a) ? !1 : this.getLayerByElement(a).isMovable() : !1 }, hasMovableSelectedElements: function() { for (var a = this.getSelectionModel().getSelection(), b = 0; b < a.size(); b++) { var c = a.get(b); if (this.isMovable(c)) return !0 } return !1 }, getMovableSelectedElements: function() { return this.getSelectionModel().toSelection(function(a) { return this.isMovable(a) }, this) }, moveSelectedElements: function(a, b, c, d) { if (a !== 0 || b !== 0) { var e = this.getMovableSelectedElementsRect(); e != null && (this._limitElementInPositiveLocation && (e.x + a < 0 && (a = -e.x), e.y + b < 0 && (b = -e.y)), Ib.Util.moveElements(this.getMovableSelectedElements(), a, b, c, d, this)) } }, getMovableSelectedElementsRect: function() { var a = this.getMovableSelectedElements(); if (a.size() === 0) return null; for (var b = null, c = 0, d = a.size(); d > c; c++) { var e = a.get(c); if (e instanceof Ld) { var f = this.getElementUI(e); f && (b = Tb.unionRect(b, f.getViewRect())) } } return b }, isVisible: function(a, b, c) { if (!this._box.contains(a)) return !1; if (!a.isVisible()) return !1; if (arguments.length !== 3 && (b = this._visibleFunction), b && !b(a)) return !1; if (!(c || this._box._layerBox.getLayerByElement(a))._visible) return !1; if (vc.getSubNetwork(a) !== this._currentSubNetwork) return !1; if (a instanceof Ib.Link) { if (!this._noAgentLinkVisible) { if (!a._fromAgent || !a._toAgent) return !1; if (!this.isVisible(a._fromAgent, b, c) || !this.isVisible(a._toAgent, b, c)) return !1 } if (a.getBundleIndex() > 0 && a.getBundleCount() > 1 && !a.getStyle('link.bundle.expanded')) return !1 } else for (var d = a._parent; d && !d.ISubNetwork;) { if (d instanceof Ib.Group && (!d.isExpanded() || !this.isVisible(d, b, c))) return !1; d = d._parent } return a.IDummy ? !1 : !0 }, getVisibleFunction: function() { return this._visibleFunction }, setVisibleFunction: function(a) { var b = this._visibleFunction; this._visibleFunction = a, this.firePropertyChange('visibleFunction', b, a), this.invalidateElementVisibility() }, isEditable: function(a) { return this._box.contains(a) ? this._editableFunction && !this._editableFunction(a) ? !1 : this.getLayerByElement(a).isEditable() : !1 }, getEditableFunction: function() { return this._editableFunction }, setEditableFunction: function(a) { var b = this._editableFunction; this._editableFunction = a, this.firePropertyChange('editableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, isRotatable: function(a) { return this._rotatableFunction && !this._rotatableFunction(a) ? !1 : !0 }, getRotatableFunction: function() { return this._rotatableFunction }, setRotatableFunction: function(a) { var b = this._rotatableFunction; this._rotatableFunction = a, this.firePropertyChange('rotatableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, isLinkable: function(a) { return this._linkableFunction == null || this._linkableFunction(a) }, getLinkableFunction: function() { return this._linkableFunction }, setLinkableFunction: function(a) { var b = this._linkableFunction; this._linkableFunction = a, this.firePropertyChange('linkableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, onShareSelectionModelChanged: function() { this.invalidateElementUIs() }, getShadowColor: function(a) { var b = a.getStyle('shadow.color'); return !b && this.isSelected(a) && a.getStyle('select.style') === 'shadow' ? a.getStyle('select.color') : b }, getSelectColor: function(a) { return a.getStyle('select.color') }, getAlarmLabel: function(a) { var b = a.getAlarmState().getHighestNewAlarmSeverity(); if (b) { var c = a.getAlarmState().getNewAlarmCount(b) + b.nickName; return a.getAlarmState().hasLessSevereNewAlarms() && (c += '+'), c } return null }, getLinkHandlerLabel: function(a) { return a.isBundleAgent() ? '+(' + a.getBundleCount() + ')' : null }, setInteractions: function(a) { var b = this._interactions; b && b.forEach(function(a) { a.tearDown() }), this._interactions = a, a && a.forEach(function(a) { a.setUp() }), this.invalidateSelectedElementUIs(!0), this.firePropertyChange('interactions', b, a) }, getInteractions: function() { return this._interactions }, setDefaultInteractions: function(a) { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.SelectInteraction(this), new Ib.canvas.interaction.MoveInteraction(this, a), new Ib.canvas.interaction.ScrollInteraction(this)]) }, setTouchInteractions: function() { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.SelectInteraction(this), new Ib.canvas.interaction.MoveInteraction(this, !1), new Ib.canvas.interaction.ScrollInteraction(this), new Ib.canvas.interaction.TouchInteraction(this)]) }, setMSTouchInteractions: function() {
    this.setInteractions([new Ib.canvas.interaction.ScrollInteraction(this), new Ib.canvas.interaction.MSTouchInteraction(this)])
  }, setEditInteractions: function(a) { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.SelectInteraction(this), new Ib.canvas.interaction.EditInteraction(this, a), new Ib.canvas.interaction.MoveInteraction(this, a), new Ib.canvas.interaction.ScrollInteraction(this)]) }, setCreateElementInteractions: function(a) { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.CreateElementInteraction(this, a)]) }, setCreateLinkInteractions: function(a) { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.CreateLinkInteraction(this, a), new Ib.canvas.interaction.ScrollInteraction(this)]) }, setCreateShapeLinkInteractions: function(a) { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.CreateShapeLinkInteraction(this, a), new Ib.canvas.interaction.ScrollInteraction(this)]) }, setCreateShapeNodeInteractions: function(a) { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.CreateShapeNodeInteraction(this, a), new Ib.canvas.interaction.ScrollInteraction(this)]) }, setPanInteractions: function() { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.PanInteraction(this), new Ib.canvas.interaction.ScrollInteraction(this)]) }, setMagnifyInteractions: function() { this.setInteractions([new Ib.canvas.interaction.DefaultInteraction(this), new Ib.canvas.interaction.SelectInteraction(this), new Ib.canvas.interaction.MoveInteraction(this), new Ib.canvas.interaction.ScrollInteraction(this), new Ib.canvas.interaction.MagnifyInteraction(this)]) }, hasEditInteraction: function() { return this._hasEditInteraction }, setHasEditInteraction: function(a) { var b = this._hasEditInteraction; this._hasEditInteraction = a, this.firePropertyChange('hasEditInteraction', b, a) }, addElementByInteraction: function(a) { a.getParent() || a.setParent(this._currentSubNetwork), this._box.add(a), this.getSelectionModel().setSelection(a), this.fireInteractionEvent({ kind: 'createElement', element: a }) }, getToolTip: function(a) { if (a) { var b = a.getToolTip(); return b || a.getName() } return null }, isToolTipEnabled: function() { return this._toolTipEnabled ? !0 : !1 }, setToolTipEnabled: function(a) { if (this._toolTipEnabled = a, a) { if (!this._toolTipListener) { var b = this; this._toolTipListener = function(a) { if (b.isMovingElement()) return void Bc.hideToolTip(); var c = b.getElementAt(a); if (b._preElement !== c) if (b._preElement = c, c) { var d = b.getToolTip(c); Bc.showToolTip({ x: a.pageX, y: a.pageY }, d); var e = Bc.getToolTipDiv(), e = Bc.getToolTipDiv(); if (e.children.length > 0) { var f = b._view.getBoundingClientRect(), g = e.getBoundingClientRect(); g.width + g.left > f.width + f.left && (e.style.left = f.width + f.left - g.width + (Ob.documentElement.scrollLeft || Ob.body.scrollLeft) + 'px'), g.height + g.top > f.height + f.top && (e.style.top = f.height + f.top - g.height + (Ob.documentElement.scrollTop || Ob.body.scrollTop) + 'px') } } else Bc.hideToolTip() }, this._view.addEventListener('mousemove', this._toolTipListener, !1), this.firePropertyChange('toolTipEnabled', !1, !0) } } else this._toolTipListener && (Bc.hideToolTip(), this._view.removeEventListener('mousemove', this._toolTipListener, !1), delete this._toolTipListener, this.firePropertyChange('toolTipEnabled', !0, !1)) }, setZoom: function(a) { a = this.checkZoom(a); var b = this._zoom; if (this._zoom != a) { var c = { x: (this.viewRect.x + this.viewRect.width / 2) / this.getZoom() * a, y: (this.viewRect.y + this.viewRect.height / 2) / this.getZoom() * a }; this._zoom = a, this.invalidateElementVisibility(), this.invalidateCanvasSize(), this.validateCanvasSize(), this.setViewRect(c.x - this.viewRect.width / 2, c.y - this.viewRect.height / 2, this.viewRect.width, this.viewRect.height), this.firePropertyChange('zoom', b, this._zoom) } }, getZoom: function() { return this._zoom }, setTouchZoom: function(a) { this.setZoom(a, !1) }, zoomOverview: function(a) { if (!(this.realWidth <= 0 || this.realHeight <= 0)) { var b = this.realWidth / this.getZoom(), c = this.realHeight / this.getZoom(), d = this.viewRect.width / b, e = this.viewRect.height / c, f = Math.min(d, e); this.setZoom(f) } }, zoomReset: function() { this.setZoom(1) }, zoomIn: function() { this.setZoom(1.2 * this.getZoom()) }, zoomOut: function() { this.setZoom(this.getZoom() / 1.2) }, upSubNetwork: function(a, b) { this._currentSubNetwork && this.setCurrentSubNetwork(vc.getSubNetwork(this._currentSubNetwork), a, b) }, getCurrentSubNetwork: function() { return this._currentSubNetwork }, setCurrentSubNetwork: function(a, b, c) { if (Ib.animate.AnimateManager.endAnimate(), b) { if (this._currentSubNetwork === a) return; if (a && !this._box.contains(a)) throw a + " is not contained in this network's elementBox"; var d = new Ib.animate.AnimateSubNetwork(this, a, c); Ib.animate.AnimateManager.start(d) } else this._setCurrentSubNetwork(a), c && c() }, _setCurrentSubNetwork: function(a) { if (this._currentSubNetwork !== a) { if (a && !this._box.contains(a)) throw a + " is not contained in this network's elementBox"; var b = this._currentSubNetwork; this._currentSubNetwork = a, this.firePropertyChange('currentSubNetwork', b, a), this.invalidateElementVisibility(), this.invalidateCanvasSize() } }, makeVisible: function(a) { var b = this.getElementUI(a); if (b) { var c = vc.getSubNetwork(a); if (c !== this._currentSubNetwork) { var d = this; return void this.setCurrentSubNetwork(c, this.isSubNetworkAnimate(), function() { Jb.callLater(d.makeVisible, d, [a]) }) } for (var e = a; (e = e.getParent()) && e !== c;)e instanceof Ib.Group && e.setExpanded(!0); var f = b.getViewRect(); if (f) { var g = { x: f.x * this.getZoom(), y: f.y * this.getZoom(), width: f.width * this.getZoom(), height: f.height * this.getZoom() }; Tb.intersects(this.viewRect, g) || this.isVisible(a) && Jb.callLater(this.centerByLogicalPoint, this, [g.x + g.width / 2, g.y + g.height / 2]) } } }, centerByLogicalPoint: function(a, b, c) { var d = a - this.viewRect.width / 2, e = b - this.viewRect.height / 2; this.setViewRect(d, e, this.viewRect.width, this.viewRect.height) }, panByOffset: function(a, b) { this.setViewOffSet(a, b) }, getIconsNames: function(a) { return a.getStyle('icons.names') }, getIconsColors: function(a) { return a.getStyle('icons.colors') }, getLinkFlowStepping: function(a) { var b = parseInt(a.getStyle('link.flow.stepping')); return b || (b = Ed.NETWORK_LINK_FLOW_STEPPING), b }, getLinkFlowOffset: function(a) { var b = a.getStyle('link.flow.offset'); return isNaN(b) && (b = 0), b + this.getLinkFlowStepping(a) }, toCanvas: function(a, b, c) { c || (c = Wb.createCanvas()), c.setAttribute('width', a), c.setAttribute('height', b), c._viewRect ? (c._viewRect.width = a, c._viewRect.height = b) : c._viewRect = { x: 0, y: 0, width: a, height: b }; var d = c.getContext('2d'); if (d.clearRect(0, 0, a, b), ld.draw(d, this), this._view.clientWidth === 0 || this._view.clientHeight === 0) return c; var e = a / this.realWidth * this._zoom, f = b / this.realHeight * this._zoom; d.scale(e, f); var g = this.getBackgroundImage(); if (g && g._viewRect) { var h = g._viewRect; try { d.drawImage(g, h.x, h.y, h.width, h.height) } catch (i) {} } var j = this.getElementBox().getDatas()._as, k = j.length; this._topAttachmentList = new Ib.List(); var l, m, n, o, p, q, r = this.getElementBox().getLayerBox(), s = r.getRoots(), t = s.size(); if (t === 1) for (n = 0; k > n; n++)o = j[n], this._visibleMap[o._id] && (p = this._elementUIMap[o._id], p != null && p.paint(d)); else for (l = 0; t > l; l++) for (m = s.get(l), n = 0; k > n; n++)o = j[n], r.getLayerByElement(o) === m && this._visibleMap[o._id] && (p = this._elementUIMap[o._id], p != null && p.paint(d)); for (k = this._topAttachmentList.size(), n = 0; k > n; n++)q = this._topAttachmentList.get(n), q.getElementUI().paintAttachment(d, q); return c }, toCanvasByRegion: function(a, b, c) { c || (c = Wb.createCanvas()); var d = a.width * b, e = a.height * b; c.setAttribute('width', d), c.setAttribute('height', e), c._viewRect ? (c._viewRect.width = d, c._viewRect.height = e) : c._viewRect = { x: 0, y: 0, width: d, height: e }; var f = c.getContext('2d'); if (f.clearRect(0, 0, d, e), ld.draw(f, this), this._view.clientWidth === 0 || this._view.clientHeight === 0) return c; f.save(), f.scale(b, b), f.beginPath(), f.translate(-a.x, -a.y); var g = this.getElementBox().getDatas()._as, h = g.length; this._topAttachmentList = new Ib.List(); var i = this.getBackgroundImage(); if (i && i._viewRect && Tb.intersects(a, i._viewRect)) { var a = Tb.intersection(a, i._viewRect), j = i._viewRect; try { f.drawImage(i, j.x, j.y, j.width, j.height) } catch (k) {} } var l, m, n, o, p, q, r = this.getElementBox().getLayerBox(), s = r.getRoots(), t = s.size(); if (t === 1) for (n = 0; h > n; n++)o = g[n], this._visibleMap[o._id] && (p = this._elementUIMap[o._id], p != null && Tb.intersects(a, p._viewRect) && p.paint(f)); else for (l = 0; t > l; l++) for (m = s.get(l), n = 0; h > n; n++)o = g[n], r.getLayerByElement(o) === m && this._visibleMap[o._id] && (p = this._elementUIMap[o._id], p != null && Tb.intersects(a, p._viewRect) && p.paint(f)); for (h = this._topAttachmentList.size(), n = 0; h > n; n++)q = this._topAttachmentList.get(n), q.getElementUI().paintAttachment(f, q); return f.restore(), c }, getGroupChildrenRects: function(a) { var b = new nd(); return a.getChildren().forEach(function(a) { if (a instanceof Ld) { var c = this.getElementUI(a); if (c) { var d = c.getViewRect(); d && b.add(d) } } }, this), b }, getBackgroundImageRect: function() { return null }, getLinkPathFunction: function() { return this._linkPathFunction }, setLinkPathFunction: function(a) { var b = this._linkPathFunction; this._linkPathFunction = a, this.firePropertyChange('linkPathFunction', b, a), this.invalidateElementUIs() }, onClickElement: function(a, b) {}, onClickBackground: function(a) {}, onDoubleClickElement: function(a, b) {}, onDoubleClickBackground: function(a) {}, onLongClickElement: function(a, b) {}, onLongClickBackground: function(a) {}, onMouseMove: function(a, b) {}, onMouseEnter: function(a, b) {}, onMouseLeave: function(a, b) {}, setMovingElement: function(a) { if (a != this._movingElement) { var b = this._movingElement; this._movingElement = a, this.firePropertyChange('movingElement', b, a), this._box._undoManager._enabled && (a ? this._box._undoManager.startBatch() : this._box._undoManager.endBatch()) } }, setEditingElement: function(a) { if (a != this._editingElement) { var b = this._editingElement; this._editingElement = a, this.firePropertyChange('editingElement', b, a), this._box._undoManager._enabled && (a ? this._box._undoManager.startBatch() : this._box._undoManager.endBatch()) } } }), Ib.canvas.Overview = function(a) { Ib.canvas.Overview.superClass.constructor.apply(this, a), this._view = Wb.createView(), this._rootDiv = Wb.createDiv(), this._imageCanvas = Wb.createCanvas(), this._imageDiv = Wb.createDiv(), this._maskCanvas = Wb.createCanvas(), this._selectDiv = Wb.createDiv(), this._isNetworkDirty = !1, this._isMaskDirty = !1, Wb.setVisible(this._selectDiv, !1), this._view.appendChild(this._rootDiv), this._rootDiv.appendChild(this._imageDiv), this._rootDiv.appendChild(this._maskCanvas), this._rootDiv.appendChild(this._selectDiv), this._imageDiv.appendChild(this._imageCanvas), this.setNetwork(a), Qb.isTouchable ? Qb.isMSTouchable ? new Ib.canvas.OverviewMSTouchInteraction(this) : (new Ib.canvas.OverviewTouchInteraction(this), new Ib.canvas.OverviewInteraction(this)) : new Ib.canvas.OverviewInteraction(this) }, Jb.ext('twaver.canvas.Overview', Ib.controls.ControlBase, { __accessor: ['fillColor', 'outlineColor', 'outlineWidth', 'selectColor', 'selectWidth', 'padding', 'maxPackingWidth', 'maxPackingHeight'], __bool: ['animate'], _fillColor: Ed.OVERVIEW_FILL_COLOR, _outlineColor: Ed.OVERVIEW_OUTLINE_COLOR, _outlineWidth: Ed.OVERVIEW_OUTLINE_WIDTH, _selectColor: Ed.OVERVIEW_SELECT_COLOR, _selectWidth: Ed.OVERVIEW_SELECT_WIDTH, _padding: Ed.OVERVIEW_PADDING, _animate: Ed.OVERVIEW_ANIMATE, _maxPackingWidth: Ed.OVERVIEW_MAX_PACKING_WIDTH, _maxPackingHeight: Ed.OVERVIEW_MAX_PACKING_HEIGHT, getNetwork: function() { return this._network }, onPropertyChanged: function(a) { this._invalidateMask() }, setNetwork: function(a) { a !== this._network && (this._network && (this._network.removePropertyChangeListener(this._handleNetworkPropertyChange, this), this._network.removeViewListener(this._handleNetworkViewChange, this), Wb.removeEventListener('scroll', '_handleScrollChange', this._network.getView(), this)), this._network = a, this._network && (this._network.addPropertyChangeListener(this._handleNetworkPropertyChange, this), this._network.addViewListener(this._handleNetworkViewChange, this), Wb.addEventListener('scroll', '_handleScrollChange', this._network.getView(), this)), this.invalidate()) }, _handleNetworkPropertyChange: function(a) { (a.property === 'zoom' || a.property === 'currentSubNetwork' || a.property === 'elementBox' || a.property === 'dataBox' || a.property === 'canvasSizeChange') && this.invalidate() }, _handleNetworkViewChange: function(a) { a.kind === 'validateEnd' && this.invalidate() }, _handleScrollChange: function() { this._invalidateMask() }, invalidate: function(a) { this._isNetworkDirty && this._isMaskDirty || (this._isNetworkDirty || (this._isNetworkDirty = !0), this._isMaskDirty || (this._isMaskDirty = !0), Jb.callLater(this.validate, this, null, a)) }, _invalidateMask: function() { this._isMaskDirty || (this._isMaskDirty = !0, Jb.callLater(this.validate, this, [], 100)) }, validate: function() { if ((this._isMaskDirty || this._isNetworkDirty) && this._network && (this._maxPackingWidth > 0 && this._maxPackingHeight > 0 || this._view.clientWidth > 0 && this._view.clientHeight > 0) && this._network.getViewRect().width !== 0 && this._network.getViewRect().height !== 0 && !this._network._invalidate) { var a, b = this._maxPackingWidth > 0 && this._maxPackingHeight > 0; a = b ? { x: 0, y: 0, width: this._maxPackingWidth, height: this._maxPackingHeight } : { x: 0, y: 0, width: this._view.clientWidth, height: this._view.clientHeight }, Tb.grow(a, -this._padding, -this._padding); var c = Math.min(a.width / this._network.getCanvasSize().width, a.height / this._network.getCanvasSize().height); b && (Wb.setDiv(this._view, { x: 0, y: 0, width: this._imageDiv._viewRect.width, height: this._imageDiv._viewRect.height }, null, 0, null), a.width = this._imageDiv._viewRect.width, a.height = this._imageDiv._viewRect.height); var d = this._network.getCanvasSize().width * c, e = this._network.getCanvasSize().height * c, f = a.x + (a.width - d) / 2, g = a.y + (a.height - e) / 2; if (this._isNetworkDirty) { var h = { x: f, y: g, width: d, height: e }; this._network.toCanvas(h.width, h.height, this._imageCanvas), Wb.setDiv(this._imageDiv, h, null, 0, null), this._network.getElementBox && (this._imageDiv.style.backgroundColor = (this._network.getCurrentSubNetwork() || this._network.getElementBox()).getStyle('background.color') || ''), this._isNetworkDirty = !1 } if (this._isMaskDirty) { var i = { x: this._network.getViewRect().x * c, y: this._network.getViewRect().y * c, width: d * this._network._view.clientWidth / this._network.getCanvasSize().width, height: e * this._network._view.clientHeight / this._network.getCanvasSize().height }; i.x = i.x < 0 ? 0 : i.x, i.y = i.y < 0 ? 0 : i.y; var j = Wb.setCanvas(this._maskCanvas, f, g, d, e); j.lineWidth = 0, j.fillStyle = this._fillColor, j.beginPath(), Xb.drawVector(j, 'rectangle', null, f, g, d, e), j.fill(), j.clearRect(f + i.x, g + i.y, i.width, i.height); var k = this._outlineWidth < 0 ? 0 : this._outlineWidth; j.lineWidth = k, j.strokeStyle = this._outlineColor; var l = i.width - 2 * k, m = i.height - 2 * k; l = Math.min(l, d - 2 - i.x - this._outlineWidth), m = Math.min(m, e - 2 - i.y - this._outlineWidth), j.beginPath(), Xb.drawVector(j, 'rectangle', null, f + i.x + k, g + i.y + k, l, m), k >= 0 && j.stroke(), this._isMaskDirty = !1 } } else this._isNetworkDirty = !1, this._isMaskDirty = !1 }, getLogicalPoint: function(a) { return Wb.getLogicalPoint(this._view, a, 1, this._rootDiv) }, centerNetwork: function(a, b) { var c = this._imageDiv._viewRect; Tb.containsPoint(c, a) && (this._network.centerByLogicalPoint((a.x - c.x) / c.width * this._network.getCanvasSize().width, (a.y - c.y) / c.height * this._network.getCanvasSize().height, b), this._invalidateMask()) } }), Ib.canvas.OverviewTouchInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, Wb.addEventListener('touchstart', 'handleTouchstart', this.view, this) }, Jb.ext('twaver.canvas.OverviewTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a), this.clear(), this.endPoint = this.overview.getLogicalPoint(a), zc.isMultiTouch(a) && (this.distance = zc.getDistance(a), this.zoom = this.network.getZoom()), Wb.addEventListener('touchmove', 'handleTouchmove', this.view, this), Wb.addEventListener('touchend', 'handleTouchend', this.view, this) }, handleTouchmove: function(a) { if (this.moved || (this.moved = !0), this.endPoint = this.overview.getLogicalPoint(a), zc.isSingleTouch(a)) this.overview.centerNetwork(this.endPoint, !1); else if (this.distance) { var b = zc.getDistance(a) / this.distance; this.network.setZoom(this.zoom * b, !1) } }, handleTouchend: function(a) { if (!this.moved) { this.endPoint = this.overview.getLogicalPoint(a); var b = this.lastPoint && this.lastTouchStartTime && (new Date()).getTime() - this.lastTouchStartTime.getTime() <= 300 && Math.abs(this.endPoint.x - this.lastPoint.x) <= 10 && Math.abs(this.endPoint.y - this.lastPoint.y) <= 10; b ? (this.lastPoint = null, this.lastTouchStartTime = null) : (this.lastPoint = this.endPoint, this.lastTouchStartTime = new Date()), b ? Jb.callLater(this.network.zoomReset, this.network, [this.overview._animate]) : this.overview.centerNetwork(this.endPoint, this.overview._animate) } this.clear() }, clear: function() { this.endPoint && (this.endPoint = null, Wb.removeEventListener('touchmove', this.view, this), Wb.removeEventListener('touchend', this.view, this)), this.moved = !1 } }), Ib.canvas.OverviewMSTouchInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, this._pointerMap = {}, this._pointerIdArray = [], Wb.addEventListener('MSPointerDown', 'handleTouchstart', this.view, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', this.view, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', this.view, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', this.view, this) }, Jb.ext('twaver.canvas.OverviewMSTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a), a.isPrimary && this._pointerIdArray.length > 0 && (this._pointerMap = {}, this._pointerIdArray = []), !this._pointerMap[a.pointerId] && this.overview.getLogicalPoint(a) && (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a), this._pointerIdArray.length == 1 ? (this._startTouchPoint = this.overview.getLogicalPoint(a), this._startTouchTime = new Date()) : this._pointerIdArray.length == 2 && (this._distance = this._getDistance(), this._zoom = this.network.getZoom()) }, handleTouchmove: function(a) { if (this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 10)) if (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2) { var b = this._getDistance() / this._distance; this.network.setZoom(this._zoom * b, !1) } else if (this._pointerIdArray.length == 1 && this._startTouchPoint) { var c = this.overview.getLogicalPoint(a); if (c == null) return; this._startTouchPoint = c, this.overview.centerNetwork(this._startTouchPoint, !1) } }, handleTouchend: function(a) { var b = this.overview.getLogicalPoint(a); if (this._pointerIdArray.length == 1 && b) { var c = this._endTouchPoint && this._endTouchTime && (new Date()).getTime() - this._endTouchTime.getTime() <= 500 && Tb.getDistance(this._endTouchPoint, b) <= 10; c ? (this._endTouchPoint = null, this._endTouchTime = null) : (this._endTouchPoint = b, this._endTouchTime = new Date()), c ? Jb.callLater(this.network.zoomReset, this.network, [this.overview._animate]) : this.overview.centerNetwork(this._endTouchPoint, this.overview._animate) } this._pointerMap = {}, this._pointerIdArray = [] }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) } }), Ib.canvas.OverviewInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, Wb.addEventListener('mousedown', 'handleMousedown', this.view, this) }, Jb.ext('twaver.canvas.OverviewInteraction', Object, { handleMousedown: function(a) { a.button === 0 && (this.clear(), this.endPoint = this.overview.getLogicalPoint(a), Jb.isCtrlDown(a) && (this.startPoint = this.endPoint, Wb.setVisible(this.overview._selectDiv, !0)), Wb.addEventListener('mousemove', 'handleMousemove', this.view, this), Wb.addEventListener('mouseup', 'handleMouseup', this.view, this)) }, handleMouseup: function(a) { if (this.endPoint = this.overview.getLogicalPoint(a), 'detail' in a && a.detail === 2)Jb.callLater(this.network.zoomReset, this.network, [this.overview._animate]); else if (Wb.isVisible(this.overview._selectDiv) && this.startPoint) { var b = this.overview._imageDiv._viewRect, c = this.overview._selectDiv._viewRect.x, d = this.overview._selectDiv._viewRect.y, e = b.width / this.overview._selectDiv._viewRect.width, f = b.height / this.overview._selectDiv._viewRect.height, g = Math.min(e, f); this.network.setZoom(g * Math.min(this.network.getViewRect().width / this.network.getCanvasSize().width, this.network.getViewRect().height / this.network.getCanvasSize().height) * this.network.getZoom(), !1); var h = this.network.getCanvasSize().width * ((c - b.x + this.overview._selectDiv._viewRect.width / 2) / b.width), i = this.network.getCanvasSize().height * ((d - b.y + this.overview._selectDiv._viewRect.height / 2) / b.height); Jb.callLater(this.network.centerByLogicalPoint, this.network, [h, i, this.overview._animate]), Wb.setVisible(this.overview._selectDiv, !1), Wb.setDiv(this.overview._selectDiv, { x: 0, y: 0, width: 0, height: 0 }, null, 0, null), this.startPoint = null } else this.overview.centerNetwork(this.endPoint, this.overview._animate); this.clear() }, handleMousemove: function(a) { var b = this.overview.getLogicalPoint(a); if (this.endPoint = b, Wb.isVisible(this.overview._selectDiv) && this.startPoint) { var c = b.x > this.startPoint.x ? this.startPoint.x : b.x, d = b.x > this.startPoint.x ? this.startPoint.y : b.y; b.x > this.startPoint.x && b.y < this.startPoint.y && (d = b.y), b.x < this.startPoint.x && b.y > this.startPoint.y && (d = this.startPoint.y); var e = this.overview._imageDiv._viewRect; c < e.x && (c = e.x), c > e.x + e.width && (c = e.x + e.width), d < e.y && (d = e.y), d > e.y + e.height && (d = e.y + e.height); var f = Math.abs(b.x - this.startPoint.x), g = Math.abs(b.y - this.startPoint.y); c + f > e.x + e.width && (f = e.x + e.width - c), d + g > e.y + e.height && (g = e.y + e.height - d), Wb.setDiv(this.overview._selectDiv, { x: c, y: d, width: f, height: g }, null, this.overview._selectWidth, this.overview._selectColor) } else this.overview.centerNetwork(b, !1) }, clear: function() { this.endPoint && (this.endPoint = null, Wb.removeEventListener('mousemove', this.view, this), Wb.removeEventListener('mouseup', this.view, this)) } }), Ib.canvas.ElementUI = function(a, b) { this._network = a, this._element = b, this._attachments = new Ib.List(), this._bodyBounds = new Ib.List(), this._hitTest = !1, this._hitTest = !1, this._intersectTest = !1, this.invalidate(!0) }, Jb.ext('twaver.canvas.ElementUI', Object, { getElement: function() { return this._element }, getNetwork: function() { return this._network }, handlePropertyChange: function(a) { this.invalidate(!0) }, handleSelectionChange: function(a) { this.invalidate(!0) }, invalidate: function(a) { a === b && (a = !0), a && (this._invalidateAttachmentsFlag = !0), this._invalidateFlag || (this._hotSpot = null, this._bodyRect = null, this._invalidateFlag = !0, this._network.invalidateElementVisibility()) }, updateStyle: function() { this._innerColor = this._network.getInnerColor(this._element), this._outerColor = this._network.getOuterColor(this._element), this._shadowColor = this._network.getShadowColor(this._element), this._shadowXOffset = this._element.getStyle('shadow.xoffset'), this._shadowYOffset = this._element.getStyle('shadow.yoffset'), this._shadowBlur = this._element.getStyle('shadow.blur'), this._wholeAlpha = this._element.getStyle('whole.alpha') }, validate: function() { if (this._invalidateFlag != 0) { this._bodyBounds.clear(), this._invalidateAttachmentsFlag && (this._invalidateAttachmentsFlag = !1, this.checkAttachments()), this._invalidateFlag = !1, this.updateStyle(), this.validateImpl(), this._attachments.forEach(function(a) { a.validate() }); var a; this._bodyBounds.forEach(function(b) { a = Tb.unionRect(a, b) }), this._unionBodyBounds = Jb.clone(a), this._attachments.forEach(function(b) { a = Tb.unionRect(a, b.getViewRect()) }), this._viewRect = a } }, validateImpl: function() {}, setShadow: function(a, b) { var c = a.isShadowable() && this._shadowColor && !this._editAttachment; return b.shadowOffsetX === this._shadowXOffset && b.shadowOffsetY === this._shadowYOffset && b.shadowBlur === this._shadowBlur ? b : ((c || this._network._showShadowInEdit) && (b.shadowOffsetX = this._shadowXOffset, b.shadowOffsetY = this._shadowYOffset, b.shadowBlur = this._shadowBlur, b.shadowColor = this._shadowColor), b) }, clearShadow: function(a) { (a.shadowOffsetX != 0 || a.shadowOffsetY != 0 || a.shadowBlur != 0) && (a.shadowOffsetX = 0, a.shadowOffsetY = 0, a.shadowBlur = 0) }, appendShadowBound: function(a, b) { var c = a.isShadowable() && this._shadowColor && !this._editAttachment; return c && (this._shadowXOffset > 0 ? b.width += this._shadowXOffset : (b.x += this._shadowXOffset, b.width += -this._shadowXOffset), this._shadowYOffset > 0 ? b.height += this._shadowYOffset : (b.y += this._shadowYOffset, b.height += -this._shadowYOffset), Tb.grow(b, this._shadowBlur, this._shadowBlur)), b }, isShadowable: function() { return this._shadowColor && this._network.isSelected(this._element) && this._element.getStyle('select.style') === 'shadow' ? !0 : !1 }, addAttachment: function(a) { this._attachments.add(a) }, removeAttachment: function(a) { this._attachments.remove(a) }, getAttachments: function() { return this._attachments }, checkAttachments: function() { this.checkLabelAttachment(), this.checkAlarmAttachment(), this.checkIconsAttachment(), this.checkEditAttachment() }, checkLabelAttachment: function() { var a = this._network.getLabel(this._element); a != null && a !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.canvas.LabelAttachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkAlarmAttachment: function() { var a = this._network.getAlarmLabel(this._element); a != null && a !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.canvas.AlarmAttachment(this, Ed.SHOW_ALARM_IN_ATTACHMENT_DIV), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) }, checkIconsAttachment: function() { var a = this._network.getIconsNames(this._element); a && a.length > 0 ? this._iconsAttachment || (this._iconsAttachment = new Ib.canvas.IconsAttachment(this), this.addAttachment(this._iconsAttachment)) : this._iconsAttachment && (this.removeAttachment(this._iconsAttachment), this._iconsAttachment = null) }, checkEditAttachment: function() { this._network.hasEditInteraction() && this._network.isSelected(this._element) && this._network.isEditable(this._element) && this.isEditable() ? this._editAttachment || (this._editAttachment = new Ib.canvas.EditAttachment(this), this.addAttachment(this._editAttachment)) : this._editAttachment && (this.removeAttachment(this._editAttachment), this._editAttachment = null) }, getLabelAttachment: function() { return this._labelAttachment }, getAlarmAttachment: function() { return this._alarmAttachment }, getIconsAttachment: function() { return this._iconsAttachment }, getEditAttachment: function() { return this._editAttachment }, isEditable: function() { return !0 }, getInnerColor: function() { return this._innerColor }, getOuterColor: function() { return this._outerColor }, getShadowColor: function() { return this._shadowColor }, getDyeColor: function(a) { return this._innerColor ? this._innerColor : this.getStyle(a) }, getStyle: function(a) { return this._element.getStyle(a) }, getFont: function(a) { var b = this._element.getStyle(a); return b || Ib.Defaults.FONT }, paint: function(a) { a.save(), a.globalAlpha = this._wholeAlpha, a.beginPath(), this.paintBody(a), this.clearShadow(a), a.closePath(), a.beginPath(), this.paintAttachments(a), a.closePath(), a.restore() }, paintBody: function(a) {}, paintAttachments: function(a) { a.beginPath(); for (var b = this._attachments.size(), c = 0; b > c; c++) { var d = this._attachments.get(c); this._hitTest == 1 && d.isShowOnTop() == 0 && this.paintAttachment(a, d), this._intersectTest == 1 && this.paintAttachment(a, d), this._hitTest == 0 && this._intersectTest == 0 && (d.isShowOnTop() ? this._network._topAttachmentList.add(d) : this.paintAttachment(a, d)) } }, paintAttachment: function(a, b) { a.beginPath(), b.paint(a), this.clearShadow(a) }, getViewRect: function() { return Jb.clone(this._viewRect) }, getUnionBodyBounds: function() { return Jb.clone(this._unionBodyBounds) }, addBodyBounds: function(a) { a && this._bodyBounds.add(a) }, getBodyRect: function() { return this._bodyRect || (this._bodyRect = this.createBodyRect()), Jb.clone(this._bodyRect) }, getHotSpot: function() { return this._hotSpot ? Jb.clone(this._hotSpot) : { x: 0, y: 0 } }, setHotSpot: function(a) { this._hotSpot = a }, hit: function(a, b) { return !1 }, intersects: function(a) { return Tb.contains(a, this.getViewRect()) ? !0 : !1 }, hitCanvasRectAtBody: function(a) { var b = Od.getHitCanvas(a.width, a.height), c = Od.getCtx(b); if (c.save(), c.translate(-a.x, -a.y), this._element.getImage) { var d = Jb.getImageAsset(this._element.getImage()); if (d && d.getImage() instanceof Hd) return 1 } this.paintBody(c); try { for (var e = c.getImageData(0, 0, a.width, a.height), f = e.data, g = 0; g < e.width; g++) for (var h = 0; h < e.height; h++) { var i = 4 * (h * e.width + g), j = f[i + 3]; if (j !== 0) return c.restore(), 1 } } catch (k) { if (Od.disposeHitCanvas(), Tb.contains(this.getUnionBodyBounds(), a)) return 0 } return c.restore(), -1 }, hitCanvasRectAtAttachments: function(a) { var b = Od.getHitCanvas(a.width, a.height), c = Od.getCtx(b); c.save(), c.translate(-a.x, -a.y), this.paintAttachments(c); try { for (var d = c.getImageData(0, 0, a.width, a.height), e = d.data, f = 0; f < d.width; f++) for (var g = 0; g < d.height; g++) { var h = 4 * (g * d.width + f), i = e[h + 3]; if (i !== 0) return c.restore(), 1 } } catch (j) { Od.disposeHitCanvas() } return c.restore(), -1 }, hitCanvasRect: function(a) { this._intersectTest = !0, this._hitTest == 1 && (this._intersectTest = !1); var b = Tb.intersection(a, this._viewRect), c = this.hitCanvasRectAtBody(b); if (c == 1) return this._intersectTest = !1, !0; var d = this.hitCanvasRectAtAttachments(b); return d == 1 ? (this._intersectTest = !1, !0) : (this._intersectTest = !1, c == 0) }, hitCanvasPoint: function(a, b) { var c = { x: a, y: b, width: 0, height: 0 }, d = this._network.getSelectionTolerance(); if (d && d > 0 && Tb.grow(c, d, d), !Tb.intersects(this._viewRect, c)) return !1; this._hitTest = !0; var e = this.hitCanvasRect(c); return this._hitTest = !1, e }, hitTest: function(a, b) { var c = { x: a, y: b, width: 0, height: 0 }, d = this._network.getSelectionTolerance(); if (d && d > 0 && Tb.grow(c, d, d), !Tb.intersects(this._viewRect, c)) return null; var e = Tb.intersection(c, this._viewRect), f = this.hitCanvasRectAtBody(e); if (f == 1) return this; for (var g = this._attachments.size(), h = 0; g > h; h++) { var i = this._attachments.get(h); if (i.hit(a, b)) return i } return f == 0 ? this : null }, dispose: function() { this._attachments.forEach(function(a) { a.dispose() }), this._attachments.clear() } }), Ib.canvas.NodeUI = function(a, b) { Ib.canvas.NodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.NodeUI', Ib.canvas.ElementUI, { invalidate: function(a) { Ib.canvas.NodeUI.superClass.invalidate.call(this, a), this.curInterval && clearInterval(this.curInterval); var b = this._element.getAgentLinks(); b && b.forEach(function(a) { this._network.invalidateElementUI(a, !1) }, this); var c = this._element.getParent(); c instanceof Ib.Group && this._network.invalidateElementUI(c, !1) }, createBodyRect: function() { return this._element.getRect() }, validateImpl: function() { Ib.canvas.NodeUI.superClass.validateImpl.call(this); var a = this.getStyle('vector.shape'), b = this.getBodyRect(); this._hotSpot = Tb.getHotSpot(b.x, b.y, b.width, b.height, a), this.validateBodyBounds() }, validate: function() { this._invalidateFlag != 0 && Ib.canvas.NodeUI.superClass.validate.call(this) }, validateBodyBounds: function() { var a = this.getStyle('body.type'); a === 'default' ? this.addBodyBounds(this.getDefaultBodyRect()) : a === 'vector' ? this.addBodyBounds(this.getVectorBody()) : a === 'default.vector' ? (this.addBodyBounds(this.getVectorBody()), this.addBodyBounds(this.getDefaultBodyRect())) : a === 'vector.default' && (this.addBodyBounds(this.getDefaultBodyRect()), this.addBodyBounds(this.getVectorBody())), this._outerColor && this.addBodyBounds(this.getOuterBorderRect()), !this._editAttachment && this.getStyle('select.style') === 'border' && this._network.isSelected(this._element) && this.addBodyBounds(this.getSelectBorderRect()) }, getDefaultBodyRect: function() { var a = this._element, b = Jb.getImageAsset(a.getImage()), c = this.getBodyRect(); if (!b) return c; Tb.addPadding(c, this._element, 'image.padding', 1), this._defaultRect = c; var d = Jb.clone(c); return this.appendShadowBound(this, d), c = d }, getVectorBody: function() { var a = this.getPathRect('vector'); return a }, getOuterBorderRect: function() { return this._getBorderRect('outer') }, getSelectBorderRect: function() { return this._getBorderRect('select') }, _getBorderRect: function(a) { var b = this._element, c = b.getStyle(a + '.width'); if (c > 0) { var d = this.getBodyRect(); Tb.addPadding(d, b, a + '.padding', 1); var e = Jb.clone(d); return Tb.grow(e, c / 2, c / 2), e } return null }, getPathRect: function(a, b) {
    var c = this._element, d = this.getBodyRect(); b && Tb.addPadding(d, c, a + '.padding', 1)

    var e = Jb.clone(d), f = c.getStyle(a + '.outline.width'); return f > 0 && Tb.grow(e, f / 2, f / 2), this.appendShadowBound(this, e), e
  }, paintBody: function(a) { this.curInterval && clearInterval(this.curInterval); var b = this.getStyle('body.type'); b === 'default' ? this.drawDefaultBody(a) : b === 'vector' ? this.drawVectorBody(a) : b === 'default.vector' ? (this.drawVectorBody(a), this.drawDefaultBody(a)) : b === 'vector.default' && (this.drawDefaultBody(a), this.drawVectorBody(a)), this._outerColor && this.drawOuterBorder(a), this.getStyle('select.style') === 'border' && this._network.isSelected(this._element) && this.drawSelectBorder(a) }, drawOuterBorder: function(a) { var b = this._element, c = b.getStyle('outer.width'); if (c > 0) { var d = this.getBodyRect(); Tb.addPadding(d, b, 'outer.padding', 1), a.lineWidth = c, a.lineCap = b.getStyle('outer.cap'), a.lineJoin = b.getStyle('outer.join'), a.strokeStyle = this._outerColor, Xb.drawVector(a, b.getStyle('outer.shape'), null, d), a.stroke() } }, drawDefaultBody: function(a) { var b = this._element, c = Jb.getImageAsset(b.getImage()), d = this._defaultRect; if (c && c.getImage()) { b.getAngle() != 0 && (a.save(), d = b.getOriginalRect(), Ib.Util.rotateCanvas(a, d, b.getAngle())), this.setShadow(this, a); if (c.getImage() instanceof Hd) { var e, f = c.getImage().frames, g = c.getImage().size, h = 0; e = Jd(f, g, 0), a.drawImage(e, d.x, d.y, d.width, d.height), this.curInterval = setInterval(function() { h = (h + f.length) % f.length, e = Jd(f, g, h), a.drawImage(e, d.x, d.y, d.width, d.height), h++ }, 100) } else Nc(a, b.getImage(), this.getInnerColor(), d, b, this._network); b.getAngle() != 0 && a.restore() } }, drawSelectBorder: function(a) { var b = this._element, c = b.getStyle('select.width'); if (c > 0) { var d = this.getBodyRect(); d = Jb.clone(d); var e = b.getStyle('select.physicalZoom') ? 1 : this._network.getGraphicsZoom(); Tb.addPadding(d, b, 'select.padding', 1 / e), Tb.grow(d, c / 2 / e, c / 2 / e), a.lineWidth = c / e, a.lineCap = b.getStyle('select.cap'), a.lineJoin = b.getStyle('select.join'), a.strokeStyle = b.getStyle('select.color'), Xb.drawVector(a, b.getStyle('select.shape'), null, d), a.stroke() } }, drawVectorBody: function(a) { this.drawPath(a, 'vector', !0, this._element.getStyle('vector.outline.pattern')); var b = this.getStyle('vector.deep'), c = this.getStyle('vector.fill.color'), d = this.getBodyRect(); if (b !== 0 && c) { var e = this._element.getAngle(); e != 0 && (a.save(), d = this._element.getOriginalRect(), Ib.Util.rotateCanvas(a, d, e)), this.getStyle('vector.shape') === 'rectangle' && Xb.draw3DRect(a, c, b, d), e != 0 && a.restore() } }, drawPath: function(a, b, c, d, e, f, g) { var h = this._element, i = this.getBodyRect(); c && Tb.addPadding(i, h, b + '.padding', 1); var j = h.getStyle(b + '.outline.width'); this.setShadow(this, a), h.getAngle() != 0 && (h instanceof Nd || (i = h.getOriginalRect()), a.save(), Ib.Util.rotateCanvas(a, i, h.getAngle())); var k, l = h.getStyle(b + '.fill'); if (l) { k = this._innerColor && !vc.hasDefault(this._element) ? this._innerColor : h.getStyle(b + '.fill.color'); var m = h.getStyle(b + '.gradient'); m ? Xb.fill(a, k, m, h.getStyle(b + '.gradient.color'), i) : a.fillStyle = k } var n = h.getStyle(b + '.shape'), o = h.getStyle('group.shape.roundrect.radius'); l && (a.beginPath(), e ? Xb.drawLinePoints(a, e, null, f, g) : n === 'roundrect' && b === 'group' ? Xb.drawVector(a, n, null, i, o) : Xb.drawVector(a, n, null, i), a.fill()), j > 0 && (a.lineWidth = j, a.lineCap = h.getStyle(b + '.cap'), a.lineJoin = h.getStyle(b + '.join'), a.strokeStyle = h.getStyle(b + '.outline.color'), a.beginPath(), e ? Xb.drawLinePoints(a, e, d, f, g) : n === 'roundrect' && b === 'group' ? Xb.drawVector(a, n, d, i, o) : Xb.drawVector(a, n, d, i), a.stroke()), h.getAngle() != 0 && a.restore() }, hit: function(a, b) { var c = { x: a, y: b, width: 0, height: 0 }, d = this._network.getSelectionTolerance(); if (d && d > 0 && Tb.grow(c, d, d), this._network._transparentSelectionEnable) { var e = this.getBodyRect(); if (Jb.math.intersects(e, c)) return !0 } return Tb.intersects(this.getViewRect(), c) ? this.hitCanvasPoint(a, b) : !1 }, intersects: function(a) { var b = Ib.canvas.NodeUI.superClass.intersects.apply(this, arguments); if (b == 1) return !0; if (this._network._transparentSelectionEnable) { var c = this.getBodyRect(); if (Jb.math.intersects(c, a)) return !0 } return Tb.intersects(a, this.getViewRect()) ? this.hitCanvasRect(a) : !1 } }), Ib.canvas.LinkUI = function(a, b) { Ib.canvas.LinkUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.LinkUI', Ib.canvas.ElementUI, { isEditable: function() { return xc.isOrthogonalLink(this._element) && this.getControlPoint() ? !0 : !1 }, invalidate: function(a) { this._linkPoints = null, this._fromPoint = null, this._toPoint = null, this._angle = null, Ib.canvas.LinkUI.superClass.invalidate.call(this, a) }, validateImpl: function() { this.validateBodyBounds(), Ib.canvas.LinkUI.superClass.validateImpl.call(this) }, validateBodyBounds: function() { var a = this.getLinkPoints(); if (a && !(a.size() < 2)) { var b = this._element, c = Tb.getLineRect(a), d = b.getStyle('link.width'), e = d; if (this._outerColor) { var f = b.getStyle('outer.width'); e += 2 * f } var g = !this._editAttachment && b.getStyle('select.style') === 'border' && this._network.isSelected(this._element); if (g) { var h = b.getStyle('select.width'); e += 2 * h }Tb.grow(c, e / 2, e / 2), b.getStyle('arrow.from') && (this._network._debug && (this._arrowFromRect = od.getArrowRect(this, a, !0, b.getStyle('arrow.from.shape'), b.getStyle('arrow.from.width'), b.getStyle('arrow.from.height'), b.getStyle('arrow.from.xoffset'), b.getStyle('arrow.from.yoffset'))), c = Tb.unionRect(c, od.getArrowRect(this, a, !0, b.getStyle('arrow.from.shape'), b.getStyle('arrow.from.width'), b.getStyle('arrow.from.height'), b.getStyle('arrow.from.xoffset'), b.getStyle('arrow.from.yoffset')))), b.getStyle('arrow.to') && (this._network._debug && (this._arrowToRect = od.getArrowRect(this, a, !1, b.getStyle('arrow.to.shape'), b.getStyle('arrow.to.width'), b.getStyle('arrow.to.height'), b.getStyle('arrow.to.xoffset'), b.getStyle('arrow.to.yoffset'))), c = Tb.unionRect(c, od.getArrowRect(this, a, !1, b.getStyle('arrow.to.shape'), b.getStyle('arrow.to.width'), b.getStyle('arrow.to.height'), b.getStyle('arrow.to.xoffset'), b.getStyle('arrow.to.yoffset')))), this.appendShadowBound(this, c), this.addBodyBounds(c) } }, createBodyRect: function() { var a = this.getHotSpot(); return a ? { x: a.x - 1, y: a.y - 1, width: 2, height: 2 } : null }, paintBody: function(a) { var b = this._linkPoints; if (b && !(b.size() < 2)) { var c = this._element, d = c.getStyle('link.width'), e = d; if (this._outerColor) { var f = c.getStyle('outer.width'); e += 2 * f } var g = !this._editAttachment && c.getStyle('select.style') === 'border' && this._network.isSelected(this._element); if (g) { var h = c.getStyle('select.width'); e += 2 * h } this.setShadow(this, a), a.lineCap = c.getStyle('link.cap'), a.lineJoin = c.getStyle('link.join'); var i = c.getStyle('link.pattern'); g && this.drawLinePoints(a, b, e, c.getStyle('select.color'), i), this._outerColor && this.drawLinePoints(a, b, d + 2 * f, this._outerColor, i), this.drawLinePoints(a, b, d, this._innerColor || c.getStyle('link.color'), i), od.drawLinkArrow(this, a, b) } }, drawLinePoints: function(a, b, c, d, e) { if (a.lineWidth = c, a.strokeStyle = d, this._element.getStyle('link.flow') === !0 && e && e.length > 1) { var f = new uc(a, e[0], e[1]), g = this._element.getStyle('link.flow.offset'), h = Math.floor(g / (e[0] + e[1])); h > 2 && (g -= (e[0] + e[1]) * h), this._element.getStyle('link.flow.converse') ? g < e[0] ? f.overflow = e[0] - g : g >= e[0] && g <= e[0] + e[1] ? (f.overflow = e[1] - (g - e[0]), f.overflow && (f.isLine = !1)) : (g -= e[0] + e[1], f.overflow = e[0] - g) : g <= e[1] ? (f.overflow = g, g && (f.isLine = !1)) : g > e[1] && g <= e[0] + e[1] ? f.overflow = g - e[1] : (g -= e[0] + e[1], g && (f.isLine = !1), f.overflow = g), this._element._styleMap['link.flow.offset'] = g, a.beginPath(), Xb._drawLine(b, a), a.stroke(), a.shadowColor = 'transparent', a.beginPath(); var i = this._element.getStyle('link.flow.color'); i = i || Ed.NETWORK_LINK_FLOW_COLOR, a.strokeStyle = i, Xb._drawLine(b, f), a.stroke(), a.shadowColor = this._shadowColor } else a.beginPath(), Xb.drawLinePoints(a, b, e), a.stroke() }, getLinkPoints: function() { return this._linkPoints || (this._linkPoints = this.createLinkPoints(), this._lineLength = Tb.calculateLineLength(this._linkPoints)), this._linkPoints }, getFromPosition: function(a, b) { var c = this.getFromPoint(); return c ? { x: c.x + a, y: c.y + b } : null }, getToPosition: function(a, b) { var c = this.getToPoint(); return c ? { x: c.x + a, y: c.y + b } : null }, getFromPoint: function() { return this._fromPoint || (this._fromPoint = xc.createFromPoint(this)), this._fromPoint }, getToPoint: function() { return this._toPoint || (this._toPoint = xc.createToPoint(this)), this._toPoint }, createLinkPoints: function() { var a = this.getFromPoint(), b = this.getToPoint(), c = this.getStyle('link.type'), d = new Ib.List(); if (xc.isOrthogonalOrFlexionalLink(this._element))d = xc.orthogonalAndFlexional(this, c); else if (this._element.isLooped()) { var e = this._network.getElementUI(this._element.getFromAgent()); e != null && (this._hotSpot = xc.fillLoopedPoints(this, e.getBodyRect(), d)) } else { if (c !== 'arc' && c !== 'triangle' && c !== 'parallel') throw "Can not resolve link type '" + c + "'"; this._hotSpot = xc.fillBundlePoints(this, c, a, b, d) } if (this._network._linkPathFunction) { var f = this._network._linkPathFunction(this, d); f && (d = f) } return d }, checkAttachments: function() { Ib.canvas.LinkUI.superClass.checkAttachments.call(this), this.checkLinkHandlerAttachment() }, checkLinkHandlerAttachment: function() { var a = this._network.getLinkHandlerLabel(this._element); a != null && a !== '' ? this._linkHandlerAttachment || (this._linkHandlerAttachment = new Ib.canvas.LinkHandlerAttachment(this), this.addAttachment(this._linkHandlerAttachment)) : this._linkHandlerAttachment && (this.removeAttachment(this._linkHandlerAttachment), this._linkHandlerAttachment = null) }, getLinkHandlerAttachment: function() { return this._linkHandlerAttachment }, getControlPoint: function() { return xc.getControlPoint(this._element, this) }, setControlPoint: function(a) { if (a) { var b = this.getStyle('link.type'); if (xc.hasControlPoint(b)) { var c = xc.getLinkSourceBounds(this), d = xc.getLinkTargetBounds(this); xc.setParamsByControlPoint(a, c, d, b, this._element) } } }, getLineLength: function() { return this._lineLength }, hit: function(a, b) { var c = { x: a, y: b, width: 0, height: 0 }, d = this._network.getSelectionTolerance(); return d && d > 0 && Tb.grow(c, d, d), Tb.intersects(this.getViewRect(), c) ? this.hitCanvasPoint(a, b) : !1 }, intersects: function(a) { var b = Ib.canvas.LinkUI.superClass.intersects.apply(this, arguments); if (b == 1) return !0; if (Tb.intersects(a, this.getViewRect()) == 0) return !1; var c = this.getLinkPoints(), d = c.size(); if (d == 2) for (var e = 0; d > e; e += 2) { var f = c.get(e); if (d > e + 1) { var g = c.get(e + 1); if (Od.intersectsLine(f.x, f.y, g.x, g.y, a.x, a.y, a.width, a.height)) return !0 } } return this.hitCanvasRect(a) }, getAngle: function() { return !this._angle && this._fromPoint && this._toPoint && (this._angle = Tb.getAngle(this._fromPoint, this._toPoint)), this._angle || 0 } }), Ib.canvas.GroupUI = function(a, b) { Ib.canvas.GroupUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.GroupUI', Ib.canvas.NodeUI, { isEditable: function() { return !this._element.isExpanded() }, paintBody: function(a) { this._shapeRect ? this.drawExpandedGroup(a) : Ib.canvas.GroupUI.superClass.paintBody.apply(this, arguments) }, validateBodyBounds: function() { this.getBodyRect(), this._shapeRect ? this.addBodyBounds(this.getPathRect('group', !1)) : Ib.canvas.GroupUI.superClass.validateBodyBounds.call(this) }, drawExpandedGroup: function(a) { this.drawPath(a, 'group', !1, this._element.getStyle('vector.outline.pattern')); var b = this.getStyle('group.deep'), c = this.getStyle('group.fill.color'); b !== 0 && c && this.getStyle('group.shape') === 'rectangle' && Xb.draw3DRect(a, c, b, this._bodyRect) }, getChildrenRects: function() { return this._network.getGroupChildrenRects(this._element) }, createBodyRect: function() { this._shapeRect = null; var a = this._element, b = this._network; if (a.isExpanded()) { a.getChildren().forEach(function(a) { var c = b.getElementUI(a); c && c.validate() }); var c = this.getChildrenRects(); if (!c.isEmpty()) { var d = a.getStyle('group.shape'), e = Ub[d]; if (!e) throw "Can not resolve group shape '" + d + "'"; this._shapeRect = e(c) } } return this._shapeRect ? (Tb.addPadding(this._shapeRect, a, 'group.padding', 1), this._shapeRect) : Ib.canvas.GroupUI.superClass.createBodyRect.call(this) } }), Ib.canvas.ShapeNodeUI = function(a, b) { Ib.canvas.ShapeNodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.ShapeNodeUI', Ib.canvas.NodeUI, { getDefaultBodyRect: function() { return this._element._points.size() < 2 ? null : this.getPathRect('vector', !0) }, drawDefaultBody: function(a) { this._element._points.size() < 2 || (this.drawPath(a, 'vector', !0, this._element.getStyle('vector.outline.pattern'), this._element._points, this._element._segments, this._element.getStyle('shapenode.closed')), od.drawLinkArrow(this, a, Tb.getPointObject(this._element._points, this._element._segments))) }, drawSelectBorder: function(a) { var b = this._element, c = b.getStyle('select.width'); if (c > 0) { var d = this.getBodyRect(); d = Jb.clone(d); var e = b.getStyle('select.physicalZoom') ? 1 : this._network.getGraphicsZoom(); Tb.addPadding(d, b, 'select.padding', 1 / e), Tb.grow(d, c / 2, c / 2); var f = b.getStyle('vector.outline.width'); f > 0 && Tb.grow(d, f / 2 / e, f / 2 / e), a.lineWidth = c / e, a.lineCap = b.getStyle('select.cap'), a.lineJoin = b.getStyle('select.join'), a.strokeStyle = b.getStyle('select.color'), Xb.drawVector(a, b.getStyle('select.shape'), null, d), a.stroke() } } }), Ib.canvas.ShapeLinkUI = function(a, b) { Ib.canvas.ShapeLinkUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.ShapeLinkUI', Ib.canvas.LinkUI, { isEditable: function() { return !0 }, createLinkPoints: function() { var a = this.getFromPoint(), b = this.getToPoint(), c = new Ib.List(), d = this.getStyle('shapelink.type'); c.add(a), this._element._points != null && c.addAll(this._element._points), c.add(b); var e, f, g, h, i, j, k, l = Tb.calculateLineLength(c) / 2, m = c.size(), n = 0, o = 0; for (e = 0; m > e; e++) if (h = c.get(e), e != 0) { if (g = h, g instanceof nd && (g = g._as), g instanceof Array ? (i = Tb.calculateCurveLength(f, g, 1), f = g[g.length - 1]) : (k = h.y - f.y, j = h.x - f.x, i = Math.sqrt(j * j + k * k), f = g), o += i, l >= n && o >= l) { var p = l - n, q = c.get(e - 1); q instanceof nd && (q = q._as, q instanceof Array && (q = q[q.length - 1])); var r = c.get(e), s = Tb.getPathInfo(r, q, p, 0, -1).point; this._hotSpot = Jb.clone(s) }n = o } else f = h; var t, u, v; if (d === 'lineto');else if (d === 'quadto') { for (t = new Ib.List(c.get(0)), u = 1, pointCount = c.size(); u < pointCount; u++)t.add(u < pointCount - 1 ? new Ib.List([c.get(u++), c.get(u)]) : c.get(u)); c = t } else if (d === 'cubicto') { for (t = new Ib.List(c.get(0)), u = 1, pointCount = c.size(); u < pointCount; u++)t.add(u < pointCount - 2 ? new Ib.List([c.get(u++), c.get(u++), c.get(u)]) : u < pointCount - 1 ? new Ib.List([c.get(u++), c.get(u)]) : c.get(u)); c = t } else { if (d !== 'orthogonalto') throw "Can not resolve shapelink type '" + d + "'"; for (v = c.get(0), t = new Ib.List(v), u = 1, pointCount = c.size(); u < pointCount; u++) if (u < pointCount - 1) { var h = Jb.clone(c.get(u)), w = h.x, x = h.y, j = w - v.x, k = x - v.y; Math.abs(j) > Math.abs(k) ? (h.x = w, h.y = v.y) : (h.x = v.x, h.y = x), v = h, t.add(v) } else t.add(c.get(u)); c = t } return c } }), Ib.canvas.GridUI = function(a, b) { Ib.canvas.GridUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.GridUI', Ib.canvas.NodeUI, { drawDefaultBody: function(a) { this._element.getImage() ? Ib.canvas.GridUI.superClass.drawDefaultBody.apply(this, arguments) : this.drawGridBody(a) }, validateBodyBounds: function() { if (this._element.getImage())Ib.canvas.GridUI.superClass.validateBodyBounds.call(this); else { var a = this.getBodyRect(), b = Jb.clone(a); this.appendShadowBound(this, b), this.addBodyBounds(b) } }, drawGridBody: function(a) { var b = this.getStyle('grid.fill'), c = this.getStyle('grid.deep'), d = this.getStyle('grid.cell.deep'); if (b || c !== 0 || d !== 0) { a.beginPath(); var e = this._element.getRect(), f = this.getDyeColor('grid.fill.color'); if (this.setShadow(this, a), b && (a.fillStyle = f, a.rect(e.x, e.y, e.width, e.height), a.fill()), a.closePath(), this.clearShadow(a), a.beginPath(), c != 0 && Xb.draw3DRect(a, f, c, e.x, e.y, e.width, e.height), a.closePath(), d != 0) for (var g = this.getStyle('grid.row.count'), h = this.getStyle('grid.column.count'), i = 0; g > i; i++) for (var j = 0; h > j; j++) { var k = this._element.getCellRect(i, j); k != null && (a.beginPath(), Xb.draw3DRect(a, f, d, k.x, k.y, k.width, k.height), a.closePath()) } } } }), Ib.canvas.RotatableNodeUI = function(a, b) { Ib.canvas.RotatableNodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.RotatableNodeUI', Ib.canvas.NodeUI, { isEditable: function() { return !1 }, getDefaultBodyRect: function() { var a = this._element, b = Jb.getImageAsset(a.getImage()), c = this.getBodyRect(); return b ? (Tb.addPadding(c, this._element, 'image.padding', 1), c) : c }, drawDefaultBody: function(a) { var b = this._element, c = Jb.getImageAsset(b.getImage()), d = this.getBodyRect(); if (Tb.addPadding(d, this._element, 'image.padding', 1), c.getImage()) { var e = this._element._getOrignalWidth(), f = this._element._getOrignalHeight(), g = this._element._getRotateRect(); a.save(), a.translate(d.x - g.x + e / 2, d.y - g.y + f / 2), a.rotate(this._element._angle * Math.PI / 180); var d = { x: -e / 2, y: -f / 2, width: e, height: f }; Nc(a, c.getImage(this._innerColor, d.width, d.height), this._innerColor, d, b, this._network), a.restore() } else if (c.getSrc());else if (!c.getFunction()) throw "ImageAsset '" + b.getImage() + " ' is empty" } }), Ib.canvas.HTMLNodeUI = function(a, b) { Ib.canvas.HTMLNodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.HTMLNodeUI', Ib.canvas.NodeUI, { checkAttachments: function() { Ib.canvas.NodeUI.prototype.checkAttachments.call(this) }, checkLabelAttachment: function() { var a = this._element.getStyle('attachment.label.style'); if (a && a === 'none') return void Ib.canvas.HTMLNodeUI.superClass.checkLabelAttachment.call(this); var b = this._network.getLabel(this._element); b != null && b !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.canvas.HTMLLabelAttachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkAlarmAttachment: function() { var a = this._element.getStyle('attachment.alarm.style'); if (a && a === 'none') return void Ib.canvas.HTMLNodeUI.superClass.checkAlarmAttachment.call(this); var b = this._network.getAlarmLabel(this._element); b != null && b !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.canvas.HTMLAlarmAttachment(this, !1), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) }, setAttachmentVisible: function(a) { a ? (this._labelAttachment && this._labelAttachment.setVisibility('visible'), this._alarmAttachment && this._alarmAttachment.setVisibility('visible')) : (this._labelAttachment && this._labelAttachment.setVisibility('hidden'), this._alarmAttachment && this._alarmAttachment.setVisibility('hidden')) } }), Ib.canvas.HTMLLinkUI = function(a, b) { Ib.canvas.HTMLLinkUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.HTMLLinkUI', Ib.canvas.LinkUI, { checkAttachments: function() { Ib.canvas.LinkUI.prototype.checkAttachments.call(this) }, checkLabelAttachment: function() { var a = this._element.getStyle('attachment.label.style'); if (a && a === 'none') return void Ib.canvas.HTMLLinkUI.superClass.checkLabelAttachment.call(this); var b = this._network.getLabel(this._element); b != null && b !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.canvas.HTMLLabelAttachment(this), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkAlarmAttachment: function() { var a = this._element.getStyle('attachment.alarm.style'); if (a && a === 'none') return void Ib.canvas.HTMLLinkUI.superClass.checkAlarmAttachment.call(this); var b = this._network.getAlarmLabel(this._element); b != null && b !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.canvas.HTMLAlarmAttachment(this, !1), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) } }), Ib.canvas.Attachment = function(a, b) { this._ui = a, this._element = this._ui.getElement(), this._network = a.getNetwork(), this._showOnTop = b }, Jb.ext('twaver.canvas.Attachment', Object, { getElement: function() { return this._element }, getElementUI: function() { return this._ui }, getNetwork: function() { return this._network }, isShowOnTop: function() { return this._showOnTop === !0 }, setShowOnTop: function(a) { this._showOnTop = a }, getStyle: function(a) { return this._ui.getStyle(a) }, getFont: function(a) { return this._ui.getFont(a) }, getViewRect: function() { return Jb.clone(this._viewRect) }, getAlpha: function() { return 1 }, validate: function() {}, paint: function(a) {}, hit: function(a, b) { return Tb.containsPoint(this._viewRect, a, b) ? this.hitCanvasRect({ x: a - 1, y: b - 1, width: 2, height: 2 }) : !1 }, hitCanvasRect: function(a) { var b = Od.getHitCanvas(a.width, a.height), c = Od.getCtx(b); c.save(), c.translate(-a.x, -a.y), this.paint(c); try { for (var d = c.getImageData(0, 0, a.width, a.height), e = d.data, f = 0; f < d.width; f++) for (var g = 0; g < d.height; g++) { var h = 4 * (g * d.width + f), i = e[h + 3]; if (i !== 0) return c.restore(), !0 } } catch (j) { Od.disposeHitCanvas() } return c.restore(), !1 }, dispose: function() {}, _rotatePoint: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x + c.width / 2, c.y + c.height / 2), e = d.transform(a); return e }, _rotatePointList: function(a, b, c) { var d = this, e = new Ib.List(); return a.forEach(function(a) { e.add(d._rotatePoint(a, b, c)) }), e } }), Ib.canvas.BasicAttachment = function(a, b) { Ib.canvas.BasicAttachment.superClass.constructor.call(this, a, b), this._roundRect = { x: 0, y: 0, width: 0, height: 0 }, this._contentRect = { x: 0, y: 0, width: 0, height: 0 } }, Jb.ext('twaver.canvas.BasicAttachment', Ib.canvas.Attachment, { paint: function(a) { Ib.canvas.BasicAttachment.superClass.paint.apply(this, arguments); var b = this.isFill(), c = this.getOutlineWidth(); if (this.getElementUI().setShadow(this, a), (c > 0 || b) && (Xb.drawRoundRect(a, this._roundRect.x, this._roundRect.y, this._roundRect.width, this._roundRect.height, this.getCornerRadius()), this._pointers && (a.moveTo(this._pointers[0].x, this._pointers[0].y), a.lineTo(this._pointers[1].x, this._pointers[1].y), a.lineTo(this._pointers[2].x, this._pointers[2].y)), a.closePath(), c > 0 && (a.lineWidth = c, a.strokeStyle = this.getOutlineColor(), a.lineCap = this.getCap(), a.lineJoin = this.getJoin(), a.stroke()), b)) { var d = this.getFillColor(), e = this.getGradient(); e ? Xb.fill(a, d, e, this.getGradientColor(), this._viewRect) : a.fillStyle = d, a.fill() } }, validate: function() { Ib.canvas.BasicAttachment.superClass.validate.call(this), this.calculateMeasure(); var a = this.getOutlineWidth(); this._viewRect = Tb.getRect(this._pointers), this._viewRect = Tb.unionRect(this._viewRect, this._roundRect), a > 0 && Tb.grow(this._viewRect, a / 2, a / 2), this._viewRect = this._ui.appendShadowBound(this, this._viewRect) }, calculateMeasure: function() { var a = this.getContentWidth(), b = this.getContentHeight(), c = this.getCornerRadius(), d = this.getPointerLength(), e = this.getPointerWidth(), f = this.getPosition(), g = this.getXOffset(), h = this.getYOffset(), i = this._roundRect; i.width = a + c, i.height = b; var j; if (this._ui._element instanceof Ib.Link) { var k, l = this._ui.getLinkPoints(); k = this._ui.getLineLength ? this._ui.getLineLength() : this._ui._element.getLineLength(), Math.abs(g) > 0 && Math.abs(g) < 1 ? f === 'from' ? g *= k : f === 'to' ? g = k * (1 - g) : (g /= 2, g += 0.5, g *= k) : f === 'from' ? g = g : f === 'to' ? g = k - g : g += k / 2; { var m, n = Tb.calculatePointInfoAlongLine(l, !0, g, h), o = n.point; n.angle }m = f === 'from' ? this._ui.getFromPoint() : f === 'to' ? this._ui.getToPoint() : this._ui._hotSpot, g = o.x - m.x, h = o.y - m.y } if (d > 0) { var p = this.getDirection(); j = this._network.getPosition(f, this._ui, null, g, h, !1); var q; if (p === 'aboveleft')i.y = j.y - d - i.height, i.x = j.x - (i.width - c), q = Math.max(j.x - e, j.x - (i.width - c) + c / 2), this._pointers = [j, { x: j.x, y: j.y - d }, { x: q, y: j.y - d }]; else if (p === 'aboveright')i.y = j.y - d - i.height, i.x = j.x - c, q = Math.min(j.x + e, j.x - c + i.width - c / 2), this._pointers = [j, { x: j.x, y: j.y - d }, { x: q, y: j.y - d }]; else if (p === 'belowleft')i.y = j.y + d, i.x = j.x - (i.width - c), q = Math.max(j.x - e, j.x - (i.width - c) + c / 2), this._pointers = [j, { x: j.x, y: j.y + d }, { x: q, y: j.y + d }]; else if (p === 'belowright')i.y = j.y + d, i.x = j.x - c, q = Math.min(j.x + e, j.x - c + i.width - c / 2), this._pointers = [j, { x: j.x, y: j.y + d }, { x: q, y: j.y + d }]; else if (p === 'leftabove')i.y = j.y + c - i.height, i.x = j.x - d - i.width, q = Math.max(j.y - e, j.y + c - i.height + c / 2), this._pointers = [j, { x: j.x - d, y: j.y }, { x: j.x - d, y: q }]; else if (p === 'leftbelow')i.y = j.y - c, i.x = j.x - d - i.width, q = Math.min(j.y + e, j.y - c + i.height - c / 2), this._pointers = [j, { x: j.x - d, y: j.y }, { x: j.x - d, y: q }]; else if (p === 'rightabove')i.y = j.y + c - i.height, i.x = j.x + d, q = Math.max(j.y - e, j.y + c - i.height + c / 2), this._pointers = [j, { x: j.x + d, y: j.y }, { x: j.x + d, y: q }]; else if (p === 'rightbelow')i.y = j.y - c, i.x = j.x + d, q = Math.min(j.y + e, j.y - c + i.height - c / 2), this._pointers = [j, { x: j.x + d, y: j.y }, { x: j.x + d, y: q }]; else if (p === 'above')i.y = j.y - d - i.height, i.x = j.x - i.width / 2, q = Math.min(a / 2, e / 2), this._pointers = [j, { x: j.x - q, y: j.y - d }, { x: j.x + q, y: j.y - d }]; else if (p === 'below')i.y = j.y + d, i.x = j.x - i.width / 2, q = Math.min(a / 2, e / 2), this._pointers = [j, { x: j.x - q, y: j.y + d }, { x: j.x + q, y: j.y + d }]; else if (p === 'left')i.y = j.y - i.height / 2, i.x = j.x - d - i.width, q = Math.min(b / 2, e / 2), this._pointers = [j, { x: j.x - d, y: j.y + q }, { x: j.x - d, y: j.y - q }]; else { if (p !== 'right') throw "Can not resolve '" + p + "' attachment direction"; i.y = j.y - i.height / 2, i.x = j.x + d, q = Math.min(b / 2, e / 2), this._pointers = [j, { x: j.x + d, y: j.y + q }, { x: j.x + d, y: j.y - q }] } } else j = this._network.getPosition(f, this._ui, { width: i.width, height: i.height }, g, h, !1), i.x = j.x, i.y = j.y, this._pointers = null; this._contentRect.x = i.x + (i.width - a) / 2, this._contentRect.y = i.y + (i.height - b) / 2, this._contentRect.width = a, this._contentRect.height = b; var r = this.getPadding(); r != 0 && Tb.grow(i, r, r), r = this.getPaddingLeft(), r != 0 && (i.x -= r, i.width += r), r = this.getPaddingRight(), r != 0 && (i.width += r), r = this.getPaddingTop(), r != 0 && (i.y -= r, i.height += r), r = this.getPaddingBottom(), r != 0 && (i.height += r), i.width < 0 && (i.width = i.width, i.x -= i.width), i.height < 0 && (i.height = -i.height, i.y -= i.height) }, getContentWidth: function() { return Ib.Defaults.ATTACHMENT_CONTENT_WIDTH }, getContentHeight: function() { return Ib.Defaults.ATTACHMENT_CONTENT_HEIGHT }, getCornerRadius: function() { return Ib.Defaults.ATTACHMENT_CORNER_RADIUS }, getPointerLength: function() { return Ib.Defaults.ATTACHMENT_POINTER_LENGTH }, getPointerWidth: function() { return Ib.Defaults.ATTACHMENT_POINTER_WIDTH }, getPosition: function() { return Ib.Defaults.ATTACHMENT_POSITION }, getXOffset: function() { return Ib.Defaults.ATTACHMENT_XOFFSET }, getYOffset: function() { return Ib.Defaults.ATTACHMENT_YOFFSET }, getPadding: function() { return Ib.Defaults.ATTACHMENT_PADDING }, getPaddingLeft: function() { return Ib.Defaults.ATTACHMENT_PADDING_LEFT }, getPaddingRight: function() { return Ib.Defaults.ATTACHMENT_PADDING_RIGHT }, getPaddingTop: function() { return Ib.Defaults.ATTACHMENT_PADDING_TOP }, getPaddingBottom: function() { return Ib.Defaults.ATTACHMENT_PADDING_BOTTOM }, getDirection: function() { return Ib.Defaults.ATTACHMENT_DIRECTION }, isFill: function() { return Ib.Defaults.ATTACHMENT_FILL }, getFillColor: function() { return Ib.Defaults.ATTACHMENT_FILL_COLOR }, getGradient: function() { return Ib.Defaults.ATTACHMENT_GRADIENT }, getGradientColor: function() { return Ib.Defaults.ATTACHMENT_GRADIENT_COLOR }, getOutlineWidth: function() { return Ib.Defaults.ATTACHMENT_OUTLINE_WIDTH }, getOutlineColor: function() { return Ib.Defaults.ATTACHMENT_OUTLINE_COLOR }, getCap: function() { return Ib.Defaults.ATTACHMENT_CAP }, getJoin: function() { return Ib.Defaults.ATTACHMENT_JOIN }, isShadowable: function() { return Ib.Defaults.ATTACHMENT_SHADOWABLE }, getRoundRect: function() { return Jb.clone(this._roundRect) }, getContentRect: function() { return Jb.clone(this._contentRect) } }), Ib.canvas.LabelAttachment = function(a, b) { Ib.canvas.LabelAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.LabelAttachment', Ib.canvas.BasicAttachment, { paint: function(a) { var b = this._element instanceof Ib.Link && this._element.getStyle('link.label.rotatable'); if (b) { a.save(); var c = this._viewRect.x + this._viewRect.width / 2, d = this._viewRect.y + this._viewRect.height / 2; a.translate(c, d), a.rotate(this._network.getElementUI(this._element).getAngle()), a.translate(-c, -d) }Ib.canvas.LabelAttachment.superClass.paint.apply(this, arguments); var e = this._element.getStyle('label.align'), f = this._element && this._element.getStyle('label.rotate.angle'); f !== 0 && (a.save(), Ib.Util.rotateCanvas(a, this._contentRect, f)), Xb.drawText(a, this.text, this._contentRect, this.font, this.getStyle('label.color'), e), (b || f !== 0) && a.restore() }, validate: function() { this.font = this.getFont('label.font'); var a = this.getLabel(), b = Jb.g.getTextSize(this.font, a), c = this.getMaxLength(); c !== 0 && b.width > c ? (this.text = Jb.g.getCollapseTextInLength(this.font, a, c), this._textSize = Jb.g.getTextSize(this.font, this.text)) : (this.text = a, this._textSize = b), Ib.canvas.LabelAttachment.superClass.validate.call(this); var d = this._viewRect, e = this._element && this._element.getStyle('label.rotate.angle'); if (e !== 0) { var f = new Ib.List(); f.add({ x: d.x, y: d.y }), f.add({ x: d.x + d.width, y: d.y }), f.add({ x: d.x + d.width, y: d.y + d.height }), f.add({ x: d.x, y: d.y + d.height }), f = this._rotatePointList(f, e, d); var g = Ib.Util.getRect(f); this._viewRect = g } }, getLabel: function() { return this._network.getLabel(this._element) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('label.corner.radius') }, getPointerLength: function() { return this.getStyle('label.pointer.length') }, getPointerWidth: function() { return this.getStyle('label.pointer.width') }, getPosition: function() { return this.getStyle('label.position') }, getXOffset: function() { return this.getStyle('label.xoffset') }, getYOffset: function() { return this.getStyle('label.yoffset') }, getPadding: function() { return this.getStyle('label.padding') }, getPaddingLeft: function() { return this.getStyle('label.padding.left') }, getPaddingRight: function() { return this.getStyle('label.padding.right') }, getPaddingTop: function() { return this.getStyle('label.padding.top') }, getPaddingBottom: function() { return this.getStyle('label.padding.bottom') }, getDirection: function() { return this.getStyle('label.direction') }, isFill: function() { return this.getStyle('label.fill') }, getFillColor: function() { return this.getStyle('label.fill.color') }, getGradient: function() { return this.getStyle('label.gradient') }, getGradientColor: function() { return this.getStyle('label.gradient.color') }, getOutlineWidth: function() { return this.getStyle('label.outline.width') }, getOutlineColor: function() { return this.getStyle('label.outline.color') }, getCap: function() { return this.getStyle('label.cap') }, getJoin: function() { return this.getStyle('label.join') }, getAlpha: function() { return this.getStyle('label.alpha') }, getMaxLength: function() { return this.getStyle('label.maxlength') }, isShadowable: function() { return this.getStyle('label.shadowable') } }), Ib.canvas.AlarmAttachment = function(a, b) { Ib.canvas.AlarmAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.AlarmAttachment', Ib.canvas.BasicAttachment, { paint: function(a) { Ib.canvas.AlarmAttachment.superClass.paint.apply(this, arguments), Xb.drawText(a, this.text, this._contentRect, this.font, this.getStyle('alarm.color')) }, validate: function() { this.font = this.getFont('alarm.font'), this.text = this._network.getAlarmLabel(this._element), this._textSize = Xb.getTextSize(this.font, this.text), this._fillColor = this._network.getAlarmFillColor(this._element), Ib.canvas.LabelAttachment.superClass.validate.call(this) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('alarm.corner.radius') }, getPointerLength: function() { return this.getStyle('alarm.pointer.length') }, getPointerWidth: function() { return this.getStyle('alarm.pointer.width') }, getPosition: function() { return this.getStyle('alarm.position') }, getXOffset: function() { return this.getStyle('alarm.xoffset') }, getYOffset: function() { return this.getStyle('alarm.yoffset') }, getPadding: function() { return this.getStyle('alarm.padding') }, getPaddingLeft: function() { return this.getStyle('alarm.padding.left') }, getPaddingRight: function() { return this.getStyle('alarm.padding.right') }, getPaddingTop: function() { return this.getStyle('alarm.padding.top') }, getPaddingBottom: function() { return this.getStyle('alarm.padding.bottom') }, getDirection: function() { return this.getStyle('alarm.direction') }, isFill: function() { return this._fillColor != null }, getFillColor: function() { return this._fillColor }, getGradient: function() { return this.getStyle('alarm.gradient') }, getGradientColor: function() { return this.getStyle('alarm.gradient.color') }, getOutlineWidth: function() { return this.getStyle('alarm.outline.width') }, getOutlineColor: function() { return this.getStyle('alarm.outline.color') }, getCap: function() { return this.getStyle('alarm.cap') }, getJoin: function() { return this.getStyle('alarm.join') }, getAlpha: function() { return this.getStyle('alarm.alpha') }, isShadowable: function() { return this.getStyle('alarm.shadowable') } }), Ib.canvas.LinkHandlerAttachment = function(a, b) { Ib.canvas.LinkHandlerAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.LinkHandlerAttachment', Ib.canvas.BasicAttachment, {
    paint: function(a) { Ib.canvas.LinkHandlerAttachment.superClass.paint.apply(this, arguments), Xb.drawText(a, this.linkHandlerLabel, this._contentRect, this.linkHandlerFont, this.getStyle('link.handler.color')) }, validate: function() { this.linkHandlerFont = this.getFont('link.handler.font'), this.linkHandlerLabel = this._network.getLinkHandlerLabel(this._element), this._textSize = Xb.getTextSize(this.linkHandlerFont, this.linkHandlerLabel), Ib.canvas.LinkHandlerAttachment.superClass.validate.call(this) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('link.handler.corner.radius') }, getPointerLength: function() { return this.getStyle('link.handler.pointer.length') }, getPointerWidth: function() { return this.getStyle('link.handler.pointer.width') }, getPosition: function() { return this.getStyle('link.handler.position') }, getXOffset: function() { return this.getStyle('link.handler.xoffset') }, getYOffset: function() { return this.getStyle('link.handler.yoffset') }, getPadding: function() { return this.getStyle('link.handler.padding') }, getPaddingLeft: function() { return this.getStyle('link.handler.padding.left') }, getPaddingRight: function() { return this.getStyle('link.handler.padding.right') }, getPaddingTop: function() { return this.getStyle('link.handler.padding.top') }, getPaddingBottom: function() { return this.getStyle('link.handler.padding.bottom') }, getDirection: function() { return this.getStyle('link.handler.direction') }, isFill: function() { return this.getStyle('link.handler.fill') }, getFillColor: function() { return this.getStyle('link.handler.fill.color') }, getGradient: function() { return this.getStyle('link.handler.gradient') }, getGradientColor: function() { return this.getStyle('link.handler.gradient.color') }, getOutlineWidth: function() { return this.getStyle('link.handler.outline.width') }, getOutlineColor: function() { return this.getStyle('link.handler.outline.color') }, getCap: function() { return this.getStyle('link.handler.cap') }, getJoin: function() { return this.getStyle('link.handler.join') }, getAlpha: function() { return this.getStyle('link.handler.alpha') }, isShadowable: function() { return this.getStyle('link.handler.shadowable') } }), Ib.canvas.IconsAttachment = function(a, b) { Ib.canvas.IconsAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.IconsAttachment', Ib.canvas.Attachment, { isShadowable: function() { return Ib.Defaults.ATTACHMENT_SHADOWABLE }, validate: function() { if (Ib.canvas.IconsAttachment.superClass.validate.call(this), this.iconsNames = this._network.getIconsNames(this._element), this.iconsNames && this.iconsNames.length != 0) { var a = this._makeGroup(this.iconsNames), b = this._makeGroup(this._network.getIconsColors(this._element)); len = a.length, this.iconsOrientation = this._makeArray(this._element.getStyle('icons.orientation'), len, 'right'), this.iconsPosition = this._makeArray(this._element.getStyle('icons.position'), len, 'topleft.bottomright'), this.iconsXoffset = this._makeArray(this._element.getStyle('icons.xoffset'), len, 0), this.iconsYoffset = this._makeArray(this._element.getStyle('icons.yoffset'), len, 0), this.iconsXgap = this._makeArray(this._element.getStyle('icons.xgap'), len, 1), this.iconsYgap = this._makeArray(this._element.getStyle('icons.ygap'), len, 1), this.locations = [], this.iconsSizes = []; var c, d; for (i = 0; i < len; i++) { var e = a[i], f = this.iconsOrientation[i] || 'right', g = this.iconsPosition[i] || 'topleft.bottomright', h = this.iconsXgap[i] || 1, j = this.iconsYgap[i] || 1, k = this.iconsXoffset[i] || 0, l = this.iconsYoffset[i] || 0; if (this._ui._element instanceof Ib.Link) { var m, n = this._ui.getLinkPoints(); m = this._ui.getLineLength ? this._ui.getLineLength() : this._ui._element.getLineLength(), Math.abs(k) > 0 && Math.abs(k) < 1 ? g === 'from' ? k *= m : g === 'to' ? k = m * (1 - k) : (k /= 2, k += 0.5, k *= m) : g === 'from' ? k = k : g === 'to' ? k = m - k : k += m / 2; { var o, p = Tb.calculatePointInfoAlongLine(n, !0, k, l), q = p.point; p.angle }o = g === 'from' ? this._ui.getFromPoint() : g === 'to' ? this._ui.getToPoint() : this._ui._hotSpot, k = q.x - o.x, l = q.y - o.y }d = null, c = this._getIconsSize(e, f, h, j), c && (d = this._network.getPosition(g, this._ui, c, k, l), f === 'top' ? d.y += c.height : f === 'left' && (d.x += c.width)), this.locations.push(d), this.iconsSizes.push(c) } var r = null; for (i = 0; i < this.locations.length; i++)d = this.locations[i], c = this.iconsSizes[i], d != null && (r = r == null ? { x: d.x, y: d.y, width: c.width, height: c.height } : Tb.unionRect(r, { x: d.x, y: d.y, width: c.width, height: c.height })); this._viewRect = r || { x: this._element.getLocation().x, y: this._element.getLocation().y, width: 0, height: 0 }, this.iconsGroups = a, this.colorGroups = b; var s = this._element instanceof Ib.Link && this._element.getStyle('link.icons.rotatable'); for (i = 0; i < len; i++) if (s instanceof Array && s[i] && this._viewRect) { var t = this._viewRect.x + this._viewRect.width / 2, u = this._viewRect.y + this._viewRect.height / 2, v = Math.sqrt(this._viewRect.height * this._viewRect.height + this._viewRect.width * this._viewRect.width); this._viewRect = { x: t - v / 2, y: u - v / 2, width: v, height: v } } } }, _makeGroup: function(a) { if (!Array.isArray(a)) return [[a]]; var b, c, d, e = [], f = !1, g = a.length; for (b = 0; g > b; b++)c = a[b], Array.isArray(c) ? (f = !0, e.push(c)) : (d = [c], e.push(d)); return f || (e.length = 0, e.push(a)), e }, _makeArray: function(a, b, c) { if (Array.isArray(a)) return a; for (var d = [], e = 0; b > e; e++)d.push(a || c); return d }, paint: function(a) { if (Ib.canvas.IconsAttachment.superClass.paint.apply(this, arguments), this.iconsNames && this.iconsNames.length != 0 && this.locations) { var b, c, d, e, f, g, h, i, j, k; for (b = 0; b < this.iconsGroups.length; b++) if (c = this.locations[b]) { f = c.x, g = c.y, e = this.iconsGroups[b], h = this.colorGroups[b], i = this.iconsOrientation[b], j = this.iconsXgap[b] || 1, k = this.iconsYgap[b] || 1, d = 0; for (var l in e) { var m = null, n = null; h && h.length > d && (n = h[d++]); var o = Jb.getImageAsset(e[l]); if (o != null) { if (i === 'right')m = { x: f, y: g, width: o.getWidth(), height: o.getHeight() }, f += m.width + j; else if (i === 'left')m = { x: f - o.getWidth(), y: g, width: o.getWidth(), height: o.getHeight() }, f -= m.width + j; else if (i === 'top')m = { x: f, y: g - o.getHeight(), width: o.getWidth(), height: o.getHeight() }, g -= m.height + k; else { if (i !== 'bottom') throw "Can not resolve '" + i + "' orientation"; m = { x: f, y: g, width: o.getWidth(), height: o.getHeight() }, g += m.height + k } var p = this._element instanceof Ib.Link && this._element.getStyle('link.icons.rotatable'); if (p instanceof Array && p[b]) { a.save(); var q = m, f = q.x + q.width / 2, g = q.y + q.height / 2; a.translate(f, g), a.rotate(this._network.getElementUI(this._element).getAngle()), a.translate(-f, -g), Nc(a, o.getImage(n, m.width, m.height), n, m, this._element, this._network), a.restore() } else Nc(a, o.getImage(n, m.width, m.height), n, m, this._element, this._network); if (this._network._debug) { var m = this._viewRect; Xb.strokeRect(a, m, '#FCFC00', 1), Xb.strokeRect(a, m, '#FCFC00', 1) } } } } } }, _getIconsSize: function(a, b, c, d) { var e = 0, f = 0, g = null, h = null, i = null; for (var j in a) if (h = Jb.getImageAsset(a[j])) { if (b === 'right')g = { x: e, y: f, width: h.getWidth(), height: h.getHeight() }, e += g.width + c; else if (b === 'left')g = { x: e - h.getWidth(), y: f, width: h.getWidth(), height: h.getHeight() }, e -= g.width + c; else if (b === 'top')g = { x: e, y: f - h.getHeight(), width: h.getWidth(), height: h.getHeight() }, f -= g.height + d; else { if (b !== 'bottom') throw "Can not resolve '" + b + "' orientation"; g = { x: e, y: f, width: h.getWidth(), height: h.getHeight() }, f += g.height + d }i = i == null ? Jb.clone(g) : Tb.unionRect(i, g) } return i ? { width: Math.abs(i.width), height: Math.abs(i.height) } : null } }), Ib.canvas.EditAttachment = function(a, b) { Ib.canvas.EditAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.canvas.EditAttachment', Ib.canvas.Attachment, { paint: function(a) { Ib.canvas.EditAttachment.superClass.paint.apply(this, arguments), this._viewRect = null, this.paintResizingPoints(a), this.paintEditPoints(a), this.paintRotatePoints(a) }, paintResizingPoints: function(a) { var b = this.resizingPoints.size(); if (!(b <= 0)) { var c = 2 * this.resizePointSize, d = 2 * this.resizePointSize, e = this._network.getResizePointFillColor(), f = this._network.getResizePointOutlineWidth(), g = this._network.getResizePointOutlineColor(), h = this._element.getAngle(), i = this._element.getOriginalRect(); a.lineWidth = f; for (var j = 0; b > j; j++) { var k = this.resizingPoints.get(j), l = { x: k.x - this.resizePointSize, y: k.y - this.resizePointSize, width: 2 * this.resizePointSize, height: 2 * this.resizePointSize }, m = this._getRotateRect(l, h, { x: i.x + i.width / 2, y: i.y + i.height / 2 }); a.save(), Ib.Util.rotateCanvas(a, m, h), Od.rect(a, m.x, m.y, c, d), a.restore() }a.fillStyle = e, a.strokeStyle = g, a.fill(), a.stroke() } }, paintEditPoints: function(a) { var b = this.editPoints.size(); if (!(b <= 0)) { var c = this._network.getEditPointOutlineColor(), d = this._network.getEditPointFillColor(), e = this._network.getEditPointOutlineWidth(); a.beginPath(), a.lineWidth = e; for (var f = 0; b > f; f++) { var g = this.editPoints.get(f); a.beginPath(), Od.circle(a, g.x, g.y, this.editPointSize, d, c), a.closePath() } } }, paintRotatePoints: function(a) { var b = this.rotatePoints.size(); if (!(b <= 0)) { var c = this._network.getRotatePointOutlineColor(), d = this._network.getRotatePointFillColor(), e = this._network.getRotatePointOutlineWidth(); a.beginPath(), a.lineWidth = e; for (var f = 0; b > f; f++) { var g = this.rotatePoints.get(f); a.beginPath(), Od.circle(a, g.x, g.y, this.rotatePointSize, d, c), a.closePath() } } }, validate: function() { Ib.canvas.EditAttachment.superClass.validate.call(this), this.editPointSize = this._network.getEditPointSize(), this.resizePointSize = this._network.getResizePointSize(), this.rotatePointSize = this._network.getRotatePointSize(), this.resizingPoints = new Ib.List(), this.editPoints = new Ib.List(), this.rotatePoints = new Ib.List(), this._element instanceof Ib.Node && this._addResizingPoint(this._element), !(this._network.isRotatable(this._element) && this._element instanceof Ld) || this._element instanceof Ib.ShapeNode || this._element instanceof Ib.Grid || this._element instanceof Ib.Group || this._addRotatePoint(this._element), this._element instanceof Ib.ShapeNode && (this._addResizingPoint(this._element), this._addShapeNodePoint(this._element)), this._ui instanceof Ib.canvas.ShapeLinkUI && this._addShapeLinkPoints(this._element), this._ui instanceof Ib.canvas.LinkUI && this._addLinkControlPoint(this._ui) }, _addResizingPoint: function(a) { var b = a.getOriginalRect(); if (b) { var c = this._network.getResizePointSize(); if (!(c <= 0)) { var d = new nd([{ x: b.x, y: b.y }, { x: b.x + b.width / 2, y: b.y }, { x: b.x + b.width, y: b.y }, { x: b.x, y: b.y + b.height / 2 }, { x: b.x + b.width, y: b.y + b.height / 2 }, { x: b.x, y: b.y + b.height }, { x: b.x + b.width / 2, y: b.y + b.height }, { x: b.x + b.width, y: b.y + b.height }]), e = this._network.getResizePointOutlineWidth(), f = this._network.getResizePointOutlineColor(), g = this._network.getResizePointFillColor(); this._addPoints(a.getRect(), d, e, f, g, !0) } } }, _addRotatePoint: function(a) { var b = a.getOriginalRect(); if (b) { var c = this._network.getRotatePointSize(); if (!(c <= 0)) { var d = 2 * c, e = new Ib.List([{ x: b.x + b.width / 2, y: b.y - this._network.getRotatePointOffset() - d / 2 }]), f = a.getAngle(); f != 0 && (e = this._rotatePointList(e, f, a.getOriginalRect())); var g = e.get(0), h = { x: g.x - d / 2, y: g.y - d / 2, width: d, height: d }, i = this._network.getRotatePointOutlineWidth(), j = this.rotatePointSize + i; Tb.grow(b, j, j); var k = Tb.unionRect(a.getRect(), h); this._viewRect = Tb.unionRect(k, this._viewRect), this.rotatePoints = e } } }, _addShapeNodePoint: function(a) { this._addEditPoints(a.getPoints()) }, _addShapeLinkPoints: function(a) { this._addEditPoints(a.getPoints()) }, _addLinkControlPoint: function(a) { if (xc.isOrthogonalLink(a._element)) { var b = a.getControlPoint(); if (b) { var c = new Ib.List(); c.add(b), this._addEditPoints(c) } } }, _addEditPoints: function(a) { var b = Tb.getRect(a); if (b) { var c = this._network.getEditPointSize(); if (!(c <= 0)) { var d = this._network.getEditPointOutlineWidth(); this._addPoints(b, a, d, !1) } } }, _addPoints: function(a, b, c, d, e, f) { var g = f ? this._network.getResizePointSize() : this._network.getEditPointSize(); if (!(g < 0)) { var h = g + c; Tb.grow(a, h, h), this._viewRect = Tb.unionRect(a, this._viewRect), f == 1 ? this.resizingPoints = b : this.editPoints = b } }, _rotatePoint: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x + c.width / 2, c.y + c.height / 2), e = d.transform(a); return e }, _rotatePointList: function(a, b, c) { var d = this, e = new Ib.List(); return a.forEach(function(a) { e.add(d._rotatePoint(a, b, c)) }), e }, _getRotateRect: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x, c.y), e = { x: a.x + a.width / 2, y: a.y + a.height / 2 }, f = d.transform(e), g = new Ib.List([{ x: f.x - a.width / 2, y: f.y - a.height / 2 }, { x: f.x + a.width / 2, y: f.y - a.height / 2 }, { x: f.x + a.width / 2, y: f.y + a.height / 2 }, { x: f.x - a.width / 2, y: f.y + a.height / 2 }]); return Tb.getRect(g) } }), Ib.canvas.HTMLLabelAttachment = function(a, b) { Ib.canvas.HTMLLabelAttachment.superClass.constructor.call(this, a, b), this._triangleDiv = Ib.Util.createDiv(), this._roundDiv = Ib.Util.createDiv(), this._contentDiv = Ib.Util.createDiv(); this._network.getView().appendChild(this._roundDiv), this._roundDiv.appendChild(this._contentDiv) }, Jb.ext('twaver.canvas.HTMLLabelAttachment', Ib.canvas.LabelAttachment, { validate: function() { var a = this._element.getStyle('attachment.htmllabel.hyperlink'); a ? (Ib.Util.setCSSStyle(this._triangleDiv, 'pointer-events', 'auto'), Ib.Util.setCSSStyle(this._contentDiv, 'pointer-events', 'auto')) : (Ib.Util.setCSSStyle(this._triangleDiv, 'pointer-events', 'none'), Ib.Util.setCSSStyle(this._contentDiv, 'pointer-events', 'none')), Ib.Util.setCSSStyle(this._triangleDiv, 'border-style', 'solid'), Ib.Util.setCSSStyle(this._contentDiv, 'white-space', 'nowrap'); var b = (this.getFont('label.font'), this.getLabel()); this._contentDiv.innerHTML = b, this._contentDiv.style.visibility = 'hidden', Ib.canvas.HTMLLabelAttachment.superClass.validate.call(this) }, getContentWidth: function() { return this._contentDiv.scrollWidth || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'width')) }, getContentHeight: function() { return this._contentDiv.scrollHeight || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'height')) }, paint: function(a) { var b = this.isFill(), c = this.getOutlineWidth(), d = this._contentRect; if (this.getElementUI().setShadow(this, a), c > 0 || b) { if (Xb.drawRoundRect(a, d.x, d.y, d.width, d.height, this.getCornerRadius()), this._pointers) { var e = this._pointers; a.moveTo(e[0].x, e[0].y), a.lineTo(e[1].x, e[1].y), a.lineTo(e[2].x, e[2].y) } if (a.closePath(), c > 0 && (a.lineWidth = c, a.strokeStyle = this.getOutlineColor(), a.lineCap = this.getCap(), a.lineJoin = this.getJoin(), a.stroke()), b) { var f = this.getFillColor(), g = this.getGradient(); g ? Xb.fill(a, f, g, this.getGradientColor(), this._viewRect) : a.fillStyle = f, a.fill() } } var h = (this.getFont('label.font'), this.getLabel(), this._network.getViewRect().x), i = this._network.getViewRect().y, j = this._network.getZoom(), k = { x: this._contentRect.x + this._contentRect.width / 2, y: this._contentRect.y + this._contentRect.height / 2 }, l = k.x * j - h - this._contentDiv.offsetWidth / 2 * j + 'px', m = k.y * j - i - this._contentDiv.offsetHeight / 2 * j + 'px'; this._contentDiv.style.left = l, this._contentDiv.style.top = m, this._contentDiv.style.setProperty('-webkit-transform', 'scale(' + j + ')', null), this._contentDiv.style.setProperty('-webkit-transform-origin', '0 0', null), this._network._debug && Xb.strokeRect(a, this._contentRect, '#AAAAAA') }, setVisibility: function(a) { this._contentDiv.style.visibility = a }, dispose: function() { this._network.getView().removeChild(this._roundDiv) }, getView: function() { return this._roundDiv } }), Ib.canvas.HTMLAlarmAttachment = function(a, b) { Ib.canvas.HTMLAlarmAttachment.superClass.constructor.call(this, a, b), this._triangleDiv = Ib.Util.createDiv(), this._roundDiv = Ib.Util.createDiv(), this._contentDiv = Ib.Util.createDiv(), Ib.Util.setCSSStyle(this._triangleDiv, 'border-style', 'solid'), Ib.Util.setCSSStyle(this._triangleDiv, 'pointer-events', 'none'), Ib.Util.setCSSStyle(this._contentDiv, 'white-space', 'nowrap'), Ib.Util.setCSSStyle(this._contentDiv, 'pointer-events', 'none'); this._network.getView().appendChild(this._roundDiv), this._roundDiv.appendChild(this._contentDiv) }, Jb.ext('twaver.canvas.HTMLAlarmAttachment', Ib.canvas.AlarmAttachment, { validate: function() { var a = (this.getFont('alarm.font'), this._network.getAlarmLabel(this._element)); this._contentDiv.innerHTML = a, this._contentDiv.style.visibility = 'hidden', Ib.canvas.HTMLAlarmAttachment.superClass.validate.call(this) }, getContentWidth: function() { return this._contentDiv.scrollWidth || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'width')) }, getContentHeight: function() { return this._contentDiv.scrollHeight || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'height')) }, paint: function(a) { var b = this.isFill(), c = this.getOutlineWidth(), d = this._contentRect; if (this.getElementUI().setShadow(this, a), c > 0 || b) { if (Xb.drawRoundRect(a, d.x, d.y, d.width, d.height, this.getCornerRadius()), this._pointers) { var e = this._pointers; a.moveTo(e[0].x, e[0].y), a.lineTo(e[1].x, e[1].y), a.lineTo(e[2].x, e[2].y) } if (a.closePath(), c > 0 && (a.lineWidth = c, a.strokeStyle = this.getOutlineColor(), a.lineCap = this.getCap(), a.lineJoin = this.getJoin(), a.stroke()), b) { var f = this.getFillColor(), g = this.getGradient(); g ? Xb.fill(a, f, g, this.getGradientColor(), this._viewRect) : a.fillStyle = f, a.fill() } } var h = (this.getFont('alarm.font'), this._network.getAlarmLabel(this._element), this._network.getViewRect().x), i = this._network.getViewRect().y, j = this._network.getZoom(), k = { x: this._contentRect.x + this._contentRect.width / 2, y: this._contentRect.y + this._contentRect.height / 2 }, l = k.x * j - h - this._contentDiv.offsetWidth / 2 * j + 'px', m = k.y * j - i - this._contentDiv.offsetHeight / 2 * j + 'px'; this._contentDiv.style.left = l, this._contentDiv.style.top = m, this._contentDiv.style.setProperty('-webkit-transform', 'scale(' + j + ')', null), this._contentDiv.style.setProperty('-webkit-transform-origin', '0 0', null), this._network._debug && Xb.strokeRect(a, this._contentRect, '#AAAAAB'), Ib.canvas.AlarmAttachment.superClass.paint.apply(this, arguments) }, setVisibility: function(a) { this._contentDiv.style.visibility = a }, dispose: function() { this._network.getView().removeChild(this._roundDiv) }, getView: function() { return this._roundDiv } }), Ib.canvas.interaction.BaseInteraction = function(a) { this.network = a }, Jb.ext('twaver.canvas.interaction.BaseInteraction', Object, { setUp: function() {}, tearDown: function() {}, repaint: function() { this.network.repaintTopCanvas() }, convertPointFromView: function(a) { var b = a.x * this.network.getZoom() - this.network.getViewRect().x, c = a.y * this.network.getZoom() - this.network.getViewRect().y; return { x: b, y: c } }, convertFromUIToMarkerRect: function(a, b, c) { var d = this.network.getZoom(); return { x: a.x * d - this.network.getViewRect().x + b * d, y: a.y * d - this.network.getViewRect().y + c * d, width: a.width * d, height: a.height * d } }, getMarkerPoint: function(a) { var b; if (Qb.isTouchable && a.changedTouches && a.changedTouches.length > 0) { var c = a.changedTouches[0]; return b = { x: c.clientX, y: c.clientY } } return b = Qb.isFirefox ? { x: a.layerX, y: a.layerY } : { x: a.offsetX, y: a.offsetY } }, paint: function(a) {}, addListener: function() { for (var a = 0; a < arguments.length; a++) { var b = arguments[a]; Wb.addEventListener(b, 'handle_' + b, this.network.getView(), this) } }, removeListener: function() { for (var a = 0; a < arguments.length; a++)Wb.removeEventListener(arguments[a], this.network.getView(), this) }, _handle_mousedown: function(a) { a.button === 0 && (this._startLogical = this.network.getLogicalPoint(a), this._startClient = Wb.getClientPoint(a), this._startLogical && Wb.handle_mousedown(this, a)) }, _handle_mousemove: function(a) { this._endLogical = { x: this._startLogical.x + (a.clientX - this._startClient.x) / this.network.getZoom(), y: this._startLogical.y + (a.clientY - this._startClient.y) / this.network.getZoom() } }, _handle_mouseup: function(a) { delete this._startClient, delete this._startLogical, delete this._endLogical } }), Ib.canvas.interaction.SelectInteraction = function(a) { Ib.canvas.interaction.SelectInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.canvas.interaction.SelectInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mouseup'), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mouseup'), this.end(), this.network.removeMarker(this) }, paint: function(a) { if (this.startPoint != null && this.endPoint != null) { var b = this.convertPointFromView(this.startPoint), c = this.convertPointFromView(this.endPoint), d = b.x, e = b.y, f = c.x, g = c.y, h = Tb.getRect([{ x: d, y: e }, { x: f, y: g }]); if (h != null) { a.beginPath(); var i = this.network.getSelectOutlineWidth(), j = this.getIntersectMode() ? this.network.getSelectFillColor() : null; a.strokeStyle = this.network.getSelectOutlineColor(), a.lineWidth = i, Od.rect(a, h.x, h.y, h.width, h.height, j, this.network.getSelectOutlineColor()), a.closePath() } } }, handle_mousedown: function(a) { if (this.network.isValidEvent(a) && !this.network.isMovingElement() && !this.network.isEditingElement() && !a.shiftKey) { var b = this.network.getElementAt(a), c = this.network.getSelectionModel(); b ? Jb.isCtrlDown(a) ? c.contains(b) ? c.removeSelection(b) : c.appendSelection(b) : c.contains(b) || c.setSelection(b) : (Jb.isCtrlDown(a) || c.clearSelection(), this.end(a), this.startPoint = this.network.getLogicalPoint(a), this.startPoint && this.network.isRectSelectEnabled() && this.addListener('mousemove')) } }, handle_mouseup: function(a) { this.end(a) }, handle_mousemove: function(a) { if (this.network.isMovingElement() || this.network.isEditingElement()) return void this.end(a); var b = this.network.getLogicalPoint(a); b && (this.network.setSelectingElement(!0), this.network.fireInteractionEvent(this.endPoint == null ? { kind: 'selectStart', event: a } : { kind: 'selectBetween', event: a }), this.endPoint = b, this.repaint()) }, end: function(a) { if (this.startPoint) { if (this.endPoint && this.startPoint.x !== this.endPoint.x && this.startPoint.y !== this.endPoint.y) { var b = Tb.getRect([this.startPoint, this.endPoint]), c = this.network.getElementsAtRect(b, this.getIntersectMode(), this.network.getRectSelectFilter()); if (c && c.size() > 0) { var d = this.network.getSelectionModel(), e = d.toSelection(); c.forEach(function(a) { d.contains(a) ? e.remove(a) : e.add(a) }, this), d.setSelection(e) } this.network.fireInteractionEvent({ kind: 'selectEnd', event: a }) } this.network.setSelectingElement(!1), this.removeListener('mousemove'), this.startPoint = null, this.endPoint = null, this.repaint() } }, getIntersectMode: function() { return this.network.getSelectMode() === 'intersect' ? !0 : this.network.getSelectMode() === 'contain' ? !1 : this.startPoint.x > this.endPoint.x && this.startPoint.y > this.endPoint.y } }), Ib.canvas.interaction.MoveInteraction = function(a, b) { this.lazyMode = b, Ib.canvas.interaction.MoveInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.canvas.interaction.MoveInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mouseup', 'keydown', 'mouseout'), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mouseup', 'keydown', 'mouseout'), this.end(), this.network.removeMarker(this) }, handle_keydown: function(a) { this.currentKeyEvent = a, this.addListener('keyup') }, handle_keyup: function(a) { this.currentKeyEvent = null, this.removeListener('keyup') }, isParenting: function() { return this.pressPoint && this.currentKeyEvent != null && this.currentKeyEvent.keyCode === 80 }, parentProcess: function(a, b) { var c = null; this.parent = null; var d = this; if (!b && this.isParenting()) { var e = {}, f = this.network.getLogicalPoint(a); e.x = f.x - 1, e.y = f.y - 1, e.width = 2, e.height = 2; var g = this.network.getElementsAtRect(e, !0); if (g && g.size() > 0) for (var h = g.size(), i = 0; h > i; i++) { var j = g.get(i); if (!d.network.getElementBox().getSelectionModel().contains(j)) { d.parent = j; break } } } else this.parent = null; this.parent != null && (c = this.network.getElementUI(this.parent).getViewRect()), this.parentRect = c == null || b ? null : c }, paint: function(a) { if (this.lazyMode) { if (this.pressPoint == null || this.dragPoint == null) return; a.beginPath(); var b = this.dragPoint.x - this.pressPoint.x, c = this.dragPoint.y - this.pressPoint.y, d = this.network.getMovableSelectedElements(), e = d.size(), f = this.network.isLazyMoveFill() ? this.network.getLazyMoveFillColor() : null, g = this.network.getLazyMoveOutlineWidth(), h = this.network.getLazyMoveOutlineColor(); a.strokeStyle = h, a.lineWidth = g, a.fillStyle = f; for (var i = 0; e > i; i++) { var j = d.get(i), k = this.network.getElementUI(j); if (k) { var l = this.convertFromUIToMarkerRect(k.getViewRect(), b, c); Od.rect(a, l.x, l.y, l.width, l.height) } }a.fill(), a.stroke() } if (this.parentRect) { a.beginPath(); var f = this.network.isLazyMoveFill() ? this.network.getLazyMoveFillColor() : null, g = this.network.getLazyMoveOutlineWidth(), h = this.network.getLazyMoveOutlineColor(); a.strokeStyle = h, a.lineWidth = g, a.fillStyle = f; var l = this.parentRect; Od.rect(a, l.x, l.y, l.width, l.height), a.fill(), a.stroke() } }, handle_mousedown: function(a) { if (a.button === 0 && this.network.isValidEvent(a) && !this.network.isSelectingElement() && !this.network.isEditingElement()) { var b = this.network.getElementAt(a); this.network.isMovable(b) && (this.end(a), this.lastPoint = this.network.getLogicalPoint(a), this.lazyMode && (this.pressPoint = this.lastPoint), this.lastPoint && this.addListener('mousemove')) } }, handle_mouseup: function(a) { this.end(a) }, handle_mouseout: function(a) { this.end(a) }, handle_mousemove: function(a) { if (this.network.isSelectingElement() || this.network.isEditingElement() || !this.network.hasMovableSelectedElements()) return void this.end(a); var b = this.network.getLogicalPoint(a); b && this.lastPoint && (this.xoffset = b.x - this.lastPoint.x, this.yoffset = b.y - this.lastPoint.y, Math.abs(this.xoffset) < 1 && Math.abs(this.yoffset) < 1 || (this.lazyMode ? this.dragPoint == null ? (this.network.fireInteractionEvent({ kind: 'lazyMoveStart', event: a }), this.network.setMovingElement(!0)) : this.network.fireInteractionEvent({ kind: 'lazyMoveBetween', event: a }) : (this.lastPoint = b, this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a })), this.network.moveSelectedElements(this.xoffset, this.yoffset)), this.parentProcess(a, !1), this.lazyMode && (this.dragPoint = b), (this.lazyMode || this.isParenting()) && this.repaint())) }, end: function(a) { if (this.lazyMode) { if (this.dragPoint != null && this.pressPoint != null) { var b = this, c = function() { b.network.fireInteractionEvent({ kind: 'lazyMoveEnd', event: a }), b.network.setMovingElement(!1) }, d = this.dragPoint.x - this.pressPoint.x, e = this.dragPoint.y - this.pressPoint.y; this.network.moveSelectedElements(d, e, this.network.isLazyMoveAnimate(), c) } } else this.network.isMovingElement() && (this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: a })); if (this.isParenting()) { this.parent == null && (this.parent = this.network.getCurrentSubNetwork()); var b = this; this.network.getMovableSelectedElements().forEach(function(a) { a.setParent(b.parent) }, this.network) } this.parentProcess(a, !0), this.isParenting() && this.repaint(), this.network.invalidateCanvasSize(), this.removeListener('mousemove'), this.lastPoint = null, this.dragPoint = null, this.pressPoint = null } }), Ib.canvas.interaction.ScrollInteraction = function(a) { Ib.canvas.interaction.ScrollInteraction.superClass.constructor.call(this, a), this.hThumbRect = null, this.vThumbRect = null, this.scrollBarVisible = !1 }, Jb.ext('twaver.canvas.interaction.ScrollInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mouseover', 'mouseout'), Qb.isFirefox ? Wb.addEventListener('DOMMouseScroll', 'handleMouseWheel', this.network.getView(), this) : Wb.addEventListener('mousewheel', 'handleMouseWheel', this.network.getView(), this), Wb.addEventListener('mouseup', 'handleMouseUp', a, this), Wb.addEventListener('mousemove', 'handleMouseMove', a, this), this.network.addPropertyChangeListener(this.handleViewRectChange, this), this.validateScrollBar(), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mouseover', 'mouseout'), Qb.isFirefox ? Wb.removeEventListener('DOMMouseScroll', this.network.getView(), this) : Wb.removeEventListener('mousewheel', this.network.getView(), this), Wb.removeEventListener('mouseup', a, this), Wb.removeEventListener('mousemove', a, this), this.network.removePropertyChangeListener(this.handleViewRectChange, this), this.network.removeMarker(this) }, handleViewRectChange: function(a) { (a.property == 'viewRect' || a.property == 'canvasSizeChange') && this.validateScrollBar() }, getScrollBarWidth: function() { return this.network.getScrollBarWidth() }, getScrollBarColor: function() { return '#cccccc' }, validateScrollBar: function() { if (this.hThumbRect = null, this.vThumbRect = null, this.network.isScrollBarVisible() == 0) return void this.repaint(); var a = this.network.getViewRect().height, b = this.network.getViewRect().width, c = this.network.getViewRect().x, d = this.network.getViewRect().y, e = this.network.getCanvasSize(), f = e.width, g = e.height; if (f > b && (c < 0 || c + b > f)) return void this.repaint(); if (g > a && (d < 0 || d + a > g)) return void this.repaint(); var h = 0, i = g > a, j = f > b, k = this.getScrollBarWidth(); if (g > a) { h = j ? a * (a - k) / g : a * a / g; var l = d / (g - a) * (a - h - k); this.vThumbRect = { x: b - k, y: l, width: k, height: h } } var m = 0; if (f > b) { m = i ? b * (b - k) / f : b * b / f; var n = c / (f - b) * (b - m - k); this.hThumbRect = { x: n, y: a - k, width: m, height: k } } this.network.setHScrollBarVisible(this.hThumbRect != null), this.network.setVScrollBarVisible(this.vThumbRect != null), this.repaint() }, scrollXOffset: function(a) { var b = this.network.getViewRect().height, c = this.network.getViewRect().width, d = this.network.getViewRect().x, e = this.network.getViewRect().y, f = 30; a && (f = -30), this.network.setViewRect(d + f, e, c, b) }, scrollYOffset: function(a) { var b = this.network.getViewRect().height, c = this.network.getViewRect().width, d = this.network.getViewRect().x, e = this.network.getViewRect().y, f = 30; a && (f = -30), this.network.setViewRect(d, e + f, c, b) }, handle_mousedown: function(a) { if (this.network.isValidEvent(a) != 1) { var b = this.getMarkerPoint(a); this.hBarDownPoint = null, this.vBarDownPoint = null, this.vThumbRect != null && Tb.containsPoint(this.vThumbRect, b.x, b.y) && (this.vBarDownPoint = { x: a.screenX, y: a.screenY }, this.vBarDownOffset = this.vBarDownPoint.y - this.vThumbRect.y), this.hThumbRect != null && Tb.containsPoint(this.hThumbRect, b.x, b.y) && (this.hBarDownPoint = { x: a.screenX, y: a.screenY }, this.hBarDownOffset = this.hBarDownPoint.x - this.hThumbRect.x) } }, handle_mouseover: function(a) { this.scrollBarVisible != 1 && (this.scrollBarVisible = !0, this.repaint()) }, handle_mouseout: function(a) { this.scrollBarVisible != 0 && (this.scrollBarVisible = !1, this.repaint()) }, handleMouseUp: function(a) { this.vBarDownPoint = null, this.hBarDownPoint = null, this.repaint() }, handleMouseMove: function(a) { var b = { x: a.screenX, y: a.screenY }, c = this.network.getCanvasSize(), d = this.network.getViewRect().height, e = this.network.getViewRect().width, f = this.getScrollBarWidth(); if (this.hBarDownPoint != null) { var g = b.x - this.hBarDownPoint.x; return this.hBarDownPoint = b, void this.network.setViewOffSet(g * c.width / (e - f), 0) } if (this.vBarDownPoint != null) { var h = b.y - this.vBarDownPoint.y; return this.vBarDownPoint = b, void this.network.setViewOffSet(0, h * c.height / (d - f)) } }, handleMouseWheel: function(a) { var b = !1; a.wheelDelta !== a.wheelDeltaX ? (a.wheelDelta ? a.wheelDelta > 0 && (b = !0) : a.detail < 0 && (b = !0), this.scrollYOffset(b)) : (a.wheelDelta ? a.wheelDelta > 0 && (b = !0) : a.detail < 0 && (b = !0), this.scrollYOffset(b)) }, paintRoundRect: function(a, b, c, d, e, f, g, h) { a.beginPath(), a.globalAlpha = c, a.fillStyle = b, Xb.drawRoundRect(a, d, e, f, g, h), a.fill() }, paint: function(a) { if (this.network.isScrollBarVisible() != 0 && (this.scrollBarVisible != 0 || this.hBarDownPoint != null || this.vBarDownPoint != null)) { var b = this.getScrollBarWidth(), c = this.network.getViewRect().height, d = this.network.getViewRect().width; a.save(); var e, f = this.getScrollBarColor(); this.hThumbRect != null && (e = a.createLinearGradient(this.hThumbRect.x, this.hThumbRect.y, this.hThumbRect.x, this.hThumbRect.y + this.hThumbRect.height), e.addColorStop(0, f), e.addColorStop(1, '#666666'), this.paintRoundRect(a, this.getScrollBarColor(), 0.5, 0, c - b, d - b, b, b / 2), this.paintRoundRect(a, e, 0.9, this.hThumbRect.x, this.hThumbRect.y + 1, this.hThumbRect.width, this.hThumbRect.height - 2, b / 2)), this.vThumbRect != null && (e = a.createLinearGradient(this.vThumbRect.x, this.vThumbRect.y, this.vThumbRect.x + this.vThumbRect.width, this.vThumbRect.y), e.addColorStop(0, f), e.addColorStop(1, '#666666'), this.paintRoundRect(a, this.getScrollBarColor(), 0.5, d - b, 0, b, c - b, b / 2), this.paintRoundRect(a, e, 0.9, this.vThumbRect.x + 1, this.vThumbRect.y, this.vThumbRect.width - 2, this.vThumbRect.height, b / 2)), a.restore() } } }), Ib.canvas.interaction.DefaultInteraction = function(a) { Ib.canvas.interaction.DefaultInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.canvas.interaction.DefaultInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove', 'keydown') }, tearDown: function() { this.removeListener('mousedown', 'mousemove', 'keydown') }, handle_mousedown: function(a) {
    if (this.network.isValidEvent(a)) {
      this.network.isFocusOnClick() && Ib.Util.setFocus(this.network.getView()); var b = this.network.getElementAt(a); a.detail === 2 ? this.handleDoubleClicked(a, b) : this.handleClicked(a, b)
    }
  }, handleClicked: function(a, b) { Cc.handleClicked(this.network, a, b) }, handleDoubleClicked: function(a, b) { Cc.handleDoubleClicked(this.network, a, b) }, handle_keydown: function(a) { Cc.handleKeyDown(this.network, a) }, handle_mousemove: function(a) { var b = this.network.getElementAt(a), c = this._preElement, d = Dc(c), e = Dc(b); c !== b && (c && (d && d.onMouseLeave && d.onMouseLeave(c, this.network), this.network.onMouseLeave(c, a)), b && (e && e.onMouseEnter && e.onMouseEnter(b, this.network), this.network.onMouseEnter(b, a))), b && e && e.onMouseMove && e.onMouseMove(b, this.network), this.network.onMouseMove(b, a), this._preElement = b } }), Ib.canvas.interaction.PanInteraction = function(a) { Ib.canvas.interaction.PanInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.canvas.interaction.PanInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mouseup'), this._oldCursor = this.network.getView().style.cursor }, tearDown: function() { this.removeListener('mousedown', 'mouseup') }, handle_mousedown: function(a) { this.network.isValidEvent(a) && (this.lastPoint = this.getMarkerPoint(a), this.lastPoint && (this.addListener('mousemove'), this.network.getView().style.cursor = 'pointer')) }, handle_mouseup: function(a) { this._clear() }, handle_mousemove: function(a) { if (this.lastPoint) { var b = this.getMarkerPoint(a); if (b) { var c = b.x - this.lastPoint.x, d = b.y - this.lastPoint.y; this.network.panByOffset(-c, -d), this.lastPoint = b } } }, _clear: function(a) { this.lastPoint && (this.lastPoint = null, this.network.getView().style.cursor = this._oldCursor, this.removeListener('mousemove')) } }), Ib.canvas.interaction.CreateElementInteraction = function(a, b) { b || (b = Ib.Node), this.elementFunction = Ib.Util.isTypeOf(b, Ib.Node) ? function(a) { var c = new b(); return c instanceof Ib.Node && c.setCenterLocation(a), c } : b, Ib.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.canvas.interaction.CreateElementInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown') }, tearDown: function() { this.removeListener('mousedown') }, handle_mousedown: function(a) { var b = this.network.getLogicalPoint(a); if (b) { var c = this.elementFunction(b); c && this.network.addElementByInteraction(c) } } }), Ib.canvas.interaction.EditInteraction = function(a, b) { this.lazyMode = b, this.pointIndex = -1, Ib.canvas.interaction.EditInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.canvas.interaction.EditInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mouseup', 'mousemove'), this.oldCursor = this.network.getView().style.cursor, this.network.setHasEditInteraction(!0), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mouseup', 'mousemove'), this.network.getView().style.cursor = this.oldCursor, this.network.setHasEditInteraction(!1), this.clear(), this.network.removeMarker(this) }, paint: function(a) { if (this.lazyMode == 1 && this.resizingRect != null) { a.lineWidth = this.network.getResizeLineWidth(); var b = this.convertFromUIToMarkerRect(this.resizingRect, 0, 0); a.save(), Ib.Util.rotateCanvas(a, b, this.node.getAngle()), a.beginPath(), Od.rect(a, b.x, b.y, b.width, b.height, null, this.network.getResizeLineColor()), a.restore() } this.isStartRotate && this.showRotateScale(a) }, clear: function() { this.network.setEditingElement(!1), this.network.setRotatingElement(!1), this.isStart = !1, this.isStartRotate = !1, this.node = null, this.shapeNode = null, this.shapeLink = null, this.linkUI = null, this.resizingRect = null, this.resizeDirection = null, this.pointIndex = -1, this._removeCursor(), this.oldCursor = null, this.network.repaintTopCanvas() }, _removeCursor: function() { this.cursorID && (this.network.getView().style.cursor = this.oldCursor || 'default', this.cursorID = null), this.resizeDirection = null, this.isCrossCursor = !1 }, _setCrossCursor: function() { this.isCrossCursor || (this._removeCursor(), this._setCursor('crosshair'), this.isCrossCursor = !0) }, _setCursor: function(a) { this.cursorID = a, this.network.getView().style.cursor !== this.cursorID && (this.network.getView().style.cursor = this.cursorID) }, handle_mousedown: function(a) { if (a.button === 0) if (!Jb.isAltDown(a) || this.network.isEditingElement())!this.network.isEditingElement() || this.isStart || this.isStartRotate || (this.node && this.resizeDirection ? (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: this.lazyMode ? 'lazyResizeStart' : 'liveResizeStart', event: a, element: this.node, resizeDirection: this.resizeDirection })) : this.shapeNode && this.pointIndex >= 0 ? Jb.isAltDown(a) ? (this.shapeNode.removeAt(this.pointIndex), this.network.fireInteractionEvent({ kind: 'removePoint', event: a, element: this.shapeNode })) : (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.shapeNode, pointIndex: this.pointIndex })) : this.shapeLink && this.pointIndex >= 0 ? Jb.isAltDown(a) ? (this.shapeLink.removeAt(this.pointIndex), this.network.fireInteractionEvent({ kind: 'removePoint', event: a, element: this.shapeLink })) : (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.shapeLink, pointIndex: this.pointIndex })) : this.linkUI ? (this.isStart = !0, this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.linkUI._element })) : this.node && (this.isStartRotate = !0, this._handle_mousedown(a))); else { var b = this.network.getElementAt(a), c = this.network.getLogicalPoint(a); if (b instanceof Ib.ShapeNode) { var d = this.getPointIndex(b.getPoints(), c, !0); d > 0 && (this._handle_mousedown(a), this.pointIndex = d, this.shapeNode = b, b.addPoint(c, d), this._setCrossCursor(), this.network.setEditingElement(!0), this.isStart = !0, this.network.fireInteractionEvent({ kind: 'addPoint', event: a, element: b, pointIndex: d }), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: b, pointIndex: d })) } if (b instanceof Ib.ShapeLink) { var e = new Ib.List(b.getPoints()), f = this.network.getElementUI(b); e.add(f.getFromPoint(), 0), e.add(f.getToPoint()); var d = this.getPointIndex(e, c) - 1; d > 0 && (this._handle_mousedown(a), this.pointIndex = d, this.shapeLink = b, b.addPoint(c, d), this._setCrossCursor(), this.network.setEditingElement(!0), this.isStart = !0, this.network.fireInteractionEvent({ kind: 'addPoint', event: a, element: b, pointIndex: d }), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: b, pointIndex: d })) } } }, handle_mouseup: function(a) { if (this.isStart) { var b = this.network.getLogicalPoint(a); if (this.resizingRect) if (this.lazyMode) if (this.network.isResizeAnimate()) { var c = this, d = new Ib.animate.AnimateBounds(this.node, this.resizingRect, function() { c.network.fireInteractionEvent({ kind: 'lazyResizeEnd', event: a, element: c.node, resizeDirection: c.resizeDirection }), c.clear() }); Ib.animate.AnimateManager.start(d) } else this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.network.fireInteractionEvent({ kind: 'lazyResizeEnd', event: a, element: this.node, resizeDirection: this.resizeDirection }); else this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.network.fireInteractionEvent({ kind: 'liveResizeEnd', event: a, element: this.node, resizeDirection: this.resizeDirection }); else this.shapeNode && this.pointIndex >= 0 && b ? (this.shapeNode.setPoint(this.pointIndex, b), this.network.fireInteractionEvent({ kind: 'liveMovePointEnd', event: a, element: this.shapeNode, pointIndex: this.pointIndex })) : this.shapeLink && this.pointIndex >= 0 && b ? (this.shapeLink.setPoint(this.pointIndex, b), this.network.fireInteractionEvent({ kind: 'liveMovePointEnd', event: a, element: this.shapeLink, pointIndex: this.pointIndex })) : this.linkUI && b && (this.linkUI.setControlPoint(b), this.network.fireInteractionEvent({ kind: 'liveMovePointEnd', event: a, element: this.linkUI._element })) } this._handle_mouseup(a), this.lazyMode || this.clear() }, handle_mousemove: function(a) { if (this.network.isValidEvent(a)) { if (this.isStartRotate && this.node) return this._handleRotateElement(a, this.node), void (this.network.isShowRotateScale() && this.repaint()); if (this.isStart) { if (this.shapeNode && this.pointIndex >= 0) return void this._handleMovingShapeNodePoint(a); if (this.shapeLink && this.pointIndex >= 0) return void this._handleMovingShapeLinkPoint(a); if (this.node && this.resizeDirection) return void this._handleResizing(a); if (this.linkUI) return void this._handleMovingLinkControlPoint(a) } if (this.network.isSelectingElement() || this.network.isMovingElement() || this.network.getSelectionModel().size() === 0) return void this.clear(); var b = this.network.getElementAt(a), c = this.network.getElementUI(b); if (!c || !c.getEditAttachment()) return void this.clear(); var d = this.network.getLogicalPoint(a); if (b instanceof Ib.Node) { if (this.node = b, this._isEditingShapeNode(d) || this._isResizingNode(d)) return void this.network.setEditingElement(!0); if (this._isRotatingElement(d)) return this.network.setRotatingElement(!0), void this.network.setEditingElement(!0) } else if (b instanceof Ib.ShapeLink) { if (this.shapeLink = b, this._isEditingShapeLink(d)) return void this.network.setEditingElement(!0) } else if (c instanceof Ib.canvas.LinkUI) { var e = this.network.getEditPointSize(); if (xc.isOrthogonalLink(c._element)) { this.linkUI = c; var f = this.linkUI.getControlPoint(); return void (f && this._contains(d, f, e) && (this._setCrossCursor(), this.network.setEditingElement(!0))) } } this.clear() } }, _isRotatingElement: function(a) { var b = this.network.getRotatePointSize(); if (b <= 0) return !1; var c = this.node.getOriginalRect(), d = this.node.getAngle(); return this._isRotating(a, 'crosshair', c, d) }, _isRotating: function(a, b, c, d) { var e = this.network.getRotatePointSize(), f = { x: c.x + c.width / 2, y: c.y - this.network.getRotatePointOffset() - e }, g = this._rotatePoint(f, d, c), h = { x: g.x - e, y: g.y - e, width: 2 * e, height: 2 * e }; return Tb.containsPoint(h, a) ? (this._removeCursor(), this._setCursor(b), !0) : !1 }, _handleRotateElement: function(a, b) { this._handle_mousemove(a); var c = this._calculateAngle(this.network.getLogicalPoint(a), b); b.setAngle(c) }, _calculateAngle: function(a, b) { var c = b.getCenterLocation(); return Math.round(180 * Math.atan2(c.x - a.x, a.y - c.y) / Math.PI + 180) }, _handleMovingShapeNodePoint: function(a) { var b = this.network.getLogicalPoint(a); this.shapeNode.setPoint(this.pointIndex, b), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.shapeNode, pointIndex: this.pointIndex }) }, _handleMovingShapeLinkPoint: function(a) { var b = this.network.getLogicalPoint(a); this.shapeLink.setPoint(this.pointIndex, b), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.shapeLink, pointIndex: this.pointIndex }) }, _handleMovingLinkControlPoint: function(a) { this.linkUI.setControlPoint(this.network.getLogicalPoint(a)), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.linkUI._element }) }, _handleResizing: function(a) { this._handle_mousemove(a); var b = this.node.getAngle(), c = this.node.getLocation(), d = this.node.getWidth() / 2, e = this.node.getHeight() / 2, f = { x: c.x + d, y: c.y + e }, g = { x: -d, y: -e }, h = { x: -d, y: e }, i = { x: d, y: e }, j = { x: d, y: -e }, k = { x: 0, y: -e }, l = { x: d, y: 0 }, m = { x: 0, y: e }, n = { x: -d, y: 0 }; if (this.resizeDirection === 'northwest' && (this._transformPoint(i, f, b), g.x = this._endLogical.x, g.y = this._endLogical.y, f.x = (g.x + i.x) / 2, f.y = (g.y + i.y) / 2, this._reversPoint(g, f, b), this._reversPoint(i, f, b), this.resizingRect = { x: g.x, y: g.y, width: i.x - g.x, height: i.y - g.y }), this.resizeDirection === 'north') { var o = { x: this._endLogical.x, y: this._endLogical.y }; this._reversPoint(o, f, b), k.y = o.y - f.y, this._transformPoint(k, f, b), this._transformPoint(m, f, b), f.x = (k.x + m.x) / 2, f.y = (k.y + m.y) / 2, this._reversPoint(k, f, b), this._reversPoint(m, f, b), this.resizingRect = { x: f.x - this.node.getWidth() / 2, y: f.y - (m.y - k.y) / 2, width: this.node.getWidth(), height: m.y - k.y } } if (this.resizeDirection === 'northeast' && (this._transformPoint(h, f, b), j.x = this._endLogical.x, j.y = this._endLogical.y, f.x = (h.x + j.x) / 2, f.y = (h.y + j.y) / 2, this._reversPoint(h, f, b), this._reversPoint(j, f, b), this.resizingRect = { x: h.x, y: j.y, width: j.x - h.x, height: h.y - j.y }), this.resizeDirection === 'west') { var o = { x: this._endLogical.x, y: this._endLogical.y }; this._reversPoint(o, f, b), n.x = o.x - f.x, this._transformPoint(l, f, b), this._transformPoint(n, f, b), f.x = (l.x + n.x) / 2, f.y = (l.y + n.y) / 2, this._reversPoint(l, f, b), this._reversPoint(n, f, b), this.resizingRect = { x: f.x - (l.x - n.x) / 2, y: f.y - this.node.getHeight() / 2, width: l.x - n.x, height: this.node.getHeight() } } if (this.resizeDirection === 'east') { var o = { x: this._endLogical.x, y: this._endLogical.y }; this._reversPoint(o, f, b), l.x = o.x - f.x, this._transformPoint(l, f, b), this._transformPoint(n, f, b), f.x = (l.x + n.x) / 2, f.y = (l.y + n.y) / 2, this._reversPoint(l, f, b), this._reversPoint(n, f, b), this.resizingRect = { x: f.x - (l.x - n.x) / 2, y: f.y - this.node.getHeight() / 2, width: l.x - n.x, height: this.node.getHeight() } } if (this.resizeDirection === 'southwest' && (this._transformPoint(j, f, b), h.x = this._endLogical.x, h.y = this._endLogical.y, f.x = (h.x + j.x) / 2, f.y = (h.y + j.y) / 2, this._reversPoint(h, f, b), this._reversPoint(j, f, b), this.resizingRect = { x: h.x, y: j.y, width: j.x - h.x, height: h.y - j.y }), this.resizeDirection === 'south') { var o = { x: this._endLogical.x, y: this._endLogical.y }; this._reversPoint(o, f, b), m.y = o.y - f.y, this._transformPoint(k, f, b), this._transformPoint(m, f, b), f.x = (k.x + m.x) / 2, f.y = (k.y + m.y) / 2, this._reversPoint(k, f, b), this._reversPoint(m, f, b), this.resizingRect = { x: f.x - this.node.getWidth() / 2, y: f.y - (m.y - k.y) / 2, width: this.node.getWidth(), height: m.y - k.y } } this.resizeDirection === 'southeast' && (this._transformPoint(g, f, b), i.x = this._endLogical.x, i.y = this._endLogical.y, f.x = (g.x + i.x) / 2, f.y = (g.y + i.y) / 2, this._reversPoint(g, f, b), this._reversPoint(i, f, b), this.resizingRect = { x: g.x, y: g.y, width: i.x - g.x, height: i.y - g.y }), this.lazyMode ? (this.repaint(), this.network.fireInteractionEvent({ kind: 'lazyResizeBetween', event: a, element: this.node, resizeDirection: this.resizeDirection })) : (this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.network.fireInteractionEvent({ kind: 'liveResizeBetween', event: a, element: this.node, resizeDirection: this.resizeDirection })) }, _isEditingShapeNode: function(a) { var b = this.network.getEditPointSize(); if (this.node instanceof Ib.ShapeNode) { this.shapeNode = this.node; for (var c = this.shapeNode.getPoints(), d = 0, e = c.size(); e > d; d++) { var f = c.get(d); if (this._contains(a, f, b)) return this._setCrossCursor(), this.pointIndex = d, !0 } } return this.pointIndex = -1, !1 }, _isEditingShapeLink: function(a) { for (var b = this.network.getEditPointSize(), c = this.shapeLink.getPoints(), d = 0, e = c.size(); e > d; d++) { var f = c.get(d); if (this._contains(a, f, b)) return this._setCrossCursor(), this.pointIndex = d, !0 } return this.pointIndex = -1, !1 }, _isResizingNode: function(a) { var b = this.network.getResizePointSize(); if (b <= 0) return !1; var c = this.node.getOriginalRect(), d = this.node.getAngle(), e = { x: c.x, y: c.y }, f = this._rotatePoint(e, d, c); return this._isResizing(a, f.x, f.y, 'northwest', 'nwse-resize') ? !0 : (e = { x: c.x + c.width / 2, y: c.y }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'north', 'ns-resize') ? !0 : (e = { x: c.x + c.width, y: c.y }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'northeast', 'nesw-resize') ? !0 : (e = { x: c.x, y: c.y + c.height / 2 }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'west', 'ew-resize') ? !0 : (e = { x: c.x + c.width, y: c.y + c.height / 2 }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'east', 'ew-resize') ? !0 : (e = { x: c.x, y: c.y + c.height }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'southwest', 'nesw-resize') ? !0 : (e = { x: c.x + c.width / 2, y: c.y + c.height }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'south', 'ns-resize') ? !0 : (e = { x: c.x + c.width, y: c.y + c.height }, f = this._rotatePoint(e, d, c), this._isResizing(a, f.x, f.y, 'southeast', 'nwse-resize') ? !0 : !1))))))) }, _rotatePoint: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x + c.width / 2, c.y + c.height / 2), e = d.transform(a); return e }, _isResizing: function(a, b, c, d, e) { var f = this.network.getResizePointSize(); return this._contains(a, { x: b, y: c }, f) ? (this.resizeDirection !== d && (this._removeCursor(), e = this._changeCursorWithAngle(d, this.node.getAngle()), this._setCursor(e), this.resizeDirection = d), !0) : !1 }, _getRect: function(a, b, c, d) { var e = c > a ? a : c, f = d > b ? b : d, g = Math.abs(a - c), h = Math.abs(b - d); return { x: e, y: f, width: g, height: h } }, _contains: function(a, b, c) { var d = { x: b.x - c, y: b.y - c, width: 2 * c, height: 2 * c }; return Tb.containsPoint(d, a) }, getPointIndex: function(a, b, c) { if (a.size() < 2) return 0; for (var d, e = a.get(0), f = 1; f < a.size(); f++) { if (d = a.get(f), this.isPointOnLine(b, e, d, 6)) return f; e = d } return e = a.get(0), c && this.isPointOnLine(b, e, d, 6) ? a.size() : 0 }, showRotateScale: function(a) { var b, c, d, e, f, g = (new Ib.List(), this.network.getRotateScaleWidth()), h = this.network.getRotateScaleHeight(), i = this.network.getRotatePointSize(), j = this.node.getAngle(), k = this.node.getOriginalRect(), l = { x: k.x + k.width / 2, y: k.y - this.network.getRotatePointOffset() - i }, m = this._rotatePoint(l, j, k), n = '13px Arial', o = j + '°'; this.node.getAngle() >= 0 && this.node.getAngle() <= 180 ? (c = { x: m.x + i, y: m.y }, d = { x: c.x + g, y: c.y }, e = { x: d.x, y: d.y - h }, f = { x: c.x, y: e.y }) : this.node.getAngle() > 180 && this.node.getAngle() <= 360 && (c = { x: m.x - i, y: m.y }, d = { x: c.x - g, y: c.y }, e = { x: d.x, y: d.y - h }, f = { x: c.x, y: e.y }); var p = new Ib.List([c, d, e, f]), b = Jb.math.getRect(p); a.fillStyle = this.network.getRotateScaleFillColor(), a.fillRect(b.x, b.y, b.width, b.height), a.fillStyle = this.network.getRotateScaleFontColor(), a.textBaseline = 'middle', a.textAlign = 'center', a.font = n, a.fillText(o, b.x + b.width / 2, b.y + b.height / 2) }, isPointOnLine: function(a, b, c, d) { d < 0 && (d = 0); var e = this.getDistanceFromPointToLine(a, b, c); return d >= e && a.x >= Math.min(b.x, c.x) - d && a.x <= Math.max(b.x, c.x) + d && a.y >= Math.min(b.y, c.y) - d && a.y <= Math.max(b.y, c.y) + d }, getDistanceFromPointToLine: function(a, b, c) { if (b.x === c.x) return Math.abs(a.x - b.x); var d = (c.y - b.y) / (c.x - b.x), e = (c.x * b.y - b.x * c.y) / (c.x - b.x); return Math.abs(d * a.x - a.y + e) / Math.sqrt(d * d + 1) }, _transformPoint: function(a, b, c) { var d = Math.cos(c * Math.PI / 180), e = Math.sin(c * Math.PI / 180), f = a.x, g = a.y, h = f * d - g * e, i = f * e + g * d; a.x = h + b.x, a.y = i + b.y }, _reversPoint: function(a, b, c) { c *= -1; var d = Math.cos(c * Math.PI / 180), e = Math.sin(c * Math.PI / 180), f = a.x - b.x, g = a.y - b.y, h = f * d - g * e, i = f * e + g * d; a.x = h + b.x, a.y = i + b.y }, _changeCursorWithAngle: function(a, b) { var c, d = ['auto', 'nwse-resize', 'ns-resize', 'nesw-resize', 'ew-resize', 'nwse-resize', 'ns-resize', 'nesw-resize', 'ew-resize']; switch (a) { case 'northwest':c = 1; break; case 'north':c = 2; break; case 'northeast':c = 3; break; case 'east':c = 4; break; case 'southeast':c = 5; break; case 'south':c = 6; break; case 'southwest':c = 7; break; case 'west':c = 8; break; default:c = 0 } return (b >= 360 || b <= -360) && (b %= 360), b > 22.5 && b <= 67.5 && (c += 1), b < -22.5 && b >= -67.5 && (c -= 1), b > 67.5 && b <= 112.5 && (c += 2), b < -67.5 && b >= -112.5 && (c -= 2), b > 112.5 && b <= 157.5 && (c += 3), b < -112.5 && b >= -157.5 && (c -= 3), b > 157.5 && b <= 202.5 && (c += 4), b < -157.5 && b >= -202.5 && (c -= 4), b > 202.5 && b <= 247.5 && (c += 5), b < -202.5 && b >= -247.5 && (c -= 5), b > 247.5 && b <= 292.5 && (c += 6), b < -247.5 && b >= -292.5 && (c -= 6), b > 292.5 && b <= 337.5 && (c += 7), b < -292.5 && b >= -337.5 && (c -= 7), c > 8 && (c -= 8), c <= 0 && (c += 8), d[c] } }), Ib.canvas.interaction.CreateLinkInteraction = function(a, b) { b || (b = Ib.Link), this.linkFunction = Ib.Util.isTypeOf(b, Ib.Link) ? function(a, c) { var d = new b(); return d instanceof Ib.Link && (d.setFromNode(a), d.setToNode(c)), d } : b, Ib.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.canvas.interaction.CreateLinkInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove'), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mousemove'), this.clear(), this.network.removeMarker(this) }, paint: function(a) { a.beginPath(); var b, c; a.lineWidth = this.network.getEditLineWidth(); var d = this.network.getEditLineColor(); this.currentNode && this.currentNode !== this.fromNode && (b = this.network.getElementUI(this.currentNode).getViewRect(), c = this.convertFromUIToMarkerRect(b, 0, 0), Od.rect(a, c.x, c.y, c.width, c.height, null, d)), this.fromNode && (b = this.network.getElementUI(this.fromNode).getViewRect(), c = this.convertFromUIToMarkerRect(b, 0, 0), Od.rect(a, c.x, c.y, c.width, c.height, null, d)), this.currentPoint && this.paintLine(a), a.closePath() }, paintLine: function(a) { var b = this.network.getEditLineColor(), c = this.convertPointFromView(this.fromNode.getCenterLocation()), d = c.x, e = c.y, f = this.currentPoint.x, g = this.currentPoint.y; a.strokeStyle = b, a.beginPath(), a.moveTo(d, e), a.lineTo(f, g), a.stroke() }, clear: function() { this.currentPoint = null, this.currentNode = null, this.fromNode = null, this.toNode = null }, createLink: function() { return this.linkFunction(this.fromNode, this.toNode) }, handle_mousedown: function(a) { if (this.network.isValidEvent(a)) if (this.fromNode) { if (this.toNode = this.currentNode, this.toNode) { var b = this.createLink(); b && this.network.addElementByInteraction(b) } this.clear() } else this.fromNode = this.currentNode, this.currentNode = null, this.currentPoint = null, this.repaint() }, handle_mousemove: function(a) { var b = this.getMarkerPoint(a); if (b) { if (this.network.isMovingElement() || this.network.isEditingElement()) return void this.clear(); var c = null; this.fromNode ? (this.currentNode = this.getToNode(a), this.currentPoint = b, this.repaint()) : (c = this.getFromNode(a), this.currentNode !== c && (this.currentNode = c, this.repaint())) } }, getFromNode: function(a) { return this.getNode(a) }, getToNode: function(a) { return this.getNode(a) }, getNode: function(a) { var b = this.network.getElementAt(a); return b instanceof Ld && this.network.isLinkable(b) && this.network.getElementBox().getSelectionModel().isSelectable(b) ? b : null } }), Ib.canvas.interaction.CreateShapeLinkInteraction = function(a, b) { Ib.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this, a), b || (b = Ib.ShapeLink), this.linkFunction = Ib.Util.isTypeOf(b, Ib.ShapeLink) ? function(a, c, d) { var e = new b(); return e instanceof Ib.ShapeLink && (e.setFromNode(a), e.setToNode(c), d && e.setPoints(d)), e } : b }, Jb.ext('twaver.canvas.interaction.CreateShapeLinkInteraction', Ib.canvas.interaction.CreateLinkInteraction, { clear: function() { this.points = null, Ib.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this) }, createLink: function() { return this.linkFunction(this.fromNode, this.toNode, this.points) }, handle_mousedown: function(a) { if (a.button === 0) { var b = this.network.getLogicalPoint(a); if (b) { if (this.fromNode) if (this.toNode = this.currentNode, this.toNode) { var c = this.createLink(); c && this.network.addElementByInteraction(c), this.clear() } else { if (this.points || (this.points = new Ib.List()), this.points.size() > 0) { var d = this.points.get(this.points.size() - 1); if (d.x === b.x && d.y === b.y) return } this.points.add(b) } else this.fromNode = this.currentNode, this.points = null, this.currentNode = null, this.currentPoint = null; this.repaint() } } }, paintLine: function(a) { if (this.currentPoint) { var b, c = new Ib.List(); if (b = this.convertPointFromView(this.fromNode.getCenterLocation()), c.add(b, 0), this.points && this.points.size() > 0) for (var d = this.points.size(), e = 0; d > e; e++)b = this.convertPointFromView(this.points.get(e)), c.add(b); b = this.currentPoint, c.add(b), a.lineWidth = this.network.getEditLineWidth(), a.strokeStyle = this.network.getEditLineColor(), a.beginPath(), Xb.drawLinePoints(a, c), a.stroke() } } }), Ib.canvas.interaction.CreateShapeNodeInteraction = function(a, b) { b || (b = Ib.ShapeNode), this.shapeNodeFunction = Ib.Util.isTypeOf(b, Ib.ShapeNode) ? function(a) { var c = new b(); return c instanceof Ib.ShapeNode && a && c.setPoints(a), c } : b, Ib.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this, a), this.timeStamp = -1 }, Jb.ext('twaver.canvas.interaction.CreateShapeNodeInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove'), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mousemove'), this.clear(), this.network.removeMarker(this), this.network.setEditingElement(!1) }, clear: function() { this.points = null, this.currentPoint = null }, paint: function(a) { if (this.points && this.points.size() > 0 && this.currentPoint) { for (var b, c = new Ib.List(), d = this.points.size(), e = 0; d > e; e++)b = this.convertPointFromView(this.points.get(e)), c.add(b); b = this.convertPointFromView(this.currentPoint), c.add(b), a.lineWidth = this.network.getEditLineWidth(), a.strokeStyle = this.network.getEditLineColor(), a.beginPath(), Xb.drawLinePoints(a, c), a.stroke() } }, handle_mousedown: function(a) { if (a.button === 0) { var b = this.network.getLogicalPoint(a); if (b) { if (a.detail === 2 || a.timeStamp - this.timeStamp < 300) { if (this.points) { var c = this.shapeNodeFunction(this.points); this.network.addElementByInteraction(c), this.clear(); var d = this; setTimeout(function() { d.network.setEditingElement(!1) }, 0) } } else { if (this.network.isEditingElement() || this.network.setEditingElement(!0), this.points || (this.points = new Ib.List()), this.points.size() > 0) { var e = this.points.get(this.points.size() - 1); if (e.x === b.x && e.y === b.y) return } this.points.add(b) } this.timeStamp = a.timeStamp, this.repaint() } } }, handle_mousemove: function(a) { this.points && (this.currentPoint = this.network.getLogicalPoint(a), this.repaint()) } }), Ib.canvas.interaction.MagnifyInteraction = function(a, b, c, d, e) { Ib.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this, a), this.zoom = b || 2, this.xRadius = c || 100, this.yRadius = d || 100, this.shape = e || 'circle', this.borderColor = 'black', this.borderWidth = 1, this.backgroundColor = 'white', this.markCanvas = Wb.createCanvas() }, Jb.ext('twaver.canvas.interaction.MagnifyInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { this.addListener('mousemove'), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousemove'), this.network.removeMarker(this) }, paint: function(a) { if (this.point) { var b = this.network._zoom, c = this.zoom * b, d = this.point.x * b - this.network.viewRect.x - this.xRadius, e = this.point.y * b - this.network.viewRect.y - this.yRadius, f = 2 * this.xRadius, g = 2 * this.yRadius, h = { x: this.point.x - this.xRadius / c, y: this.point.y - this.yRadius / c, width: f / c, height: g / c }, i = this.borderWidth, j = Wb.createCanvas(); j.width = f, j.height = g, this.network.toCanvasByRegion(h, c, j), a.save(), a.beginPath(), Xb.drawVector(a, this.shape, null, d, e, f, g), a.clip(), a.fillStyle = this.backgroundColor, a.beginPath(), a.rect(d, e, f, g), a.fill(), a.drawImage(j, d, e), a.restore(), a.beginPath(), a.lineWidth = i, Xb.drawVector(a, this.shape, null, d + i / 2, e + i / 2, f - i, g - i), a.strokeStyle = this.borderColor, a.stroke() } }, handle_mousemove: function(a) { this.point = this.network.getLogicalPoint(a), this.point && this.repaint() }, getZoom: function() { return this.zoom }, setZoom: function(a) { this.zoom = a, this.network.repaintTopCanvas() }, getShape: function() { return this.shape }, setShape: function(a) { this.shape = a, this.network.repaintTopCanvas() }, getXRadius: function() { return this.xRadius }, setXRadius: function(a) { this.xRadius = a, this.network.repaintTopCanvas() }, getYRadius: function() { return this.yRadius }, setYRadius: function(a) { this.yRadius = a, this.network.repaintTopCanvas() }, getBorderColor: function() { return this.borderColor }, setBorderColor: function(a) { this.borderColor = a, this.network.repaintTopCanvas() }, getBorderWidth: function() { return this.borderWidth }, setBorderWidth: function(a) { this.borderWidth = a, this.network.repaintTopCanvas() }, getBackgroundColor: function() { return this.backgroundColor }, setBackgroundColor: function(a) { this.backgroundColor = a, this.network.repaintTopCanvas() } }), Ib.canvas.interaction.TouchInteraction = function(a) { Ib.canvas.interaction.TouchInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.canvas.interaction.TouchInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { var a = this.network.getView(); Wb.addEventListener('touchstart', 'handleTouchstart', a, this), Wb.addEventListener('touchmove', 'handleTouchmove', a, this), Wb.addEventListener('touchend', 'handleTouchend', a, this), Wb.addEventListener('touchcancel', 'handleTouchend', a, this), this.network.addMarker(this) }, tearDown: function() { var a = this.network.getView(); Wb.removeEventListener('touchstart', this.network.getView(), this), Wb.removeEventListener('touchmove', a, this), Wb.removeEventListener('touchend', a, this), Wb.removeEventListener('touchcancel', a, this), this.network.removeMarker(this) }, handleTouchstart: function(a) { if (Wb.preventDefault(a), a.touches && a.touches.length == 1) { var b = this.network.getLogicalPoint(a), c = this.network.getElementAt(b); this._startTouchTime = new Date(), this._startTouchPoint = b, this._startTouchClient = this.getMarkerPoint(a), c ? (this._haveElementUnderTouch = !0, this._startTouchElement = c) : (this._haveElementUnderTouch = !1, this._startTouchElement = null), this.timer = setTimeout(function() { Cc.handleLongClicked(self.network, a, c) }, 1e3) } else a.touches && a.touches.length == 2 && (this._distance = zc.getDistance(a), this._zoom = this.network.getZoom()); this._touchCount = a.touches.length }, handleTouchmove: function(a) { if (Wb.preventDefault(a), this._touchCount == 2 && a.touches && a.touches.length == 2) if (this.timer && clearTimeout(this.timer), Math.abs(this._distance - zc.getDistance(a)) >= Ed.TOUCH_ZOOM_THRESHOLD || this._zoomFlag) { this._zoomFlag = !0; var b = zc.getDistance(a) / this._distance; this.network.setTouchZoom(this._zoom * b, !1) } else { var c = this.getMarkerPoint(a), d = this._startTouchClient.x - c.x, e = this._startTouchClient.y - c.y; this.network.panByOffset(d, e), this._startTouchClient = c } else if (this._touchCount == 1 && a.touches && a.touches.length == 1) if (this._haveElementUnderTouch || !this.network.isRectSelectEnabled()) { var f = this.network.getLogicalPoint(a), g = this.network.getElementAt(f); if (this.network.isMovingElement() || this._startTouchElement != null && this._startTouchElement == g && this.network.getMovableSelectedElements().contains(g)) { var d = f.x - this._startTouchPoint.x, e = f.y - this._startTouchPoint.y; (Math.abs(d) >= Ed.TOUCH_MOVE_THRESHOLD || Math.abs(e) >= Ed.TOUCH_MOVE_THRESHOLD) && (this._startTouchPoint = f, this.network.moveSelectedElements(d, e), this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a }), this.timer && clearTimeout(this.timer))) } else { var d = f.x - this._startTouchPoint.x, e = f.y - this._startTouchPoint.y; (Math.abs(d) >= Ed.TOUCH_MOVE_THRESHOLD || Math.abs(e) >= Ed.TOUCH_MOVE_THRESHOLD) && this.timer && clearTimeout(this.timer); var c = this.getMarkerPoint(a), d = this._startTouchClient.x - c.x, e = this._startTouchClient.y - c.y; this.network.panByOffset(d, e), this._startTouchClient = c } } else { var h = this.network.getLogicalPoint(a); if (!h) return; var d = h.x - this._startTouchPoint.x, e = h.y - this._startTouchPoint.y; Math.abs(d) >= Ed.TOUCH_RECT_SELECT_THRESHOLD && Math.abs(e) >= Ed.TOUCH_RECT_SELECT_THRESHOLD && (this.network.setSelectingElement(!0), this._moveTouchPoint ? this.network.fireInteractionEvent({ kind: 'selectBetween', event: a }) : (this.network.fireInteractionEvent({ kind: 'selectStart', event: a }), this.timer && clearTimeout(this.timer)), this._moveTouchPoint = h, this.repaint()) } }, handleTouchend: function(a) { if (Wb.preventDefault(a), this.network.isMovingElement()) this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: a }); else if (this.network.isSelectingElement()) { var b = Tb.getRect([this._startTouchPoint, this._moveTouchPoint]), c = this.network.getElementsAtRect(b, this.getIntersectMode(), this.network.getRectSelectFilter()); if (c && c.size() > 0) { var d = this.network.getSelectionModel(), e = d.toSelection(); c.forEach(function(a) { d.contains(a) ? e.remove(a) : e.add(a) }, this), d.setSelection(e) } this.network.fireInteractionEvent({ kind: 'selectEnd', event: a }), this._moveTouchPoint = null, this.network.setSelectingElement(!1), this.repaint() } else if (this._startTouchPoint) { this._zoomFlag = !1; var f = new Date(), g = this.network.getLogicalPoint(a), h = this.network.getElementAt(this._startTouchPoint); g && f.getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, g) <= 20 && (h ? this.network.getSelectionModel().contains(h) || this.network.getSelectionModel().setSelection(h) : this.network.getSelectionModel().clearSelection(), Cc.handleClicked(this.network, a, h), this.timer && clearTimeout(this.timer), this._endTouchTime && f.getTime() - this._endTouchTime.getTime() <= 500 && Tb.getDistance(this._endTouchPoint, g) <= 20 ? (delete this._endTouchTime, delete this._endTouchPoint, Cc.handleDoubleClicked(this.network, a, h)) : (this._endTouchTime = f, this._endTouchPoint = g)) } }, paint: function(a) {
    if (this._startTouchPoint && this._moveTouchPoint) {
      var b = this.convertPointFromView(this._startTouchPoint), c = this.convertPointFromView(this._moveTouchPoint), d = b.x, e = b.y, f = c.x, g = c.y, h = Tb.getRect([{ x: d, y: e }, { x: f, y: g }]); if (h != null) {
        a.beginPath(); var i = this.network.getSelectOutlineWidth(), j = this.getIntersectMode() ? this.network.getSelectFillColor() : null; a.strokeStyle = this.network.getSelectOutlineColor(),
        a.lineWidth = i, Od.rect(a, h.x, h.y, h.width, h.height, j, this.network.getSelectOutlineColor()), a.closePath()
      }
    }
  }, getIntersectMode: function() { return this.network.getSelectMode() === 'intersect' ? !0 : this.network.getSelectMode() === 'contain' ? !1 : this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y } }), Ib.canvas.interaction.MSTouchInteraction = function(a) { Ib.canvas.interaction.MSTouchInteraction.superClass.constructor.call(this, a), this._pointerMap = {}, this._pointerIdArray = [] }, Jb.ext('twaver.canvas.interaction.MSTouchInteraction', Ib.canvas.interaction.BaseInteraction, { setUp: function() { var a = this.network.getView(); Wb.addEventListener('MSPointerDown', 'handleTouchstart', a, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', a, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', a, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', a, this), this.network.addMarker(this) }, tearDown: function() { var a = this.network.getView(); Wb.removeEventListener('MSPointerDown', a, this), Wb.removeEventListener('MSPointerMove', a, this), Wb.removeEventListener('MSPointerUp', a, this), Wb.removeEventListener('MSPointerCancel', a, this), this.network.removeMarker(this) }, handleTouchstart: function(a) { if (this.network.isFocusOnClick() && Ib.Util.setFocus(this.network._view), !this.network.isSelectingElement() || a.pointerType != a.MSPOINTER_TYPE_MOUSE) { var b = this.network.getLogicalPoint(a), c = new Date(); if (a.isPrimary && this._pointerIdArray.length > 0 && this.handle_mouseup(a), this._pointerMap[a.pointerId] || (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a), this._pointerIdArray.length == 1) { var d = this.network.getElementAt(b); this._startTouchElement = d, this._startClientPoint = { x: a.clientX, y: a.clientY }, Cc.handleClicked(this.network, a, d), this._startTouchTime && this._startTouchPoint && c.getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, b) <= 20 ? (Cc.handleDoubleClicked(this.network, a, d), this._doubleClick = !0) : (Wb.handle_mousedown(this, a), this._startTouchPoint = b, this._startTouchTime = c); var e = this.network.getSelectionModel(); d ? Jb.isCtrlDown(a) ? e.contains(d) ? e.removeSelection(d) : e.appendSelection(d) : e.contains(d) || e.setSelection(d) : Jb.isCtrlDown(a) || e.clearSelection() } else this._pointerIdArray.length == 2 && (this._distance = this._getDistance(), this._zoom = this.network.getZoom()) } }, handleTouchmove: function(a) { if (this._startTouchPoint != null && this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 10) && (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2)) { var b = this._getDistance() / this._distance; this.network.setZoom(this._zoom * b, !1) } }, handleTouchend: function(a) { if (this.network.isMovingElement() && (this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: a })), this.network.isSelectingElement()) { var b = Tb.getRect([this._startTouchPoint, this._moveTouchPoint]), c = this.network.getElementsAtRect(b, this.getIntersectMode(), this.network.getRectSelectFilter()); if (c && c.size() > 0) { var d = this.network.getSelectionModel(), e = d.toSelection(); c.forEach(function(a) { d.contains(a) ? e.remove(a) : e.add(a) }, this), d.setSelection(e) } this.network.fireInteractionEvent({ kind: 'selectEnd', event: a }), this._moveTouchPoint = null, this.network.setSelectingElement(!1), this.repaint() } this._doubleClick && (delete this._doubleClick, delete this._startTouchPoint, delete this._startTouchTime); for (var f = -1, g = 0; g < this._pointerIdArray.length; g++) if (this._pointerIdArray[g] == a.pointerId) { f = g; break }f >= 0 && this._pointerIdArray.splice(f, 1), delete this._pointerMap[a.pointerId], this._startTouchPoint = null, this._moveTouchPoint = null }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) }, getIntersectMode: function() { return this.network.getSelectMode() === 'intersect' ? !0 : this.network.getSelectMode() === 'contain' ? !1 : this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y }, handle_mousemove: function(a) { var b = { x: a.clientX, y: a.clientY }; if (!(Tb.getDistance(this._startClientPoint, b) < 3) && this._startTouchPoint && this._pointerIdArray.length == 1) if (this._moveTouchPoint = { x: this._startTouchPoint.x + (b.x - this._startClientPoint.x) / this.network.getZoom(), y: this._startTouchPoint.y + (b.y - this._startClientPoint.y) / this.network.getZoom() }, this._startTouchElement == null && this.network.isRectSelectEnabled()) { var c = this.network.getLogicalPoint(a); if (!c) return; this.network.setSelectingElement(!0), this.network.fireInteractionEvent(this._moveTouchPoint ? { kind: 'selectBetween', event: a } : { kind: 'selectStart', event: a }), this.repaint() } else { var d = this.network.getElementAt(this._moveTouchPoint); if (this._startTouchElement != null || this.network.isRectSelectEnabled()) { if (this.network.isMovingElement() || this._startTouchElement != null && d == this._startTouchElement && this.network.getMovableSelectedElements().contains(d)) { var e = this._moveTouchPoint.x - this._startTouchPoint.x, f = this._moveTouchPoint.y - this._startTouchPoint.y; this.network.moveSelectedElements(e, f), this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a })) } } else { var e = this._startClientPoint.x - b.x, f = this._startClientPoint.y - b.y; this.network.panByOffset(e, f) } this._startClientPoint = b } }, handle_mouseup: function(a) { this.handleTouchend(a), this._pointerIdArray = [], this._pointerMap = {} }, paint: function(a) { if (this._startTouchPoint && this._moveTouchPoint && !this._startTouchElement && this.network.isRectSelectEnabled()) { var b = this.convertPointFromView(this._startTouchPoint), c = this.convertPointFromView(this._moveTouchPoint), d = b.x, e = b.y, f = c.x, g = c.y, h = Tb.getRect([{ x: d, y: e }, { x: f, y: g }]); if (h != null) { a.beginPath(); var i = this.network.getSelectOutlineWidth(), j = this.getIntersectMode() ? this.network.getSelectFillColor() : null; a.strokeStyle = this.network.getSelectOutlineColor(), a.lineWidth = i, Od.rect(a, h.x, h.y, h.width, h.height, j, this.network.getSelectOutlineColor()), a.closePath() } } } }); var Pd = function(a, b) { Jb.registerImage(a, b), Qd[a] = 1 }, Qd = {}; Pd('node_image', { w: 32, h: 24, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z', gradient: { id: 'SVGID_1_', type: 'linear', x1: '15.9995', y1: '21', x2: '15.9995', y2: '24', stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z', gradient: { id: 'SVGID_2_', type: 'linear', x1: '9', y1: '22', x2: '9', y2: '25', stop: [{ offset: '0', color: '#69B4A5' }, { offset: '0.1', color: '#61AD9C' }] }}, { shape: 'path', data: 'M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z', gradient: { id: 'SVGID_3_', type: 'linear', x1: '15.9995', y1: '-0.1221', x2: '15.9995', y2: '19.9471', stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 2, y: 1, w: 28, h: 18, fill: '#FFFFFF' }, { shape: 'rect', x: 3, y: 2, w: 26, h: 16, gradient: { id: 'SVGID_4_', type: 'linear', x1: '15.9995', y1: '2.0654', x2: '15.9995', y2: '17.3835', stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#0089C1' }] }}, { shape: 'path', data: '9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z', fill: '#FFFFFF' }, { shape: 'path', data: '12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z', fill: '#FFFFFF' }, { shape: 'path', data: '14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z', fill: '#FFFFFF' }] }), Pd('group_image', { w: 32, h: 24, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z', gradient: { id: 'SVGID_1_', type: 'linear', x1: '19.5', y1: '15', x2: '19.5', y2: '17', stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z', gradient: { id: 'SVGID_2_', type: 'linear', x1: '14.4995', y1: '15.9209', x2: '14.4995', y2: '17.0459', stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z', gradient: { id: 'SVGID_3_', type: 'linear', x1: '19.5', y1: '0', x2: '19.5', y2: '14.0005', stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 9, y: 1, w: 21, h: 12, fill: '#FFFFFF' }, { shape: 'rect', x: 10, y: 2, w: 19, h: 10, gradient: { id: 'SVGID_4_', type: 'linear', x1: '19.5', y1: '1.9619', x2: '19.5', y2: '11.9744', stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z', gradient: { id: 'SVGID_5_', type: 'linear', x1: '12.4995', y1: '22', x2: '12.4995', y2: '24', stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z', gradient: { id: 'SVGID_6_', type: 'linear', x1: '7.5', y1: '22.9209', x2: '7.5', y2: '24.0459', stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z', gradient: { id: 'SVGID_7_', type: 'linear', x1: '12.4995', y1: '7', x2: '12.4995', y2: '21.0005', stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 2, y: 8, w: 21, h: 12, fill: '#FFFFFF' }, { shape: 'rect', x: 3, y: 9, w: 19, h: 10, gradient: { id: 'SVGID_8_', type: 'linear', x1: '12.4995', y1: '8.9619', x2: '12.4995', y2: '18.9749', stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#0089C1' }] }}] }), Pd('subnetwork_image', { w: 32, h: 24, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 21.5, y1: 12.999, x2: 21.5, y2: 14.9995, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z', gradient: { id: 'SVGID_2_', type: 'linear', x1: 18, y1: 13.9199, x2: 18, y2: 15.0449, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z', gradient: { id: 'SVGID_3_', type: 'linear', x1: 21.5, y1: -0.9502, x2: 21.5, y2: 12.5498, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 13, y: 0.999, w: 17, h: 10, fill: '#FFFFFF' }, { shape: 'rect', x: 14, y: 1.999, w: 15, h: 8, gradient: { id: 'SVGID_4_', type: 'linear', x1: 21.5, y1: 1.9312, x2: 21.5, y2: 9.6537, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z', gradient: { id: 'SVGID_5_', type: 'linear', x1: 10.4995, y1: 22, x2: 10.4995, y2: 24, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 22, y: 20.5, w: 3, h: 1.999, gradient: { id: 'SVGID_6_', type: 'linear', x1: -464.9424, y1: -722.2754, x2: -462.9424, y2: -722.2754, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'rect', x: 28, y: 16, w: 2, h: 3, gradient: { id: 'SVGID_7_', type: 'linear', x1: 29, y1: 16, x2: 29, y2: 19, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z', gradient: { id: 'SVGID_8_', type: 'linear', x1: 7, y1: 22.9209, x2: 7, y2: 24.0459, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z', gradient: { id: 'SVGID_9_', type: 'linear', x1: 10.4995, y1: 8.0508, x2: 10.4995, y2: 21.5513, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 2, y: 10, w: 17, h: 10, fill: '#FFFFFF' }, { shape: 'rect', x: 3, y: 11, w: 15, h: 8, gradient: { id: 'SVGID_10_', type: 'linear', x1: 10.4995, y1: 10.9321, x2: 10.4995, y2: 18.6551, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#0089C1' }] }}, { shape: 'path', data: 'M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z', gradient: { id: 'SVGID_11_', type: 'linear', x1: 29, y1: 20, x2: 29, y2: 23, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}] }), Pd('bus_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'rect', x: 4, y: 6, w: 1, h: 1, fill: '#232424' }, { shape: 'path', data: 'M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 4.5, y1: 2, x2: 4.5, y2: 5, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 3, y: 3, w: 3, h: 1, fill: '#232424' }, { shape: 'rect', x: 3, y: 3, w: 3, h: 1, fill: '#FFFFFF' }, { shape: 'path', data: 'M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z', gradient: { id: 'SVGID_2_', type: 'linear', x1: 4.5, y1: 6, x2: 4.5, y2: 5, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'rect', x: 12, y: 6, w: 1, h: 1, fill: '#232424' }, { shape: 'path', data: 'M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z', gradient: { id: 'SVGID_3_', type: 'linear', x1: 12.5, y1: 2, x2: 12.5, y2: 5, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 11, y: 3, w: 3, h: 1, fill: '#232424' }, { shape: 'rect', x: 11, y: 3, w: 3, h: 1, fill: '#FFFFFF' }, { shape: 'path', data: 'M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z', gradient: { id: 'SVGID_4_', type: 'linear', x1: 12.5, y1: 6, x2: 12.5, y2: 5, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'rect', x: 8, y: 10, w: 1, h: 1, fill: '#232424' }, { shape: 'path', data: 'M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z', gradient: { id: 'SVGID_5_', type: 'linear', x1: -1428.3853, y1: -571.5747, x2: -1428.3853, y2: -568.5747, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 7, y: 13, w: 3, h: 1, fill: '#232424' }, { shape: 'rect', x: 7, y: 13, w: 3, h: 1, fill: '#FFFFFF' }, { shape: 'path', data: 'M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z', gradient: { id: 'SVGID_6_', type: 'linear', x1: -1428.3862, y1: -567.5737, x2: -1428.3862, y2: -568.5737, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z', gradient: { id: 'SVGID_7_', type: 'linear', x1: 8.4995, y1: 6.1152, x2: 8.4995, y2: 7.5558, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z', gradient: { id: 'SVGID_8_', type: 'linear', x1: 8.4995, y1: 8.1147, x2: 8.4995, y2: 9.556, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}] }), Pd('data_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 10.5, y1: 6.959, x2: 10.5, y2: 12.2259, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 7, y: 8, w: 7, h: 4, fill: '#FFFFFF' }, { shape: 'rect', x: 8, y: 9, w: 5, h: 2, gradient: { id: 'SVGID_2_', type: 'linear', x1: 10.5, y1: 8.6997, x2: 10.5, y2: 11.0333, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z', gradient: { id: 'SVGID_3_', type: 'linear', x1: 10.5, y1: 13.125, x2: 10.5, y2: 14.5518, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 8, y: 14, w: 1, h: 1, gradient: { id: 'SVGID_4_', type: 'linear', x1: 8.4995, y1: 14.0049, x2: 8.4995, y2: 14.9471, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z', gradient: { id: 'SVGID_5_', type: 'linear', x1: 6.9995, y1: 2.0527, x2: 6.9995, y2: 11.4757, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z', gradient: { id: 'SVGID_6_', type: 'linear', x1: 6.9995, y1: 2.9902, x2: 6.9995, y2: 11.0032, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}] }), Pd('grid_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 8.4995, y1: 2.1255, x2: 8.4995, y2: 14.909, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 3, y: 3, w: 11, h: 11, fill: '#FFFFFF' }, { shape: 'rect', x: 3, y: 5, w: 11, h: 1, gradient: { id: 'SVGID_2_', type: 'linear', x1: 8.4995, y1: 3.209, x2: 8.4995, y2: 13.8043, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'rect', x: 3, y: 8, w: 11, h: 1, gradient: { id: 'SVGID_3_', type: 'linear', x1: 8.4995, y1: 3.209, x2: 8.4995, y2: 13.8043, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'rect', x: 3, y: 11, w: 11, h: 1, gradient: { id: 'SVGID_4_', type: 'linear', x1: 8.4995, y1: 3.2095, x2: 8.4995, y2: 13.8048, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'rect', x: 11, y: 3, w: 1, h: 11, gradient: { id: 'SVGID_5_', type: 'linear', x1: 11.5, y1: 3.209, x2: 11.5, y2: 13.8048, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'rect', x: 8, y: 3, w: 1, h: 11, gradient: { id: 'SVGID_6_', type: 'linear', x1: 8.4995, y1: 3.209, x2: 8.4995, y2: 13.8048, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'rect', x: 5, y: 3, w: 1, h: 11, gradient: { id: 'SVGID_7_', type: 'linear', x1: 5.5, y1: 3.209, x2: 5.5, y2: 13.8048, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}] }), Pd('databox_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 8.4995, y1: 6.0625, x2: 8.4995, y2: 14.063, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z', gradient: { id: 'SVGID_2_', type: 'linear', x1: 8.5005, y1: 3.104, x2: 8.5005, y2: -5.6467, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: '12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z', gradient: { id: 'SVGID_3_', type: 'linear', x1: 8.5005, y1: 9.2295, x2: 8.5005, y2: 5.4586, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z', fill: '#FFFFFF' }] }), Pd('group_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 9.5, y1: 0.9512, x2: 9.5, y2: 8.9787, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 5, y: 2, w: 9, h: 6, fill: '#FFFFFF' }, { shape: 'rect', x: 6, y: 3, w: 7, h: 4, gradient: { id: 'SVGID_2_', type: 'linear', x1: 9.5, y1: 3.02, x2: 9.5, y2: 6.9606, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z', gradient: { id: 'SVGID_3_', type: 'linear', x1: 9.5, y1: 9.9941, x2: 9.5, y2: 10.9976, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 6, y: 10.001, w: 2, h: 0.999, gradient: { id: 'SVGID_4_', type: 'linear', x1: 7, y1: 10.0059, x2: 7, y2: 10.9472, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z', gradient: { id: 'SVGID_5_', type: 'linear', x1: 6.4995, y1: 4.9512, x2: 6.4995, y2: 12.9792, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 2, y: 6, w: 9, h: 6, fill: '#FFFFFF' }, { shape: 'rect', x: 3, y: 7, w: 7, h: 4, gradient: { id: 'SVGID_6_', type: 'linear', x1: 6.4995, y1: 7.02, x2: 6.4995, y2: 10.9611, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z', gradient: { id: 'SVGID_7_', type: 'linear', x1: 6.4995, y1: 13.9941, x2: 6.4995, y2: 14.9976, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 3, y: 14.001, w: 2, h: 0.999, gradient: { id: 'SVGID_8_', type: 'linear', x1: 4, y1: 14.0059, x2: 4, y2: 14.9472, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}] }), Pd('link_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'line', p1: { x: 2.5, y: 2.5 }, p2: { x: 13.5, y: 13.5 }, lineColor: 'url(#SVGID_1_)', lineWidth: 1 }, { shape: 'ellipse', cx: 13, cy: 13, rx: 2, ry: 2, gradient: { id: 'SVGID_2_', type: 'linear', x1: 11.5371, y1: 11.5371, x2: 14.2155, y2: 14.2155, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 13, cy: 13, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 3, cy: 3, rx: 2, ry: 2, gradient: { id: 'SVGID_3_', type: 'linear', x1: 1.4956, y1: 1.4956, x2: 4.1473, y2: 4.1473, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 3, cy: 3, rx: 1, ry: 1, fill: '#FFFFFF' }] }), Pd('linksubnetwork_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 7.9995, y1: 1.959, x2: 7.9995, y2: 11.0921, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z', fill: '#FFFFFF' }, { shape: 'path', data: 'M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z', gradient: { id: 'SVGID_2_', type: 'linear', x1: 8.019, y1: 4.084, x2: 8.019, y2: 9.8062, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'line', p1: { x: 8.01, y: 8.01 }, p2: { x: 13.186, y: 13.186 }, lineColor: 'url(#SVGID_3_)', lineWidth: 1 }, { shape: 'ellipse', cx: 8, cy: 8, rx: 2, ry: 2, gradient: { id: 'SVGID_4_', type: 'linear', x1: 6.7881, y1: 6.7881, x2: 9.9924, y2: 9.9924, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'ellipse', cx: 8, cy: 8, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 13, cy: 13, rx: 2, ry: 2, gradient: { id: 'SVGID_5_', type: 'linear', x1: 11.5791, y1: 11.5791, x2: 14.3132, y2: 14.3132, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'ellipse', cx: 13, cy: 13, rx: 1, ry: 1, fill: '#FFFFFF' }] }), Pd('node_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 7.9995, y1: 1.939, x2: 7.9995, y2: 11.9739, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 2, y: 3, w: 12, h: 8, fill: '#FFFFFF' }, { shape: 'rect', x: 3, y: 4, w: 10, h: 6, gradient: { id: 'SVGID_2_', type: 'linear', x1: 7.9995, y1: 4.0513, x2: 7.9995, y2: 9.865, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z', gradient: { id: 'SVGID_3_', type: 'linear', x1: 7.9995, y1: 13.0508, x2: 7.9995, y2: 14.9258, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z', gradient: { id: 'SVGID_4_', type: 'linear', x1: 5.9995, y1: 14.0508, x2: 5.9995, y2: 15.9258, stop: [{ offset: '0', color: '#69B4A5' }, { offset: '0.1', color: '#61AD9C' }, { offset: '0.4637', color: '#449981' }, { offset: '0.7764', color: '#2C8E73' }, { offset: '1', color: '#218A6E' }] }}] }), Pd('shapelink_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'line', p1: { x: 7.5, y: 2.5 }, p2: { x: 2.5, y: 7.5 }, lineColor: 'url(#SVGID_1_)', lineWidth: 1 }, { shape: 'line', p1: { x: 2.5, y: 7.5 }, p2: { x: 8.5, y: 13.5 }, lineColor: 'url(#SVGID_2_)', lineWidth: 1 }, { shape: 'line', p1: { x: 9, y: 13.186 }, p2: { x: 13.5, y: 6.5 }, lineColor: 'url(#SVGID_3_)', lineWidth: 1 }, { shape: 'ellipse', cx: 7, cy: 3, rx: 2, ry: 2, gradient: { id: 'SVGID_4_', type: 'linear', x1: 5.5864, y1: 1.5864, x2: 8.4149, y2: 4.4149, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 7, cy: 3, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 2, cy: 8, rx: 2, ry: 2, gradient: { id: 'SVGID_5_', type: 'linear', x1: 0.5864, y1: 6.5864, x2: 3.4142, y2: 9.4142, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 2, cy: 8, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 8, cy: 13, rx: 2, ry: 2, gradient: { id: 'SVGID_6_', type: 'linear', x1: 6.5869, y1: 11.5869, x2: 9.4147, y2: 14.4147, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 8, cy: 13, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 13, cy: 7, rx: 2, ry: 2, gradient: { id: 'SVGID_7_', type: 'linear', x1: 11.5859, y1: 5.5859, x2: 14.4144, y2: 8.4144, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 13, cy: 7, rx: 1, ry: 1, fill: '#FFFFFF' }] }), Pd('shapenode_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 7.9995, y1: 3.209, x2: 7.9995, y2: 13.6621, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'ellipse', cx: 6, cy: 3, rx: 2, ry: 2, gradient: { id: 'SVGID_2_', type: 'linear', x1: 4.5859, y1: 1.5859, x2: 7.4151, y2: 4.4151, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 6, cy: 3, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 13, cy: 3, rx: 2, ry: 2, gradient: { id: 'SVGID_3_', type: 'linear', x1: 11.5869, y1: 1.5864, x2: 14.4153, y2: 4.4149, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 13, cy: 3, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 9, cy: 8, rx: 2, ry: 2, gradient: { id: 'SVGID_4_', type: 'linear', x1: 7.5864, y1: 6.5864, x2: 10.4149, y2: 9.4149, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 9, cy: 8, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 2, cy: 7, rx: 2, ry: 2, gradient: { id: 'SVGID_5_', type: 'linear', x1: 0.5859, y1: 5.5859, x2: 3.4144, y2: 8.4144, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 2, cy: 7, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 12.825, cy: 13, rx: 2, ry: 2, gradient: { id: 'SVGID_6_', type: 'linear', x1: 11.4111, y1: 11.5869, x2: 14.2396, y2: 14.4153, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'ellipse', cx: 12.825, cy: 13, rx: 1, ry: 1, fill: '#FFFFFF' }] }), Pd('shapesubnetwork_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'path', data: 'M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z', gradient: { id: 'SVGID_1_', type: 'linear', x1: 7.9995, y1: 1.3755, x2: 7.9995, y2: 9.733, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: 'M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z', fill: '#FFFFFF' }, { shape: 'path', data: 'M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z', gradient: { id: 'SVGID_2_', type: 'linear', x1: 7.9995, y1: 3.459, x2: 7.9995, y2: 8.4597, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z', gradient: { id: 'SVGID_3_', type: 'linear', x1: 7.4443, y1: 7.1724, x2: 10.1111, y2: 12.8383, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'path', data: '5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z', fill: '#FFFFFF' }, { shape: 'ellipse', cx: 5, cy: 8, rx: 2, ry: 2, gradient: { id: 'SVGID_4_', type: 'linear', x1: 3, y1: 8, x2: 7, y2: 8, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'ellipse', cx: 5, cy: 8, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 12, cy: 8, rx: 2, ry: 2, gradient: { id: 'SVGID_5_', type: 'linear', x1: 10, y1: 8, x2: 14, y2: 8, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'ellipse', cx: 12, cy: 8, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 7, cy: 12, rx: 2, ry: 2, gradient: { id: 'SVGID_6_', type: 'linear', x1: 5, y1: 12, x2: 9, y2: 12, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'ellipse', cx: 7, cy: 12, rx: 1, ry: 1, fill: '#FFFFFF' }, { shape: 'ellipse', cx: 14, cy: 12, rx: 2, ry: 2, gradient: { id: 'SVGID_7_', type: 'linear', x1: 12, y1: 12, x2: 16, y2: 12, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'ellipse', cx: 14, cy: 12, rx: 1, ry: 1, fill: '#FFFFFF' }] }), Pd('subnetwork_icon', { w: 16, h: 16, origin: { x: 0, y: 0 }, v: [{ shape: 'rect', x: 10, y: 14.001, w: 2, h: 1, gradient: { id: 'SVGID_1_', type: 'linear', x1: 11, y1: 14.0059, x2: 11, y2: 14.9481, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'rect', x: 14, y: 10.001, w: 1, h: 2, gradient: { id: 'SVGID_2_', type: 'linear', x1: 14.5, y1: 10.0117, x2: 14.5, y2: 11.8962, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z', gradient: { id: 'SVGID_3_', type: 'linear', x1: 11.5, y1: 0.96, x2: 11.5, y2: 6.2265, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 8, y: 2.001, w: 7, h: 4, fill: '#FFFFFF' }, { shape: 'rect', x: 9, y: 3.001, w: 5, h: 2, gradient: { id: 'SVGID_4_', type: 'linear', x1: 11.5, y1: 2.7007, x2: 11.5, y2: 5.0337, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z', gradient: { id: 'SVGID_5_', type: 'linear', x1: 11.5, y1: 7.126, x2: 11.5, y2: 8.5535, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 9, y: 8.001, w: 1, h: 0.999, gradient: { id: 'SVGID_6_', type: 'linear', x1: 9.5, y1: 8.0063, x2: 9.5, y2: 8.9477, stop: [{ offset: '0', color: '#58AC9A' }, { offset: '1', color: '#248576' }] }}, { shape: 'path', data: 'M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   ', gradient: { id: 'SVGID_7_', type: 'linear', x1: 4.4995, y1: 6.959, x2: 4.4995, y2: 12.2259, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 1, y: 8, w: 7, h: 4, fill: '#FFFFFF'
  }, { shape: 'rect', x: 2, y: 9, w: 5, h: 2, gradient: { id: 'SVGID_8_', type: 'linear', x1: 4.5, y1: 8.6997, x2: 4.5, y2: 11.0333, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z', gradient: { id: 'SVGID_9_', type: 'linear', x1: 4.4995, y1: 13.125, x2: 4.4995, y2: 14.5518, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}, { shape: 'rect', x: 2, y: 14, w: 1, h: 1, gradient: { id: 'SVGID_10_', type: 'linear', x1: 2.5, y1: 14.0049, x2: 2.5, y2: 14.9471, stop: [{ offset: '0', color: '#61B7D9' }, { offset: '1', color: '#005EAD' }] }}, { shape: 'path', data: 'M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z', gradient: { id: 'SVGID_11_', type: 'linear', x1: 14.5, y1: 13.0117, x2: 14.5, y2: 14.8962, stop: [{ offset: '0', color: '#666767' }, { offset: '1', color: '#232424' }] }}] }); var Od = { _hitCanvas: null, getHitCanvas: function(a, b) { this._hitCanvas == null && (this._hitCanvas = Wb.createCanvas()), arguments.length == 0 && (a = 2, b = 2), this._hitCanvas.setAttribute('width', '' + a - 1), this._hitCanvas.setAttribute('height', '' + b - 1), this._hitCanvas.setAttribute('width', '' + a), this._hitCanvas.setAttribute('height', '' + b); var c = this.getCtx(this._hitCanvas); return c.clearRect(0, 0, a, b), this._hitCanvas }, disposeHitCanvas: function() { this._hitCanvas = null }, getCtx: function(a) { return a.getContext('2d') }, render: function(a, c, d) { c != b && (a.fillStyle = c, a.fill()), d != b && (a.strokeStyle = d, a.stroke()) }, text: function(a, b, c, d, e, f) { a.textAlign = 'center', a.textBaseline = 'middle', e != null && (a.fillStyle = e, a.fillText(b, c, d)), f && (a.strokeStyle = f, a.strokeText(b, c, d)) }, circle: function(a, b, c, d, e, f) { a.arc(b, c, d, 0, 2 * Math.PI, !0), a.closePath(), this.render(a, e, f) }, rect: function(a, b, c, d, e, f, g) { a.rect(b, c, d, e), a.closePath(), this.render(a, f, g) }, OUT_LEFT: 1, OUT_TOP: 2, OUT_RIGHT: 4, OUT_BOTTOM: 8, outcode: function(a, b, c, d, e, f) { var g = 0; return e <= 0 ? g |= this.OUT_LEFT | this.OUT_RIGHT : c > a ? g |= this.OUT_LEFT : a > c + e && (g |= this.OUT_RIGHT), f <= 0 ? g |= this.OUT_TOP | this.OUT_BOTTOM : d > b ? g |= this.OUT_TOP : b > d + f && (g |= this.OUT_BOTTOM), g }, intersectsLine: function(a, b, c, d, e, f, g, h) { var i, j; if ((j = this.outcode(c, d, e, f, g, h)) == 0) return !0; for (;(i = this.outcode(a, b, e, f, g, h)) != 0;) { if ((i & j) != 0) return !1; if ((i & (this.OUT_LEFT | this.OUT_RIGHT)) != 0) { var k = e; (i & this.OUT_RIGHT) != 0 && (k += g), b += (k - a) * (d - b) / (c - a), a = k } else { var l = f; (i & this.OUT_BOTTOM) != 0 && (l += h), a += (l - b) * (c - a) / (d - b), b = l } } return !0 } }; Ib.vector = {}, Ib.vector.interaction = {}, Ib.vector.Network = function(a) { Ib.vector.Network.superClass.constructor.apply(this, arguments), this.zoomManager = new Ib.vector.PhysicalZoomManager(this), this._view = Wb.createView('hidden'), this._rootCanvas = Wb.createCanvas(), this._topCanvas = Wb.createCanvas(), this._view.appendChild(this._rootCanvas), this._view.appendChild(this._topCanvas), this.realWidth = 0, this.realHeight = 0, this._unionBounds = { x: 0, y: 0, width: 0, height: 0 }, this._zoom = 1, this._elementUIMap = {}, this._zoomMap = {}, this._viewRectMap = {}, this.viewRect = { x: 0, y: 0, width: 0, height: 0 }, this.hScrollBarVisible = !1, this.vScrollBarVisible = !1, this.markerList = new Ib.List(), this._topAttachmentList = new Ib.List(), this._hitTestTopAttachmentList = new Ib.List(), this.setElementBox(a || new Ib.ElementBox()), Qb.isTouchable ? Qb.isMSTouchable ? this.setDefaultInteractions(!1) : this.setTouchInteractions() : this.setDefaultInteractions(!1); var b = this; this._flowLink = function() { if (!(b.isMovingElement() || b.isSelectingElement() || b.isEditingElement() || b._box._layoutMovingElements)) { b._flowLinkQuickFinder || (b._flowLinkQuickFinder = new Ib.QuickFinder(b._box, 'link.flow', 'style')); var a = b._flowLinkQuickFinder.find(!0); a.forEach(function(a) { a._styleMap['link.flow.offset'] = b.getLinkFlowOffset(a), b.invalidateElementUI(a) }) } }, this.setToolTipEnabled(Ib.Defaults.NETWORK_TOOLTIP_ENABLED), this._paintAll = !0, this._dirtyRects = new nd(), this._invalidateMap = {}, this._invalidateAll = !0, b._count = 0, b._invalidate = !0, (function c(a) { b._loopId = requestAnimationFrame(c), b._invalidate && (b._count++, b._now = a, b.validate()) }(0)), Ib.imageUtil.addEventListener(this.invalidateElementUIs, this) }, Jb.ext('twaver.vector.Network', Ib.controls.View, { __accessor: ['selectMode', 'makeVisibleOnSelected', 'movableFunction', 'editPointSize', 'editPointFillColor', 'scrollBarWidth', 'editPointOutlineWidth', 'editPointOutlineColor', 'editLineColor', 'editLineWidth', 'resizePointSize', 'resizePointFillColor', 'resizePointOutlineWidth', 'resizePointOutlineColor', 'resizeLineColor', 'resizeLineWidth', 'rotatePointSize', 'rotatePointFillColor', 'rotatePointOffset', 'rotatePointOutlineWidth', 'rotatePointOutlineColor', 'rotateScaleFillColor', 'rotateScaleFontColor', 'rotateScaleWidth', 'rotateScaleHeight', 'selectOutlineColor', 'selectOutlineWidth', 'selectFillColor', 'lazyMoveOutlineColor', 'lazyMoveOutlineWidth', 'lazyMoveFillColor', 'rectSelectFilter', 'selectionTolerance'], __bool: ['doubleClickToUpSubNetwork', 'doubleClickToSubNetwork', 'doubleClickToEmptySubNetwork', 'doubleClickToLinkBundle', 'doubleClickToGroupExpand', 'scrollBarVisible', 'limitViewInCanvas', 'autoValidateCanvasSize', 'subNetworkAnimate', 'lazyMoveAnimate', 'resizeAnimate', 'noAgentLinkVisible', 'keyboardRemoveEnabled', 'keyboardSelectEnabled', 'sendToTopOnSelected', 'lazyMoveFill', 'editingElement', 'rotatingElement', 'movingElement', 'selectingElement', 'rectSelectEnabled', 'limitElementInPositiveLocation', 'showRotateScale', 'transparentSelectionEnable', 'edgeDetect', 'dragToPan', 'wheelToZoom', 'asyncZoomAndViewRect', 'debug', 'zoomDivVisible', 'showShadowInEdit'], _currentSubNetwork: null, _subNetworkAnimate: Ib.Defaults.NETWORK_SUBNETWORK_ANIMATE, _scrollBarWidth: 10, _scrollBarVisible: !0, _limitViewInCanvas: !1, _autoValidateCanvasSize: !0, _makeVisibleOnSelected: Ib.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: Ib.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: Ib.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED, _rectSelectEnabled: Ed.NETWORK_RECT_SELECT_ENABLED, _rectSelectFilter: null, _elementUIFunction: Ib.Defaults.VECTORUI_FUNCTION, _doubleClickToUpSubNetwork: Ib.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK, _doubleClickToSubNetwork: Ib.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK, _doubleClickToEmptySubNetwork: Ib.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK, _doubleClickToLinkBundle: Ib.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE, _doubleClickToGroupExpand: Ib.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND, _selectOutlineColor: Ib.Defaults.NETWORK_SELECT_OUTLINE_COLOR, _selectOutlineWidth: Ib.Defaults.NETWORK_SELECT_OUTLINE_WIDTH, _selectFillColor: Ib.Defaults.NETWORK_SELECT_FILL_COLOR, _sendToTopOnSelected: Ib.Defaults.NETWORK_SENDTOTOP_ON_SELECTED, _lazyMoveOutlineColor: Ib.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR, _lazyMoveOutlineWidth: Ib.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH, _lazyMoveFillColor: Ib.Defaults.NETWORK_LAZYMOVE_FILL_COLOR, _lazyMoveFill: Ib.Defaults.NETWORK_LAZYMOVE_FILL, _lazyMoveAnimate: Ib.Defaults.NETWORK_LAZYMOVE_ANIMATE, _resizePointSize: Ib.Defaults.NETWORK_RESIZE_POINT_SIZE, _resizePointFillColor: Ib.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR, _resizePointOutlineColor: Ib.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR, _resizePointOutlineWidth: Ib.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH, _resizeLineColor: Ib.Defaults.NETWORK_RESIZE_LINE_COLOR, _resizeLineWidth: Ib.Defaults.NETWORK_RESIZE_LINE_WIDTH, _resizeAnimate: Ib.Defaults.NETWORK_RESIZE_ANIMATE, _rotatePointSize: Ib.Defaults.NETWORK_ROTATE_POINT_SIZE, _rotatePointFillColor: Ib.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR, _rotatePointOffset: Ib.Defaults.NETWORK_ROTATE_POINT_OFFSET, _rotatePointOutlineWidth: Ib.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH, _rotatePointOutlineColor: Ib.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR, _rotateScaleWidth: Ed.NETWORK_ROTATE_SCALE_WIDTH, _rotateScaleHeight: Ed.NETWORK_ROTATE_SCALE_HEIGHT, _rotateScaleFillColor: Ed.NETWORK_ROTATE_SCALE_FILL_COLOR, _rotateScaleFontColor: Ed.NETWORK_ROTATE_SCALE_FONT_COLOR, _editPointSize: Ib.Defaults.NETWORK_EDIT_POINT_SIZE, _editPointFillColor: Ib.Defaults.NETWORK_EDIT_POINT_FILL_COLOR, _editPointOutlineColor: Ib.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR, _editPointOutlineWidth: Ib.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH, _editLineColor: Ib.Defaults.NETWORK_EDIT_LINE_COLOR, _editLineWidth: Ib.Defaults.NETWORK_EDIT_LINE_WIDTH, _limitElementInPositiveLocation: !1, _linkFlowInterval: Ed.NETWORK_LINK_FLOW_INTERVAL, _selectionTolerance: Ed.NETWORK_SELECTION_TOLERANCE, _invalidateViewRectFlag: !1, _repaintTopFlag: !1, _invalidateCanvasSizeFlag: !1, _isEditingElement: !1, _isRotatingElement: !1, _isMovingElement: !1, _isSelectingElement: !1, _hasEditInteraction: !1, _showRotateScale: !0, _transparentSelectionEnable: Ib.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE, _edgeDetect: !1, _dragToPan: !0, _wheelToZoom: !0, _asyncZoomAndViewRect: !1, _debug: !1, _zoomDivVisible: !0, _showShadowInEdit: !1, adjustBounds: function(a) { var b = !1, c = this._view.style; if (c.left == a.x + 'px' && c.top == a.y + 'px' && c.width == a.width + 'px' && c.height == a.height + 'px' && (b = !0), Ib.vector.Network.superClass.adjustBounds.apply(this, arguments), b != 1) { var d = this._view.offsetWidth, e = this._view.offsetHeight; this._rootCanvas.setAttribute('width', d), this._rootCanvas.setAttribute('height', e), this._topCanvas.setAttribute('width', d), this._topCanvas.setAttribute('height', e), this.setViewRect(this.viewRect.x, this.viewRect.y, d, e), typeof Ib.gis === 'undefined' && (Ib.Util.makeHighRes(this._rootCanvas), Ib.Util.makeHighRes(this._topCanvas)), this.invalidateElementVisibility() } }, getLabel: function(a) { return a.getStyle('network.label') || a.getName() }, getLabel2: function(a) { return a.getStyle('network.label') || a.getName2() }, setZoomManager: function(a) { var b = this.zoomManager; b != a && (this.zoomManager = a, this.invalidateElementVisibility(), this.invalidateCanvasSize(), this.validateCanvasSize(), this.invalidateElementUIs(), this.firePropertyChange('zoomManager', b, a)) }, getZoomManager: function() { return this.zoomManager }, getRootCanvas: function() { return this._rootCanvas }, getTopCanvas: function() { return this._topCanvas }, validateImpl: function() { oc.twm(this); var a, b, c, d, e = this.getElementBox().getDatas()._as, f = e.length, g = {}, h = this._visibleFunction, i = this._box._layerBox.size() === 1 ? this._box._layerBox._defaultLayer : null; for (a = 0; f > a; a++)c = e[a], g[c._id] = this.isVisible(c, h, i); var j = this.getGraphicsZoom(), k = null, l = { x: this.viewRect.x / j, y: this.viewRect.y / j, width: this.viewRect.width / j, height: this.viewRect.height / j }; if (this._invalidateAll) { if (this._visibleMap) for (a = 0; f > a; a++)c = e[a], g[c._id] !== this._visibleMap[c._id] && (d = this._elementUIMap[c._id], d && d.invalidate()); for (a = 0; f > a; a++)c = e[a], d = this._elementUIMap[c._id], d && d.validate(); this._paintAll = !0 } else if (this._paintAll) { for (b in this._invalidateMap)d = this._elementUIMap[b], d && d.invalidate(); for (b in this._invalidateMap)d = this._elementUIMap[b], d && d.validate() } else { for (b in this._invalidateMap)d = this._elementUIMap[b], d && (this._dirtyRects.add(d.getZoomViewRect(!1)), d.invalidate()); for (b in this._invalidateMap)d = this._elementUIMap[b], d && (d.validate(), this._dirtyRects.add(d.getZoomViewRect(!0))) } this._paintAll ? k = l : (this._dirtyRects.forEach(function(a) { k = k == null ? Jb.cloneRect(a) : Tb.unionRect(k, a) }), k ? (Tb.grow(k, 2, 2), k = Tb.intersection(k, l)) : k = l), this._visibleMap = g, k && this.paintRoot(k), this.validateCanvasSize(), this._repaintTopFlag == 1 && (this._repaintTopFlag = !1, this.paintTopCanvas()) }, isLinkFlowEnabled: function() { return this._linkFlowEnabled ? !0 : !1 }, setLinkFlowEnabled: function(a) { a ? (this._linkFlowEnabled || (this._linkFlowEnabled = !0, this.firePropertyChange('linkFlowEnabled', !1, !0)), clearInterval(this._linkFlowTimerId), this._linkFlowTimerId = setInterval(this._flowLink, this._linkFlowInterval)) : (this._linkFlowEnabled && (this._linkFlowEnabled = !1, this.firePropertyChange('linkFlowEnabled', !0, !1)), clearInterval(this._linkFlowTimerId), delete this._linkFlowTimerId) }, getLinkFlowInterval: function() { return this._linkFlowInterval }, setLinkFlowInterval: function(a) { var b = this._linkFlowInterval; this._linkFlowInterval = a, this.firePropertyChange('linkFlowInterval', b, a), clearInterval(this._linkFlowTimerId), this.isLinkFlowEnabled() && (this._linkFlowTimerId = setInterval(this._flowLink, this._linkFlowInterval)) }, getElementBox: function() { return this._box }, setElementBox: function(a) { if (!a) throw 'ElementBox can not be null'; if (this._box !== a) { var b = this._box; b && (b.removeDataBoxChangeListener(this.handleElementBoxChange, this), b.removeDataPropertyChangeListener(this.handleElementPropertyChange, this), b.removePropertyChangeListener(this.handleElementBoxPropertyChange, this), b.removeIndexChangeListener(this.handleIndexChange, this), b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange, this), b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange, this), b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange, this), this._selectionModel || b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)), this._box = a, this._box.addDataBoxChangeListener(this.handleElementBoxChange, this), this._box.addDataPropertyChangeListener(this.handleElementPropertyChange, this), this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange, this), this._box.addIndexChangeListener(this.handleIndexChange, this), this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange, this), this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange, this), this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange, this), this._flowLinkQuickFinder && (this._flowLinkQuickFinder.dispose(), this._flowLinkQuickFinder = new Ib.QuickFinder(this._box, 'link.flow', 'style')), this._selectionModel ? this._selectionModel._setDataBox(a) : this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this), this._elementUIMap = {}, this._box.forEach(this.createElementUI, this), this.invalidateElementVisibility(), this.invalidateCanvasSize(), this.firePropertyChange('elementBox', b, this._box) } }, handleElementBoxChange: function(a) { var b = a.data; if (a.kind === 'add') this.createElementUI(b), this.invalidateBundleLink(b); else if (a.kind === 'remove') { var c = this.getElementUI(b); c && (this._dirtyRects.add(c.getZoomViewRect()), c.dispose(), delete this._elementUIMap[b.getId()]), b === this._currentSubNetwork && this._currentSubNetwork != null && this._setCurrentSubNetwork(null), delete this._invalidateMap[b._id] } else a.kind === 'clear' && (this._elementUIMap = {}, this._currentSubNetwork != null && this._setCurrentSubNetwork(null), this._paintAll = !0); this.invalidateElementVisibility(), this.invalidateCanvasSize() }, handleElementPropertyChange: function(a) { var b = a.source, c = this.getElementUI(b); c && (this.invalidateElementUI(b), c.handlePropertyChange(a)), this.invalidateBundleLink(b), this.invalidateElementVisibility(), this.invalidateCanvasSize() }, handleElementBoxPropertyChange: function() { this.invalidateElementVisibility() }, handleIndexChange: function(a) { this.invalidateElementVisibility() }, handleLayerBoxChange: function() { this.invalidateElementVisibility() }, handleLayerPropertyChange: function(a) { a.property === 'editable' && this.invalidateSelectedElementUIs(!0), this.invalidateElementVisibility() }, handleLayerHierarchyChange: function() { this.invalidateElementVisibility() }, handleSelectionChange: function(a) { var b = this.getSelectionModel().getLastData(); b && (a.kind === 'append' || a.kind === 'set') && (this.isMakeVisibleOnSelected() && this.makeVisible(b), this.isSendToTopOnSelected() && this.sendToTop(b)), a.datas.forEach(function(b) { var c = this.getElementUI(b); c && c.handleSelectionChange(a), this.invalidateElementUI(b) }, this), this.invalidateElementVisibility() }, sendToTop: function(a) { if (this._box.contains(a)) { for (var b = a; b._parent && this.isVisible(b._parent) && (b = b._parent););b !== a && this._box.adjustElementIndex(b), this._box.adjustElementIndex(a) } }, getViewRect: function() { return this.viewRect ? Jb.cloneRect(this.viewRect) : { x: 0, y: 0, width: 0, height: 0 } }, getCanvasSize: function() { return { width: this.realWidth, height: this.realHeight } }, setViewOffSet: function(a, b) { var c = this.viewRect.x, d = this.viewRect.y, e = this.viewRect.width, f = this.viewRect.height; this.setViewRect(c + a, d + b, e, f) }, setViewRect: function(a, b, c, d) { this.isLimitViewInCanvas() == 1 && (a < 0 && (a = 0), c > this.realWidth ? a = 0 : a + c > this.realWidth && (a = this.realWidth - c), b < 0 && (b = 0), d > this.realHeight ? b = 0 : b + d > this.realHeight && (b = this.realHeight - d)); var e = this.viewRect; (this.viewRect == null || a != this.viewRect.x || b != this.viewRect.y || c != this.viewRect.width || d != this.viewRect.height) && (this.viewRect = { x: a, y: b, width: c, height: d }, this.firePropertyChange('viewRect', e, this.viewRect), this.invalidateElementVisibility(), this._paintAll = !0) }, isHScrollBarVisible: function() { return this.hScrollBarVisible }, setHScrollBarVisible: function(a) { this.hScrollBarVisible = a }, isVScrollBarVisible: function() { return this.vScrollBarVisible }, setVScrollBarVisible: function(a) { this.vScrollBarVisible = a }, setZoomVisibilityThresholds: function(a) { var b = this._visibilityThresholds; this._zoomVisibilityThresholds = a, this.firePropertyChange('zoomVisibilityThresholds', b, a), this.invalidateElementVisibility() }, getZoomVisibilityThresholds: function() { return this._zoomVisibilityThresholds || {} }, invalidateElementVisibility: function() { this.invalidate() }, repaintTopCanvas: function() { this._repaintTopFlag || (this._repaintTopFlag = !0, this.invalidate()) }, invalidateCanvasSize: function(a) { this._invalidateCanvasSizeFlag || (this._invalidateCanvasSizeFlag = !0, this.invalidate()) }, validateCanvasSize: function() { this._invalidateCanvasSizeFlag != 0 && (this._invalidateCanvasSizeFlag = !1, this._validateCanvasSize()) }, _validateCanvasSize: function() { if (this.isAutoValidateCanvasSize() == 0) return this.realWidth = 0, this.realHeight = 0, void (this._unionBounds = { x: 0, y: 0, width: 0, height: 0 }); var a, b = this.getElementBox().getDatas(), c = b.size(); if (c > 0) { for (var d = 0; c > d; d++) { var e = b.get(d); if (this._visibleMap[e._id]) { var f = this._elementUIMap[e._id]; f && (a = a ? Tb.unionRect(a, f.getZoomViewRect(!0)) : Jb.cloneRect(f.getZoomViewRect(!0))) } }a == null && (a = { x: 0, y: 0, width: 0, height: 0 }); var g = this.getGraphicsZoom(); if (this.realWidth == (a.x + a.width) * g && this.realHeight == (a.y + a.height) * g) return; this.realWidth = (a.x + a.width) * g, this.realHeight = (a.y + a.height) * g, this._unionBounds = { x: a.x * g, y: a.y * g, width: a.width * g, height: a.height * g } } else this.realWidth = 0, this.realHeight = 0, this._unionBounds = { x: 0, y: 0, width: 0, height: 0 }; this.setViewRect(this.viewRect.x, this.viewRect.y, this.viewRect.width, this.viewRect.height), this.firePropertyChange('canvasSizeChange', null, this.viewRect) }, getElementUI: function(a) { return a == null ? null : this._elementUIMap[a._id] }, getUnionBounds: function() { return this._unionBounds }, getZoomBodyRect: function(a) { var b = this.getElementUI(a); return b ? b.getZoomBodyRect() : null }, getShapeNodeZoomPoints: function(a, b) { if (a._points) { var c = this.getElementUI(a); if (c) return c._getZoomPoints() } return null }, createElementUI: function(a) { var b = this._elementUIMap[a.getId()]; if (!b) { if (b = this._elementUIFunction(this, a), !b) { var c = a.getClassName(), d = c.substr(c.indexOf('.') + 1) + 'UI', e = Ib.vector[d]; e && (b = new e(this, a)) }b && (this._elementUIMap[a.getId()] = b) } return this._invalidateMap && (this._invalidateMap[a._id] = a), b }, getElementUIFunction: function() { return this._elementUIFunction }, setElementUIFunction: function(a) { if (!a) throw 'ElementUIFunction can not be null'; if (this._elementUIFunction !== a) { var b = this._elementUIFunction; this._elementUIFunction = a, this.firePropertyChange('elementUIFunction', b, a), this._box.isEmpty() || (this._elementUIMap = {}, this._box.forEach(this.createElementUI, this), this.invalidateElementVisibility(), this.invalidateCanvasSize()) } }, invalidateElementUI: function(a, b) { if (!this._invalidateAll) { this._invalidateMap[a._id] = a; { this.getElementUI(a) } if (a instanceof Ld) { var c = a.getAgentLinks(); c != null && c.forEach(this.invalidateElementUI, this); var d = a.getParent(); d instanceof Ib.Group && this.invalidateElementUI(d) } this.invalidateElementVisibility() } }, invalidateElementUIs: function(a) { this._invalidateAll = !0, this._invalidateMap = {}, this._visibleMap = {}, this.invalidateElementVisibility(), this.invalidateCanvasSize(), this.invalidate() }, invalidateSelectedElementUIs: function(a) { this.getSelectionModel().getSelection().forEach(function(b) { this.invalidateElementUI(b, a) }, this) }, invalidateBundleLink: function(a) { if (a instanceof Ib.Link && a._bundleLinks) { var b = this._elementUIMap; a._bundleLinks.forEachSiblingLink(function(c) { if (c !== a) { var d = b[c._id]; d && d.invalidate(!1) } }, this) } }, paintRoot: function(a) { var c = this._rootCanvas.getContext('2d'); c.save(); var d = this.getGraphicsZoom(); c.beginPath(), c.rect(Math.round(a.x * d - this.viewRect.x), Math.round(a.y * d - this.viewRect.y), Math.round(a.width * d), Math.round(a.height * d)), c.clip(), c.clearRect(Math.round(a.x * d - this.viewRect.x), Math.round(a.y * d - this.viewRect.y), Math.round(a.width * d), Math.round(a.height * d)), this.visibleList = new Ib.List(), this._topAttachmentList = new Ib.List(), ld.draw(c, this); var e = this.getElementBox().getDatas()._as, f = e.length, g = this.zoomManager; g._zoomGraphicsBegin(c), this.paintBottom(c, a); var h, i, j, k, l = this._box._layerBox, d = this.getGraphicsZoom(), m = { x: this.viewRect.x / d, y: this.viewRect.y / d, width: this.viewRect.width / d, height: this.viewRect.height / d }; if (l.size() === 1) for (h = 0; f > h; h++)i = e[h], this._visibleMap[i._id] ? (j = this._elementUIMap[i._id], this._debug && Xb.strokeRect(c, a, 'red'), j != null && this._isInView(j, a) && (j.paint(c), j.setAttachmentVisible && j.setAttachmentVisible(!0)), j != null && Tb.intersects(m, j.getZoomViewRect()) ? j.setAttachmentVisible && j.setAttachmentVisible(!0) : j.setAttachmentVisible && j.setAttachmentVisible(!1), this.visibleList.add(i)) : (j = this._elementUIMap[i._id], j && j.setAttachmentVisible && j.setAttachmentVisible(!1)); else l.forEachByDepthFirst(function(b) { for (h = 0; f > h; h++)i = e[h], l.getLayerByElement(i) === b && this._visibleMap[i._id] ? (j = this._elementUIMap[i._id], j != null && this._isInView(j, a) && (j.paint(c), j.setAttachmentVisible && j.setAttachmentVisible(!0)), j != null && Tb.intersects(m, j.getZoomViewRect()) ? j.setAttachmentVisible && j.setAttachmentVisible(!0) : j.setAttachmentVisible && j.setAttachmentVisible(!1), j && j.validateZIndex && j.validateZIndex(l.getDatas().indexOf(b)), this.visibleList.add(i)) : j = this._elementUIMap[i._id] }, null, this); for (f = this._topAttachmentList.size(), h = 0; f > h; h++)k = this._topAttachmentList.get(h), k.getElementUI().paintAttachment(c, k); if (this.paintTop(c, a), this._xyz !== b) { var f, n = this._xyz, o = n.markText, p = n.type, q = (n.expired, n.innerHTML), r = 0, s = 0, t = this.viewRect; c.translate(this.viewRect.x / this.getZoom(), this.viewRect.y / this.getZoom()), c.scale(1 / this.getZoom(), 1 / this.getZoom()); var d = this.getZoom(); o != b && o != null && o != '' || p == '2' ? (c.font = '15px Arial sans-serif', f = Jb.g.getTextSize(c.font, q), c.fillStyle = 'red', r = t.width - f.width, s = t.height - 20) : (c.font = '10px Arial sans-serif', f = Jb.g.getTextSize(c.font, q), r = t.width / 2 - f.width / 2, s = t.height / 2), c.fillText(q, r, s) }c.restore(), this._invalidateMap = {}, this._invalidateAll = !1, this._paintAll = !1, this._dirtyRects = new nd() }, paintBottom: function(a, b) {}, paintTop: function(a, b) {}, _isInView: function(a, b) { return Tb.intersects(b, a.getZoomViewRect()) }, paintTopCanvas: function() { var a = this._topCanvas.getContext('2d'); a.clearRect(0, 0, this._topCanvas.width, this._topCanvas.height), this.paintMarker(a) }, paintMarker: function(a) { for (var b = this.markerList.size(), c = 0; b > c; c++) { var d = this.markerList.get(c); d.paint(a) } }, getLayerByElement: function(a) { return this._box.getLayerBox().getLayerByElement(a) }, getLogicalPoint2: function(a) { return this.zoomManager._getLogicalPoint(a) }, getLogicalPoint: function(a) { return this.zoomManager._getLogicalPoint(a, !0) }, getElementAt: function(a) { if (this.visibleList == null) return null; var b; if (a.target ? b = this.getLogicalPoint2(a) : a.event ? a.event.target && (b = this.getLogicalPoint2(a.event)) : b = a, this._hitTestTopAttachmentList != null) for (var c = this._hitTestTopAttachmentList.size(), d = c - 1; d >= 0; d--) { var e = this._hitTestTopAttachmentList.get(d); if (e.hit(b.x, b.y)) return e.getElement() } if (this.visibleList != null) for (var f = this.visibleList.size(), g = f - 1; g >= 0; g--) { var h = this.visibleList.get(g), i = this.getElementUI(h); if (i && i.hit(b.x, b.y)) return h } return null }, hitTest: function(a) { var b = this.getElementAt(a); if (!b) return null; var c = this.getElementUI(b); if (!c) return null; var d; return d = a.target ? this.getLogicalPoint2(a) : a.event ? this.getLogicalPoint2(a.event) : a, c.hitTest(d.x, d.y) }, getElementsAtRect: function(a, c, d, e) { var f = new Ib.List(); if (this.visibleList == null) return f; e = e === b ? !0 : e; for (var g = this.visibleList.size(), h = g - 1; h >= 0; h--) { var i = this.visibleList.get(h), j = this.getElementUI(i); j && (!d || d(j._element)) && (e && this.isSelectable(j._element) || !e) && (c ? j.intersects(a) && f.add(i) : Tb.contains(a, j.getZoomViewRect(lc)) && f.add(i)) } return f }, getPosition: function(a, b, c, d, e, f) { var g, h = b instanceof Ib.vector.ElementUI ? b : this.getElementUI(b); if (h) if (a === 'from' || a === 'to') { if (h.getFromPosition && (g = a === 'from' ? h.getFromPosition(d, e) : h.getToPosition(d, e))) return c ? { x: g.x - c.width / 2, y: g.y - c.height / 2 } : g } else g = a === 'hotspot' ? f ? h.getZoomHotSpot(this.zoomManager) : h.getHotSpot() : Vb.get(a, f ? h.getZoomBodyRect() : h.getBodyRect(), c); if (!g && b.getRect && (g = Vb.get(a, b.getRect(), c)), g) return { x: g.x + d, y: g.y + e }; throw "position '" + a + "' object '" + b + "'" }, isValidEvent: function(a) { if (!a) return !1; var b, c; if (a.currentTarget === this._view) { if (Qb.isFirefox ? (b = a.layerX, c = a.layerY) : (b = a.offsetX, c = a.offsetY), this.isHScrollBarVisible() == 1 && c >= this.viewRect.height - this.getScrollBarWidth()) return !1; if (this.isVScrollBarVisible() == 1 && b >= this.viewRect.width - this.getScrollBarWidth()) return !1 } return !0 }, addMarker: function(a) { this.markerList.add(a), this.repaintTopCanvas() }, removeMarker: function(a) { this.markerList.remove(a), this.repaintTopCanvas() }, clearMarker: function() { this.markerList.clear(), this.repaintTopCanvas() }, isMovable: function(a) { return this._box.contains(a) && a.isMovable() ? a instanceof Ib.Link ? !1 : this._movableFunction && !this._movableFunction(a) ? !1 : this.getLayerByElement(a).isMovable() : !1 }, hasMovableSelectedElements: function() { for (var a = this.getSelectionModel().getSelection(), b = 0; b < a.size(); b++) { var c = a.get(b); if (this.isMovable(c)) return !0 } return !1 }, getMovableSelectedElements: function() { return this.getSelectionModel().toSelection(function(a) { return this.isMovable(a) }, this) }, moveSelectedElements: function(a, b, c, d) { if (a !== 0 || b !== 0) { var e = this.getMovableSelectedElementsRect(); e != null && (this._limitElementInPositiveLocation && (e.x + a < 0 && (a = -e.x), e.y + b < 0 && (b = -e.y)), Ib.Util.moveElements(this.getMovableSelectedElements(), a, b, c, d, this)) } }, getMovableSelectedElementsRect: function() { var a = this.getMovableSelectedElements(); if (a.size() === 0) return null; for (var b = null, c = 0, d = a.size(); d > c; c++) { var e = a.get(c); if (e instanceof Ld) { var f = this.getElementUI(e); f && (b = Tb.unionRect(b, f.getViewRect())) } } return b }, isVisible: function(a, b, c) { if (!this._box.contains(a)) return !1; if (!a.isVisible()) return !1; if (arguments.length !== 3 && (b = this._visibleFunction), b && !b(a)) return !1; if (!(c || this._box._layerBox.getLayerByElement(a))._visible) return !1; if (vc.getSubNetwork(a) !== this._currentSubNetwork) return !1; if (!this.zoomManager.isElementVisible(a)) return !1; if (a instanceof Ib.Link) { if (!this._noAgentLinkVisible) { if (!a._fromAgent || !a._toAgent) return !1; if (!this.isVisible(a._fromAgent, b, c) || !this.isVisible(a._toAgent, b, c)) return !1 } if (a.getBundleIndex() > 0 && a.getBundleCount() > 1 && !a.getStyle('link.bundle.expanded')) return !1 } else for (var d = a._parent; d && !d.ISubNetwork;) { if (d instanceof Ib.Group && (!d.isExpanded() || !this.isVisible(d, b, c))) return !1; d = d._parent } return a.IDummy ? !1 : !0 }, getVisibleFunction: function() { return this._visibleFunction }, setVisibleFunction: function(a) { var b = this._visibleFunction; this._visibleFunction = a, this.firePropertyChange('visibleFunction', b, a), this.invalidateElementVisibility() }, isEditable: function(a) { return this._box.contains(a) ? this._editableFunction && !this._editableFunction(a) ? !1 : this.getLayerByElement(a).isEditable() : !1 }, getEditableFunction: function() { return this._editableFunction }, setEditableFunction: function(a) { var b = this._editableFunction; this._editableFunction = a, this.firePropertyChange('editableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, isRotatable: function(a) { return this._rotatableFunction && !this._rotatableFunction(a) ? !1 : !0 }, getRotatableFunction: function() { return this._rotatableFunction }, setRotatableFunction: function(a) { var b = this._rotatableFunction; this._rotatableFunction = a, this.firePropertyChange('rotatableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, isLinkable: function(a, b) { return this._linkableFunction == null || this._linkableFunction(a, b) }, getLinkableFunction: function() { return this._linkableFunction }, setLinkableFunction: function(a) { var b = this._linkableFunction; this._linkableFunction = a, this.firePropertyChange('linkableFunction', b, a), this.invalidateSelectedElementUIs(!0) }, onShareSelectionModelChanged: function() { this.invalidateElementUIs() }, getShadowColor: function(a) { var b = a.getStyle('shadow.color'); return !b && this.isSelected(a) && a.getStyle('select.style') === 'shadow' ? a.getStyle('select.color') : b }, getSelectColor: function(a) { return a.getStyle('select.color') }, getAlarmLabel: function(a) { var b = a.getAlarmState().getHighestNewAlarmSeverity(); if (b) { var c = a.getAlarmState().getNewAlarmCount(b) + b.nickName; return a.getAlarmState().hasLessSevereNewAlarms() && (c += '+'), c } return null }, getLinkHandlerLabel: function(a) { return a.isBundleAgent() ? '+(' + a.getBundleCount() + ')' : null }, setInteractions: function(a) { var b = this._interactions; b && b.forEach(function(a) { a.tearDown() }), this._interactions = a, a && a.forEach(function(a) { a.setUp() }), this.invalidateSelectedElementUIs(!0), this.firePropertyChange('interactions', b, a) }, getInteractions: function() { return this._interactions }, setDefaultInteractions: function(a) { this.setInteractions([new Ib.vector.interaction.DefaultInteraction(this, a)]) }, setTouchInteractions: function() { this.setInteractions([new Ib.vector.interaction.DefaultInteraction(this, !1), new Ib.vector.interaction.TouchInteraction(this)]) }, setMSTouchInteractions: function() { this.setInteractions([new Ib.vector.interaction.MSTouchInteraction(this)]) }, setEditInteractions: function(a) { this.setInteractions([new Ib.vector.interaction.EditInteraction(this, a), new Ib.vector.interaction.DefaultInteraction(this)]) }, setCreateElementInteractions: function(a) { this.setInteractions([new Ib.vector.interaction.CreateElementInteraction(this, a), new Ib.vector.interaction.DefaultInteraction(this)]) }, setCreateLinkInteractions: function(a) { this.setInteractions([new Ib.vector.interaction.CreateLinkInteraction(this, a), new Ib.vector.interaction.DefaultInteraction(this)]) }, setCreateShapeLinkInteractions: function(a) { this.setInteractions([new Ib.vector.interaction.CreateShapeLinkInteraction(this, a), new Ib.vector.interaction.DefaultInteraction(this)]) }, setCreateShapeNodeInteractions: function(a) { this.setInteractions([new Ib.vector.interaction.CreateShapeNodeInteraction(this, a), new Ib.vector.interaction.DefaultInteraction(this)]) }, setMagnifyInteractions: function() { this.setInteractions([new Ib.vector.interaction.DefaultInteraction(this), new Ib.vector.interaction.MagnifyInteraction(this)]) }, hasEditInteraction: function() { return this._hasEditInteraction }, setHasEditInteraction: function(a) { var b = this._hasEditInteraction; this._hasEditInteraction = a, this.firePropertyChange('hasEditInteraction', b, a) }, addElementByInteraction: function(a) { a.getParent() || a.setParent(this._currentSubNetwork), this._box.add(a), this.getSelectionModel().setSelection(a), this.fireInteractionEvent({ kind: 'createElement', element: a }) }, getToolTip: function(a) { if (a) { var b = a.getToolTip(); return b || a.getName() } return null }, isToolTipEnabled: function() { return this._toolTipEnabled ? !0 : !1 }, setToolTipEnabled: function(a) {
    if (this._toolTipEnabled = a, a) {
      if (!this._toolTipListener) {
        var b = this; this._toolTipListener = function(a) { if (b.isMovingElement()) return void Bc.hideToolTip(); var c = b.getElementAt(a); if (b._preElement !== c) if (b._preElement = c, c) { var d = b.getToolTip(c); Bc.showToolTip({ x: a.pageX, y: a.pageY }, d); var e = Bc.getToolTipDiv(); if (e.children.length > 0) { var f = b._view.getBoundingClientRect(), g = e.getBoundingClientRect(); g.width + g.left > f.width + f.left && (e.style.left = f.width + f.left - g.width + (Ob.documentElement.scrollLeft || Ob.body.scrollLeft) + 'px'), g.height + g.top > f.height + f.top && (e.style.top = f.height + f.top - g.height + (Ob.documentElement.scrollTop || Ob.body.scrollTop) + 'px') } } else Bc.hideToolTip() }, this._view.addEventListener('mousemove', this._toolTipListener, !1),
        this.firePropertyChange('toolTipEnabled', !1, !0)
      }
    } else this._toolTipListener && (Bc.hideToolTip(), this._view.removeEventListener('mousemove', this._toolTipListener, !1), delete this._toolTipListener, this.firePropertyChange('toolTipEnabled', !0, !1))
  }, setZoom: function(a, b) { if (a = this.checkZoom(a), this.isAsyncZoomAndViewRect()) var c = this._zoomMap[this._currentSubNetwork].zoom; else var c = this._zoom; if (a != c) { var d = this.getViewRect(); b || (b = { x: d.width / 2, y: d.height / 2 }); var e = this.viewRect, f = b.x - (b.x + e.x) * a / c, g = b.y - (b.y + e.y) * a / c; this.isAsyncZoomAndViewRect() ? this._zoomMap[this._currentSubNetwork].zoom = a : this._zoom = a, this._paintAll = !0, this.invalidateElementVisibility(), this.invalidateCanvasSize(), this.zoomManager._invalidateZoom(), this.setViewRect(-f, -g, this.viewRect.width, this.viewRect.height), this._asyncZoomAndViewRect ? this.firePropertyChange('zoom', c, this._zoomMap[this._currentSubNetwork].zoom) : this.firePropertyChange('zoom', c, this._zoom) } }, getZoom: function() { if (this.isAsyncZoomAndViewRect()) { var a = this._zoomMap[this._currentSubNetwork]; return a || (this._zoomMap[this._currentSubNetwork] = { zoom: 1 }), this._zoomMap[this._currentSubNetwork].zoom } return this._zoom }, getSizeZoom: function(a) { return this.zoomManager.getSizeZoom(a) }, getLocationZoom: function() { return this.zoomManager.getLocationZoom() }, getGraphicsZoom: function() { return this.zoomManager.getGraphicsZoom() }, zoomOverview: function(a) { if (!(this._unionBounds.width <= 0 || this._unionBounds.width <= 0)) { var b = this.getZoom(), c = this._unionBounds, d = c.width / b, e = c.height / b, f = this.viewRect.width / d, g = this.viewRect.height / e, h = Math.min(f, g); this.setZoom(h); var i = this.getZoom(), j = this.viewRect.width / 2 - this._unionBounds.width / 2 * i / b, k = this.viewRect.height / 2 - this._unionBounds.height / 2 * i / b; if (this.setViewRect(this._unionBounds.x * i / b - j, this._unionBounds.y * i / b - k, this.viewRect.width, this.viewRect.height), this.getLocationZoom() != 1) { var l = arguments[1] == null ? 5 : arguments[1]; if (l > 0) { l--; var m = this; setTimeout(function() { m.zoomOverview(a, l) }, 25) } } } }, zoomReset: function(a) { this.setZoom(1, a) }, zoomIn: function(a) { this.setZoom(1.2 * this.getZoom(), a) }, zoomOut: function(a) { this.setZoom(this.getZoom() / 1.2, a) }, upSubNetwork: function(a, b) { this._currentSubNetwork && this.setCurrentSubNetwork(vc.getSubNetwork(this._currentSubNetwork), a, b) }, getCurrentSubNetwork: function() { return this._currentSubNetwork }, setCurrentSubNetwork: function(a, b, c) { if (Ib.animate.AnimateManager.endAnimate(), b) { if (this._currentSubNetwork === a) return; if (a && !this._box.contains(a)) throw a + " is not contained in this network's elementBox"; var d = new Ib.animate.AnimateSubNetwork(this, a, c); Ib.animate.AnimateManager.start(d) } else this._setCurrentSubNetwork(a), c && c() }, _setCurrentSubNetwork: function(a) { if (this._currentSubNetwork !== a) { if (a && !this._box.contains(a)) throw a + " is not contained in this network's elementBox"; if (this.isAsyncZoomAndViewRect()) { var b = this._viewRectMap[this._currentSubNetwork]; this._viewRectMap[this._currentSubNetwork] = b ? this.viewRect : this.viewRect ? this.viewRect : { x: 0, y: 0, width: this.viewRect.width, height: this.viewRect.height } } var c = this._currentSubNetwork; if (this._currentSubNetwork = a, this.firePropertyChange('currentSubNetwork', c, a), this.isAsyncZoomAndViewRect()) { this._viewRectMap[this._currentSubNetwork] || (this._viewRectMap[this._currentSubNetwork] = { x: 0, y: 0, width: this.viewRect.width, height: this.viewRect.height }); var b = this._viewRectMap[this._currentSubNetwork]; this.setViewRect(b.x, b.y, b.width, b.height), this.invalidateElementUIs() } this.invalidateElementVisibility(), this.invalidateCanvasSize(), this._paintAll = !0 } }, makeVisible: function(a) { var b = this.getElementUI(a); if (b) { var c = vc.getSubNetwork(a); if (c !== this._currentSubNetwork) { var d = this; return void this.setCurrentSubNetwork(c, this.isSubNetworkAnimate(), function() { Jb.callLater(d.makeVisible, d, [a]) }) } for (var e = a; (e = e.getParent()) && e !== c;)e instanceof Ib.Group && e.setExpanded(!0); var f = b.getViewRect(); if (f) { var g, h = b.getZoomViewRect(this.zoomManager); g = f.x == h.x && f.y == h.y && f.width == h.width && f.height == h.height ? { x: f.x * this.getGraphicsZoom(), y: f.y * this.getGraphicsZoom(), width: f.width * this.getGraphicsZoom(), height: f.height * this.getGraphicsZoom() } : h, Tb.intersects(this.viewRect, g) || this.isVisible(a) && Jb.callLater(this.centerByLogicalPoint, this, [g.x + g.width / 2, g.y + g.height / 2]) } } }, centerByLogicalPoint: function(a, b, c) { var d = a - this.viewRect.width / 2, e = b - this.viewRect.height / 2; this.setViewRect(d, e, this.viewRect.width, this.viewRect.height) }, panByOffset: function(a, b) { this.setViewOffSet(a, b) }, getIconsNames: function(a) { return a.getStyle('icons.names') }, getIconsColors: function(a) { return a.getStyle('icons.colors') }, getLinkFlowStepping: function(a) { var b = parseInt(a.getStyle('link.flow.stepping')); return b || (b = Ed.NETWORK_LINK_FLOW_STEPPING), b }, getLinkFlowOffset: function(a) { var b = a.getStyle('link.flow.offset'); return isNaN(b) && (b = 0), b + this.getLinkFlowStepping(a) }, toCanvas: function(a, b, c, d, e, f) { c || (c = Wb.createCanvas()), c.setAttribute('width', a), c.setAttribute('height', b), c._viewRect ? (c._viewRect.width = a, c._viewRect.height = b) : c._viewRect = { x: 0, y: 0, width: a, height: b }; var g = c.getContext('2d'); if (g.translate(-e, -f), g.clearRect(0, 0, a, b), ld.draw(g, this), this._view.clientWidth === 0 || this._view.clientHeight === 0) return c; a / this.realWidth * this.getGraphicsZoom(), b / this.realHeight * this.getGraphicsZoom(); g.scale(d, d); var h = this.getElementBox().getDatas()._as, i = h.length; this._topAttachmentList = new Ib.List(); var j, k, l, m, n, o, p = this.getElementBox().getLayerBox(), q = p.getRoots(), r = q.size(); if (r === 1) for (l = 0; i > l; l++)m = h[l], this._visibleMap[m._id] && (n = this._elementUIMap[m._id], n != null && n.paint(g)); else for (j = 0; r > j; j++) for (k = q.get(j), l = 0; i > l; l++)m = h[l], p.getLayerByElement(m) === k && this._visibleMap[m._id] && (n = this._elementUIMap[m._id], n != null && n.paint(g)); for (i = this._topAttachmentList.size(), l = 0; i > l; l++)o = this._topAttachmentList.get(l), o.getElementUI().paintAttachment(g, o); return c }, toCanvasByRegion: function(a, b, c) { c || (c = Wb.createCanvas()); var d = a.width * b, e = a.height * b; c.setAttribute('width', d), c.setAttribute('height', e), c._viewRect ? (c._viewRect.width = d, c._viewRect.height = e) : c._viewRect = { x: 0, y: 0, width: d, height: e }; var f = c.getContext('2d'); if (f.clearRect(0, 0, d, e), ld.draw(f, this), this._view.clientWidth === 0 || this._view.clientHeight === 0) return c; f.save(), f.scale(b, b), f.beginPath(), f.translate(-a.x, -a.y); var g = this.getElementBox().getDatas()._as, h = g.length; this._topAttachmentList = new Ib.List(); var i, j, k, l, m, n, o = this.getElementBox().getLayerBox(), p = o.getRoots(), q = p.size(); if (q === 1) for (k = 0; h > k; k++)l = g[k], this._visibleMap[l._id] && (m = this._elementUIMap[l._id], m != null && Tb.intersects(a, m.getZoomViewRect()) && m.paint(f)); else for (i = 0; q > i; i++) for (j = p.get(i), k = 0; h > k; k++)l = g[k], o.getLayerByElement(l) === j && this._visibleMap[l._id] && (m = this._elementUIMap[l._id], m != null && Tb.intersects(a, m.getZoomViewRect()) && m.paint(f)); for (h = this._topAttachmentList.size(), k = 0; h > k; k++)n = this._topAttachmentList.get(k), n.getElementUI().paintAttachment(f, n); return f.restore(), c }, getGroupChildrenRects: function(a) { return this.zoomManager._getGroupChildrenRects(a) }, convertPointFromView: function(a) { return this.zoomManager._convertPointFromView(a) }, getOffset: function(a, b) { return this.zoomManager._getOffset(a, b) }, panToCenter: function() { this.setViewRect((this.realWidth - this.viewRect.width) / 2, (this.realHeight - this.viewRect.height) / 2, this.viewRect.width, this.viewRect.height) }, moveElementsToCenter: function() { if (this._limitViewInCanvas) { var a = this.viewRect, b = this._unionBounds, c = a.x + a.width / 2 - b.x - b.width / 2, d = a.y + a.height / 2 - b.y - b.height / 2; Ib.Util.moveElements(this._box.toDatas(), c, d) } else { var c = this.viewRect.width / 2 - this._unionBounds.width / 2, d = this.viewRect.height / 2 - this._unionBounds.height / 2; this.setViewRect(this._unionBounds.x - c, this._unionBounds.y - d, this.viewRect.width, this.viewRect.height) } }, getLinkPathFunction: function() { return this._linkPathFunction }, setLinkPathFunction: function(a) { var b = this._linkPathFunction; this._linkPathFunction = a, this.firePropertyChange('linkPathFunction', b, a), this.invalidateElementUIs() }, invalidate: function() { this._invalidate || (this._invalidate = !0, this.fireViewEvent({ kind: 'invalidate' })) }, validate: function() { this._invalidate && (Mb || this._view.offsetWidth !== 0 || this._view.offsetHeight !== 0) && (this._invalidate = !1, this._isValidating = !0, this.fireViewEvent({ kind: 'validateStart' }), this.validateImpl(), this.fireViewEvent({ kind: 'validateEnd' }), this._isValidating = !1) }, onClickElement: function(a, b) {}, onClickBackground: function(a) {}, onDoubleClickElement: function(a, b) {}, onDoubleClickBackground: function(a) {}, onLongClickElement: function(a, b) {}, onLongClickBackground: function(a) {}, onMouseMove: function(a, b) {}, onMouseEnter: function(a, b) {}, onMouseLeave: function(a, b) {}, setMovingElement: function(a) { if (a != this._movingElement) { var b = this._movingElement; this._movingElement = a, this.firePropertyChange('movingElement', b, a), this._box._undoManager._enabled && (a ? this._box._undoManager.startBatch() : this._box._undoManager.endBatch()) } }, setEditingElement: function(a) { if (a != this._editingElement) { var b = this._editingElement; this._editingElement = a, this.firePropertyChange('editingElement', b, a), this._box._undoManager._enabled && (a ? this._box._undoManager.startBatch() : this._box._undoManager.endBatch()) } }, dispose: function() { Ib.imageUtil.removeEventListener(this.invalidateElementUIs, this), this.setInteractions(null), cancelAnimationFrame(this._loopId) } }), Ib.vector.Overview = function(a) { Ib.vector.Overview.superClass.constructor.apply(this, a), this._view = Wb.createView(), this._rootDiv = Wb.createDiv(), this._imageCanvas = Wb.createCanvas(), this._imageDiv = Wb.createDiv(), this._maskCanvas = Wb.createCanvas(), this._selectDiv = Wb.createDiv(), this._isNetworkDirty = !1, this._isMaskDirty = !1, Wb.setVisible(this._selectDiv, !1), this._view.appendChild(this._rootDiv), this._rootDiv.appendChild(this._imageDiv), this._rootDiv.appendChild(this._maskCanvas), this._rootDiv.appendChild(this._selectDiv), this._imageDiv.appendChild(this._imageCanvas), this._exportImageCanvas = Wb.createCanvas(), this._imageCtx = this._imageCanvas.getContext('2d'), this.setNetwork(a), Qb.isTouchable ? Qb.isMSTouchable ? new Ib.vector.OverviewMSTouchInteraction(this) : (new Ib.vector.OverviewTouchInteraction(this), new Ib.vector.OverviewInteraction(this)) : new Ib.vector.OverviewInteraction(this) }, Jb.ext('twaver.vector.Overview', Ib.controls.ControlBase, { __accessor: ['fillColor', 'outlineColor', 'outlineWidth', 'selectColor', 'selectWidth', 'padding', 'maxPackingWidth', 'maxPackingHeight'], __bool: ['animate'], _fillColor: Ed.OVERVIEW_FILL_COLOR, _outlineColor: Ed.OVERVIEW_OUTLINE_COLOR, _outlineWidth: Ed.OVERVIEW_OUTLINE_WIDTH, _selectColor: Ed.OVERVIEW_SELECT_COLOR, _selectWidth: Ed.OVERVIEW_SELECT_WIDTH, _padding: Ed.OVERVIEW_PADDING, _animate: Ed.OVERVIEW_ANIMATE, _maxPackingWidth: Ed.OVERVIEW_MAX_PACKING_WIDTH, _maxPackingHeight: Ed.OVERVIEW_MAX_PACKING_HEIGHT, getNetwork: function() { return this._network }, onPropertyChanged: function(a) { this._invalidateMask() }, setNetwork: function(a) { a !== this._network && (this._network && (this._network.removePropertyChangeListener(this._handleNetworkPropertyChange, this), this._network.removeViewListener(this._handleNetworkViewChange, this), Wb.removeEventListener('scroll', '_handleScrollChange', this._network.getView(), this)), this._network = a, this._network && (this._network.addPropertyChangeListener(this._handleNetworkPropertyChange, this), this._network.addViewListener(this._handleNetworkViewChange, this), Wb.addEventListener('scroll', '_handleScrollChange', this._network.getView(), this)), this.invalidate()) }, _handleNetworkPropertyChange: function(a) { (a.property === 'zoom' || a.property === 'currentSubNetwork' || a.property === 'elementBox' || a.property === 'dataBox' || a.property === 'canvasSizeChange') && this.invalidate() }, _handleNetworkViewChange: function(a) { a.kind === 'validateEnd' && this.invalidate() }, _handleScrollChange: function() { this._invalidateMask() }, invalidate: function(a) { this._isNetworkDirty && this._isMaskDirty || (this._isNetworkDirty || (this._isNetworkDirty = !0), this._isMaskDirty || (this._isMaskDirty = !0), Jb.callLater(this.validate, this, null, a)) }, _invalidateMask: function() { this._isMaskDirty || (this._isMaskDirty = !0, Jb.callLater(this.validate, this, [], 100)) }, validate: function() { if ((this._isMaskDirty || this._isNetworkDirty) && this._network && (this._maxPackingWidth > 0 && this._maxPackingHeight > 0 || this._view.clientWidth > 0 && this._view.clientHeight > 0) && this._network.getViewRect().width !== 0 && this._network.getViewRect().height !== 0 && !this._network._invalidate) { var a, b = this._maxPackingWidth > 0 && this._maxPackingHeight > 0; a = b ? { x: 0, y: 0, width: this._maxPackingWidth, height: this._maxPackingHeight } : { x: 0, y: 0, width: this._view.clientWidth, height: this._view.clientHeight }, Tb.grow(a, -this._padding, -this._padding), b && (Wb.setDiv(this._view, { x: 0, y: 0, width: this._imageDiv._viewRect.width, height: this._imageDiv._viewRect.height }, null, 0, null), a.width = this._imageDiv._viewRect.width, a.height = this._imageDiv._viewRect.height); var c = this._network.getGraphicsZoom(), d = this._network._unionBounds; d = Tb.unionRect(d, { x: 0, y: 0, width: d.x, height: d.y }), d = { x: d.x / c, y: d.y / c, width: d.width / c, height: d.height / c }; var e = { x: this._network.viewRect.x / c, y: this._network.viewRect.y / c, width: this._network.viewRect.width / c, height: this._network.viewRect.height / c }, f = Tb.unionRect(d, e), g = Math.min(a.width / f.width, a.height / f.height), h = f.width * g, i = f.height * g, j = f.width * g, k = f.height * g, l = a.x + (a.width - j) / 2, m = a.y + (a.height - k) / 2; if (this._isNetworkDirty) { var n = { x: l, y: m, width: j, height: k }; this._network.toCanvas(h, i, this._exportImageCanvas, g, f.x * g, f.y * g), this._imageCanvas.setAttribute('width', j), this._imageCanvas.setAttribute('height', k), this._imageCtx.drawImage(this._exportImageCanvas, 0, 0, h, i), Wb.setDiv(this._imageDiv, n, null, 0, null), this._network.getElementBox && (this._imageDiv.style.backgroundColor = (this._network.getCurrentSubNetwork() || this._network.getElementBox()).getStyle('background.color') || ''), this._isNetworkDirty = !1 } if (this._isMaskDirty) { var o = { x: (e.x - f.x) * g, y: (e.y - f.y) * g, width: e.width * g, height: e.height * g }, p = Wb.setCanvas(this._maskCanvas, l, m, j, k); p.lineWidth = 0, p.fillStyle = this._fillColor, Xb.drawVector(p, 'rectangle', null, l, m, j, k), p.closePath(), p.fill(), p.stroke(), p.clearRect(l + o.x, m + o.y, o.width, o.height), p.lineWidth = this._outlineWidth, p.strokeStyle = this._outlineColor; var q = o.width - 2 * this._outlineWidth, r = o.height - 2 * this._outlineWidth; q = Math.min(q, j - 2 - o.x - this._outlineWidth), r = Math.min(r, k - 2 - o.y - this._outlineWidth), Xb.drawVector(p, 'rectangle', null, l + o.x + this._outlineWidth, m + o.y + this._outlineWidth, q, r), p.closePath(), p.stroke(), this._isMaskDirty = !1 } } else this._isNetworkDirty = !1, this._isMaskDirty = !1 }, getLogicalPoint: function(a) { return Wb.getLogicalPoint(this._view, a, 1, this._rootDiv) }, centerNetwork: function(a, b) { var c = this._imageDiv._viewRect; if (Tb.containsPoint(c, a)) { var d = this._network.getGraphicsZoom(), e = this._network._unionBounds; e = Tb.unionRect(e, { x: 0, y: 0, width: e.x, height: e.y }), e = { x: e.x / d, y: e.y / d, width: e.width / d, height: e.height / d }; var f = { x: this._network.viewRect.x / d, y: this._network.viewRect.y / d, width: this._network.viewRect.width / d, height: this._network.viewRect.height / d }, g = Tb.unionRect(e, f); this._network.centerByLogicalPoint((a.x - c.x) / c.width * g.width * d, (a.y - c.y) / c.height * g.height * d, b), this._invalidateMask() } } }), Ib.vector.OverviewTouchInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, Wb.addEventListener('touchstart', 'handleTouchstart', this.view, this) }, Jb.ext('twaver.vector.OverviewTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a), this.clear(), this.endPoint = this.overview.getLogicalPoint(a), zc.isMultiTouch(a) && (this.distance = zc.getDistance(a), this.zoom = this.network.getZoom()), Wb.addEventListener('touchmove', 'handleTouchmove', this.view, this), Wb.addEventListener('touchend', 'handleTouchend', this.view, this) }, handleTouchmove: function(a) { if (this.moved || (this.moved = !0), this.endPoint = this.overview.getLogicalPoint(a), zc.isSingleTouch(a)) this.overview.centerNetwork(this.endPoint, !1); else if (this.distance) { var b = zc.getDistance(a) / this.distance; this.network.setZoom(this.zoom * b, !1) } }, handleTouchend: function(a) { if (!this.moved) { this.endPoint = this.overview.getLogicalPoint(a); var b = this.lastPoint && this.lastTouchStartTime && (new Date()).getTime() - this.lastTouchStartTime.getTime() <= 300 && Math.abs(this.endPoint.x - this.lastPoint.x) <= 10 && Math.abs(this.endPoint.y - this.lastPoint.y) <= 10; b ? (this.lastPoint = null, this.lastTouchStartTime = null) : (this.lastPoint = this.endPoint, this.lastTouchStartTime = new Date()), b ? Jb.callLater(this.network.zoomReset, this.network, [this.overview._animate]) : this.overview.centerNetwork(this.endPoint, this.overview._animate) } this.clear() }, clear: function() { this.endPoint && (this.endPoint = null, Wb.removeEventListener('touchmove', this.view, this), Wb.removeEventListener('touchend', this.view, this)), this.moved = !1 } }), Ib.vector.OverviewMSTouchInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, this._pointerMap = {}, this._pointerIdArray = [], Wb.addEventListener('MSPointerDown', 'handleTouchstart', this.view, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', this.view, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', this.view, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', this.view, this) }, Jb.ext('twaver.vector.OverviewMSTouchInteraction', Object, { handleTouchstart: function(a) { Wb.preventDefault(a), a.isPrimary && this._pointerIdArray.length > 0 && (this._pointerMap = {}, this._pointerIdArray = []), !this._pointerMap[a.pointerId] && this.overview.getLogicalPoint(a) && (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a), this._pointerIdArray.length == 1 ? (this._startTouchPoint = this.overview.getLogicalPoint(a), this._startTouchTime = new Date()) : this._pointerIdArray.length == 2 && (this._distance = this._getDistance(), this._zoom = this.network.getZoom()) }, handleTouchmove: function(a) { if (this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 10)) if (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2) { var b = this._getDistance() / this._distance; this.network.setZoom(this._zoom * b, !1) } else if (this._pointerIdArray.length == 1 && this._startTouchPoint) { var c = this.overview.getLogicalPoint(a); if (c == null) return; this._startTouchPoint = c, this.overview.centerNetwork(this._startTouchPoint, !1) } }, handleTouchend: function(a) { var b = this.overview.getLogicalPoint(a); if (this._pointerIdArray.length == 1 && b) { var c = this._endTouchPoint && this._endTouchTime && (new Date()).getTime() - this._endTouchTime.getTime() <= 500 && Tb.getDistance(this._endTouchPoint, b) <= 10; c ? (this._endTouchPoint = null, this._endTouchTime = null) : (this._endTouchPoint = b, this._endTouchTime = new Date()), c ? Jb.callLater(this.network.zoomReset, this.network, [this.overview._animate]) : this.overview.centerNetwork(this._endTouchPoint, this.overview._animate) } this._pointerMap = {}, this._pointerIdArray = [] }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) } }), Ib.vector.OverviewInteraction = function(a) { this.overview = a, this.network = a.getNetwork(), this.view = a._view, Wb.addEventListener('mousedown', 'handleMousedown', this.view, this) }, Jb.ext('twaver.vector.OverviewInteraction', Object, { handleMousedown: function(a) { this.clear(), this.endPoint = this.overview.getLogicalPoint(a), Jb.isCtrlDown(a) && (this.startPoint = this.endPoint, Wb.setVisible(this.overview._selectDiv, !0)), Wb.addEventListener('mousemove', 'handleMousemove', this.view, this), Wb.addEventListener('mouseup', 'handleMouseup', this.view, this) }, handleMouseup: function(a) { if (this.endPoint = this.overview.getLogicalPoint(a), 'detail' in a && a.detail === 2)Jb.callLater(this.network.zoomReset, this.network, [this.endPoint, this.overview._animate]); else if (Wb.isVisible(this.overview._selectDiv) && this.startPoint) { var b = this.overview._imageDiv._viewRect, c = this.overview._selectDiv._viewRect.x, d = this.overview._selectDiv._viewRect.y, e = b.width / this.overview._selectDiv._viewRect.width, f = b.height / this.overview._selectDiv._viewRect.height, g = Math.min(e, f); this.network.setZoom(g * Math.min(this.network.getViewRect().width / this.network.getCanvasSize().width, this.network.getViewRect().height / this.network.getCanvasSize().height) * this.network.getZoom(), !1); var h = this.network.getCanvasSize().width * ((c - b.x + this.overview._selectDiv._viewRect.width / 2) / b.width), i = this.network.getCanvasSize().height * ((d - b.y + this.overview._selectDiv._viewRect.height / 2) / b.height); Jb.callLater(this.network.centerByLogicalPoint, this.network, [h, i, this.overview._animate]), Wb.setVisible(this.overview._selectDiv, !1), Wb.setDiv(this.overview._selectDiv, { x: 0, y: 0, width: 0, height: 0 }, null, 0, null), this.startPoint = null } else this.overview.centerNetwork(this.endPoint, this.overview._animate); this.clear() }, handleMousemove: function(a) { var b = this.overview.getLogicalPoint(a); if (this.endPoint = b, Wb.isVisible(this.overview._selectDiv) && this.startPoint) { var c = b.x > this.startPoint.x ? this.startPoint.x : b.x, d = b.x > this.startPoint.x ? this.startPoint.y : b.y; b.x > this.startPoint.x && b.y < this.startPoint.y && (d = b.y), b.x < this.startPoint.x && b.y > this.startPoint.y && (d = this.startPoint.y); var e = this.overview._imageDiv._viewRect; c < e.x && (c = e.x), c > e.x + e.width && (c = e.x + e.width), d < e.y && (d = e.y), d > e.y + e.height && (d = e.y + e.height); var f = Math.abs(b.x - this.startPoint.x), g = Math.abs(b.y - this.startPoint.y); c + f > e.x + e.width && (f = e.x + e.width - c), d + g > e.y + e.height && (g = e.y + e.height - d), Wb.setDiv(this.overview._selectDiv, { x: c, y: d, width: f, height: g }, null, this.overview._selectWidth, this.overview._selectColor) } else this.overview.centerNetwork(b, !1) }, clear: function() { this.endPoint && (this.endPoint = null, Wb.removeEventListener('mousemove', this.view, this), Wb.removeEventListener('mouseup', this.view, this)) } }), Ib.vector.ElementUI = function(a, b) { this._network = a, this._element = b, this._attachments = new Ib.List(), this._bodyBounds = new Ib.List(), this._hitTest = !1, this._hitTest = !1, this._intersectTest = !1, this.invalidate(!0) }, Jb.ext('twaver.vector.ElementUI', Object, { getElement: function() { return this._element }, getNetwork: function() { return this._network }, handlePropertyChange: function(a) {}, handleSelectionChange: function(a) {}, invalidate: function(a) { a === b && (a = !0), a && (this._invalidateAttachmentsFlag = !0), this._invalidateFlag || (this._hotSpot = null, this._bodyRect = null, this._invalidateFlag = !0, this.invalidateZoom(), this.setAttachmentVisible && this.setAttachmentVisible(!1)) }, invalidateZoom: function() { this._zoomBodyRect = null, this._zoomViewRect = null, this._zoomHotSpot = null }, updateStyle: function() { this._innerColor = this._network.getInnerColor(this._element), this._outerColor = this._network.getOuterColor(this._element), this._glowBlur = this._element.getStyle('glow.blur'), this._shadowColor = this._network.getShadowColor(this._element), this._shadowXOffset = this._element.getStyle('shadow.xoffset'), this._shadowYOffset = this._element.getStyle('shadow.yoffset'), this._shadowBlur = this._element.getStyle('shadow.blur'), this._wholeAlpha = this._element.getStyle('whole.alpha') }, validate: function() { var a = this; if (this._invalidateFlag != 0) { this._bodyBounds.clear(), this._invalidateAttachmentsFlag && (this._invalidateAttachmentsFlag = !1, this.checkAttachments()), this._invalidateFlag = !1, this.updateStyle(), this.validateImpl(), this._attachments.forEach(function(a) { a.validate() }); var b; this._bodyBounds.forEach(function(a) { b = Tb.unionRect(b, a) }), b == null && (b = Jb.cloneRect(this._element.getLocation()), b.width = 0, b.height = 0), this._unionBodyBounds = { x: b.x, y: b.y, width: b.width, height: b.height }, this._attachments.forEach(function(c) { b = c instanceof Ib.vector.EditAttachment ? c.getElementUI() instanceof Ib.vector.LinkUI ? Tb.unionRect(b, c._viewRect) : Tb.unionRect(b, a._network.zoomManager._reverseElementZoomRect(a, c._viewRect)) : c.getElementUI() instanceof Ib.vector.LinkUI ? Tb.unionRect(b, a._network.zoomManager._getAttachmentZoomOutLineRect(c, c._viewRect)) : c.getElementUI() instanceof Ib.vector.GroupUI && c.getElementUI()._shapeRect ? c instanceof Ib.vector.IconsAttachment ? Tb.unionRect(b, c._viewRect) : Tb.unionRect(b, a._network.zoomManager._getAttachmentZoomOutLineRect(c, c._viewRect)) : Tb.unionRect(b, c._viewRect) }), this._viewRect = b } }, validateImpl: function() {}, setGlow: function(a, b) { this._element.getStyle('outer.style') === 'glow' && (b.shadowColor = this._outerColor, b.shadowOffsetX = 0, b.shadowOffsetY = 0, b.shadowBlur = this._glowBlur) }, clearGlow: function(a) { (a.shadowOffsetX != 0 || a.shadowOffsetY != 0 || a.shadowBlur != 0) && (a.shadowOffsetX = 0, a.shadowOffsetY = 0, a.shadowBlur = 0) }, setShadow: function(a, b) { var c = this._network.zoomManager, d = a.isShadowable() && this._shadowColor && !this._editAttachment; if (b.shadowOffsetX === this._shadowXOffset && b.shadowOffsetY === this._shadowYOffset && b.shadowBlur === this._shadowBlur) return b; if (d || this._network._showShadowInEdit) { var e = c.getGraphicsZoom(), f = c.getSizeZoom(); e *= f, e > 1 && (e = 1), b.shadowOffsetX = this._shadowXOffset * e, b.shadowOffsetY = this._shadowYOffset * e, b.shadowBlur = this._shadowBlur * e, b.shadowColor = this._shadowColor } return b }, clearShadow: function(a) { (a.shadowOffsetX != 0 || a.shadowOffsetY != 0 || a.shadowBlur != 0) && (a.shadowOffsetX = 0, a.shadowOffsetY = 0, a.shadowBlur = 0) }, appendShadowBound: function(a, b) { var c = a.isShadowable() && this._shadowColor && !this._editAttachment; if (c) { var d = this._network.zoomManager, e = d.getGraphicsZoom(), f = d.getSizeZoom(); e *= f, e > 1 && (e = 1), this._shadowXOffset > 0 ? b.width += this._shadowXOffset : (b.x += this._shadowXOffset, b.width += -this._shadowXOffset), this._shadowYOffset > 0 ? b.height += this._shadowYOffset : (b.y += this._shadowYOffset, b.height += -this._shadowYOffset); var g = this._shadowBlur; g = Math.ceil(g / e), Tb.grow(b, g + 1, g + 1) } return b }, appendGlowBound: function(a, b) { if (this._element.getStyle('outer.style') === 'glow') { var c = this._network.zoomManager, d = c.getGraphicsZoom(), e = c.getSizeZoom(); d *= e, d > 1 && (d = 1); var f = this._glowBlur; f = Math.ceil(f / d), Tb.grow(b, f + 1, f + 1) } }, isShadowable: function() { return this._shadowColor && this._network.isSelected(this._element) && this._element.getStyle('select.style') === 'shadow' ? !0 : !1 }, addAttachment: function(a) { this._attachments.add(a), this.invalidate(!1) }, removeAttachment: function(a) { this._attachments.remove(a), this.invalidate(!1) }, getAttachments: function() { return this._attachments }, checkAttachments: function() { this.checkLabelAttachment(), this.checkLabel2Attachment(), this.checkAlarmAttachment(), this.checkIconsAttachment(), this.checkEditAttachment() }, checkLabelAttachment: function() { var a = this._network.getLabel(this._element); a != null && a !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.vector.LabelAttachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkLabel2Attachment: function() { var a = this._network.getLabel2(this._element); a != null && a !== '' ? this._label2Attachment || (this._label2Attachment = new Ib.vector.Label2Attachment(this, Ed.SHOW_LABEL2_IN_ATTACHMENT_DIV), this.addAttachment(this._label2Attachment)) : this._label2Attachment && (this.removeAttachment(this._label2Attachment), this._label2Attachment = null) }, checkAlarmAttachment: function() { var a = this._network.getAlarmLabel(this._element); a != null && a !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.vector.AlarmAttachment(this, Ed.SHOW_ALARM_IN_ATTACHMENT_DIV), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) }, checkIconsAttachment: function() { var a = this._network.getIconsNames(this._element); a && a.length > 0 ? this._iconsAttachment || (this._iconsAttachment = new Ib.vector.IconsAttachment(this, Ed.SHOW_ICON_IN_ATTACHMENT_DIV), this.addAttachment(this._iconsAttachment)) : this._iconsAttachment && (this.removeAttachment(this._iconsAttachment), this._iconsAttachment = null) }, checkEditAttachment: function() { this._network.hasEditInteraction() && this._network.isSelected(this._element) && this._network.isEditable(this._element) && this.isEditable() ? this._editAttachment || (this._editAttachment = new Ib.vector.EditAttachment(this, Ed.SHOW_EDIT_IN_ATTACHMENT_DIV), this.addAttachment(this._editAttachment)) : this._editAttachment && (this.removeAttachment(this._editAttachment), this._editAttachment = null) }, getLabelAttachment: function() { return this._labelAttachment }, getAlarmAttachment: function() { return this._alarmAttachment }, getIconsAttachment: function() { return this._iconsAttachment }, getEditAttachment: function() { return this._editAttachment }, isEditable: function() { return !0 }, getInnerColor: function() { return this._innerColor }, getOuterColor: function() { return this._outerColor }, getShadowColor: function() { return this._shadowColor }, getDyeColor: function(a) { return this._innerColor ? this._innerColor : this.getStyle(a) }, getStyle: function(a) { return this._element.getStyle(a) }, getFont: function(a) { var b = this._element.getStyle(a); return b || Ib.Defaults.FONT }, paint: function(a) { a.save(), a.globalAlpha = this._wholeAlpha, a.beginPath(), this.paintBody(a), this.clearShadow(a), this.clearGlow(a), a.closePath(), a.beginPath(), this.paintAttachments(a), a.closePath(), a.restore(), this._network._debug && Xb.strokeRect(a, this.getZoomViewRect(), 'orange') }, paintBody: function(a) {}, getZoomBodyRect: function(a) { return this._network.zoomManager._getElementZoomRect(this, this.getBodyRect()) }, getZoomHotSpot: function() { return this._zoomHotSpot || (this._zoomHotSpot = this._network.zoomManager._getZoomHotSpot(this, this._hotSpot)), Jb.clone(this._zoomHotSpot) }, getZoomPointers: function(a, b) { return this._network.zoomManager._getZoomPointers(a, this, b) }, _getZoomViewRect: function(a, b, c) { var d = this._network.zoomManager; if (b) { var e = Jb.cloneRect(d._getAttachmentZoomRect(b, a)); return e } var f = d.getLocationZoom(), g = d.getSizeZoom(this), h = this._bodyRect ? this._bodyRect : this.getBodyRect(); a = a || { x: h.x, y: h.y, width: 0, height: 0 }; var i = h.x + h.width / 2, j = h.y + h.height / 2; return { x: i * f + (a.x - i) * g, y: j * f + (a.y - j) * g, width: a.width * g, height: a.height * g } }, getZoomViewRect: function(a) { { var b = this._network.zoomManager, c = b.getLocationZoom(); b.getGraphicsZoom() } if (c == 1) return Jb.cloneRect(this._viewRect); if (!this._zoomViewRect || a) { var d, e = this._getZoomViewRect(Jb.cloneRect(this._unionBodyBounds), !1); d = Tb.unionRect(d, e); this._attachments.forEach(function(a) { d = a instanceof Ib.vector.EditAttachment ? Tb.unionRect(d, a._viewRect) : Tb.unionRect(d, a.getZoomViewRect()) }), this._zoomViewRect = d } return Jb.cloneRect(this._zoomViewRect) }, paintAttachments: function(a) { a.beginPath(); for (var b = this._attachments.size(), c = 0; b > c; c++) { var d = this._attachments.get(c); this._hitTest == 1 && d.isShowOnTop() == 0 && this.paintAttachment(a, d), this._intersectTest == 1 && this.paintAttachment(a, d), this._hitTest == 0 && this._intersectTest == 0 && (d.isShowOnTop() ? this._network._topAttachmentList.add(d) : this.paintAttachment(a, d)) } }, paintAttachment: function(a, b) { var c = this._network.zoomManager; c.isAttachmentVisible(this._element) && (b != this._labelAttachment && b != this._label2Attachment || c.isLabelVisible(this._element)) && (b != this._alarmAttachment || c.isAlarmBalloonVisible(this._element)) && (a.beginPath(), b.paint(a), this.clearShadow(a)) }, getViewRect: function() { return Jb.cloneRect(this._viewRect) }, getUnionBodyBounds: function() { return Jb.cloneRect(this._unionBodyBounds) }, addBodyBounds: function(a) { a && this._bodyBounds.add(a) }, getBodyRect: function(a) { return a == b && (a = !0), this._bodyRect || (this._bodyRect = this.createBodyRect()), a ? Jb.cloneRect(this._bodyRect) : this._bodyRect }, getHotSpot: function() { return this._hotSpot ? Jb.clone(this._hotSpot) : { x: 0, y: 0 } }, setHotSpot: function(a) { this._hotSpot = a }, hit: function(a, b) { return !1 }, intersects: function(a) { return Tb.contains(a, this.getZoomViewRect()) ? !0 : !1 }, hitCanvasRectAtBody: function(a) { var b = Od.getHitCanvas(a.width, a.height), c = Od.getCtx(b); if (c.save(), c.translate(-a.x, -a.y), this._element.getImage) { var d = Jb.getImageAsset(this._element.getImage()); if (d && d.getImage() instanceof Hd) return 1 } this.paintBody(c); try { for (var e = c.getImageData(0, 0, a.width, a.height), f = e.data, g = 0; g < e.width; g++) for (var h = 0; h < e.height; h++) { var i = 4 * (h * e.width + g), j = f[i + 3]; if (j !== 0) return c.restore(), 1 } } catch (k) { if (Od.disposeHitCanvas(), Tb.contains(this.getUnionBodyBounds(), a)) return 0 } return c.restore(), -1 }, hitCanvasRectAtAttachments: function(a) {
    var b = Od.getHitCanvas(a.width, a.height), c = Od.getCtx(b); c.save(), c.translate(-a.x, -a.y), this.paintAttachments(c); try { for (var d = c.getImageData(0, 0, a.width, a.height), e = d.data, f = 0; f < d.width; f++) for (var g = 0; g < d.height; g++) { var h = 4 * (g * d.width + f), i = e[h + 3]; if (i !== 0) return c.restore(), 1 } } catch (j) { Od.disposeHitCanvas() } return c.restore(), -1
  }, hitCanvasRect: function(a) { this._intersectTest = !0, this._hitTest == 1 && (this._intersectTest = !1); var b = Tb.intersection(a, this.getZoomViewRect()), c = this.hitCanvasRectAtBody(b); if (c == 1) return this._intersectTest = !1, !0; var d = this.hitCanvasRectAtAttachments(b); return d == 1 ? (this._intersectTest = !1, !0) : (this._intersectTest = !1, c == 0) }, hitCanvasPoint: function(a, b) { var c = { x: a, y: b, width: 0, height: 0 }, d = this._network.getSelectionTolerance(); if (d && d > 0 && Tb.grow(c, d, d), !Tb.intersects(this.getZoomViewRect(), c)) return !1; this._hitTest = !0; var e = this.hitCanvasRect(c); return this._hitTest = !1, e }, hitTest: function(a, b) { var c = { x: a, y: b, width: 0, height: 0 }, d = this._network.getSelectionTolerance(); if (d && d > 0 && Tb.grow(c, d, d), !Tb.intersects(this.getZoomViewRect(), c)) return null; for (var e = Tb.intersection(c, this.getZoomViewRect()), f = this._attachments.size(), g = 0; f > g; g++) { var h = this._attachments.get(g); if (h.hit(a, b)) return h } var i = this.hitCanvasRectAtBody(e); return i == 1 ? this : i == 0 ? this : null }, dispose: function() { this._attachments.forEach(function(a) { a.dispose() }), this._attachments.clear() } }), Ib.vector.NodeUI = function(a, b) { Ib.vector.NodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.NodeUI', Ib.vector.ElementUI, { invalidate: function(a) { this.curInterval && clearInterval(this.curInterval), Ib.vector.NodeUI.superClass.invalidate.call(this, a) }, createBodyRect: function() { return this._element.getRect() }, validateImpl: function() { Ib.vector.NodeUI.superClass.validateImpl.call(this); var a = this.getStyle('vector.shape'), b = this.getBodyRect(); this._hotSpot = Tb.getHotSpot(b.x, b.y, b.width, b.height, a), this.validateBodyBounds() }, validate: function() { this._invalidateFlag != 0 && Ib.vector.NodeUI.superClass.validate.call(this) }, validateBodyBounds: function() { var a = this.getStyle('body.type'); a === 'default' ? this.addBodyBounds(this.getDefaultBodyRect()) : a === 'vector' ? this.addBodyBounds(this.getVectorBody()) : a === 'default.vector' ? (this.addBodyBounds(this.getVectorBody()), this.addBodyBounds(this.getDefaultBodyRect())) : a === 'vector.default' && (this.addBodyBounds(this.getDefaultBodyRect()), this.addBodyBounds(this.getVectorBody())), this._outerColor && this.getStyle('outer.style') === 'border' && this.addBodyBounds(this.getOuterBorderRect()), !this._editAttachment && this.getStyle('select.style') === 'border' && this._network.isSelected(this._element) && this.addBodyBounds(this.getSelectBorderRect()) }, getDefaultBodyRect: function() { var a = this._element, b = this.getBodyRect(); if (!a.getImage() || typeof a.getImage() === 'string' && !Jb.getImageAsset(a.getImage())) return b; Tb.addPadding(b, this._element, 'image.padding', 1); var c = Jb.cloneRect(b); return this.appendGlowBound(this, c), this.appendShadowBound(this, c), b = c }, getVectorBody: function() { var a = this.getPathRect('vector'); return a }, getOuterBorderRect: function() { return this._getBorderRect('outer') }, getSelectBorderRect: function() { return this._getBorderRect('select') }, _getBorderRect: function(a) { var b = this._element, c = b.getStyle(a + '.width'); if (c > 0) { var d = this.getBodyRect(); Tb.addPadding(d, b, a + '.padding', 1); var e = Jb.cloneRect(d); return Tb.grow(e, 2 * c, 2 * c), e } return null }, getPathRect: function(a, b) { { var c = this._element, d = this.getBodyRect(); this._network.zoomManager.getSizeZoom() }b && Tb.addPadding(d, c, a + '.padding', 1); var e = Jb.cloneRect(d), f = c.getStyle(a + '.outline.width'); if (f > 0) if (this._getZoomPoints) { for (var g = this._element._points, h = g.size(), i = 0, j = 0; h > j; j++) { if (j == 0) var k = g.get(j), l = g.get(h - 1), m = g.get(j + 1); else if (j == h - 1) var k = g.get(j), l = g.get(j - 1), m = g.get(0); else var k = g.get(j), l = g.get(j - 1), m = g.get(j + 1); var n = Tb.getCenterPoint(l, m), o = Tb.getAngle(n, k), p = Math.abs(5 * (f + 1) * Math.sin(o)); i = p > i ? p : i, p = Math.abs(5 * (f + 1) * Math.cos(o)), i = p > i ? p : i }Tb.grow(e, i, i) } else Tb.grow(e, f / 2, f / 2); return this.appendGlowBound(this, e), this.appendShadowBound(this, e), e }, getZoomPathRect: function(a, b) { { var c = this._element, d = this.getZoomBodyRect(); this._network.zoomManager.getSizeZoom() }b && Tb.addPadding(d, c, a + '.padding', 1); var e = Jb.cloneRect(d), f = c.getStyle(a + '.outline.width'); if (f > 0) if (this._getZoomPoints) { for (var g = this._getZoomPoints(), h = g.size(), i = 0, j = 0; h > j; j++) { if (j == 0) var k = g.get(j), l = g.get(h - 1), m = g.get(j + 1); else if (j == h - 1) var k = g.get(j), l = g.get(j - 1), m = g.get(0); else var k = g.get(j), l = g.get(j - 1), m = g.get(j + 1); var n = Tb.getCenterPoint(l, m), o = Tb.getAngle(n, k), p = Math.abs(5 * (f + 1) * Math.sin(o)); i = p > i ? p : i, p = Math.abs(5 * (f + 1) * Math.cos(o)), i = p > i ? p : i }Tb.grow(e, i, i) } else Tb.grow(e, f / 2, f / 2); return this.appendGlowBound(this, e), this.appendShadowBound(this, e), e }, paintBody: function(a) { if (this._network.hasEditInteraction() && this._network.isEditable(this._element) && this.isEditable() && this._network.isSelected(this._element)) { var b, c = this._network.getElementBox(), d = c.getDatas(); for (b = 0; b < d.size(); b++) if (d.get(b) instanceof Ib.Link) { var e = d.get(b).getToNode(), f = d.get(b).getFromNode(); c.adjustElementIndex(f), c.adjustElementIndex(e) } } this.curInterval && clearInterval(this.curInterval); var g = this.getStyle('body.type'); g === 'default' ? this.drawDefaultBody(a) : g === 'vector' ? this.drawVectorBody(a) : g === 'default.vector' ? (this.drawVectorBody(a), this.drawDefaultBody(a)) : g === 'vector.default' && (this.drawDefaultBody(a), this.drawVectorBody(a)), this._outerColor && this.getStyle('outer.style') === 'border' && this.drawOuterBorder(a), this.getStyle('select.style') === 'border' && this._network.isSelected(this._element) && this.drawSelectBorder(a) }, drawOuterBorder: function(a) { var b = this._element, c = b.getStyle('outer.width'); if (c > 0) { var d = this.getZoomBodyRect(); Tb.addPadding(d, b, 'outer.padding', 1), a.lineWidth = c, a.lineCap = b.getStyle('outer.cap'), a.lineJoin = b.getStyle('outer.join'), a.strokeStyle = this._outerColor, Xb.drawVector(a, b.getStyle('outer.shape'), null, d), a.stroke() } }, drawDefaultBody: function(a) { var b, c = this._element; if (c.getImage() && (typeof c.getImage() !== 'string' || (b = Jb.getImageAsset(c.getImage())))) { var d = this.getZoomBodyRect(); Tb.addPadding(d, this._element, 'image.padding', 1), c.getAngle() != 0 && (a.save(), d = c.getOriginalRect(), d = this._network.zoomManager._getElementZoomRect(this, d), Ib.Util.rotateCanvas(a, d, c.getAngle())), this.setGlow(this, a), this.setShadow(this, a); if (b && b.getImage() instanceof Hd) { var e, f = b.getImage().frames, g = b.getImage().size, h = 0; e = Jd(f, g, 0), a.drawImage(e, d.x, d.y, d.width, d.height), this.curInterval = setInterval(function() { h = (h + f.length) % f.length, e = Jd(f, g, h), a.drawImage(e, d.x, d.y, d.width, d.height), h++ }, 100) } else Nc(a, c.getImage(), this.getInnerColor(), d, c, this._network); c.getAngle() != 0 && a.restore() } }, drawSelectBorder: function(a) { this.clearGlow(a); var b = this._element, c = b.getStyle('select.width'); if (c > 0) { var d = this.getZoomBodyRect(); d = Jb.cloneRect(d); var e = b.getStyle('select.physicalZoom') ? 1 : this._network.getGraphicsZoom(); Tb.addPadding(d, b, 'select.padding', 1 / e), Tb.grow(d, c / 2 / e, c / 2 / e), a.lineWidth = c / e, a.lineCap = b.getStyle('select.cap'), a.lineJoin = b.getStyle('select.join'), a.strokeStyle = b.getStyle('select.color'), Xb.drawVector(a, b.getStyle('select.shape'), null, d), a.stroke() } }, drawVectorBody: function(a) { this.drawPath(a, 'vector', !0, this._element.getStyle('vector.outline.pattern')); var b = this.getStyle('vector.deep'), c = this.getStyle('vector.fill.color'); if (b !== 0 && c && this.getStyle('vector.shape') === 'rectangle') { var d = this.getZoomBodyRect(), e = this._element.getAngle(); if (e != 0) { a.save(); var f = this._element.getOriginalRect(); f = this._network.zoomManager._getElementZoomRect(this, f), Ib.Util.rotateCanvas(a, f, e) }Xb.draw3DRect(a, c, b, d), e != 0 && a.restore() } }, drawPath: function(a, b, c, d, e, f, g) { var h = this._network.zoomManager, i = this._element, j = null; j = b == 'group' ? this._shapeRect : this.getZoomBodyRect(), c && Tb.addPadding(j, i, b + '.padding', 1); var k = i.getStyle(b + '.outline.width'); this.setGlow(this, a), this.setShadow(this, a), i.getAngle() != 0 && (i instanceof Nd || (j = i.getOriginalRect(), j = h._getElementZoomRect(this, j)), a.save(), Ib.Util.rotateCanvas(a, j, i.getAngle())); var l, m = i.getStyle(b + '.fill'); if (m) { l = this._innerColor && !vc.hasDefault(this._element) ? this._innerColor : i.getStyle(b + '.fill.color'); var n = i.getStyle(b + '.gradient'); n ? Xb.fill(a, l, n, i.getStyle(b + '.gradient.color'), j) : a.fillStyle = l } var o = i.getStyle(b + '.shape'), p = i.getStyle('group.shape.roundrect.radius'); m && (a.beginPath(), e ? Xb.drawLinePoints(a, e, null, f, g) : o === 'roundrect' && b === 'group' ? Xb.drawVector(a, o, null, j, p) : Xb.drawVector(a, o, null, j), a.fill()), k > 0 && (a.lineWidth = k, a.lineCap = i.getStyle(b + '.cap'), a.lineJoin = i.getStyle(b + '.join'), a.strokeStyle = i.getStyle(b + '.outline.color'), a.beginPath(), e ? Xb.drawLinePoints(a, e, d, f, g) : o === 'roundrect' && b === 'group' ? Xb.drawVector(a, o, d, j, p) : Xb.drawVector(a, o, d, j), a.stroke()), i.getAngle() != 0 && a.restore() }, hit: function(a, b) { var c = { x: a, y: b, width: 0, height: 0 }, d = this._network.getSelectionTolerance(); if (d && d > 0 && Tb.grow(c, d, d), this._network._transparentSelectionEnable) { var e = this.getBodyRect(); if (Jb.math.intersects(e, c)) return !0 } return Tb.intersects(this.getZoomViewRect(), c) ? this.hitCanvasPoint(a, b) : !1 }, intersects: function(a) { var b = Ib.vector.NodeUI.superClass.intersects.apply(this, arguments); if (b == 1) return !0; if (this._network._transparentSelectionEnable) { var c = this.getBodyRect(); if (Jb.math.intersects(c, a)) return !0 } return Tb.intersects(a, this.getZoomViewRect()) ? this.hitCanvasRect(a) : !1 } }), Ib.vector.LinkUI = function(a, b) { Ib.vector.LinkUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.LinkUI', Ib.vector.ElementUI, { isEditable: function() { return !0 }, invalidate: function(a) { this._linkPoints = null, this._fromPoint = null, this._toPoint = null, this._angle = null, Ib.vector.LinkUI.superClass.invalidate.call(this, a) }, invalidateZoom: function() { this._fromPoint = null, this._toPoint = null, this._linkPoints = null, Ib.vector.LinkUI.superClass.invalidateZoom.call(this) }, validateImpl: function() { this.validateBodyBounds(), Ib.vector.LinkUI.superClass.validateImpl.call(this) }, validateBodyBounds: function() { var a = this.getLinkPoints(); if (a && !(a.size() < 2)) { var b = this._element, c = Tb.getLineRect(a), d = b.getStyle('link.width'), e = d; if (this._outerColor) { var f = b.getStyle('outer.width'); e += 2 * f } var g = !this._editAttachment && b.getStyle('select.style') === 'border' && this._network.isSelected(this._element); if (g) { var h = b.getStyle('select.width'); e += 2 * h }Tb.grow(c, e / 2, e / 2), b.getStyle('arrow.from') && (this._network._edgeDetect ? (this._network._debug && (this._arrowFromRect = od.getArrowRect(this, a, !0, b.getStyle('arrow.from.shape'), b.getStyle('arrow.from.width'), b.getStyle('arrow.from.height'), 0, 0, this._network.zoomManager)), c = Tb.unionRect(c, od.getArrowRect(this, a, !0, b.getStyle('arrow.from.shape'), b.getStyle('arrow.from.width'), b.getStyle('arrow.from.height'), 0, 0, this._network.zoomManager))) : (this._network._debug && (this._arrowFromRect = od.getArrowRect(this, a, !0, b.getStyle('arrow.from.shape'), b.getStyle('arrow.from.width'), b.getStyle('arrow.from.height'), b.getStyle('arrow.from.xoffset'), b.getStyle('arrow.from.yoffset'), this._network.zoomManager)), c = Tb.unionRect(c, od.getArrowRect(this, a, !0, b.getStyle('arrow.from.shape'), b.getStyle('arrow.from.width'), b.getStyle('arrow.from.height'), b.getStyle('arrow.from.xoffset'), b.getStyle('arrow.from.yoffset'), this._network.zoomManager)))), b.getStyle('arrow.to') && (this._network._edgeDetect ? (this._network._debug && (this._arrowToRect = od.getArrowRect(this, a, !1, b.getStyle('arrow.to.shape'), b.getStyle('arrow.to.width'), b.getStyle('arrow.to.height'), 0, 0, this._network.zoomManager)), c = Tb.unionRect(c, od.getArrowRect(this, a, !1, b.getStyle('arrow.to.shape'), b.getStyle('arrow.to.width'), b.getStyle('arrow.to.height'), 0, 0, this._network.zoomManager))) : (this._network._debug && (this._arrowToRect = od.getArrowRect(this, a, !1, b.getStyle('arrow.to.shape'), b.getStyle('arrow.to.width'), b.getStyle('arrow.to.height'), b.getStyle('arrow.to.xoffset'), b.getStyle('arrow.to.yoffset'), this._network.zoomManager)), c = Tb.unionRect(c, od.getArrowRect(this, a, !1, b.getStyle('arrow.to.shape'), b.getStyle('arrow.to.width'), b.getStyle('arrow.to.height'), b.getStyle('arrow.to.xoffset'), b.getStyle('arrow.to.yoffset'), this._network.zoomManager)))), this.appendShadowBound(this, c), this.addBodyBounds(c), this._growLinkJoinBounds(c, e) } }, _growLinkJoinBounds: function(a, b) {}, createBodyRect: function() { var a = this.getHotSpot(); return a ? { x: a.x - 1, y: a.y - 1, width: 2, height: 2 } : null }, paintBody: function(a) { if (this._network.hasEditInteraction() && this._network.isEditable(this._element) && this.isEditable()) { if (this._network.isSelected(this._element)) { var b, c, d = this._network.getElementBox(), e = d.getDatas(); for (c = 0; c < e.size(); c++) if (e.get(c) instanceof Ib.Link) { var f = e.get(c).getToNode(), g = e.get(c).getFromNode(); d.adjustElementIndex(g), d.adjustElementIndex(f) }b = d.getDatas().indexOf(this._element), d.getDatas().removeAt(b), d.getDatas().add(this._element) } } else if (this._network.isSelected(this._element)) { var d = this._network.getElementBox(), f = this._element.getToNode(), g = this._element.getFromNode(); d.adjustElementIndex(g), d.adjustElementIndex(f) } var h = this.getLinkPoints(); if (h && !(h.size() < 2)) { var i = this._element, j = i.getStyle('link.width'), k = j; if (this._outerColor && this.getStyle('outer.style') === 'border') { var l = i.getStyle('outer.width'); k += 2 * l } var m = !this._editAttachment && i.getStyle('select.style') === 'border' && this._network.isSelected(this._element); if (m) { var n = i.getStyle('select.width'); k += 2 * n } this.setGlow(this, a), this.setShadow(this, a), a.lineCap = i.getStyle('link.cap'), a.lineJoin = i.getStyle('link.join'); var o = i.getStyle('link.pattern'); m && this.drawLinePoints(a, h, k, i.getStyle('select.color'), o), this._outerColor && this.getStyle('outer.style') === 'border' && this.drawLinePoints(a, h, j + 2 * l, this._outerColor, o), this.drawLinePoints(a, h, j, this._innerColor || i.getStyle('link.color'), o), od.drawLinkArrow(this, a, h, this._network.zoomManager) } }, drawLinePoints: function(a, b, c, d, e) { if (a.lineWidth = c, a.strokeStyle = d, this._element.getStyle('link.flow') === !0 && e && e.length > 1) { var f = new uc(a, e[0], e[1]), g = this._element.getStyle('link.flow.offset'), h = Math.floor(g / (e[0] + e[1])); h > 2 && (g -= (e[0] + e[1]) * h), this._element.getStyle('link.flow.converse') ? g < e[0] ? f.overflow = e[0] - g : g >= e[0] && g <= e[0] + e[1] ? (f.overflow = e[1] - (g - e[0]), f.overflow && (f.isLine = !1)) : (g -= e[0] + e[1], f.overflow = e[0] - g) : g <= e[1] ? (f.overflow = g, g && (f.isLine = !1)) : g > e[1] && g <= e[0] + e[1] ? f.overflow = g - e[1] : (g -= e[0] + e[1], g && (f.isLine = !1), f.overflow = g), this._element._styleMap['link.flow.offset'] = g, a.beginPath(), Xb._drawLine(b, a), a.stroke(), a.shadowColor = 'transparent', a.beginPath(); var i = this._element.getStyle('link.flow.color'); i = i || Ed.NETWORK_LINK_FLOW_COLOR, a.strokeStyle = i, Xb._drawLine(b, f), a.stroke(), a.shadowColor = this._shadowColor } else a.beginPath(), Xb.drawLinePoints(a, b, e), a.stroke() }, getLinkPoints: function() { return this._linkPoints || (this._linkPoints = this.createLinkPoints(), this._lineLength = Tb.calculateLineLength(this._linkPoints)), this._linkPoints }, getFromPosition: function(a, b) { var c = this.getFromPoint(); return c ? { x: c.x + a, y: c.y + b } : null }, getToPosition: function(a, b) { var c = this.getToPoint(); return c ? { x: c.x + a, y: c.y + b } : null }, getFromPoint: function() { return this._fromPoint || (this._fromPoint = xc.createFromPoint(this, this._network.zoomManager)), this._fromPoint }, getToPoint: function() { return this._toPoint || (this._toPoint = xc.createToPoint(this, this._network.zoomManager)), this._toPoint }, getZoomBodyRect: function() { return this.getBodyRect() }, getZoomViewRect: function() { return this._viewRect }, createLinkPoints: function() { var a = this._network.zoomManager, b = this.getStyle('link.type'), c = new Ib.List(); if (xc.isOrthogonalOrFlexionalLink(this._element))c = xc.orthogonalAndFlexional(this, b, a); else if (this._element.isLooped()) { var d = this._network.getElementUI(this._element.getFromAgent()); d != null && (this._hotSpot = xc.fillLoopedPoints(this, d.getZoomBodyRect(), c)) } else { if (b !== 'arc' && b !== 'triangle' && b !== 'parallel') throw "Can not resolve link type '" + b + "'"; var e = this.getFromPoint(), f = this.getToPoint(); this._hotSpot = xc.fillBundlePoints(this, b, e, f, c, a) } if (this._network._linkPathFunction) { var g = this._network._linkPathFunction(this, c); g && (c = g) } return c }, checkAttachments: function() { Ib.vector.LinkUI.superClass.checkAttachments.call(this), this.checkLinkHandlerAttachment() }, checkLinkHandlerAttachment: function() { var a = this._network.getLinkHandlerLabel(this._element); a != null && a !== '' ? this._linkHandlerAttachment || (this._linkHandlerAttachment = new Ib.vector.LinkHandlerAttachment(this), this.addAttachment(this._linkHandlerAttachment)) : this._linkHandlerAttachment && (this.removeAttachment(this._linkHandlerAttachment), this._linkHandlerAttachment = null) }, getLinkHandlerAttachment: function() { return this._linkHandlerAttachment }, getControlPoint: function() { return xc.getControlPoint(this._element, this, this._network.zoomManager) }, setControlPoint: function(a) { if (a) { var b = this.getStyle('link.type'); if (xc.hasControlPoint(b)) { var c = xc.getLinkSourceBounds(this, this._network.zoomManager), d = xc.getLinkTargetBounds(this, this._network.zoomManager); xc.setParamsByControlPoint(a, c, d, b, this._element) } } }, getLineLength: function() { return this._lineLength }, hit: function(a, b) { var c = { x: a, y: b, width: 0, height: 0 }, d = this._network.getSelectionTolerance(); return d && d > 0 && Tb.grow(c, d, d), Tb.intersects(this._viewRect, c) ? this.hitCanvasPoint(a, b) : !1 }, intersects: function(a) { var b = Ib.vector.NodeUI.superClass.intersects.apply(this, arguments); if (b == 1) return !0; if (Tb.intersects(a, this._viewRect) == 0) return !1; var c = this.getLinkPoints(), d = c.size(); if (d == 2) for (var e = 0; d > e; e += 2) { var f = c.get(e); if (d > e + 1) { var g = c.get(e + 1); if (Od.intersectsLine(f.x, f.y, g.x, g.y, a.x, a.y, a.width, a.height)) return !0 } } return this.hitCanvasRect(a) }, getAngle: function() { return !this._angle && this._fromPoint && this._toPoint && (this._angle = Tb.getAngle(this._fromPoint, this._toPoint)), this._angle || 0 }, getAbsoluteAngle: function() { var a = { x: 10, y: 0 }, b = this._fromPoint, c = this._toPoint, d = { x: c.x - b.x, y: c.y - b.y }, e = 180 * Math.acos((d.x * a.x + d.y * a.y) / (Math.sqrt(a.x * a.x + a.y * a.y) * Math.sqrt(d.x * d.x + d.y * d.y))) / Math.PI; return e = b.y <= c.y ? e : 360 - e, e = e % 360 * Math.PI / 180 }, appendShadowBound: function(a, b) { var c = a.isShadowable() && this._shadowColor && !this._editAttachment; if (c) { this._shadowXOffset > 0 ? b.width += this._shadowXOffset : (b.x += this._shadowXOffset, b.width += -this._shadowXOffset), this._shadowYOffset > 0 ? b.height += this._shadowYOffset : (b.y += this._shadowYOffset, b.height += -this._shadowYOffset); var d = this._shadowBlur; Tb.grow(b, d + 1, d + 1) } return b } }), Ib.vector.GroupUI = function(a, b) { Ib.vector.GroupUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.GroupUI', Ib.vector.NodeUI, { isEditable: function() { return !this._element.isExpanded() }, paintBody: function(a) { this._shapeRect ? this.drawExpandedGroup(a) : Ib.vector.GroupUI.superClass.paintBody.apply(this, arguments) }, validateBodyBounds: function() { if (this.getBodyRect(), this._shapeRect) { var a = this.getPathRect('group', !1), b = this.getStyle('group.deep'); Tb.grow(a, b + 1, b + 1), this.addBodyBounds(a) } else Ib.vector.GroupUI.superClass.validateBodyBounds.call(this) }, getZoomBodyRect: function() { return this._element.isExpanded() ? this.getBodyRect() : Ib.vector.GroupUI.superClass.getZoomBodyRect.call(this) }, getZoomViewRect: function() { return this._element.isExpanded() ? this.getViewRect() : Ib.vector.GroupUI.superClass.getZoomViewRect.call(this) }, drawExpandedGroup: function(a) { this.drawPath(a, 'group', !1, this._element.getStyle('vector.outline.pattern')); var b = this.getStyle('group.deep'), c = this.getStyle('group.fill.color'); b !== 0 && c && this.getStyle('group.shape') === 'rectangle' && Xb.draw3DRect(a, c, b, this._shapeRect) }, getChildrenRects: function() { return this._network.getGroupChildrenRects(this._element) }, createBodyRect: function() { this._shapeRect = null; var a = this._element, b = this._network; if (a.isExpanded()) { a.getChildren().forEach(function(a) { var c = b.getElementUI(a); c && c.validate() }); var c = this.getChildrenRects(); if (!c.isEmpty()) { var d = a.getStyle('group.shape'), e = Ub[d]; if (!e) throw "Can not resolve group shape '" + d + "'"; this._shapeRect = e(c) } } return this._shapeRect ? (Tb.addPadding(this._shapeRect, a, 'group.padding', 1), this._shapeRect) : Ib.vector.GroupUI.superClass.createBodyRect.call(this) }, appendShadowBound: function(a, b) { var c = a.isShadowable() && this._shadowColor && !this._editAttachment; if (c) { this._shadowXOffset > 0 ? b.width += this._shadowXOffset : (b.x += this._shadowXOffset, b.width += -this._shadowXOffset), this._shadowYOffset > 0 ? b.height += this._shadowYOffset : (b.y += this._shadowYOffset, b.height += -this._shadowYOffset); var d = this._shadowBlur; Tb.grow(b, d + 1, d + 1) } return b } }), Ib.vector.ShapeNodeUI = function(a, b) { Ib.vector.ShapeNodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.ShapeNodeUI', Ib.vector.NodeUI, { getDefaultBodyRect: function() { return this._element._points.size() < 2 ? null : this._reverseZoomPathRect() }, drawDefaultBody: function(a) { this._element._points.size() < 2 || (this.drawPath(a, 'vector', !0, this._element.getStyle('vector.outline.pattern'), this._getZoomPoints(), this._element._segments, this._element.getStyle('shapenode.closed')), od.drawLinkArrow(this, a, Tb.getPointObject(this._element._points, this._element._segments))) }, invalidateZoom: function() { this._zoomPoints = null, Ib.vector.LinkUI.superClass.invalidateZoom.call(this) }, _getZoomPoints: function() { return this._zoomPoints = this._network.zoomManager._getShapeNodeZoomPoints(this, this._element._points), this._zoomPoints }, _reverseZoomPathRect: function() { return this._network.zoomManager._reverseElementZoomRect(this, this.getZoomPathRect('vector', !0)) } }), Ib.vector.ShapeLinkUI = function(a, b) { Ib.vector.ShapeLinkUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.ShapeLinkUI', Ib.vector.LinkUI, { isEditable: function() { return !0 }, createLinkPoints: function() { var a = this.getFromPoint(), b = this.getToPoint(), c = new Ib.List(), d = this.getStyle('shapelink.type'); c.add(a), this._element._points != null && c.addAll(this._network.zoomManager._getShapeLinkZoomPoints(this._element._points)), c.add(b); var e, f, g; if (d === 'lineto');else if (d === 'quadto') { for (e = new Ib.List(c.get(0)), f = 1, pointCount = c.size(); f < pointCount; f++)e.add(f < pointCount - 1 ? new Ib.List([c.get(f++), c.get(f)]) : c.get(f)); c = e } else if (d === 'cubicto') { for (e = new Ib.List(c.get(0)), f = 1, pointCount = c.size(); f < pointCount; f++)e.add(f < pointCount - 2 ? new Ib.List([c.get(f++), c.get(f++), c.get(f)]) : f < pointCount - 1 ? new Ib.List([c.get(f++), c.get(f)]) : c.get(f)); c = e } else { if (d !== 'orthogonalto') throw "Can not resolve shapelink type '" + d + "'"; for (g = c.get(0), e = new Ib.List(g), f = 1, pointCount = c.size(); f < pointCount; f++) if (f < pointCount - 1) { var h = Jb.clone(c.get(f)), i = h.x, j = h.y, k = i - g.x, l = j - g.y; Math.abs(k) > Math.abs(l) ? (h.x = i, h.y = g.y) : (h.x = g.x, h.y = j), g = h, e.add(g) } else e.add(c.get(f)); c = e } var m, n, o, h, p, k, l, q = Tb.calculateLineLength(c) / 2, r = c.size(), s = 0, t = 0; for (m = 0; r > m; m++) if (h = c.get(m), m != 0) { if (o = h, o instanceof nd && (o = o._as), o instanceof Array ? (p = Tb.calculateCurveLength(n, o, 1), n = o[o.length - 1]) : (l = h.y - n.y, k = h.x - n.x, p = Math.sqrt(k * k + l * l), n = o), t += p, q >= s && t >= q) { var u = q - s, v = c.get(m - 1); v instanceof nd && (v = v._as, v instanceof Array && (v = v[v.length - 1])); var w = c.get(m), x = Tb.getPathInfo(w, v, u, 0, -1).point; this._hotSpot = Jb.clone(x) }s = t } else n = h; return c }, _growLinkJoinBounds: function(a, b) { Tb.grow(a, 3 * b, 3 * b) } }), Ib.vector.GridUI = function(a, b) { Ib.vector.GridUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.GridUI', Ib.vector.NodeUI, { drawDefaultBody: function(a) { this._element.getImage() ? Ib.vector.GridUI.superClass.drawDefaultBody.apply(this, arguments) : this.drawGridBody(a) }, validateBodyBounds: function() { if (this._element.getImage())Ib.vector.GridUI.superClass.validateBodyBounds.call(this); else { var a = this.getBodyRect(), b = Jb.clone(a), c = this._element.getStyle('outer.width'); Tb.grow(b, c, c), this.appendShadowBound(this, b), this.addBodyBounds(b) } }, _getZoomCellRect: function(a, b) { var c = this._element.getCellRect(a, b), d = this._element.getRect(), e = d.x + d.width / 2, f = d.y + d.height / 2, g = this.getZoomBodyRect(), h = g.width / d.width, i = g.x + g.width / 2, j = e == 0 ? 1 : i / e; return { x: e * j + (c.x - e) * h, y: f * j + (c.y - f) * h, width: c.width * h, height: c.height * h } }, drawGridBody: function(a) { var b = this.getStyle('grid.fill'), c = this.getStyle('grid.deep'), d = this.getStyle('grid.cell.deep'); if (b || c !== 0 || d !== 0) { a.beginPath(); var e = this.getZoomBodyRect(), f = this.getDyeColor('grid.fill.color'); if (this.setGlow(this, a), this.setShadow(this, a), b && (a.fillStyle = f, a.rect(e.x, e.y, e.width, e.height), a.fill()), a.closePath(), this.clearShadow(a), a.beginPath(), c != 0 && Xb.draw3DRect(a, f, c, e.x, e.y, e.width, e.height), a.closePath(), d != 0) for (var g = this.getStyle('grid.row.count'), h = this.getStyle('grid.column.count'), i = 0; g > i; i++) for (var j = 0; h > j; j++) { var k = this._getZoomCellRect(i, j); k != null && (a.beginPath(), Xb.draw3DRect(a, f, d, k.x, k.y, k.width, k.height), a.closePath()) } } } }), Ib.vector.RotatableNodeUI = function(a, b) { Ib.vector.RotatableNodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.RotatableNodeUI', Ib.vector.NodeUI, { isEditable: function() { return !1 }, getDefaultBodyRect: function() { var a = this._element, b = Jb.getImageAsset(a.getImage()), c = this.getBodyRect(); return b ? (Tb.addPadding(c, this._element, 'image.padding', 1), c) : c }, drawDefaultBody: function(a) { var b = this._element, c = Jb.getImageAsset(b.getImage()); if (c) { var d = this.getBodyRect(); if (Tb.addPadding(d, this._element, 'image.padding', 1), c.getImage()) { var e = this._element._getOrignalWidth(), f = this._element._getOrignalHeight(), g = this._element._getRotateRect(); a.save(), a.translate(d.x - g.x + e / 2, d.y - g.y + f / 2), a.rotate(this._element._angle * Math.PI / 180), a.drawImage(c.getImage(this._innerColor), -e / 2, -f / 2, e, f), a.restore() } else if (c.getSrc());else if (!c.getFunction()) throw "ImageAsset '" + b.getImage() + " ' is empty" } } }), Ib.vector.HTMLNodeUI = function(a, b) { Ib.vector.HTMLNodeUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.HTMLNodeUI', Ib.vector.NodeUI, { checkAttachments: function() { Ib.vector.NodeUI.prototype.checkAttachments.call(this) }, checkLabelAttachment: function() { var a = this._element.getStyle('attachment.label.style'); if (a && a === 'none') return void Ib.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this); var b = this._network.getLabel(this._element); b != null && b !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.vector.HTMLLabelAttachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkLabel2Attachment: function() { var a = this._element.getStyle('attachment.label2.style'); if (a && a === 'none') return void Ib.vector.HTMLNodeUI.superClass.checkLabel2Attachment.call(this); var b = this._network.getLabel2(this._element); b != null && b !== '' ? this._label2Attachment || (this._label2Attachment = new Ib.vector.HTMLLabel2Attachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._label2Attachment)) : this._label2Attachment && (this.removeAttachment(this._label2Attachment), this._label2Attachment = null) }, checkAlarmAttachment: function() { var a = this._element.getStyle('attachment.alarm.style'); if (a && a === 'none') return void Ib.vector.HTMLNodeUI.superClass.checkAlarmAttachment.call(this); var b = this._network.getAlarmLabel(this._element); b != null && b !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.vector.HTMLAlarmAttachment(this, !1), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) }, setAttachmentVisible: function(a) { a ? (this._labelAttachment && this._labelAttachment.setVisibility('visible'), this._label2Attachment && this._label2Attachment.setVisibility('visible'), this._alarmAttachment && this._alarmAttachment.setVisibility('visible')) : (this._labelAttachment && this._labelAttachment.setVisibility('hidden'), this._label2Attachment && this._label2Attachment.setVisibility('hidden'), this._alarmAttachment && this._alarmAttachment.setVisibility('hidden')) }, validateZIndex: function(a) { this._labelAttachment && this._labelAttachment.validateZIndex(a) } }), Ib.vector.HTMLLinkUI = function(a, b) { Ib.vector.HTMLLinkUI.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.HTMLLinkUI', Ib.vector.LinkUI, { checkAttachments: function() { Ib.vector.LinkUI.prototype.checkAttachments.call(this) }, checkLabelAttachment: function() { var a = this._element.getStyle('attachment.label.style'); if (a && a === 'none') return void Ib.vector.HTMLLinkUI.superClass.checkLabelAttachment.call(this); var b = this._network.getLabel(this._element); b != null && b !== '' ? this._labelAttachment || (this._labelAttachment = new Ib.vector.HTMLLabelAttachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._labelAttachment)) : this._labelAttachment && (this.removeAttachment(this._labelAttachment), this._labelAttachment = null) }, checkLabel2Attachment: function() { var a = this._element.getStyle('attachment.label2.style'); if (a && a === 'none') return void Ib.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this); var b = this._network.getLabel2(this._element); b != null && b !== '' ? this._label2Attachment || (this._label2Attachment = new Ib.vector.HTMLLabel2Attachment(this, Ed.SHOW_LABEL_IN_ATTACHMENT_DIV), this.addAttachment(this._label2Attachment)) : this._label2Attachment && (this.removeAttachment(this._label2Attachment), this._label2Attachment = null) }, checkAlarmAttachment: function() { var a = this._element.getStyle('attachment.alarm.style'); if (a && a === 'none') return void Ib.vector.HTMLLinkUI.superClass.checkAlarmAttachment.call(this); var b = this._network.getAlarmLabel(this._element); b != null && b !== '' ? this._alarmAttachment || (this._alarmAttachment = new Ib.vector.HTMLAlarmAttachment(this, !1), this.addAttachment(this._alarmAttachment)) : this._alarmAttachment && (this.removeAttachment(this._alarmAttachment), this._alarmAttachment = null) }, setAttachmentVisible: function(a) { a ? (this._labelAttachment && this._labelAttachment.setVisibility('visible'), this._label2Attachment && this._label2Attachment.setVisibility('visible'), this._alarmAttachment && this._alarmAttachment.setVisibility('visible')) : (this._labelAttachment && this._labelAttachment.setVisibility('hidden'), this._label2Attachment && this._label2Attachment.setVisibility('hidden'), this._alarmAttachment && this._alarmAttachment.setVisibility('hidden')) } }), Ib.vector.Attachment = function(a, b) { this._ui = a, this._element = this._ui.getElement(), this._network = a.getNetwork(), this._showOnTop = b, b && this._network._hitTestTopAttachmentList.add(this) }, Jb.ext('twaver.vector.Attachment', Object, { getElement: function() { return this._element }, getElementUI: function() { return this._ui }, getNetwork: function() { return this._network }, isShowOnTop: function() { return this._showOnTop === !0 }, setShowOnTop: function(a) { this._showOnTop = a }, getStyle: function(a) { return this._ui.getStyle(a) }, getFont: function(a) { return this._ui.getFont(a) }, getViewRect: function() { return Jb.clone(this._viewRect) }, getAlpha: function() { return 1 }, validate: function() {}, paint: function(a) {}, getZoomViewRect: function() { var a = this._network.zoomManager._getAttachmentZoomOutLineRect(this, this._viewRect); return a }, hit: function(a, b) { return Tb.containsPoint(this.getZoomViewRect(), a, b) ? this.hitCanvasRect({ x: a - 1, y: b - 1, width: 2, height: 2 }) : !1 }, hitCanvasRect: function(a) { var b = Od.getHitCanvas(a.width, a.height), c = Od.getCtx(b); c.save(), c.translate(-a.x, -a.y), this.paint(c); try { for (var d = c.getImageData(0, 0, a.width, a.height), e = d.data, f = 0; f < d.width; f++) for (var g = 0; g < d.height; g++) { var h = 4 * (g * d.width + f), i = e[h + 3]; if (i !== 0) return c.restore(), !0 } } catch (j) { Od.disposeHitCanvas() } return c.restore(), !1 }, dispose: function() { this._network._hitTestTopAttachmentList.remove(this) }, _rotatePoint: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x + c.width / 2, c.y + c.height / 2), e = d.transform(a); return e }, _rotatePointList: function(a, b, c) { var d = this, e = new Ib.List(); return a.forEach(function(a) { e.add(d._rotatePoint(a, b, c)) }), e } }), Ib.vector.BasicAttachment = function(a, b) { Ib.vector.BasicAttachment.superClass.constructor.call(this, a, b), this._roundRect = { x: 0, y: 0, width: 0, height: 0 }, this._contentRect = { x: 0, y: 0, width: 0, height: 0 } }, Jb.ext('twaver.vector.BasicAttachment', Ib.vector.Attachment, { paint: function(a) {
    Ib.vector.BasicAttachment.superClass.paint.apply(this, arguments); var b = this.isFill(), c = this.getOutlineWidth(), d = this._network.zoomManager._getAttachmentZoomOutLineRect(this, this._roundRect); if (this.getElementUI().setGlow(this, a), this.getElementUI().setShadow(this, a),
      c > 0 || b) { if (Xb.drawRoundRect(a, d.x, d.y, d.width, d.height, this.getCornerRadius()), this._network._debug && Xb.strokeRect(a, d, '#C71585'), this._pointers) { var e = this._ui.getZoomPointers(this, this._pointers); a.moveTo(e[0].x, e[0].y), a.lineTo(e[1].x, e[1].y), a.lineTo(e[2].x, e[2].y) } if (a.closePath(), c > 0 && (a.lineWidth = c, a.strokeStyle = this.getOutlineColor(), a.lineCap = this.getCap(), a.lineJoin = this.getJoin(), a.stroke()), b) { var f = this.getFillColor(), g = this.getGradient(); g ? Xb.fill(a, f, g, this.getGradientColor(), this._viewRect) : a.fillStyle = f, a.fill() } }
  }, validate: function() { Ib.vector.BasicAttachment.superClass.validate.call(this), this.calculateMeasure(); var a = this.getOutlineWidth(); (a == null || a <= 0) && (a = 1), this._viewRect = Tb.getRect(this._pointers), this._viewRect = Tb.unionRect(this._viewRect, this._roundRect), a > 0 && Tb.grow(this._viewRect, 2 * a, 2 * a), this._viewRect = this._ui.appendShadowBound(this, this._viewRect); var b = this._element instanceof Ib.Link && this._element.getStyle('link.label.rotatable'); if (b) { var c = this._viewRect.x + this._viewRect.width / 2, d = this._viewRect.y + this._viewRect.height / 2, e = Math.sqrt(this._viewRect.height * this._viewRect.height + this._viewRect.width * this._viewRect.width); this._viewRect = { x: c - e, y: d - e, width: 2 * e, height: 2 * e } } }, calculateMeasure: function() { var a = this.getContentWidth(), b = this.getContentHeight(), c = this.getCornerRadius(), d = this.getPointerLength(), e = this.getPointerWidth(), f = this.getPosition(), g = this.getXOffset(), h = this.getYOffset(), i = this._roundRect; i.width = a + c, i.height = b; var j; if (this._ui._element instanceof Ib.Link) { var k, l = this._ui.getLinkPoints(); k = this._ui.getLineLength ? this._ui.getLineLength() : this._ui._element.getLineLength(), Math.abs(g) > 0 && Math.abs(g) < 1 ? f === 'from' ? g *= k : f === 'to' ? g = k * (1 - g) : (g /= 2, g += 0.5, g *= k) : f === 'from' ? g = g : f === 'to' ? g = k - g : g += k / 2; { var m, n = Tb.calculatePointInfoAlongLine(l, !0, g, h), o = n.point; n.angle }m = f === 'from' ? this._ui.getFromPoint() : f === 'to' ? this._ui.getToPoint() : this._ui._hotSpot, g = o.x - m.x, h = o.y - m.y } if (d > 0) { var p = this.getDirection(); j = this._network.getPosition(f, this._ui, null, g, h, !1); var q; if (p === 'aboveleft')i.y = j.y - d - i.height, i.x = j.x - (i.width - c), q = Math.max(j.x - e, j.x - (i.width - c) + c / 2), this._pointers = [j, { x: j.x, y: j.y - d }, { x: q, y: j.y - d }]; else if (p === 'aboveright')i.y = j.y - d - i.height, i.x = j.x - c, q = Math.min(j.x + e, j.x - c + i.width - c / 2), this._pointers = [j, { x: j.x, y: j.y - d }, { x: q, y: j.y - d }]; else if (p === 'belowleft')i.y = j.y + d, i.x = j.x - (i.width - c), q = Math.max(j.x - e, j.x - (i.width - c) + c / 2), this._pointers = [j, { x: j.x, y: j.y + d }, { x: q, y: j.y + d }]; else if (p === 'belowright')i.y = j.y + d, i.x = j.x - c, q = Math.min(j.x + e, j.x - c + i.width - c / 2), this._pointers = [j, { x: j.x, y: j.y + d }, { x: q, y: j.y + d }]; else if (p === 'leftabove')i.y = j.y + c - i.height, i.x = j.x - d - i.width, q = Math.max(j.y - e, j.y + c - i.height + c / 2), this._pointers = [j, { x: j.x - d, y: j.y }, { x: j.x - d, y: q }]; else if (p === 'leftbelow')i.y = j.y - c, i.x = j.x - d - i.width, q = Math.min(j.y + e, j.y - c + i.height - c / 2), this._pointers = [j, { x: j.x - d, y: j.y }, { x: j.x - d, y: q }]; else if (p === 'rightabove')i.y = j.y + c - i.height, i.x = j.x + d, q = Math.max(j.y - e, j.y + c - i.height + c / 2), this._pointers = [j, { x: j.x + d, y: j.y }, { x: j.x + d, y: q }]; else if (p === 'rightbelow')i.y = j.y - c, i.x = j.x + d, q = Math.min(j.y + e, j.y - c + i.height - c / 2), this._pointers = [j, { x: j.x + d, y: j.y }, { x: j.x + d, y: q }]; else if (p === 'above')i.y = j.y - d - i.height, i.x = j.x - i.width / 2, q = Math.min(a / 2, e / 2), this._pointers = [j, { x: j.x - q, y: j.y - d }, { x: j.x + q, y: j.y - d }]; else if (p === 'below')i.y = j.y + d, i.x = j.x - i.width / 2, q = Math.min(a / 2, e / 2), this._pointers = [j, { x: j.x - q, y: j.y + d }, { x: j.x + q, y: j.y + d }]; else if (p === 'left')i.y = j.y - i.height / 2, i.x = j.x - d - i.width, q = Math.min(b / 2, e / 2), this._pointers = [j, { x: j.x - d, y: j.y + q }, { x: j.x - d, y: j.y - q }]; else { if (p !== 'right') throw "Can not resolve '" + p + "' attachment direction"; i.y = j.y - i.height / 2, i.x = j.x + d, q = Math.min(b / 2, e / 2), this._pointers = [j, { x: j.x + d, y: j.y + q }, { x: j.x + d, y: j.y - q }] } } else j = this._network.getPosition(f, this._ui, { width: i.width, height: i.height }, g, h, !1), i.x = j.x, i.y = j.y, this._pointers = null; this._contentRect.x = i.x + (i.width - a) / 2, this._contentRect.y = i.y + (i.height - b) / 2, this._contentRect.width = a, this._contentRect.height = b; var r = this.getPadding(); r != 0 && Tb.grow(i, r, r), r = this.getPaddingLeft(), r != 0 && (i.x -= r, i.width += r), r = this.getPaddingRight(), r != 0 && (i.width += r), r = this.getPaddingTop(), r != 0 && (i.y -= r, i.height += r), r = this.getPaddingBottom(), r != 0 && (i.height += r), i.width < 0 && (i.width = i.width, i.x -= i.width), i.height < 0 && (i.height = -i.height, i.y -= i.height) }, getContentWidth: function() { return Ib.Defaults.ATTACHMENT_CONTENT_WIDTH }, getContentHeight: function() { return Ib.Defaults.ATTACHMENT_CONTENT_HEIGHT }, getCornerRadius: function() { return Ib.Defaults.ATTACHMENT_CORNER_RADIUS }, getPointerLength: function() { return Ib.Defaults.ATTACHMENT_POINTER_LENGTH }, getPointerWidth: function() { return Ib.Defaults.ATTACHMENT_POINTER_WIDTH }, getPosition: function() { return Ib.Defaults.ATTACHMENT_POSITION }, getXOffset: function() { return Ib.Defaults.ATTACHMENT_XOFFSET }, getYOffset: function() { return Ib.Defaults.ATTACHMENT_YOFFSET }, getPadding: function() { return Ib.Defaults.ATTACHMENT_PADDING }, getPaddingLeft: function() { return Ib.Defaults.ATTACHMENT_PADDING_LEFT }, getPaddingRight: function() { return Ib.Defaults.ATTACHMENT_PADDING_RIGHT }, getPaddingTop: function() { return Ib.Defaults.ATTACHMENT_PADDING_TOP }, getPaddingBottom: function() { return Ib.Defaults.ATTACHMENT_PADDING_BOTTOM }, getDirection: function() { return Ib.Defaults.ATTACHMENT_DIRECTION }, isFill: function() { return Ib.Defaults.ATTACHMENT_FILL }, getFillColor: function() { return Ib.Defaults.ATTACHMENT_FILL_COLOR }, getGradient: function() { return Ib.Defaults.ATTACHMENT_GRADIENT }, getGradientColor: function() { return Ib.Defaults.ATTACHMENT_GRADIENT_COLOR }, getOutlineWidth: function() { return Ib.Defaults.ATTACHMENT_OUTLINE_WIDTH }, getOutlineColor: function() { return Ib.Defaults.ATTACHMENT_OUTLINE_COLOR }, getCap: function() { return Ib.Defaults.ATTACHMENT_CAP }, getJoin: function() { return Ib.Defaults.ATTACHMENT_JOIN }, isShadowable: function() { return Ib.Defaults.ATTACHMENT_SHADOWABLE }, getRoundRect: function() { return Jb.clone(this._roundRect) }, getContentRect: function() { return Jb.clone(this._contentRect) } }), Ib.vector.LabelAttachment = function(a, b) { Ib.vector.LabelAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.LabelAttachment', Ib.vector.BasicAttachment, { paint: function(a) { var b = this._element instanceof Ib.Link && this._element.getStyle('link.label.rotatable'); if (b) { a.save(); var c = this.getZoomViewRect(), d = c.x + c.width / 2, e = c.y + c.height / 2; a.translate(d, e), a.rotate(this._network.getElementUI(this._element).getAngle()), a.translate(-d, -e) }Ib.vector.LabelAttachment.superClass.paint.apply(this, arguments); var f = this._network.zoomManager, g = f._getAttachmentZoomRect(this, this._contentRect), h = this._element.getStyle('label.align'), i = this._element && this._element.getStyle('label.rotate.angle'); if (i !== 0 && (a.save(), Ib.Util.rotateCanvas(a, this._contentRect, i)), f._drawText(this, a, this.text, g, this.font, this.getStyle('label.color'), h), (b || i !== 0) && a.restore(), this._network._debug) { var j = this._viewRect; Xb.strokeRect(a, j, '#AAABBB') } }, validate: function() { this.font = this.getFont('label.font'); var a = this.getLabel(), b = Jb.g.getTextSize(this.font, a), c = this.getMaxLength(); c !== 0 && b.width > c ? (this.text = Jb.g.getCollapseTextInLength(this.font, a, c), this._textSize = Jb.g.getTextSize(this.font, this.text)) : (this.text = a, this._textSize = b), Ib.vector.LabelAttachment.superClass.validate.call(this); var d = this._viewRect, e = this._element && this._element.getStyle('label.rotate.angle'); if (e !== 0) { var f = new Ib.List(); f.add({ x: d.x, y: d.y }), f.add({ x: d.x + d.width, y: d.y }), f.add({ x: d.x + d.width, y: d.y + d.height }), f.add({ x: d.x, y: d.y + d.height }), f = this._rotatePointList(f, e, d); var g = Ib.Util.getRect(f); this._viewRect = g } }, getLabel: function() { return this._network.getLabel(this._element) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('label.corner.radius') }, getPointerLength: function() { return this.getStyle('label.pointer.length') }, getPointerWidth: function() { return this.getStyle('label.pointer.width') }, getPosition: function() { return this.getStyle('label.position') }, getXOffset: function() { return this.getStyle('label.xoffset') }, getYOffset: function() { return this.getStyle('label.yoffset') }, getPadding: function() { return this.getStyle('label.padding') }, getPaddingLeft: function() { return this.getStyle('label.padding.left') }, getPaddingRight: function() { return this.getStyle('label.padding.right') }, getPaddingTop: function() { return this.getStyle('label.padding.top') }, getPaddingBottom: function() { return this.getStyle('label.padding.bottom') }, getDirection: function() { return this.getStyle('label.direction') }, isFill: function() { return this.getStyle('label.fill') }, getFillColor: function() { return this.getStyle('label.fill.color') }, getGradient: function() { return this.getStyle('label.gradient') }, getGradientColor: function() { return this.getStyle('label.gradient.color') }, getOutlineWidth: function() { return this.getStyle('label.outline.width') }, getOutlineColor: function() { return this.getStyle('label.outline.color') }, getCap: function() { return this.getStyle('label.cap') }, getJoin: function() { return this.getStyle('label.join') }, getAlpha: function() { return this.getStyle('label.alpha') }, getMaxLength: function() { return this.getStyle('label.maxlength') }, isShadowable: function() { return this.getStyle('label.shadowable') } }), Ib.vector.Label2Attachment = function(a, b) { Ib.vector.Label2Attachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.Label2Attachment', Ib.vector.BasicAttachment, { paint: function(a) { var b = this._element instanceof Ib.Link && this._element.getStyle('link.label.rotatable'); if (b) { a.save(); var c = this.getZoomViewRect(), d = c.x + c.width / 2, e = c.y + c.height / 2; a.translate(d, e), a.rotate(this._network.getElementUI(this._element).getAngle()), a.translate(-d, -e) }Ib.vector.Label2Attachment.superClass.paint.apply(this, arguments); var f = this._network.zoomManager, g = f._getAttachmentZoomRect(this, this._contentRect), h = this._element.getStyle('label.align'), i = this._element && this._element.getStyle('label2.rotate.angle'); if (i !== 0 && (a.save(), Ib.Util.rotateCanvas(a, this._contentRect, i)), f._drawText(this, a, this.text, g, this.font, this.getStyle('label2.color'), h), (b || i !== 0) && a.restore(), this._network._debug) { var j = f.getAttachmentSizeZoom(this), k = g; k.width *= j, k.height *= j, Xb.strokeRect(a, k, '#AAABBB') } }, validate: function() { this.font = this.getFont('label2.font'); var a = this.getLabel(), b = Jb.g.getTextSize(this.font, a), c = this.getMaxLength(); c !== 0 && b.width > c ? (this.text = Jb.g.getCollapseTextInLength(this.font, a, c), this._textSize = Jb.g.getTextSize(this.font, this.text)) : (this.text = a, this._textSize = b), Ib.vector.LabelAttachment.superClass.validate.call(this); var d = this._viewRect, e = this._element && this._element.getStyle('label2.rotate.angle'); if (e !== 0) { var f = new Ib.List(); f.add({ x: d.x, y: d.y }), f.add({ x: d.x + d.width, y: d.y }), f.add({ x: d.x + d.width, y: d.y + d.height }), f.add({ x: d.x, y: d.y + d.height }), f = this._rotatePointList(f, e, d); var g = Ib.Util.getRect(f); this._viewRect = g } }, getLabel: function() { return this._network.getLabel2(this._element) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('label2.corner.radius') }, getPointerLength: function() { return this.getStyle('label2.pointer.length') }, getPointerWidth: function() { return this.getStyle('label2.pointer.width') }, getPosition: function() { return this.getStyle('label2.position') }, getXOffset: function() { return this.getStyle('label2.xoffset') }, getYOffset: function() { return this.getStyle('label2.yoffset') }, getPadding: function() { return this.getStyle('label2.padding') }, getPaddingLeft: function() { return this.getStyle('label2.padding.left') }, getPaddingRight: function() { return this.getStyle('label2.padding.right') }, getPaddingTop: function() { return this.getStyle('label2.padding.top') }, getPaddingBottom: function() { return this.getStyle('label2.padding.bottom') }, getDirection: function() { return this.getStyle('label2.direction') }, isFill: function() { return this.getStyle('label2.fill') }, getFillColor: function() { return this.getStyle('label2.fill.color') }, getGradient: function() { return this.getStyle('label2.gradient') }, getGradientColor: function() { return this.getStyle('label2.gradient.color') }, getOutlineWidth: function() { return this.getStyle('label2.outline.width') }, getOutlineColor: function() { return this.getStyle('label2.outline.color') }, getCap: function() { return this.getStyle('label2.cap') }, getJoin: function() { return this.getStyle('label2.join') }, getAlpha: function() { return this.getStyle('label2.alpha') }, getMaxLength: function() { return this.getStyle('label2.maxlength') }, isShadowable: function() { return this.getStyle('label2.shadowable') } }), Ib.vector.AlarmAttachment = function(a, b) { Ib.vector.AlarmAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.AlarmAttachment', Ib.vector.BasicAttachment, { paint: function(a) { Ib.vector.AlarmAttachment.superClass.paint.apply(this, arguments); var b = this._network.zoomManager, c = b._getAttachmentZoomRect(this, this._contentRect); b._drawText(this, a, this.text, c, this.font, this.getStyle('alarm.color')) }, validate: function() { this.font = this.getFont('alarm.font'), this.text = this._network.getAlarmLabel(this._element), this._textSize = Xb.getTextSize(this.font, this.text), this._fillColor = this._network.getAlarmFillColor(this._element), Ib.vector.AlarmAttachment.superClass.validate.call(this) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('alarm.corner.radius') }, getPointerLength: function() { return this.getStyle('alarm.pointer.length') }, getPointerWidth: function() { return this.getStyle('alarm.pointer.width') }, getPosition: function() { return this.getStyle('alarm.position') }, getXOffset: function() { return this.getStyle('alarm.xoffset') }, getYOffset: function() { return this.getStyle('alarm.yoffset') }, getPadding: function() { return this.getStyle('alarm.padding') }, getPaddingLeft: function() { return this.getStyle('alarm.padding.left') }, getPaddingRight: function() { return this.getStyle('alarm.padding.right') }, getPaddingTop: function() { return this.getStyle('alarm.padding.top') }, getPaddingBottom: function() { return this.getStyle('alarm.padding.bottom') }, getDirection: function() { return this.getStyle('alarm.direction') }, isFill: function() { return this._fillColor != null }, getFillColor: function() { return this._fillColor }, getGradient: function() { return this.getStyle('alarm.gradient') }, getGradientColor: function() { return this.getStyle('alarm.gradient.color') }, getOutlineWidth: function() { return this.getStyle('alarm.outline.width') }, getOutlineColor: function() { return this.getStyle('alarm.outline.color') }, getCap: function() { return this.getStyle('alarm.cap') }, getJoin: function() { return this.getStyle('alarm.join') }, getAlpha: function() { return this.getStyle('alarm.alpha') }, isShadowable: function() { return this.getStyle('alarm.shadowable') } }), Ib.vector.LinkHandlerAttachment = function(a, b) { Ib.vector.LinkHandlerAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.LinkHandlerAttachment', Ib.vector.BasicAttachment, { paint: function(a) { var b = this._network.zoomManager; Ib.vector.LinkHandlerAttachment.superClass.paint.apply(this, arguments); var c = b._getAttachmentZoomRect(this, this._contentRect); b._drawText(this, a, this.linkHandlerLabel, c, this.linkHandlerFont, this.getStyle('link.handler.color')) }, validate: function() { this.linkHandlerFont = this.getFont('link.handler.font'), this.linkHandlerLabel = this._network.getLinkHandlerLabel(this._element), this._textSize = Xb.getTextSize(this.linkHandlerFont, this.linkHandlerLabel), Ib.vector.LinkHandlerAttachment.superClass.validate.call(this) }, getContentWidth: function() { return this._textSize ? this._textSize.width : 0 }, getContentHeight: function() { return this._textSize ? this._textSize.height : 0 }, getCornerRadius: function() { return this.getStyle('link.handler.corner.radius') }, getPointerLength: function() { return this.getStyle('link.handler.pointer.length') }, getPointerWidth: function() { return this.getStyle('link.handler.pointer.width') }, getPosition: function() { return this.getStyle('link.handler.position') }, getXOffset: function() { return this.getStyle('link.handler.xoffset') }, getYOffset: function() { return this.getStyle('link.handler.yoffset') }, getPadding: function() { return this.getStyle('link.handler.padding') }, getPaddingLeft: function() { return this.getStyle('link.handler.padding.left') }, getPaddingRight: function() { return this.getStyle('link.handler.padding.right') }, getPaddingTop: function() { return this.getStyle('link.handler.padding.top') }, getPaddingBottom: function() { return this.getStyle('link.handler.padding.bottom') }, getDirection: function() { return this.getStyle('link.handler.direction') }, isFill: function() { return this.getStyle('link.handler.fill') }, getFillColor: function() { return this.getStyle('link.handler.fill.color') }, getGradient: function() { return this.getStyle('link.handler.gradient') }, getGradientColor: function() { return this.getStyle('link.handler.gradient.color') }, getOutlineWidth: function() { return this.getStyle('link.handler.outline.width') }, getOutlineColor: function() { return this.getStyle('link.handler.outline.color') }, getCap: function() { return this.getStyle('link.handler.cap') }, getJoin: function() { return this.getStyle('link.handler.join') }, getAlpha: function() { return this.getStyle('link.handler.alpha') }, isShadowable: function() { return this.getStyle('link.handler.shadowable') } }), Ib.vector.IconsAttachment = function(a, b) { Ib.vector.IconsAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.IconsAttachment', Ib.vector.Attachment, { isShadowable: function() { return Ib.Defaults.ATTACHMENT_SHADOWABLE }, validate: function() { if (Ib.vector.IconsAttachment.superClass.validate.call(this), this.iconsNames = this._network.getIconsNames(this._element), this.iconsNames && this.iconsNames.length != 0) { var a = this._makeGroup(this.iconsNames), b = this._makeGroup(this._network.getIconsColors(this._element)), c = this._network.zoomManager; len = a.length, this.iconsOrientation = this._makeArray(this._element.getStyle('icons.orientation'), len, 'right'), this.iconsPosition = this._makeArray(this._element.getStyle('icons.position'), len, 'topleft.bottomright'), this.iconsXoffset = this._makeArray(this._element.getStyle('icons.xoffset'), len, 0), this.iconsYoffset = this._makeArray(this._element.getStyle('icons.yoffset'), len, 0), this.iconsXgap = this._makeArray(this._element.getStyle('icons.xgap'), len, 1), this.iconsYgap = this._makeArray(this._element.getStyle('icons.ygap'), len, 1), this.locations = [], this.iconsSizes = [], this.iconsOrientations = []; var d, e, f; for (i = 0; i < len; i++) { var g = a[i], f = this.iconsOrientation[i] || 'right', h = this.iconsPosition[i] || 'topleft.bottomright', j = this.iconsXgap[i] || 1, k = this.iconsYgap[i] || 1, l = this.iconsXoffset[i] || 0, m = this.iconsYoffset[i] || 0; if (this._ui._element instanceof Ib.Link) { var n, o = this._ui.getLinkPoints(); n = this._ui.getLineLength ? this._ui.getLineLength() : this._ui._element.getLineLength(), Math.abs(l) > 0 && Math.abs(l) < 1 ? h === 'from' ? l *= n : h === 'to' ? l = n * (1 - l) : (l /= 2, l += 0.5, l *= n) : h === 'from' ? l = l : h === 'to' ? l = n - l : l += n / 2; { var p, q = Tb.calculatePointInfoAlongLine(o, !0, l, m), r = q.point; q.angle }p = h === 'from' ? this._ui.getFromPoint() : h === 'to' ? this._ui.getToPoint() : this._ui._hotSpot, l = r.x - p.x, m = r.y - p.y }e = null, d = this._getIconsSize(g, f, j, k, c), d && (e = this._network.getPosition(h, this._ui, d, l, m), this._iconLocation = e, f === 'top' ? e.y += d.height : f === 'left' && (e.x += d.width)), this.locations.push(e), this.iconsSizes.push(d), this.iconsOrientations.push(f) } var s = null; for (i = 0; i < this.locations.length; i++)e = this.locations[i], d = this.iconsSizes[i], f = this.iconsOrientations[i], e != null && (s = s == null ? f === 'top' ? { x: e.x, y: e.y - d.height, width: d.width, height: d.height } : f === 'left' ? { x: e.x - d.width, y: e.y, width: d.width, height: d.height } : { x: e.x, y: e.y, width: d.width, height: d.height } : f === 'top' ? Tb.unionRect(s, { x: e.x, y: e.y - d.height, width: d.width, height: d.height }) : f === 'left' ? Tb.unionRect(s, { x: e.x - d.width, y: e.y, width: d.width, height: d.height }) : Tb.unionRect(s, { x: e.x, y: e.y, width: d.width, height: d.height })); this._viewRect = c ? s || this.getElementUI().getViewRect() : s || { x: this._element.getLocation().x, y: this._element.getLocation().y, width: 0, height: 0 }, this.iconsGroups = a, this.colorGroups = b; var t = this._element instanceof Ib.Link && this._element.getStyle('link.icons.rotatable'); for (i = 0; i < len; i++) if (t instanceof Array && t[i] && this._viewRect) { var u = this._viewRect.x + this._viewRect.width / 2, v = this._viewRect.y + this._viewRect.height / 2, w = Math.sqrt(this._viewRect.height * this._viewRect.height + this._viewRect.width * this._viewRect.width); this._viewRect = { x: u - w / 2, y: v - w / 2, width: w, height: w } } } }, _makeGroup: function(a) { if (!Array.isArray(a)) return [[a]]; var b, c, d, e = [], f = !1, g = a.length; for (b = 0; g > b; b++)c = a[b], Array.isArray(c) ? (f = !0, e.push(c)) : (d = [c], e.push(d)); return f || (e.length = 0, e.push(a)), e }, _makeArray: function(a, b, c) { if (Array.isArray(a)) return a; for (var d = [], e = 0; b > e; e++)d.push(a || c); return d }, paint: function(a) { if (Ib.vector.IconsAttachment.superClass.paint.apply(this, arguments), this.iconsNames && this.iconsNames.length != 0 && this.locations) { var b, c, d, e, f, g, h, i, j, k, l = this._network.zoomManager; for (b = 0; b < this.iconsGroups.length; b++) if (c = this.locations[b]) { f = c.x, g = c.y, e = this.iconsGroups[b], h = this.colorGroups[b], i = this.iconsOrientation[b], j = this.iconsXgap[b] || 1, k = this.iconsYgap[b] || 1, d = 0; for (var m in e) { var n = null, o = null; h && h.length > d && (o = h[d++]); var p = Jb.getImageAsset(e[m]); if (p != null) { if (l && this._ui instanceof Ib.vector.GroupUI && this._ui._shapeRect) { var q = l.getAttachmentSizeZoom(this), r = p.getWidth() * q, s = p.getHeight() * q; if (i === 'right')n = { x: f, y: g, width: r, height: s }, f += n.width + j; else if (i === 'left')n = { x: f - r, y: g, width: r, height: s }, f -= n.width + j; else if (i === 'top')n = { x: f, y: g - s, width: r, height: s }, g -= n.height + k; else { if (i !== 'bottom') throw "Can not resolve '" + i + "' orientation"; n = { x: f, y: g, width: r, height: s }, g += n.height + k } } else { if (i === 'right')n = { x: f, y: g, width: p.getWidth(), height: p.getHeight() }, f += n.width + j; else if (i === 'left')n = { x: f - p.getWidth(), y: g, width: p.getWidth(), height: p.getHeight() }, f -= n.width + j; else if (i === 'top')n = { x: f, y: g - p.getHeight(), width: p.getWidth(), height: p.getHeight() }, g -= n.height + k; else { if (i !== 'bottom') throw "Can not resolve '" + i + "' orientation"; n = { x: f, y: g, width: p.getWidth(), height: p.getHeight() }, g += n.height + k }n = l._getAttachmentZoomOutLineRect(this, n) } var t = this._element instanceof Ib.Link && this._element.getStyle('link.icons.rotatable'); if (t instanceof Array && t[b]) { a.save(); var u = n, f = u.x + u.width / 2, g = u.y + u.height / 2; a.translate(f, g), a.rotate(this._network.getElementUI(this._element).getAbsoluteAngle()), a.translate(-f, -g), Nc(a, p.getImage(o, n.width, n.height), o, n, this._element, this._network), a.restore() } else Nc(a, p.getImage(o, n.width, n.height), o, n, this._element, this._network); if (this._network._debug) { var n = this._viewRect; Xb.strokeRect(a, n, '#FCFC00', 1), Xb.strokeRect(a, n, '#FCFC00', 1) } } } } } }, _getIconsSize: function(a, b, c, d, e) { var f = 0, g = 0, h = null, i = null, j = null; for (var k in a) if (i = Jb.getImageAsset(a[k])) { if (b === 'right')h = { x: f, y: g, width: i.getWidth(), height: i.getHeight() }, f += h.width + c; else if (b === 'left')h = { x: f - i.getWidth(), y: g, width: i.getWidth(), height: i.getHeight() }, f -= h.width + c; else if (b === 'top')h = { x: f, y: g - i.getHeight(), width: i.getWidth(), height: i.getHeight() }, g -= h.height + d; else { if (b !== 'bottom') throw "Can not resolve '" + b + "' orientation"; h = { x: f, y: g, width: i.getWidth(), height: i.getHeight() }, g += h.height + d }j = j == null ? Jb.clone(h) : Tb.unionRect(j, h) } return j ? e && this._ui instanceof Ib.vector.GroupUI && this._ui._shapeRect ? { width: Math.abs(j.width) * e.getAttachmentSizeZoom(this), height: Math.abs(j.height) * e.getAttachmentSizeZoom(this) } : { width: Math.abs(j.width), height: Math.abs(j.height) } : null } }), Ib.vector.EditAttachment = function(a, b) { Ib.vector.EditAttachment.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.EditAttachment', Ib.vector.Attachment, { paint: function(a) { Ib.vector.EditAttachment.superClass.paint.apply(this, arguments), this.paintResizingPoints(a), this.paintEditPoints(a), this.paintRotatePoints(a) }, paintResizingPoints: function(a) { var b = this.resizingPoints.size(); if (!(b <= 0)) { var c = this._element.getStyle('edit.physicalZoom') ? 1 : this._network.getGraphicsZoom(), d = this.resizePointSize / c, e = 2 * d, f = 2 * d, g = this._network.getResizePointFillColor(), h = this._network.getResizePointOutlineWidth() / c, i = this._network.getResizePointOutlineColor(), j = this._element.getAngle(), k = this._network.zoomManager, l = k._getElementZoomRect(this.getElementUI(), this._element.getOriginalRect()); a.lineWidth = h; for (var m = this.resizingPoints, n = 0; b > n; n++) { var o = m.get(n), p = { x: o.x - d, y: o.y - d, width: 2 * d, height: 2 * d }, q = this._getRotateRect(p, j, { x: l.x + l.width / 2, y: l.y + l.height / 2 }); a.save(), Ib.Util.rotateCanvas(a, q, j), Od.rect(a, q.x, q.y, e, f), a.restore() } if (a.fillStyle = g, a.strokeStyle = i, a.fill(), a.stroke(), this._network._debug) { var r = this.getViewRect('resize'); Xb.strokeRect(a, r, '#CCDDCC'); var r = k._getElementZoomRect(this.getElementUI(), this.getElementUI()._viewRect); Xb.strokeRect(a, r, '#FD7766') } } }, paintEditPoints: function(a) { var b = this.editPoints.size(); if (!(b <= 0)) { var c = this._element.getStyle('edit.physicalZoom') ? 1 : this._network.getGraphicsZoom(), d = this._network.getEditPointOutlineColor(), e = this._network.getEditPointFillColor(), f = this._network.getEditPointOutlineWidth() / c; a.beginPath(), a.lineWidth = f; for (var g = this.editPoints, h = 0; b > h; h++) { var i = g.get(h); a.beginPath(), Od.circle(a, i.x, i.y, this.editPointSize, e, d), a.closePath() } if (this._network._debug) { var j = this.getViewRect('edit'); Xb.strokeRect(a, j, '#AAABBC') } } }, paintRotatePoints: function(a) { var b = this.rotatePoints.size(); if (!(b <= 0)) { var c = this._element.getStyle('edit.physicalZoom') ? 1 : this._network.getGraphicsZoom(), d = this._network.getRotatePointOutlineColor(), e = this._network.getRotatePointFillColor(), f = this._network.getRotatePointOutlineWidth() / c; a.beginPath(), a.lineWidth = f; for (var g = this.rotatePoints, h = 0; b > h; h++) { var i = g.get(h); a.beginPath(), Od.circle(a, i.x, i.y, this.rotatePointSize / c, e, d), a.closePath(), a.beginPath() } if (this._network._debug) { var j = this.getViewRect('rotate'); Xb.strokeRect(a, j, 'green') } } }, getViewRect: function(a) { if (a) { if (a === 'resize') return this._resizeRect; if (a === 'rotate') return this._rotateRect; if (a === 'edit') return this._editRect } return this._viewRect || { x: 0, y: 0, width: 0, height: 0 } }, validate: function() { Ib.vector.EditAttachment.superClass.validate.call(this); var a = this._network.getGraphicsZoom(); this.editPointSize = this._network.getEditPointSize(), this.resizePointSize = this._network.getResizePointSize(), this.rotatePointSize = this._network.getRotatePointSize(), this.resizingPoints = new Ib.List(), this.editPoints = new Ib.List(), this.rotatePoints = new Ib.List(), this._element instanceof Ib.Node && this._addResizingPoint(this._element), !(this._network.isRotatable(this._element) && this._element instanceof Ld) || this._element instanceof Ib.ShapeNode || this._element instanceof Ib.Grid || this._element instanceof Ib.Group || this._addRotatePoint(this._element), this._element instanceof Ib.ShapeNode && (this._addResizingPoint(this._element), this._addShapeNodePoint(this._element)), this._ui instanceof Ib.vector.ShapeLinkUI && this._addShapeLinkPoints(this._element), this._ui instanceof Ib.vector.LinkUI && this._addLinkControlPoint(this._ui); var b = this._network.getResizePointOutlineWidth() / a, c = this.getElementUI().getZoomBodyRect(), d = 2 * Math.sqrt(2); if (this._resizeOffset = (this.resizePointSize + b + 1) * d, Tb.grow(c, this._resizeOffset, this._resizeOffset), this._resizeRect = c, b = this._network.getEditPointOutlineWidth() / a, this.editPoints.size() > 0) { var e = Tb.getRect(this.editPoints); Tb.grow(e, 2 * this.editPointSize + 2 * b), c = Tb.unionRect(c, e) } this._editRect = e, b = this._network.getRotatePointOutlineWidth() / a; var f = this.rotatePointSize; if (this.rotatePoints.size() > 0) { var g = this.rotatePoints.get(0), h = { x: g.x - f - b - 1, y: g.y - f - b - 1, width: 2 * f + 2 * b + 2, height: 2 * f + 2 * b + 2 }; c = Tb.unionRect(c, h), this._rotateRect = h } this._viewRect = c }, _addResizingPoint: function(a) { var b = this._network.zoomManager._getElementZoomRect(this.getElementUI(), a.getOriginalRect()); if (b) { var c = this._network.getResizePointSize(); if (!(c <= 0)) { var d = new nd([{ x: b.x, y: b.y }, { x: b.x + b.width / 2, y: b.y }, { x: b.x + b.width, y: b.y }, { x: b.x, y: b.y + b.height / 2 }, { x: b.x + b.width, y: b.y + b.height / 2 }, { x: b.x, y: b.y + b.height }, { x: b.x + b.width / 2, y: b.y + b.height }, { x: b.x + b.width, y: b.y + b.height }]), e = this._network.getResizePointOutlineWidth(), f = this._network.getResizePointOutlineColor(), g = this._network.getResizePointFillColor(); this._addPoints(a.getRect(), d, e, f, g, !0) } } }, _addRotatePoint: function(a) { var b = this._network.zoomManager._getElementZoomRect(this.getElementUI(), a.getOriginalRect()); if (b) { var c = this._network.getRotatePointSize() / this._network.getGraphicsZoom(); if (!(c <= 0)) { var d = 2 * c, e = new Ib.List([{ x: b.x + b.width / 2, y: b.y - this._network.getRotatePointOffset() / this._network.getGraphicsZoom() - c }]), f = a.getAngle(); f != 0 && (e = this._rotatePointList(e, f, b)); var g = e.get(0), h = { x: g.x - d / 2, y: g.y - d / 2, width: d, height: d }, i = this._network.getRotatePointOutlineWidth(), j = this.rotatePointSize + i; Tb.grow(b, j, j); { Tb.unionRect(a.getRect(), h) } this.rotatePoints = e } } }, _addShapeNodePoint: function(a) { var b = this._network.zoomManager._getShapeNodeZoomPoints(this.getElementUI(), a.getPoints()); this._addEditPoints(b) }, _addShapeLinkPoints: function(a) { var b = this._network.zoomManager._getShapeLinkZoomPoints(a.getPoints()); this._addEditPoints(b) }, _addLinkControlPoint: function(a) { var b, c = new Ib.List(), d = a._element.getFromAgent(); b = d ? a._element.getFromAgent() : a._element.getFromNode(); var e = a._element.getStyle('link.from.xoffset'), f = a._element.getStyle('link.from.yoffset'), g = b.getCenterLocation(), h = { x: g.x + e, y: g.y + f }; c.add(h); var i, j = a._element.getToAgent(); i = j ? a._element.getToAgent() : a._element.getToNode(); var k = a._element.getStyle('link.to.xoffset'), l = a._element.getStyle('link.to.yoffset'), m = i.getCenterLocation(), n = { x: m.x + k, y: m.y + l }; if (c.add(n), xc.isOrthogonalLink(a._element) && a.getControlPoint()) { var o = a.getControlPoint(); o && c.add(o) } var p = this.editPoints.size(); if (p > 0) for (var q = 0; p > q; q++)c.add(this.editPoints.get(q)); this._addEditPoints(c) }, _addEditPoints: function(a) { var b = Tb.getRect(a); if (b) { var c = this._network.getEditPointSize(); if (!(c <= 0)) { var d = this._network.getEditPointOutlineWidth(); this._addPoints(b, a, d, !1) } } }, _addPoints: function(a, b, c, d, e, f) { var g = f ? this._network.getResizePointSize() : this._network.getEditPointSize(); if (!(g < 0)) { var h = g + c; Tb.grow(a, h, h), f == 1 ? this.resizingPoints = b : this.editPoints = b } }, _rotatePoint: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x + c.width / 2, c.y + c.height / 2), e = d.transform(a); return e }, _rotatePointList: function(a, b, c) { var d = this, e = new Ib.List(); return a.forEach(function(a) { e.add(d._rotatePoint(a, b, c)) }), e }, _getRotateRect: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x, c.y), e = { x: a.x + a.width / 2, y: a.y + a.height / 2 }, f = d.transform(e), g = new Ib.List([{ x: f.x - a.width / 2, y: f.y - a.height / 2 }, { x: f.x + a.width / 2, y: f.y - a.height / 2 }, { x: f.x + a.width / 2, y: f.y + a.height / 2 }, { x: f.x - a.width / 2, y: f.y + a.height / 2 }]); return Tb.getRect(g) } }), Ib.vector.HTMLLabelAttachment = function(a, b) { Ib.vector.HTMLLabelAttachment.superClass.constructor.call(this, a, b), this._triangleDiv = Ib.Util.createDiv(), this._roundDiv = Ib.Util.createDiv(), this._contentDiv = Ib.Util.createDiv(); this._network.getView().appendChild(this._roundDiv), this._roundDiv.appendChild(this._contentDiv) }, Jb.ext('twaver.vector.HTMLLabelAttachment', Ib.vector.LabelAttachment, { validate: function() {
    this.validateZIndex(0); var b = this._element.getStyle('attachment.htmllabel.hyperlink'); b ? (Ib.Util.setCSSStyle(this._triangleDiv, 'pointer-events', 'auto'), Ib.Util.setCSSStyle(this._contentDiv, 'pointer-events', 'auto')) : (Ib.Util.setCSSStyle(this._triangleDiv, 'pointer-events', 'none'), Ib.Util.setCSSStyle(this._contentDiv, 'pointer-events', 'none')), Ib.Util.setCSSStyle(this._triangleDiv, 'border-style', 'solid'), Ib.Util.setCSSStyle(this._contentDiv, 'white-space', 'nowrap'); var c = (this.getFont('label.font'), this.getLabel()); c !== this.text && (this.text && (typeof this.text === 'object' ? a.jquery ? a.jquery(this.text).remove() : this._contentDiv.removeChild(this.text) : this._contentDiv.innerHTML = ''), c && (typeof c === 'object' ? a.jquery ? a.jquery(this._contentDiv).append(c) : this._contentDiv.appendChild(c) : this._contentDiv.innerHTML = c), this.text = c),
    this._contentDiv.style.visibility = 'hidden', Ib.vector.HTMLLabelAttachment.superClass.validate.call(this)
  }, validateZIndex: function(a) { this._roundDiv.style.zIndex = 1e5 * a + this._network.getElementBox().getDatas().indexOf(this._element) }, getContentWidth: function() { return this._contentDiv.scrollWidth || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'width')) }, getContentHeight: function() { return this._contentDiv.scrollHeight || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'height')) }, paint: function(a) { var b = this.isFill(), c = this.getOutlineWidth(), d = this._contentRect; if (this.getElementUI().setGlow(this, a), this.getElementUI().setShadow(this, a), c > 0 || b) { if (Xb.drawRoundRect(a, d.x, d.y, d.width, d.height, this.getCornerRadius()), this._pointers) { var e = this._ui.getZoomPointers(this, this._pointers); a.moveTo(e[0].x, e[0].y), a.lineTo(e[1].x, e[1].y), a.lineTo(e[2].x, e[2].y) } if (a.closePath(), c > 0 && (a.lineWidth = c, a.strokeStyle = this.getOutlineColor(), a.lineCap = this.getCap(), a.lineJoin = this.getJoin(), a.stroke()), b) { var f = this.getFillColor(), g = this.getGradient(); g ? Xb.fill(a, f, g, this.getGradientColor(), this._viewRect) : a.fillStyle = f, a.fill() } } var h = (this.getFont('label.font'), this.getLabel(), this._network.getViewRect().x), i = this._network.getViewRect().y, j = this._network.getZoom(), k = { x: this._contentRect.x + this._contentRect.width / 2, y: this._contentRect.y + this._contentRect.height / 2 }, l = k.x * j - h - this._contentDiv.offsetWidth / 2 * j + 'px', m = k.y * j - i - this._contentDiv.offsetHeight / 2 * j + 'px'; this._contentDiv.style.left = l, this._contentDiv.style.top = m, this._contentDiv.style.setProperty('-webkit-transform', 'scale(' + j + ')', null), this._contentDiv.style.setProperty('-webkit-transform-origin', '0 0', null), this._network._debug && (Xb.strokeRect(a, this._contentRect, 'blue'), Xb.strokeRect(a, this._roundRect, 'red'), Xb.strokeRect(a, this._viewRect, 'green')); var n = this._element instanceof Ib.Link && this._element.getStyle('link.label.rotatable'); if (n) { { var o = this.getZoomViewRect(), p = (o.x + o.width / 2, o.y + o.height / 2, 180 * this._network.getElementUI(this._element).getAbsoluteAngle() / Math.PI); this._contentDiv.offsetWidth / 2 * j, this._contentDiv.offsetHeight / 2 * j }Qb.isFirefox ? Ib.Util.setCSSStyle(this._contentDiv, '-moz-transform', 'translate(0px,0px) rotate(' + p + 'deg) scale(' + j + ')') : Qb.isOpera ? Ib.Util.setCSSStyle(this._contentDiv, '-o-transform', 'translate(0px,0px) rotate(' + p + 'deg) scale(' + j + ')') : Qb.isChrome || Qb.isSafari ? Ib.Util.setCSSStyle(this._contentDiv, '-webkit-transform', 'translate(0px, 0px) rotate(' + p + 'deg) scale(' + j + ')') : Qb.isIE ? Ib.Util.setCSSStyle(this._contentDiv, '-ms-transform', 'translate(0px,0px) rotate(' + p + 'deg) scale(' + j + ')') : Ib.Util.setCSSStyle(this._contentDiv, 'transform', 'translate(0px,0px) rotate(' + p + 'deg) scale(' + j + ')') } }, setVisibility: function(a) { this._contentDiv.style.visibility = a }, dispose: function() { this._network.getView().removeChild(this._roundDiv) }, getView: function() { return this._roundDiv } }), Ib.vector.HTMLLabel2Attachment = function(a, b) { Ib.vector.HTMLLabel2Attachment.superClass.constructor.call(this, a, b), this._triangleDiv = Ib.Util.createDiv(), this._roundDiv = Ib.Util.createDiv(), this._contentDiv = Ib.Util.createDiv(); this._network.getView().appendChild(this._roundDiv), this._roundDiv.appendChild(this._contentDiv) }, Jb.ext('twaver.vector.HTMLLabel2Attachment', Ib.vector.LabelAttachment, { validate: function() { this.validateZIndex(0); var b = this._element.getStyle('attachment.htmllabel2.hyperlink'); b ? (Ib.Util.setCSSStyle(this._triangleDiv, 'pointer-events', 'auto'), Ib.Util.setCSSStyle(this._contentDiv, 'pointer-events', 'auto')) : (Ib.Util.setCSSStyle(this._triangleDiv, 'pointer-events', 'none'), Ib.Util.setCSSStyle(this._contentDiv, 'pointer-events', 'none')), Ib.Util.setCSSStyle(this._triangleDiv, 'border-style', 'solid'), Ib.Util.setCSSStyle(this._contentDiv, 'white-space', 'nowrap'); var c = (this.getFont('label2.font'), this.getLabel()); c !== this.text && (this.text && (typeof this.text === 'object' ? a.jquery ? a.jquery(this.text).remove() : this._contentDiv.removeChild(this.text) : this._contentDiv.innerHTML = ''), c && (typeof c === 'object' ? a.jquery ? a.jquery(this._contentDiv).append(c) : this._contentDiv.appendChild(c) : this._contentDiv.innerHTML = c), this.text = c), this._contentDiv.style.visibility = 'hidden', Ib.vector.HTMLLabelAttachment.superClass.validate.call(this) }, validateZIndex: function(a) { this._roundDiv.style.zIndex = 1e5 * a + this._network.getElementBox().getDatas().indexOf(this._element) }, getContentWidth: function() { return this._contentDiv.scrollWidth || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'width')) }, getContentHeight: function() { return this._contentDiv.scrollHeight || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'height')) }, paint: function(a) { var b = this.isFill(), c = this.getOutlineWidth(), d = this._contentRect; if (this.getElementUI().setGlow(this, a), this.getElementUI().setShadow(this, a), c > 0 || b) { if (Xb.drawRoundRect(a, d.x, d.y, d.width, d.height, this.getCornerRadius()), this._pointers) { var e = this._ui.getZoomPointers(this, this._pointers); a.moveTo(e[0].x, e[0].y), a.lineTo(e[1].x, e[1].y), a.lineTo(e[2].x, e[2].y) } if (a.closePath(), c > 0 && (a.lineWidth = c, a.strokeStyle = this.getOutlineColor(), a.lineCap = this.getCap(), a.lineJoin = this.getJoin(), a.stroke()), b) { var f = this.getFillColor(), g = this.getGradient(); g ? Xb.fill(a, f, g, this.getGradientColor(), this._viewRect) : a.fillStyle = f, a.fill() } } var h = (this.getFont('label2.font'), this.getLabel(), this._network.getViewRect().x), i = this._network.getViewRect().y, j = this._network.getZoom(), k = { x: this._contentRect.x + this._contentRect.width / 2, y: this._contentRect.y + this._contentRect.height / 2 }, l = k.x * j - h - this._contentDiv.offsetWidth / 2 * j + 'px', m = k.y * j - i - this._contentDiv.offsetHeight / 2 * j + 'px'; this._contentDiv.style.left = l, this._contentDiv.style.top = m, this._contentDiv.style.setProperty('-webkit-transform', 'scale(' + j + ')', null), this._contentDiv.style.setProperty('-webkit-transform-origin', '0 0', null), this._network._debug && (Xb.strokeRect(a, this._contentRect, 'blue'), Xb.strokeRect(a, this._roundRect, 'red'), Xb.strokeRect(a, this._viewRect, 'green')); var n = this._element instanceof Ib.Link && this._element.getStyle('link.label2.rotatable'); if (n) { { var o = this.getZoomViewRect(), p = (o.x + o.width / 2, o.y + o.height / 2, 180 * this._network.getElementUI(this._element).getAbsoluteAngle() / Math.PI); this._contentDiv.offsetWidth / 2 * j, this._contentDiv.offsetHeight / 2 * j }Qb.isFirefox ? Ib.Util.setCSSStyle(this._contentDiv, '-moz-transform', 'translate(0px,0px) rotate(' + p + 'deg) scale(' + j + ')') : Qb.isOpera ? Ib.Util.setCSSStyle(this._contentDiv, '-o-transform', 'translate(0px,0px) rotate(' + p + 'deg) scale(' + j + ')') : Qb.isChrome || Qb.isSafari ? Ib.Util.setCSSStyle(this._contentDiv, '-webkit-transform', 'translate(0px, 0px) rotate(' + p + 'deg) scale(' + j + ')') : Qb.isIE ? Ib.Util.setCSSStyle(this._contentDiv, '-ms-transform', 'translate(0px,0px) rotate(' + p + 'deg) scale(' + j + ')') : Ib.Util.setCSSStyle(this._contentDiv, 'transform', 'translate(0px,0px) rotate(' + p + 'deg) scale(' + j + ')') } }, setVisibility: function(a) { this._contentDiv.style.visibility = a }, dispose: function() { this._network.getView().removeChild(this._roundDiv) }, getView: function() { return this._roundDiv }, getLabel: function() { return this._network.getLabel2(this._element) }, getCornerRadius: function() { return this.getStyle('label2.corner.radius') }, getPointerLength: function() { return this.getStyle('label2.pointer.length') }, getPointerWidth: function() { return this.getStyle('label2.pointer.width') }, getPosition: function() { return this.getStyle('label2.position') }, getXOffset: function() { return this.getStyle('label2.xoffset') }, getYOffset: function() { return this.getStyle('label2.yoffset') }, getPadding: function() { return this.getStyle('label2.padding') }, getPaddingLeft: function() { return this.getStyle('label2.padding.left') }, getPaddingRight: function() { return this.getStyle('label2.padding.right') }, getPaddingTop: function() { return this.getStyle('label2.padding.top') }, getPaddingBottom: function() { return this.getStyle('label2.padding.bottom') }, getDirection: function() { return this.getStyle('label2.direction') }, isFill: function() { return this.getStyle('label2.fill') }, getFillColor: function() { return this.getStyle('label2.fill.color') }, getGradient: function() { return this.getStyle('label2.gradient') }, getGradientColor: function() { return this.getStyle('label2.gradient.color') }, getOutlineWidth: function() { return this.getStyle('label2.outline.width') }, getOutlineColor: function() { return this.getStyle('label2.outline.color') }, getCap: function() { return this.getStyle('label2.cap') }, getJoin: function() { return this.getStyle('label2.join') }, getAlpha: function() { return this.getStyle('label2.alpha') }, isShadowable: function() { return this.getStyle('label2.shadowable') } }), Ib.vector.HTMLAlarmAttachment = function(a, b) { Ib.vector.HTMLAlarmAttachment.superClass.constructor.call(this, a, b), this._triangleDiv = Ib.Util.createDiv(), this._roundDiv = Ib.Util.createDiv(), this._contentDiv = Ib.Util.createDiv(), Ib.Util.setCSSStyle(this._triangleDiv, 'border-style', 'solid'), Ib.Util.setCSSStyle(this._triangleDiv, 'pointer-events', 'none'), Ib.Util.setCSSStyle(this._contentDiv, 'white-space', 'nowrap'), Ib.Util.setCSSStyle(this._contentDiv, 'pointer-events', 'none'); this._network.getView().appendChild(this._roundDiv), this._roundDiv.appendChild(this._contentDiv) }, Jb.ext('twaver.vector.HTMLAlarmAttachment', Ib.vector.AlarmAttachment, { validate: function() { var a = (this.getFont('alarm.font'), this._network.getAlarmLabel(this._element)); this._contentDiv.innerHTML = a, this._contentDiv.style.visibility = 'hidden', Ib.vector.HTMLAlarmAttachment.superClass.validate.call(this) }, getContentWidth: function() { return this._contentDiv.scrollWidth || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'width')) }, getContentHeight: function() { return this._contentDiv.scrollHeight || parseInt(Ib.Util.getCSSStyle(this._contentDiv.firstChild, 'height')) }, paint: function(a) { var b = this.isFill(), c = this.getOutlineWidth(), d = this._contentRect; if (this.getElementUI().setShadow(this, a), c > 0 || b) { if (Xb.drawRoundRect(a, d.x, d.y, d.width, d.height, this.getCornerRadius()), this._pointers) { var e = this._ui.getZoomPointers(this, this._pointers); a.moveTo(e[0].x, e[0].y), a.lineTo(e[1].x, e[1].y), a.lineTo(e[2].x, e[2].y) } if (a.closePath(), c > 0 && (a.lineWidth = c, a.strokeStyle = this.getOutlineColor(), a.lineCap = this.getCap(), a.lineJoin = this.getJoin(), a.stroke()), b) { var f = this.getFillColor(), g = this.getGradient(); g ? Xb.fill(a, f, g, this.getGradientColor(), this._viewRect) : a.fillStyle = f, a.fill() } } var h = (this.getFont('alarm.font'), this._network.getAlarmLabel(this._element), this._network.getViewRect().x), i = this._network.getViewRect().y, j = this._network.getZoom(), k = { x: this._contentRect.x + this._contentRect.width / 2, y: this._contentRect.y + this._contentRect.height / 2 }, l = k.x * j - h - this._contentDiv.offsetWidth / 2 * j + 'px', m = k.y * j - i - this._contentDiv.offsetHeight / 2 * j + 'px'; this._contentDiv.style.left = l, this._contentDiv.style.top = m, this._contentDiv.style.setProperty('-webkit-transform', 'scale(' + j + ')', null), this._contentDiv.style.setProperty('-webkit-transform-origin', '0 0', null), this._network._debug && Xb.strokeRect(a, this._contentRect, '#DDDDDD'), Ib.vector.AlarmAttachment.superClass.paint.apply(this, arguments) }, setVisibility: function(a) { this._contentDiv.style.visibility = a }, dispose: function() { this._network.getView().removeChild(this._roundDiv) }, getView: function() { return this._roundDiv } }), Ib.vector.BaseZoomManager = function(a) { this.network = a, this.visibilityThresholds = a.visibilityThresholds }, Jb.ext('twaver.vector.BaseZoomManager', Object, { getZoom: function() { return this.network.getZoom() }, getGraphicsZoom: function() { return 1 }, getSizeZoom: function(a) { return 1 }, getAttachmentSizeZoom: function(a) { var b = a.getElementUI(); return this.getSizeZoom(b) }, getLocationZoom: function() { return 1 }, _getZoomVisibilityThresholds: function() { return this.network.getZoomVisibilityThresholds() }, _convertPointFromView: function(a) { var b = a.x * this.getGraphicsZoom() - this.network.getViewRect().x, c = a.y * this.getGraphicsZoom() - this.network.getViewRect().y; return { x: b, y: c } }, _getElementViewRect: function(a, b) { var c = this.getLocationZoom(), d = this.getSizeZoom(a); if (c == 1 && d == 1) return b; var e = this._getZoomPoint(a), f = e.x, g = e.y; return b == null && console.log('View rect is null'), { x: f * c + (b.x - f) * d, y: g * c + (b.y - g) * d, width: b.width * d, height: b.height * d } }, _invalidateZoom: function() { this.network.invalidateElementUIs() }, _getGroupChildrenRects: function(a) { var b = new nd(); return a.getChildren().forEach(function(a) { if (a instanceof Ld) { var c = this.network.getElementUI(a); if (c) { var d = c.getZoomViewRect(this); d && b.add(d) } } }, this), b }, _zoomGraphicsBegin: function(a) { var b = this.network, c = this.getGraphicsZoom(); a.scale(c, c), a.translate(-b.viewRect.x / c, -b.viewRect.y / c) }, _getEditZoomPoints: function(a, b) { var c = this.getLocationZoom(), d = this.getSizeZoom(a); if (c == 1 && d == 1 || a instanceof Ib.vector.LinkUI && !(a instanceof Ib.vector.ShapeLinkUI)) return b; var e; e = a instanceof Ib.vector.ShapeLinkUI ? Tb.getCenterPoint(Tb.getRect(b)) : this._getZoomPoint(a); var f = e.x, g = e.y; if (b.forEach) { var h, i = new nd(); return b.forEach(function(a) { a instanceof nd ? (h = new nd(), a.forEach(function(a) { h.add({ x: f * c + (a.x - f) * d, y: g * c + (a.y - g) * d }) }), i.add(h)) : i.add({ x: f * c + (a.x - f) * d, y: g * c + (a.y - g) * d }) }), i } return b.x ? { x: f * c + (b.x - f) * d, y: g * c + (b.y - g) * d } : void 0 }, _getShapeNodeZoomPoints: function(a, b, c) { var d = this.getLocationZoom(), e = this.getSizeZoom(a); if (d == 1 && e == 1) return b; c && (d = 1 / d, e = 1 / e); var f, g = Tb.getRect(b), h = g.x + g.width / 2, i = g.y + g.height / 2, j = new nd(); return b.forEach(function(a) { a instanceof nd ? (f = new nd(), a.forEach(function(a) { f.add({ x: h * d + (a.x - h) * e, y: i * d + (a.y - i) * e }) }), j.add(f)) : j.add({ x: h * d + (a.x - h) * e, y: i * d + (a.y - i) * e }) }), j }, _getShapeLinkZoomPoints: function(a, b) { var c = this.getLocationZoom(), d = c; if (c == 1 && d == 1) return a; b && (c = 1 / c, d = 1 / d); var e, f = Tb.getRect(a), g = f.x + f.width / 2, h = f.y + f.height / 2, i = new nd(); return a.forEach(function(a) { a instanceof nd ? (e = new nd(), a.forEach(function(a) { e.add({ x: g * c + (a.x - g) * d, y: h * c + (a.y - h) * d }) }), i.add(e)) : i.add({ x: g * c + (a.x - g) * d, y: h * c + (a.y - h) * d }) }), i }, _getLogicalPoint: function(a, b) { var c, d = b ? this.getZoom() : this.getGraphicsZoom(), e = this.network; if (Qb.isTouchable && a.changedTouches && a.changedTouches.length > 0) { var f = e._view.getBoundingClientRect(), g = a.changedTouches[0], h = Qb.isAndroid ? 0 : zc.scrollLeft(), i = Qb.isAndroid ? 0 : zc.scrollTop(); return c = { x: (g.clientX + e.viewRect.x - f.left - h) / d, y: (g.clientY + e.viewRect.y - f.top - i) / d } } return c = Qb.isFirefox ? { x: (a.layerX + e.viewRect.x) / d, y: (a.layerY + e.viewRect.y) / d } : { x: (a.offsetX + e.viewRect.x) / d, y: (a.offsetY + e.viewRect.y) / d } }, _getVisibleRect: function(a) { return a }, _getElementZoomRect: function(a, b) { var c = this.getLocationZoom(), d = this.getSizeZoom(a); if (c == 1 && d == 1) return Jb.cloneRect(b); var e = a != null ? this._getZoomPoint(a) : { x: b.x + b.width / 2, y: b.y + b.height / 2 }, f = e.x, g = e.y; return { x: f * c + (b.x - f) * d, y: g * c + (b.y - g) * d, width: b.width * d, height: b.height * d } }, _reverseElementZoomRect: function(a, b) { var c = this.getLocationZoom(), d = this.getSizeZoom(a); if (c == 1 && d == 1) return Jb.cloneRect(b); var e = a != null ? this._getZoomPoint(a) : { x: b.x + b.width / 2, y: b.y + b.height / 2 }, f = e.x, g = e.y; return { x: f + (b.x - f * c) / d, y: g + (b.y - g * c) / d, width: b.width / d, height: b.height / d } }, _getZoomContentRect: function(a, c, d, e, f, g) { var h = this.getSizeZoom(a.getElementUI()), i = this.getAttachmentSizeZoom(a), j = a.getElementUI(); return g == b ? j instanceof Ib.vector.GroupUI && j._shapeRect ? { x: e.x * f + 1 * (c.x - e.x) + (d.x - c.x) * i, y: e.y * f + 1 * (c.y - e.y) + (d.y - c.y) * i, width: d.width, height: d.height } : { x: e.x * f + (c.x - e.x) * h + (d.x - c.x) * i, y: e.y * f + (c.y - e.y) * h + (d.y - c.y) * i, width: d.width, height: d.height } : { x: e.x * f + (c.x - e.x) * h + (d.x - c.x) * i, y: e.y * f + (c.y - e.y) * h + (d.y - c.y) * i + g * (a.textHeight - 4) * i, width: d.width, height: a.textHeight } }, _getAttachmentZoomRect: function(a, c, d) { var e = this.getLocationZoom(), f = a.getElementUI(), g = this.getSizeZoom(a.getElementUI()), h = this.getAttachmentSizeZoom(a), i = a._pointers; if (e == 1 && h == 1 && g == 1) return d == b ? c : { x: c.x, y: c.y + d * (a.textHeight - 4), width: c.width, height: a.textHeight }; var f = a.getElementUI(), j = this._getZoomPoint(f, a), k = (j.x, j.y, a.getPosition ? a.getPosition() : 'center'), l = i ? i[0] : Rd.get(k, c); return d == b ? f instanceof Ib.vector.LinkUI || f instanceof Ib.vector.GroupUI && f._shapeRect ? this._getZoomContentRect(a, l, c, j, 1) : this._getZoomContentRect(a, l, c, j, e) : this._getZoomContentRect(a, l, c, j, e, d) }, _getZoomPoint: function(a, b) { var c, d, e = a._element; if (e instanceof Ib.Follower && e.getHost() && e.getHost() instanceof Ib.Grid) return c = e.getHost(), d = c.getRect(), { x: d.x + d.width / 2, y: d.y + d.height / 2 }; if (d = a.getBodyRect(), a instanceof Ib.vector.LinkUI && b && b.getPosition) { { b.getXOffset(), b.getYOffset() } if (b.getPosition() === 'from') return a._fromPoint; if (b.getPosition() === 'to') return a._toPoint } return { x: d.x + d.width / 2, y: d.y + d.height / 2 } }, _getZoomPointers: function(a, b, c) { if (c) { var d = this._getZoomPoint(b), e = this.getLocationZoom(), f = this.getSizeZoom(b), g = this.getAttachmentSizeZoom(a), h = c[0]; return b instanceof Ib.vector.LinkUI ? [{ x: d.x + (h.x - d.x) * f, y: d.y + (h.y - d.y) * f }, { x: d.x + (h.x - d.x) * f + (c[1].x - h.x) * g, y: d.y + (h.y - d.y) * f + (c[1].y - h.y) * g }, { x: d.x + (h.x - d.x) * f + (c[2].x - h.x) * g, y: d.y + (h.y - d.y) * f + (c[2].y - h.y) * g }] : b instanceof Ib.vector.GroupUI && b._shapeRect ? [{ x: d.x + 1 * (h.x - d.x), y: d.y + 1 * (h.y - d.y) }, { x: d.x + 1 * (h.x - d.x) + (c[1].x - h.x) * g, y: d.y + 1 * (h.y - d.y) + (c[1].y - h.y) * g }, { x: d.x + 1 * (h.x - d.x) + (c[2].x - h.x) * g, y: d.y + 1 * (h.y - d.y) + (c[2].y - h.y) * g }] : [{ x: d.x * e + (h.x - d.x) * f, y: d.y * e + (h.y - d.y) * f }, { x: d.x * e + (h.x - d.x) * f + (c[1].x - h.x) * g, y: d.y * e + (h.y - d.y) * f + (c[1].y - h.y) * g }, { x: d.x * e + (h.x - d.x) * f + (c[2].x - h.x) * g, y: d.y * e + (h.y - d.y) * f + (c[2].y - h.y) * g }] } }, _getZoomHotSpot: function(a, b) { if (b) { var c = this._getZoomPoint(a), d = this.getLocationZoom(), e = this.getSizeZoom(a); return { x: c.x * d + (b.x - c.x) * e, y: c.y * d + (b.y - c.y) * e } } return null }, limitZoom: function(a) { return a }, _isVisible: function(a) { var b, c = this._getZoomVisibilityThresholds(), d = c[a]; if (d != null) { var e = c.zoomName; if (b = e == 'sizeZoom' ? this.getSizeZoom() : e == 'locationZoom' ? this.getLocationZoom() : e == 'graphicsZoom' ? this.getGraphicsZoom() : this.getZoom(), d > b) return !1 } return !0 }, isElementVisible: function(a) { var b = this.getZoom(), c = this._isVisible('element', b); return c && a instanceof Ib.Link ? this.isLinkVisible(a) : c }, isLinkVisible: function(a) { var b = this.getZoom(); return this._isVisible('link', b) }, isLabelVisible: function(a) { var b = this.getZoom(); return this._isVisible('label', b) }, isAttachmentVisible: function(a) { var b = this.getZoom(); return this._isVisible('attachment', b) }, isAlarmBalloonVisible: function(a) { var b = this.getZoom(); return this._isVisible('alarmBallon', b) }, _getAttachmentOutLineWidth: function(a) { return a.getOutlineWidth() }, _getAttachmentZoomOutLineRect: function(a, b) { var c = this.getLocationZoom(), d = this.getAttachmentSizeZoom(a); if (c == 1 && d == 1) return b; var e = this._getAttachmentZoomRect(a, b, null), f = a.getElement(); return this.isAttachmentVisible(f) ? (a instanceof Ib.vector.LabelAttachment || a instanceof Ib.vector.Label2Attachment) && !this.isLabelVisible(f) ? { x: e.x, y: e.x, width: 0, height: 0 } : a instanceof Ib.vector.AlarmAttachment && !this.isAlarmBalloonVisible(f) ? { x: e.x, y: e.x, width: 0, height: 0 } : { x: e.x, y: e.y, width: e.width * d, height: e.height * d } : { x: e.x, y: e.x, width: 0, height: 0 } }, _drawText: function(a, b, c, d, e, f, g) { var h = this.getLocationZoom(), i = this.getAttachmentSizeZoom(a); h != 1 && i != 1 ? (b.translate(d.x, d.y), b.scale(i, i), Xb.drawText(b, c, { x: 0, y: 0, width: d.width, height: d.height }, e, f, g), b.scale(1 / i, 1 / i), b.translate(-d.x, -d.y)) : Xb.drawText(b, c, d, e, f, g) }, _getOffset: function(a, b) { var c = this.getLocationZoom(); return { x: (a.x - b.x) / c, y: (a.y - b.y) / c } } }); var Rd = { 'topleft.topleft': function(a) { return { x: a.x + a.width, y: a.y + a.height } }, 'topleft.topright': function(a) { return { x: a.x, y: a.y + a.height } }, 'top.top': function(a) { return { x: a.x + a.width / 2, y: a.y + a.height } }, 'topright.topleft': function(a) { return { x: a.x + a.width, y: a.y + a.height } }, 'topright.topright': function(a) { return { x: a.x, y: a.y + a.height } }, topleft: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, top: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, topright: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, 'topleft.bottomleft': function(a) { return { x: a.x + a.width, y: a.y } }, 'topleft.bottomright': function(a) { return { x: a.x, y: a.y } }, 'top.bottom': function(a) { return { x: a.x + a.width / 2, y: a.y } }, 'topright.bottomleft': function(a) { return { x: a.x + a.width, y: a.y } }, 'topright.bottomright': function(a) { return { x: a.x, y: a.y } }, 'left.left': function(a) { return { x: a.x + a.width, y: a.y + a.height / 2 } }, left: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, 'left.right': function(a) { return { x: a.x, y: a.y + a.height / 2 } }, center: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, 'right.left': function(a) { return { x: a.x + a.width, y: a.y + a.height / 2 } }, right: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, 'right.right': function(a) { return { x: a.x, y: a.y + a.height / 2 } }, 'bottomleft.topleft': function(a) { return { x: a.x + a.width, y: a.y + a.height } }, 'bottomleft.topright': function(a) { return { x: a.x, y: a.y + a.height } }, 'bottom.top': function(a) { return { x: a.x + a.width / 2, y: a.y + a.height } }, 'bottomright.topleft': function(a) { return { x: a.x + a.width, y: a.y + a.height } }, 'bottomright.topright': function(a) { return { x: a.x, y: a.y + a.height } }, bottomleft: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, bottom: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, bottomright: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, 'bottomleft.bottomleft': function(a) { return { x: a.x + a.width, y: a.y } }, 'bottomleft.bottomright': function(a) { return { x: a.x, y: a.y } }, 'bottom.bottom': function(a) { return { x: a.x + a.width / 2, y: a.y } }, 'bottomright.bottomleft': function(a) { return { x: a.x + a.width, y: a.y } }, 'bottomright.bottomright': function(a) { return { x: a.x, y: a.y } }, from: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, to: function(a) { return { x: a.x + a.width / 2, y: a.y + a.height / 2 } }, get: function(a, b) { if (!b) throw 'rect can not be null'; var c = Rd[a]; if (c) return c(b); throw "Can not resolve '" + a + "' position" } }; Ib.vector.PhysicalZoomManager = function(a) { Ib.vector.PhysicalZoomManager.superClass.constructor.apply(this, arguments) }, Jb.ext('twaver.vector.PhysicalZoomManager', Ib.vector.BaseZoomManager, { getGraphicsZoom: function() { return this.getZoom() }, _invalidateZoom: function() {} }), Ib.vector.LogicalZoomManager = function(a, b) { Ib.vector.LogicalZoomManager.superClass.constructor.apply(this, arguments), this.sizeChange = b }, Jb.ext('twaver.vector.LogicalZoomManager', Ib.vector.BaseZoomManager, { getLocationZoom: function() { return this.getZoom() }, getSizeZoom: function(a) { return this.sizeChange ? this.getZoom() : 1 } }), Ib.vector.MixedZoomManager = function(a, b) { Ib.vector.MixedZoomManager.superClass.constructor.call(this, a, b) }, Jb.ext('twaver.vector.MixedZoomManager', Ib.vector.LogicalZoomManager, {}), (function() { function a(a) { d[a] = function() { return this.getZoom() > 1 ? b[a].apply(this, arguments) : c[a].apply(this, arguments) } } var b = Ib.vector.LogicalZoomManager.prototype, c = Ib.vector.PhysicalZoomManager.prototype, d = Ib.vector.MixedZoomManager.prototype; for (var e in c) typeof c[e] === 'function' && e != 'constructor' && (b.hasOwnProperty(e) || c.hasOwnProperty(e)) && a(e); d._invalidateZoom = function() { this.network.invalidateElementUIs() } }()), Ib.vector.interaction.BaseInteraction = function(a) { this.network = a }, Jb.ext('twaver.vector.interaction.BaseInteraction', Object, { setUp: function() {}, tearDown: function() {}, repaint: function() { this.network.repaintTopCanvas() }, getOffset: function(a, b) { return this.network.getOffset(a, b) }, convertPointFromView: function(a) { return this.network.convertPointFromView(a) }, convertFromUIToMarkerRect: function(a, b, c, d) { var e = this.network.zoomManager, f = e.getLocationZoom(), g = e.getGraphicsZoom(), h = e.getSizeZoom(this.network.getElementUI(d)); return { x: a.x * f * g - this.network.getViewRect().x + b * f * g, y: a.y * f * g - this.network.getViewRect().y + c * f * g, width: a.width * h * g, height: a.height * h * g } }, getMarkerPoint: function(a) { var b; if (Qb.isTouchable && a.changedTouches && a.changedTouches.length > 0) { var c = a.changedTouches[0]; return b = { x: c.clientX, y: c.clientY } } return b = Qb.isFirefox ? { x: a.layerX, y: a.layerY } : { x: a.offsetX, y: a.offsetY } }, paint: function(a) {}, addListener: function() { for (var a = 0; a < arguments.length; a++) { var b = arguments[a]; Wb.addEventListener(b, 'handle_' + b, this.network.getView(), this) } }, removeListener: function() { for (var a = 0; a < arguments.length; a++)Wb.removeEventListener(arguments[a], this.network.getView(), this) }, _handle_mousedown: function(a) { a.button === 0 && (this._startLogical = this.network.getLogicalPoint2(a), this._startClient = Wb.getClientPoint(a), this._startLogical && Wb.handle_mousedown(this, a)) }, _handle_mousemove: function(a) { this._endLogical = { x: this._startLogical.x + (a.clientX - this._startClient.x) / this.network.getGraphicsZoom(), y: this._startLogical.y + (a.clientY - this._startClient.y) / this.network.getGraphicsZoom() } }, _handle_mouseup: function(a) { delete this._startClient, delete this._startLogical, delete this._endLogical } }), Ib.vector.interaction.DefaultInteraction = function(a, b) { Ib.vector.interaction.DefaultInteraction.superClass.constructor.call(this, a), this.lazyMode = b }, Jb.ext('twaver.vector.interaction.DefaultInteraction', Ib.vector.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mouseover', 'mouseout', 'keydown'), Qb.isFirefox ? Wb.addEventListener('DOMMouseScroll', 'handleMouseWheel', this.network.getView(), this) : Wb.addEventListener('mousewheel', 'handleMouseWheel', this.network.getView(), this), Wb.addEventListener('mouseup', 'handle_mouseup', a, this), Wb.addEventListener('dblclick', 'handleDoubleClicked', this.network.getView(), this), this._oldCursor = this.network.getView().style.cursor, this.network.addPropertyChangeListener(this.handleViewRectChange, this), this.validateScrollBar(), this.network.addMarker(this), this.network.getView().oncontextmenu = function(a) { a.preventDefault() }, this._createZoomDiv() }, tearDown: function() { this.removeListener('mousedown', 'mouseover', 'mouseout', 'keydown'), Qb.isFirefox ? Wb.removeEventListener('DOMMouseScroll', this.network.getView(), this) : Wb.removeEventListener('mousewheel', this.network.getView(), this), Wb.removeEventListener('mouseup', a, this), Wb.removeEventListener('dblclick', this.network.getView(), this), this.network.removePropertyChangeListener(this.handleViewRectChange, this), this.end(), this.network.removeMarker(this), this._zoomDiv = null }, _createZoomDiv: function() { if (this._zoomDiv == null) { this._zoomDiv = Ob.createElement('div'), this._zoomLabel = Ob.createElement('span'), this._zoomLabel.style.display = 'block', this._zoomLabel.style.textAlign = 'center'; var b = Ob.createElement('button'); b.innerHTML = 'Reset to default', this._zoomDiv.appendChild(this._zoomLabel), this._zoomDiv.appendChild(b); var c = Ed, d = this._zoomDiv.style; d.position = 'absolute', d.color = c.TOOLTIP_COLOR, d.background = c.TOOLTIP_BACKGROUND, d.fontSize = c.TOOLTIP_FONT_SIZE, d.padding = c.TOOLTIP_PADDING, d.border = c.TOOLTIP_BORDER, d.borderRadius = c.TOOLTIP_BORDER_RADIUS, d.boxShadow = c.TOOLTIP_BOX_SHADOW, d.zIndex = c.TOOLTIP_ZINDEX, d.setProperty && d.setProperty('-webkit-box-shadow', c.TOOLTIP_BOX_SHADOW, null); var e = this; b.onclick = function(a) { e.network.setZoom(1), e._setZoomDivVisible(!1) }; var f = this._zoomDiv, g = function() { return f.style.opacity = parseFloat(f.style.opacity) - 0.05, parseFloat(f.style.opacity) <= 0.05 ? (e._setZoomDivVisible(!1), void (f._clearTimeout = null)) : void (f._clearTimeout = setTimeout(f._clearFunc, 100)) }; f._clearFunc = g, f.onmouseover = function(b) { b || (b = a.event); for (var c = b.relatedTarget ? b.relatedTarget : b.fromElement; c && c != f;)c = c.parentNode; c != f && (f._clearTimeout && (clearTimeout(f._clearTimeout), f._clearTimeout = null), f.style.opacity = 1) }, f.onmouseout = function(b) { b || (b = a.event); for (var c = b.relatedTarget ? b.relatedTarget : b.toElement; c && c != f;)c = c.parentNode; c != f && (f._clearTimeout = setTimeout(f._clearFunc, 10)) } } }, _isZoomDivVisible: function() { return this._zoomDiv != null && this._zoomDiv.parentNode != null }, _getZoomDiv: function() { return this._zoomDiv || this._createZoomDiv(), this._zoomDiv }, _setZoomDivVisible: function(a, b, c) { var d = this._getZoomDiv(); if (a) { this._zoomLabel.innerHTML = c, d.style.opacity = 1, this._isZoomDivVisible() || this.network.getView().appendChild(d), d.style.left = Ed.TOOLTIP_XOFFSET + 'px', d.style.top = Ed.TOOLTIP_YOFFSET + 'px'; d._clearTimeout && (clearTimeout(d._clearTimeout), d._clearTimeout = null), d._clearTimeout = setTimeout(d._clearFunc, 250) } else d.parentNode && d.parentNode.removeChild(d) }, handleViewRectChange: function(a) { (a.property == 'viewRect' || a.property == 'canvasSizeChange') && this.validateScrollBar() }, getScrollBarWidth: function() { return this.network.getScrollBarWidth() }, getScrollBarColor: function() { return '#cccccc' }, validateScrollBar: function() { if (this.hThumbRect = null, this.vThumbRect = null, this.network.isScrollBarVisible() == 0) return void this.repaint(); var a = this.network.getViewRect().height, b = this.network.getViewRect().width, c = this.network.getViewRect().x, d = this.network.getViewRect().y, e = this.network.getCanvasSize(), f = this.network._unionBounds, g = f.x, h = f.y, i = f.width, j = f.height, k = e.width, l = e.height, m = b, n = a, o = !1, p = !1; (c > g || k > b + c) && (p = !0), (d > h || l > d + a) && (o = !0); var q, r, s, t = 0, u = 0, v = 0, w = 0, x = m, y = n, z = this.getScrollBarWidth(); p && (o && (x -= z), w = z, u = n - z, c > g && c + b > k ? (q = c - g, q = q * x / (q + m), t = q, v = x - q) : g > c && k > c + b ? (q = k - (c + b), q = x * q / (q + m), t = 0, v = x - q) : (r = c - g, s = k - (c + b), r = x * r / i, s = x * s / i, t = r, v = m - r - s), this.hThumbRect = { x: t, y: u, width: v, height: w }), t = 0, u = 0, v = 0, w = 0, x = m, y = n, o && (p && (y -= z), v = z, t = m - z, d > h && d + a > l ? (q = d - h, q = y * q / (q + n), u = q, w = y - q) : h > d && l > d + a ? (q = l - (d + a), q = y * q / (q + n), u = 0, w = y - q) : (r = d - h, s = l - (d + a), r = y * r / j, s = y * s / j, u = r, w = y - r - s), this.vThumbRect = { x: t, y: u, width: v, height: w }), this.network.setHScrollBarVisible(this.hThumbRect != null), this.network.setVScrollBarVisible(this.vThumbRect != null), this.repaint() }, scrollXOffset: function(a) { var b = this.network.getViewRect().height, c = this.network.getViewRect().width, d = this.network.getViewRect().x, e = this.network.getViewRect().y, f = 30; a && (f = -30), this.network.setViewRect(d + f, e, c, b) }, scrollYOffset: function(a) { var b = this.network.getViewRect().height, c = this.network.getViewRect().width, d = this.network.getViewRect().x, e = this.network.getViewRect().y, f = 30; a && (f = -30), this.network.setViewRect(d, e + f, c, b) }, handle_mouseover: function(a) { this.scrollBarVisible != 1 && (this.scrollBarVisible = !0, this.repaint()) }, handle_mouseout: function(a) { this.scrollBarVisible != 0 && (this.scrollBarVisible = !1, this.repaint(), this.end(a)) }, handle_keydown: function(a) { this.currentKeyEvent = a, this.addListener('keyup'), Cc.handleKeyDown(this.network, a) }, handle_keyup: function(a) { this.currentKeyEvent = null, this.removeListener('keyup') }, start: function(b) { this.end(b, !0), this.lastPoint = this.network.getLogicalPoint2(b), this.startPoint = this.network.getLogicalPoint2(b), this.lastPanPoint = this.getMarkerPoint(b), this.lazyMode && (this.pressPoint = this.lastPoint), Wb.addEventListener('mousemove', 'handle_mousemove', a, this) }, end: function(b, c) { if (this.vBarDownPoint = null, this.hBarDownPoint = null, c || (this.network.getView().style.cursor = this._oldCursor), this.isMoving) { if (this.lazyMode) { if (this.dragPoint != null && this.pressPoint != null) { var d = this, e = function() { d.network.fireInteractionEvent({ kind: 'lazyMoveEnd', event: b }), d.network.setMovingElement(!1) }, f = this.getOffset(this.dragPoint, this.pressPoint), g = f.x, h = f.y; this.network.moveSelectedElements(g, h, this.network.isLazyMoveAnimate(), e) } } else this.network.isMovingElement() && (this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: b })); if (this.isParenting()) { this.parent == null && (this.parent = this.network.getCurrentSubNetwork()); var d = this; this.network.getMovableSelectedElements().forEach(function(a) { a.setParent(d.parent) }, this.network) } this.parentProcess(b, !0), this.isParenting() && this.repaint(), this.network.invalidateCanvasSize(), this.lastPoint = null, this.dragPoint = null, this.pressPoint = null, this.repaint() } if (this.isSelecting && this.startPoint) { if (this.endPoint && this.startPoint.x !== this.endPoint.x && this.startPoint.y !== this.endPoint.y) { var i = Tb.getRect([this.startPoint, this.endPoint]), j = this.network.getElementsAtRect(i, this.getIntersectMode(), this.network.getRectSelectFilter()); if (j && j.size() > 0) { var k = this.network.getSelectionModel(), l = k.toSelection(); j.forEach(function(a) { k.contains(a) ? l.remove(a) : l.add(a) }, this), k.setSelection(l) } this.network.fireInteractionEvent({ kind: 'selectEnd', event: b }) } this.network.setSelectingElement(!1), this.startPoint = null, this.endPoint = null, this.repaint() } this.isMouseDown = !1, Wb.removeEventListener('mousemove', a, this) }, _isDragToSelect: function(a) { return !this.network._dragToPan }, handle_mousedown: function(a) {
    var b = this.network; if (a.target == b.getView() || a.target == b._topCanvas || a.target == b._rootCanvas) {
      if (this.isMoving = !1, this.isSelecting = !1, this.hBarDownPoint = null, this.vBarDownPoint = null,
        this._setZoomDivVisible(!1), !this.network.isValidEvent(a)) { var c = this.getMarkerPoint(a); return this.start(a), this.vThumbRect != null && Tb.containsPoint(this.vThumbRect, c.x, c.y) && (this.vBarDownPoint = { x: a.screenX, y: a.screenY }, this.vBarDownOffset = this.vBarDownPoint.y - this.vThumbRect.y), void (this.hThumbRect != null && Tb.containsPoint(this.hThumbRect, c.x, c.y) && (this.hBarDownPoint = { x: a.screenX, y: a.screenY }, this.hBarDownOffset = this.hBarDownPoint.x - this.hThumbRect.x)) } this.network.isFocusOnClick() && Ib.Util.setFocus(this.network.getView()); var d = this.network.getElementAt(a); if (this.network.isSelectingElement() || this.network.isEditingElement() || d == null || (this.network.isMovable(d) && this.network.getElementBox().getSelectionModel().isSelectable(d) ? this.isMoving = !0 : this.network.getView().style.cursor = 'pointer', this.start(a)), !this.network.isSelectingElement() && !this.network.isEditingElement()) { var e = this.network.getSelectionModel(); d == null || d && !this.network.getElementBox().getSelectionModel().isSelectable(d) ? (Jb.isCtrlDown(a) ? this.isSelecting = !0 : this._isDragToSelect(a) ? (this.isSelecting = !0, e.clearSelection()) : this.network.isRectSelectEnabled() && (e.clearSelection(), this.network.getView().style.cursor = 'pointer'), this.start(a)) : Jb.isCtrlDown(a) ? e.contains(d) ? e.removeSelection(d) : e.appendSelection(d) : e.contains(d) || e.setSelection(d) } this.handleClicked(a, d), this.isMouseDown = !0
    }
  }, handle_mousemove: function(a) { this._setZoomDivVisible(!1); var b = this.network.getLogicalPoint2(a); if (b) { var c = { x: a.screenX, y: a.screenY }, d = this.network.getCanvasSize(), e = this.network.getViewRect().height, f = this.network.getViewRect().width, g = this.getScrollBarWidth(); if (this.hBarDownPoint != null) { var h = c.x - this.hBarDownPoint.x; return this.hBarDownPoint = c, void this.network.setViewOffSet(h * d.width / (f - g), 0) } if (this.vBarDownPoint != null) { var i = c.y - this.vBarDownPoint.y; return this.vBarDownPoint = c, void this.network.setViewOffSet(0, i * d.height / (e - g)) } if (this.network.isSelectingElement() || this.network.isEditingElement() || !this.isMoving || !this.isMouseDown || Jb.isCtrlDown(a)) if (this.isSelecting && (Jb.isCtrlDown(a) || this._isDragToSelect())) this.network.setSelectingElement(!0), this.network.fireInteractionEvent(this.endPoint == null ? { kind: 'selectStart', event: a } : { kind: 'selectBetween', event: a }), this.endPoint = b, this.repaint(); else if (this.isMoving || this.isSelecting || !this.isMouseDown) this.end(a); else { if (!this.lastPanPoint || !this.network._dragToPan) return; var b = this.getMarkerPoint(a); if (!b) return; var j = b.x - this.lastPanPoint.x, k = b.y - this.lastPanPoint.y; this.network.panByOffset(-j, -k), this.lastPanPoint = b } else { var l = this.getOffset(b, this.lastPoint); if (this.xoffset = l.x, this.yoffset = l.y, Math.abs(this.xoffset) < 1 && Math.abs(this.yoffset) < 1) return; this.lazyMode ? this.dragPoint == null ? (this.network.fireInteractionEvent({ kind: 'lazyMoveStart', event: a }), this.network.setMovingElement(!0)) : this.network.fireInteractionEvent({ kind: 'lazyMoveBetween', event: a }) : (this.lastPoint = b, this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a })), this.network.moveSelectedElements(this.xoffset, this.yoffset)), this.parentProcess(a, !1), this.lazyMode && (this.dragPoint = b), (this.lazyMode || this.isParenting()) && this.repaint() } } }, handleMouseWheel: function(a) { if (Ob.activeElement === this.network.getView()) { if (!this.network._wheelToZoom) return void this._handleMouseWheelScroll(a); Wb.preventDefault(a); var b = { x: a.offsetX || a.layerX, y: a.offsetY || a.layerY }, c = this.network.getZoom(); a.wheelDelta && a.wheelDelta > 0 || a.detail && a.detail < 0 ? this.network.setZoom(1.1 * c, b) : this.network.setZoom(c / 1.1, b), this._setZoomDivVisible(this.network.isZoomDivVisible(), a, 'Zoom : ' + parseFloat(this.network.getZoom().toFixed(4))) } }, _handleMouseWheelScroll: function(a) { Wb.preventDefault(a); var b = !1, c = this._getVisibleScrollBar(); c != null && (b = a.wheelDelta ? a.wheelDelta > 0 : a.detail < 0, c == 'v' ? this.scrollYOffset(b) : this.scrollXOffset(b)) }, handle_mouseup: function(a) { this.end(a) }, isParenting: function() { return this.pressPoint && this.currentKeyEvent != null && this.currentKeyEvent.keyCode === 80 }, parentProcess: function(a, b) { var c = null; this.parent = null; var d = this; if (!b && this.isParenting()) { var e = {}, f = this.network.getLogicalPoint2(a); e.x = f.x - 1, e.y = f.y - 1, e.width = 2, e.height = 2; var g = this.network.getElementsAtRect(e, !0); if (g && g.size() > 0) for (var h = g.size(), i = 0; h > i; i++) { var j = g.get(i); if (!d.network.getElementBox().getSelectionModel().contains(j)) { d.parent = j; break } } } else this.parent = null; this.parent != null && (c = this.network.getElementUI(this.parent).getViewRect()), this.parentRect = c == null || b ? null : c }, getIntersectMode: function() { return this.network.getSelectMode() === 'intersect' ? !0 : this.network.getSelectMode() === 'contain' ? !1 : this.startPoint.x > this.endPoint.x && this.startPoint.y > this.endPoint.y }, _getVisibleScrollBar: function() { return this.network.isScrollBarVisible() == 0 ? null : this.vThumbRect != null ? 'v' : this.hThumbRect != null ? 'h' : null }, paintScroll: function(a) { if (this.network.isScrollBarVisible() != 0 && (this.scrollBarVisible != 0 || this.hBarDownPoint != null || this.vBarDownPoint != null)) { var b = this.getScrollBarWidth(), c = this.network.getViewRect().height, d = this.network.getViewRect().width; a.save(); var e, f = this.getScrollBarColor(); this.hThumbRect != null && (e = a.createLinearGradient(this.hThumbRect.x, this.hThumbRect.y, this.hThumbRect.x, this.hThumbRect.y + this.hThumbRect.height), e.addColorStop(0, f), e.addColorStop(1, '#666666'), this.paintRoundRect(a, this.getScrollBarColor(), 0.5, 0, c - b, d - b, b, b / 2), this.paintRoundRect(a, e, 0.9, this.hThumbRect.x, this.hThumbRect.y + 1, this.hThumbRect.width, this.hThumbRect.height - 2, b / 2)), this.vThumbRect != null && (e = a.createLinearGradient(this.vThumbRect.x, this.vThumbRect.y, this.vThumbRect.x + this.vThumbRect.width, this.vThumbRect.y), e.addColorStop(0, f), e.addColorStop(1, '#666666'), this.paintRoundRect(a, this.getScrollBarColor(), 0.5, d - b, 0, b, c - b, b / 2), this.paintRoundRect(a, e, 0.9, this.vThumbRect.x + 1, this.vThumbRect.y, this.vThumbRect.width - 2, this.vThumbRect.height, b / 2)), a.restore() } }, paintRoundRect: function(a, b, c, d, e, f, g, h) { a.beginPath(), a.globalAlpha = c, a.fillStyle = b, Xb.drawRoundRect(a, d, e, f, g, h), a.fill() }, paint: function(a) { if (this.paintScroll(a), this.network.isSelectingElement()) { if (this.startPoint == null || this.endPoint == null) return; var b = this.convertPointFromView(this.startPoint), c = this.convertPointFromView(this.endPoint), d = b.x, e = b.y, f = c.x, g = c.y, h = Tb.getRect([{ x: d, y: e }, { x: f, y: g }]); if (h != null) { a.beginPath(); var i = this.network.getSelectOutlineWidth(), j = this.getIntersectMode() ? this.network.getSelectFillColor() : null; a.strokeStyle = this.network.getSelectOutlineColor(), a.lineWidth = i, Od.rect(a, h.x, h.y, h.width, h.height, j, this.network.getSelectOutlineColor()), a.closePath() } } else { if (this.lazyMode) { if (this.pressPoint == null || this.dragPoint == null) return; a.beginPath(); var k = this.getOffset(this.dragPoint, this.pressPoint), l = k.x, m = k.y, n = this.network.getMovableSelectedElements(), o = n.size(), p = this.network.isLazyMoveFill() ? this.network.getLazyMoveFillColor() : null, i = this.network.getLazyMoveOutlineWidth(), q = this.network.getLazyMoveOutlineColor(); a.strokeStyle = q, a.lineWidth = i, a.fillStyle = p; for (var r = 0; o > r; r++) { var s = n.get(r), t = this.network.getElementUI(s); if (t) { var u = this.convertFromUIToMarkerRect(t.getViewRect(), l, m); Od.rect(a, u.x, u.y, u.width, u.height) } }a.fill(), a.stroke() } if (this.parentRect) { a.beginPath(); var p = this.network.isLazyMoveFill() ? this.network.getLazyMoveFillColor() : null, i = this.network.getLazyMoveOutlineWidth(), q = this.network.getLazyMoveOutlineColor(); a.strokeStyle = q, a.lineWidth = i, a.fillStyle = p; var u = this.parentRect; Od.rect(a, u.x, u.y, u.width, u.height), a.fill(), a.stroke() } } }, handleClicked: function(a, b) { Cc.handleClicked(this.network, a, b) }, handleDoubleClicked: function(a) { var b = this.network.getElementAt(a); Cc.handleDoubleClicked(this.network, a, b) } }), Ib.vector.interaction.CreateElementInteraction = function(a, b) { b || (b = Ib.Node), this.elementFunction = Ib.Util.isTypeOf(b, Ib.Node) ? function(a) { var c = new b(); return c instanceof Ib.Node && c.setCenterLocation(a), c } : b, Ib.vector.interaction.CreateElementInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.vector.interaction.CreateElementInteraction', Ib.vector.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown') }, tearDown: function() { this.removeListener('mousedown') }, handle_mousedown: function(a) { var b = this.network.getLogicalPoint2(a); if (b) { var c = this.elementFunction(b); c && this.network.addElementByInteraction(c) } } }), Ib.vector.interaction.EditInteraction = function(a, b) { this.lazyMode = b, this.pointIndex = -1, this.linkPointsType = null, Ib.vector.interaction.EditInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.vector.interaction.EditInteraction', Ib.vector.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mouseup', 'mousemove'), this.oldCursor = this.network.getView().style.cursor, this.network.setHasEditInteraction(!0), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mouseup', 'mousemove'), this.network.getView().style.cursor = this.oldCursor, this.network.setHasEditInteraction(!1), this.clear(), this.network.removeMarker(this) }, paint: function(a) { if (this.lazyMode == 1 && this.resizingRect != null) { a.lineWidth = this.network.getResizeLineWidth(); var b = this.convertFromUIToMarkerRect(this.resizingRect, 0, 0, this.node); a.save(), Ib.Util.rotateCanvas(a, b, this.node.getAngle()), a.beginPath(), Od.rect(a, b.x, b.y, b.width, b.height, null, this.network.getResizeLineColor()), a.restore() } this.isStartRotate && this.showRotateScale(a) }, clear: function() { this.network.setEditingElement(!1), this.network.setRotatingElement(!1), this.isStart = !1, this.isStartRotate = !1, this.node = null, this.shapeNode = null, this.shapeLink = null, this.linkUI = null, this.resizingRect = null, this.resizeDirection = null, this.pointIndex = -1, this._removeCursor(), this.oldCursor = null, this.network.repaintTopCanvas() }, _removeCursor: function() { this.cursorID && (this.network.getView().style.cursor = this.oldCursor || 'default', this.cursorID = null), this.resizeDirection = null, this.isCrossCursor = !1 }, _setCrossCursor: function() { this.isCrossCursor || (this._removeCursor(), this._setCursor('crosshair'), this.isCrossCursor = !0) }, _setCursor: function(a) { this.cursorID = a, this.network.getView().style.cursor !== this.cursorID && (this.network.getView().style.cursor = this.cursorID) }, handle_mousedown: function(a) { if (a.button === 0) if (!Jb.isAltDown(a) || this.network.isEditingElement())!this.network.isEditingElement() || this.isStart || this.isStartRotate || (this.node && this.resizeDirection ? (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: this.lazyMode ? 'lazyResizeStart' : 'liveResizeStart', event: a, element: this.node, resizeDirection: this.resizeDirection })) : this.shapeNode && this.pointIndex >= 0 ? Jb.isAltDown(a) ? (this.shapeNode.removeAt(this.pointIndex), this.network.fireInteractionEvent({ kind: 'removePoint', event: a, element: this.shapeNode })) : (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.shapeNode, pointIndex: this.pointIndex })) : this.shapeLink ? Jb.isAltDown(a) ? this.pointIndex >= 0 && (this.shapeLink.removeAt(this.pointIndex), this.network.fireInteractionEvent({ kind: 'removePoint', event: a, element: this.shapeLink })) : (this.isStart = !0, this._handle_mousedown(a), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.shapeLink, pointIndex: this.pointIndex })) : this.linkUI ? (this.isStart = !0, this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: this.linkUI._element })) : this.node && (this.isStartRotate = !0, this._handle_mousedown(a))); else { var b = this.network.getElementAt(a), c = this.network.getLogicalPoint2(a); if (b instanceof Ib.ShapeNode) { var d = this.getPointIndex(this.network.getShapeNodeZoomPoints(b), c, !0); d > 0 && (this._handle_mousedown(a), this.pointIndex = d, this.shapeNode = b, b.addPoint(c, d), this._setCrossCursor(), this.network.setEditingElement(!0), this.isStart = !0, this.network.fireInteractionEvent({ kind: 'addPoint', event: a, element: b, pointIndex: d }), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: b, pointIndex: d })) } if (b instanceof Ib.ShapeLink) { var e = new Ib.List(b.getPoints()), f = this.network.getElementUI(b); e.add(f.getFromPoint(), 0), e.add(f.getToPoint()); var d = this.getPointIndex(e, c) - 1; d > 0 && (this._handle_mousedown(a), this.pointIndex = d, this.shapeLink = b, b.addPoint(c, d), this._setCrossCursor(), this.network.setEditingElement(!0), this.isStart = !0, this.network.fireInteractionEvent({ kind: 'addPoint', event: a, element: b, pointIndex: d }), this.network.fireInteractionEvent({ kind: 'liveMovePointStart', event: a, element: b, pointIndex: d })) } } }, handle_mouseup: function(a) { if (this.isStart) { var b = this.network.getLogicalPoint2(a); if (this.resizingRect) if (this.lazyMode) if (this.network.isResizeAnimate()) { var c = this, d = new Ib.animate.AnimateBounds(this.node, this.resizingRect, function() { c.network.fireInteractionEvent({ kind: 'lazyResizeEnd', event: a, element: c.node, resizeDirection: c.resizeDirection }), c.clear() }); Ib.animate.AnimateManager.start(d) } else this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.network.fireInteractionEvent({ kind: 'lazyResizeEnd', event: a, element: this.node, resizeDirection: this.resizeDirection }); else this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.network.fireInteractionEvent({ kind: 'liveResizeEnd', event: a, element: this.node, resizeDirection: this.resizeDirection }); else this.shapeNode && this.pointIndex >= 0 && b ? (this._resetShapeNodePoints(b), this.network.fireInteractionEvent({ kind: 'liveMovePointEnd', event: a, element: this.shapeNode, pointIndex: this.pointIndex })) : b && (this.shapeLink || this.linkUI) && (this.linkPointsType === 'from' ? this._setFromPoint(b) : this.linkPointsType === 'to' ? this._setToPoint(b) : this.linkPointsType === 'shapeControl' ? (this._resetShapeLinkPoints(b), this.network.fireInteractionEvent({ kind: 'liveMovePointEnd', event: a, element: this.shapeLink, pointIndex: this.pointIndex })) : this.linkPointsType === 'control' && xc.isOrthogonalLink(this.linkUI._element) && this.linkUI.getControlPoint() && (this._setLinkControlPoint(b), this.network.fireInteractionEvent({ kind: 'liveMovePointEnd', event: a, element: this.linkUI._element }))) } this._handle_mouseup(a), this.lazyMode || this.clear() }, handle_mousemove: function(a) { var b = this.network.getEditPointSize(); if (this.network.isValidEvent(a)) { if (this.isStartRotate && this.node) return this._handleRotateElement(a, this.node), void (this.network.isShowRotateScale() && this.repaint()); if (this.isStart) { if (this.shapeNode && this.pointIndex >= 0) return void this._handleMovingShapeNodePoint(a); if (this.node && this.resizeDirection) return void this._handleResizing(a); if ((this.shapeLink || this.linkUI) && this.linkPointsType) { if (this.linkPointsType === 'from') return void this._handleMovingFromPoint(a); if (this.linkPointsType === 'to') return void this._handleMovingToPoint(a); if (this.linkPointsType === 'shapeControl') return void this._handleMovingShapeLinkPoint(a); if (this.linkPointsType === 'control' && xc.isOrthogonalLink(this.linkUI._element) && this.linkUI.getControlPoint()) return void this._handleMovingLinkControlPoint(a) } } if (this.network.isSelectingElement() || this.network.isMovingElement() || this.network.getSelectionModel().size() === 0) return void this.clear(); var c = this.network.getElementAt(a), d = this.network.getElementUI(c); if (!d || !d.getEditAttachment()) return void this.clear(); var e = this.network.getLogicalPoint2(a); if (c instanceof Ib.Node) { if (this.node = c, this._isEditingShapeNode(e) || this._isResizingNode(e)) return void this.network.setEditingElement(!0); if (this._isRotatingElement(e)) return this.network.setRotatingElement(!0), void this.network.setEditingElement(!0) } else if (c instanceof Ib.Link) { c instanceof Ib.ShapeLink ? this.shapeLink = c : d instanceof Ib.vector.LinkUI && (this.linkUI = d); var f, g = c.getFromAgent(); f = g ? c.getFromAgent() : c.getFromNode(); var h, i = c.getStyle('link.from.xoffset'), j = c.getStyle('link.from.yoffset'), k = f.getCenterLocation(), l = { x: k.x + i, y: k.y + j }, m = c.getToAgent(); h = m ? c.getToAgent() : c.getToNode(); var n = c.getStyle('link.to.xoffset'), o = c.getStyle('link.to.yoffset'), p = h.getCenterLocation(), q = { x: p.x + n, y: p.y + o }; if (l && this._contains(e, l, b)) return this.linkPointsType = 'from', this._setCrossCursor(), void this.network.setEditingElement(!0); if (q && this._contains(e, q, b)) return this.linkPointsType = 'to', this._setCrossCursor(), void this.network.setEditingElement(!0); if (c instanceof Ib.ShapeLink) { if (this._isEditingShapeLink(e)) return this.linkPointsType = 'shapeControl', void this.network.setEditingElement(!0) } else if (d instanceof Ib.vector.LinkUI) { if (xc.isOrthogonalLink(d._element)) { var r = this.linkUI.getControlPoint(); if (r && this._contains(e, r, b)) return this.linkPointsType = 'control', this._setCrossCursor(), void this.network.setEditingElement(!0) } return void (this.linkPointsType = null) } this.linkPointsType = null } this.clear() } }, _isRotatingElement: function(a) { var b = this.network.getRotatePointSize(); if (b <= 0) return !1; var c = this.network.zoomManager, d = this.network.getElementUI(this.node), e = c.getSizeZoom(d), f = c._getElementZoomRect(d, this.node.getOriginalRect()), g = this.node.getAngle(); return this._isRotating(a, 'crosshair', f, g, e) }, _isRotating: function(a, b, c, d, e) { var f = this.network.getRotatePointSize() / this.network.getGraphicsZoom(), g = { x: c.x + c.width / 2, y: c.y - this.network.getRotatePointOffset() / this.network.getGraphicsZoom() - f }, h = this._rotatePoint(g, d, c), i = { x: h.x - f, y: h.y - f, width: 2 * f, height: 2 * f }; return Tb.containsPoint(i, a) ? (this._removeCursor(), this._setCursor(b), !0) : !1 }, _handleRotateElement: function(a, b) { this._handle_mousemove(a); var c = this._calculateAngle(this.network.getLogicalPoint2(a), b); b.setAngle(c) }, _calculateAngle: function(a, b) { var c = this.network.getZoomBodyRect(b), d = Tb.getCenterPoint(c); return Math.round(180 * Math.atan2(d.x - a.x, a.y - d.y) / Math.PI + 180) }, _resetShapeNodePoints: function(a) { var b = this.network.getShapeNodeZoomPoints(this.shapeNode); b.set(this.pointIndex, a); var c = this.network.getElementUI(this.shapeNode), d = this.network.zoomManager._getShapeNodeZoomPoints(c, b, !0); this.shapeNode.setPoints(d) }, _handleMovingShapeNodePoint: function(a) { var b = this.network.getLogicalPoint2(a); this._resetShapeNodePoints(b), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.shapeNode, pointIndex: this.pointIndex }) }, _resetShapeLinkPoints: function(a) { var b = this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink._points); b.set(this.pointIndex, a); var c = this.network.zoomManager._getShapeLinkZoomPoints(b, !0); this.shapeLink.setPoints(c) }, _handleMovingShapeLinkPoint: function(a) { var b = this.network.getLogicalPoint2(a); this._resetShapeLinkPoints(b), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.shapeLink, pointIndex: this.pointIndex }) }, _setLinkControlPoint: function(a) { var b = this.linkUI.getControlPoint(), c = this.linkUI.getControlPoint(), d = (this.network.zoomManager, { x: a.x - c.x, y: a.y - c.y }); b.x += d.x, b.y += d.y, this.linkUI.setControlPoint(b) }, _handleMovingLinkControlPoint: function(a) { var b = this.network.getLogicalPoint2(a); this._setLinkControlPoint(b), this.network.fireInteractionEvent({ kind: 'liveMovePointBetween', e: a, element: this.linkUI._element }) }, _setFromPoint: function(a) { var b; if (this.linkUI)b = this.linkUI._element; else { if (!this.shapeLink) return; b = this.shapeLink } var c, d = b.getFromAgent(); c = d ? b.getFromAgent().getCenterLocation() : b.getFromNode().getCenterLocation(); var e = { x: a.x - c.x, y: a.y - c.y }; b.setStyle('link.from.xoffset', e.x), b.setStyle('link.from.yoffset', e.y) }, _handleMovingFromPoint: function(a) { var b = this.network.getLogicalPoint2(a); this._setFromPoint(b) }, _setToPoint: function(a) { var b; if (this.linkUI)b = this.linkUI._element; else { if (!this.shapeLink) return; b = this.shapeLink } var c, d = b.getToAgent(); c = d ? b.getToAgent().getCenterLocation() : b.getToNode().getCenterLocation(); var e = { x: a.x - c.x, y: a.y - c.y }; b.setStyle('link.to.xoffset', e.x), b.setStyle('link.to.yoffset', e.y) }, _handleMovingToPoint: function(a) { var b = this.network.getLogicalPoint2(a); this._setToPoint(b) }, convertFromUIToMarkerRect: function(a, b, c, d) { var e = this.network.zoomManager, f = e.getLocationZoom(), g = e.getGraphicsZoom(), h = this.network.getElementUI(d), i = e.getSizeZoom(h), j = a.x + a.width / 2, k = a.y + a.height / 2, l = j - a.x, m = k - a.y; return { x: j * f * g - this.network.getViewRect().x + b * f * g - l * i * g, y: k * f * g - this.network.getViewRect().y + c * f * g - m * i * g, width: a.width * i * g, height: a.height * i * g } }, _getReverseZoomPoint: function(a, b, c) { var d = this.network.zoomManager, e = d.getLocationZoom(), f = d.getSizeZoom(this.network.getElementUI(a)); return b.x *= e, b.y *= e, { x: b.x / e + (c.x - b.x) / f, y: b.y / e + (c.y - b.y) / f } }, _getReverseZoomRect: function(a, b) { var c = this.network.zoomManager, d = c.getLocationZoom(), e = c.getSizeZoom(f); if (d == e) return a; var f = this.network.getElementUI(b), g = f.getBodyRect(), h = g.x + g.width / 2, i = g.y + g.height / 2, j = { x: h * d + (a.x - h) * e, y: i * d + (a.y - i) * e, width: a.width * e, height: a.height * e }; return h = j.x + j.width / 2, i = j.y + j.height / 2, { x: h / d + (j.x - h) * e, y: i / d + (j.y - i) * e, width: a.width, height: a.height } }, _handleResizing: function(a) { this._handle_mousemove(a); var b = this.node.getAngle(), c = this.node.getLocation(), d = this.node.getWidth() / 2, e = this.node.getHeight() / 2, f = { x: c.x + d, y: c.y + e }, g = { x: -d, y: -e }, h = { x: -d, y: e }, i = { x: d, y: e }, j = { x: d, y: -e }, k = { x: 0, y: -e }, l = { x: d, y: 0 }, m = { x: 0, y: e }, n = { x: -d, y: 0 }, o = this._getReverseZoomPoint(this.node, Jb.clone(f), this._endLogical); if (this.resizeDirection === 'northwest' && (this._transformPoint(i, f, b), g.x = o.x, g.y = o.y, f.x = (g.x + i.x) / 2, f.y = (g.y + i.y) / 2, this._reversPoint(g, f, b), this._reversPoint(i, f, b), this.resizingRect = { x: g.x, y: g.y, width: i.x - g.x, height: i.y - g.y }, Jb.isShiftDown(a) && this._revertResizeRect(this.node, this.resizingRect, 1)), this.resizeDirection === 'north') { var p = { x: o.x, y: o.y }; this._reversPoint(p, f, b), k.y = p.y - f.y, this._transformPoint(k, f, b), this._transformPoint(m, f, b), f.x = (k.x + m.x) / 2, f.y = (k.y + m.y) / 2, this._reversPoint(k, f, b), this._reversPoint(m, f, b), this.resizingRect = { x: f.x - this.node.getWidth() / 2, y: f.y - (m.y - k.y) / 2, width: this.node.getWidth(), height: m.y - k.y } } if (this.resizeDirection === 'northeast' && (this._transformPoint(h, f, b), j.x = o.x, j.y = o.y, f.x = (h.x + j.x) / 2, f.y = (h.y + j.y) / 2, this._reversPoint(h, f, b), this._reversPoint(j, f, b), this.resizingRect = { x: h.x, y: j.y, width: j.x - h.x, height: h.y - j.y }, Jb.isShiftDown(a) && this._revertResizeRect(this.node, this.resizingRect, 2)), this.resizeDirection === 'west') { var p = { x: o.x, y: o.y }; this._reversPoint(p, f, b), n.x = p.x - f.x, this._transformPoint(l, f, b), this._transformPoint(n, f, b), f.x = (l.x + n.x) / 2, f.y = (l.y + n.y) / 2, this._reversPoint(l, f, b), this._reversPoint(n, f, b), this.resizingRect = { x: f.x - (l.x - n.x) / 2, y: f.y - this.node.getHeight() / 2, width: l.x - n.x, height: this.node.getHeight() } } if (this.resizeDirection === 'east') { var p = { x: o.x, y: o.y }; this._reversPoint(p, f, b), l.x = p.x - f.x, this._transformPoint(l, f, b), this._transformPoint(n, f, b), f.x = (l.x + n.x) / 2, f.y = (l.y + n.y) / 2, this._reversPoint(l, f, b), this._reversPoint(n, f, b), this.resizingRect = { x: f.x - (l.x - n.x) / 2, y: f.y - this.node.getHeight() / 2, width: l.x - n.x, height: this.node.getHeight() } } if (this.resizeDirection === 'southwest' && (this._transformPoint(j, f, b), h.x = o.x, h.y = o.y, f.x = (h.x + j.x) / 2, f.y = (h.y + j.y) / 2, this._reversPoint(h, f, b), this._reversPoint(j, f, b), this.resizingRect = { x: h.x, y: j.y, width: j.x - h.x, height: h.y - j.y }, Jb.isShiftDown(a) && this._revertResizeRect(this.node, this.resizingRect, 4)), this.resizeDirection === 'south') { var p = { x: o.x, y: o.y }; this._reversPoint(p, f, b), m.y = p.y - f.y, this._transformPoint(k, f, b), this._transformPoint(m, f, b), f.x = (k.x + m.x) / 2, f.y = (k.y + m.y) / 2, this._reversPoint(k, f, b), this._reversPoint(m, f, b), this.resizingRect = { x: f.x - this.node.getWidth() / 2, y: f.y - (m.y - k.y) / 2, width: this.node.getWidth(), height: m.y - k.y } } this.resizeDirection === 'southeast' && (this._transformPoint(g, f, b), i.x = o.x, i.y = o.y, f.x = (g.x + i.x) / 2, f.y = (g.y + i.y) / 2, this._reversPoint(g, f, b), this._reversPoint(i, f, b), this.resizingRect = { x: g.x, y: g.y, width: i.x - g.x, height: i.y - g.y }, Jb.isShiftDown(a) && this._revertResizeRect(this.node, this.resizingRect, 3)), this.resizingRect = this._getReverseZoomRect(this.resizingRect, this.node), this.lazyMode ? (this.repaint(), this.network.fireInteractionEvent({ kind: 'lazyResizeBetween', event: a, element: this.node, resizeDirection: this.resizeDirection })) : (this.node.setLocation(this.resizingRect.x, this.resizingRect.y), this.node.setSize(this.resizingRect.width, this.resizingRect.height), this.network.fireInteractionEvent({ kind: 'liveResizeBetween', event: a, element: this.node, resizeDirection: this.resizeDirection })) }, _revertResizeRect: function(a, b, c) { var d = a.getOriginalRect(), e = Math.max(b.width / d.width, b.height / d.height), f = d.width * e, g = d.height * e, h = b.x, i = b.y; c == 1 ? (h += b.width - f, i += b.height - g) : c == 2 ? i += b.height - g : c == 3 || c == 4 && (h += b.width - f), b.x = h, b.y = i, b.width = f, b.height = g }, _isEditingShapeNode: function(a) { var b = this.network.getEditPointSize(); if (this.node instanceof Ib.ShapeNode) { this.shapeNode = this.node; for (var c = this.network.getShapeNodeZoomPoints(this.node), d = 0, e = c.size(); e > d; d++) { var f = c.get(d); if (this._contains(a, f, b)) return this._setCrossCursor(), this.pointIndex = d, !0 } } return this.pointIndex = -1, !1 }, _isEditingShapeLink: function(a) { for (var b = this.network.getEditPointSize(), c = this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink.getPoints()), d = 0, e = c.size(); e > d; d++) { var f = c.get(d); if (this._contains(a, f, b)) return this._setCrossCursor(), this.pointIndex = d, !0 } return this.pointIndex = -1, !1 }, _isResizingNode: function(a) { var b = this.network.getResizePointSize(); if (b <= 0) return !1; var c = this.network.zoomManager, d = this.network.getElementUI(this.node), e = c._getElementZoomRect(d, this.node.getOriginalRect()), f = this.node.getAngle(), g = { x: e.x, y: e.y }, h = this._rotatePoint(g, f, e); return this._isResizing(a, h.x, h.y, 'northwest', 'nwse-resize') ? !0 : (g = { x: e.x + e.width / 2, y: e.y }, h = this._rotatePoint(g, f, e), this._isResizing(a, h.x, h.y, 'north', 'ns-resize') ? !0 : (g = { x: e.x + e.width, y: e.y }, h = this._rotatePoint(g, f, e), this._isResizing(a, h.x, h.y, 'northeast', 'nesw-resize') ? !0 : (g = { x: e.x, y: e.y + e.height / 2 }, h = this._rotatePoint(g, f, e), this._isResizing(a, h.x, h.y, 'west', 'ew-resize') ? !0 : (g = { x: e.x + e.width, y: e.y + e.height / 2 }, h = this._rotatePoint(g, f, e), this._isResizing(a, h.x, h.y, 'east', 'ew-resize') ? !0 : (g = { x: e.x, y: e.y + e.height }, h = this._rotatePoint(g, f, e), this._isResizing(a, h.x, h.y, 'southwest', 'nesw-resize') ? !0 : (g = { x: e.x + e.width / 2, y: e.y + e.height }, h = this._rotatePoint(g, f, e), this._isResizing(a, h.x, h.y, 'south', 'ns-resize') ? !0 : (g = { x: e.x + e.width, y: e.y + e.height }, h = this._rotatePoint(g, f, e), this._isResizing(a, h.x, h.y, 'southeast', 'nwse-resize') ? !0 : !1))))))) }, _rotatePoint: function(a, b, c) { var d = Tb.createMatrix(b * Math.PI / 180, c.x + c.width / 2, c.y + c.height / 2), e = d.transform(a); return e }, _isResizing: function(a, b, c, d, e) { var f = this.network.getGraphicsZoom(), g = this.network.getResizePointSize() / f; return this._contains(a, { x: b, y: c }, g) ? (this.resizeDirection !== d && (this._removeCursor(), e = this._changeCursorWithAngle(d, this.node.getAngle()), this._setCursor(e), this.resizeDirection = d), !0) : !1 }, _getRect: function(a, b, c, d) { var e = c > a ? a : c, f = d > b ? b : d, g = Math.abs(a - c), h = Math.abs(b - d); return { x: e, y: f, width: g, height: h } }, _contains: function(a, b, c) { var d = { x: b.x - c, y: b.y - c, width: 2 * c, height: 2 * c }; return Tb.containsPoint(d, a) }, getPointIndex: function(a, b, c) { if (a.size() < 2) return 0; for (var d, e = a.get(0), f = 1; f < a.size(); f++) { if (d = a.get(f), this.isPointOnLine(b, e, d, 6)) return f; e = d } return e = a.get(0), c && this.isPointOnLine(b, e, d, 6) ? a.size() : 0 }, showRotateScale: function(a) { var b, c, d, e, f, g = (new Ib.List(), this.network.getRotateScaleWidth()), h = this.network.getRotateScaleHeight(), i = this.network.getRotatePointSize(), j = this.node.getAngle(), k = this.network.zoomManager, l = this.network.getElementUI(this.node), m = k._getElementZoomRect(l, this.node.getOriginalRect()), n = { x: m.x + m.width / 2, y: m.y - this.network.getRotatePointOffset() - i }, o = this._rotatePoint(n, j, m), p = '13px Arial', q = j + '°', r = this.network.getViewRect(); k.getLocationZoom() === 1 && (a.translate(-r.x, -r.y), a.scale(this.network.getZoom(), this.network.getZoom())), this.node.getAngle() >= 0 && this.node.getAngle() <= 180 ? (c = { x: o.x + i, y: o.y }, d = { x: c.x + g, y: c.y }, e = { x: d.x, y: d.y - h }, f = { x: c.x, y: e.y }) : this.node.getAngle() > 180 && this.node.getAngle() <= 360 && (c = { x: o.x - i, y: o.y }, d = { x: c.x - g, y: c.y }, e = { x: d.x, y: d.y - h }, f = { x: c.x, y: e.y }); var s = new Ib.List([c, d, e, f]), b = Jb.math.getRect(s); k.getLocationZoom() !== 1 && (b.x -= r.x, b.y -= r.y), a.fillStyle = this.network.getRotateScaleFillColor(), a.fillRect(b.x, b.y, b.width, b.height), a.fillStyle = this.network.getRotateScaleFontColor(), a.textBaseline = 'middle', a.textAlign = 'center', a.font = p, a.fillText(q, b.x + b.width / 2, b.y + b.height / 2), k.getLocationZoom() === 1 && (a.scale(1 / this.network.getZoom(), 1 / this.network.getZoom()), a.translate(r.x, r.y)) }, isPointOnLine: function(a, b, c, d) { d < 0 && (d = 0); var e = this.getDistanceFromPointToLine(a, b, c); return d >= e && a.x >= Math.min(b.x, c.x) - d && a.x <= Math.max(b.x, c.x) + d && a.y >= Math.min(b.y, c.y) - d && a.y <= Math.max(b.y, c.y) + d }, getDistanceFromPointToLine: function(a, b, c) { if (b.x === c.x) return Math.abs(a.x - b.x); var d = (c.y - b.y) / (c.x - b.x), e = (c.x * b.y - b.x * c.y) / (c.x - b.x); return Math.abs(d * a.x - a.y + e) / Math.sqrt(d * d + 1) }, _transformPoint: function(a, b, c) { var d = Math.cos(c * Math.PI / 180), e = Math.sin(c * Math.PI / 180), f = a.x, g = a.y, h = f * d - g * e, i = f * e + g * d; a.x = h + b.x, a.y = i + b.y }, _reversPoint: function(a, b, c) { c *= -1; var d = Math.cos(c * Math.PI / 180), e = Math.sin(c * Math.PI / 180), f = a.x - b.x, g = a.y - b.y, h = f * d - g * e, i = f * e + g * d; a.x = h + b.x, a.y = i + b.y }, _changeCursorWithAngle: function(a, b) { var c, d = ['auto', 'nwse-resize', 'ns-resize', 'nesw-resize', 'ew-resize', 'nwse-resize', 'ns-resize', 'nesw-resize', 'ew-resize']; switch (a) { case 'northwest':c = 1; break; case 'north':c = 2; break; case 'northeast':c = 3; break; case 'east':c = 4; break; case 'southeast':c = 5; break; case 'south':c = 6; break; case 'southwest':c = 7; break; case 'west':c = 8; break; default:c = 0 } return (b >= 360 || b <= -360) && (b %= 360), b > 22.5 && b <= 67.5 && (c += 1), b < -22.5 && b >= -67.5 && (c -= 1), b > 67.5 && b <= 112.5 && (c += 2), b < -67.5 && b >= -112.5 && (c -= 2), b > 112.5 && b <= 157.5 && (c += 3), b < -112.5 && b >= -157.5 && (c -= 3), b > 157.5 && b <= 202.5 && (c += 4), b < -157.5 && b >= -202.5 && (c -= 4), b > 202.5 && b <= 247.5 && (c += 5), b < -202.5 && b >= -247.5 && (c -= 5), b > 247.5 && b <= 292.5 && (c += 6), b < -247.5 && b >= -292.5 && (c -= 6), b > 292.5 && b <= 337.5 && (c += 7), b < -292.5 && b >= -337.5 && (c -= 7), c > 8 && (c -= 8), c <= 0 && (c += 8), d[c] } }), Ib.vector.interaction.CreateLinkInteraction = function(a, b) { b || (b = Ib.Link), this.linkFunction = Ib.Util.isTypeOf(b, Ib.Link) ? function(a, c) { var d = new b(); return d instanceof Ib.Link && (d.setFromNode(a), d.setToNode(c)), d } : b, Ib.vector.interaction.CreateLinkInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.vector.interaction.CreateLinkInteraction', Ib.vector.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove'), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mousemove'), this.clear(), this.network.removeMarker(this) }, paint: function(a) { a.beginPath(); var b, c; a.lineWidth = this.network.getEditLineWidth(); var d = this.network.getEditLineColor(); this.currentNode && this.currentNode !== this.fromNode && (b = this.network.getElementUI(this.currentNode).getZoomViewRect(!0), c = this.convertFromUIToMarkerRect(b, 0, 0), Od.rect(a, c.x, c.y, c.width, c.height, null, d)), this.fromNode && (b = this.network.getElementUI(this.fromNode).getZoomViewRect(!0), c = this.convertFromUIToMarkerRect(b, 0, 0), Od.rect(a, c.x, c.y, c.width, c.height, null, d)), this.currentPoint && this.paintLine(a), a.closePath() }, convertFromUIToMarkerRect: function(a, b, c) { var d = this.network.zoomManager, e = d.getGraphicsZoom(); return { x: a.x * e - this.network.getViewRect().x + b * e, y: a.y * e - this.network.getViewRect().y + c * e, width: a.width * e, height: a.height * e } }, getZoomNodeRectOrPoint: function(a, b) { var c = this.network.getElementUI(a).getZoomBodyRect(); return b ? { x: c.x + c.width / 2, y: c.y + c.height / 2 } : c }, paintLine: function(a) { var b = this.network.getEditLineColor(), c = this.network.getElementUI(this.fromNode).getZoomBodyRect(), d = this.convertPointFromView({ x: c.x + c.width / 2, y: c.y + c.height / 2 }), e = d.x, f = d.y, g = this.currentPoint.x, h = this.currentPoint.y; a.strokeStyle = b, a.beginPath(), a.moveTo(e, f), a.lineTo(g, h), a.stroke() }, clear: function() { this.currentPoint = null, this.currentNode = null, this.fromNode = null, this.toNode = null }, createLink: function() { return this.linkFunction(this.fromNode, this.toNode) }, handle_mousedown: function(a) {
    if (this.network.isValidEvent(a)) {
      if (this.fromNode) {
        if (this.toNode = this.currentNode,
          this.toNode) { var b = this.createLink(); b && this.network.addElementByInteraction(b) } this.clear()
      } else this.fromNode = this.currentNode, this.currentNode = null, this.currentPoint = null, this.repaint()
    }
  }, handle_mousemove: function(a) { var b = this.getMarkerPoint(a); if (b) { if (this.network.isMovingElement() || this.network.isEditingElement()) return void this.clear(); var c = null; this.fromNode ? (this.currentNode = this.getToNode(a, this.fromNode), this.currentPoint = b, this.repaint()) : (c = this.getFromNode(a), this.currentNode !== c && (this.currentNode = c, this.repaint())) } }, getFromNode: function(a) { return this.getNode(a) }, getToNode: function(a, b) { return this.getNode(a, b) }, getNode: function(a, b) { var c = this.network.getElementAt(a); return c instanceof Ld && this.network.isLinkable(c, b) && this.network.getElementBox().getSelectionModel().isSelectable(c) ? c : null } }), Ib.vector.interaction.CreateShapeLinkInteraction = function(a, b) { Ib.vector.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this, a), b || (b = Ib.ShapeLink), this.linkFunction = Ib.Util.isTypeOf(b, Ib.ShapeLink) ? function(a, c, d) { var e = new b(); if (e instanceof Ib.ShapeLink && (e.setFromNode(a), e.setToNode(c), d)) { var f = this.network.zoomManager; e.setPoints(f._getShapeLinkZoomPoints(d, !0)) } return e } : b }, Jb.ext('twaver.vector.interaction.CreateShapeLinkInteraction', Ib.vector.interaction.CreateLinkInteraction, { clear: function() { this.points = null, Ib.vector.interaction.CreateShapeLinkInteraction.superClass.clear.call(this) }, createLink: function() { return this.linkFunction(this.fromNode, this.toNode, this.points) }, handle_mousedown: function(a) { if (a.button === 0) { var b = this.network.getLogicalPoint2(a); if (b) { if (this.fromNode) if (this.toNode = this.currentNode, this.toNode) { var c = this.createLink(); c && this.network.addElementByInteraction(c), this.clear() } else { if (this.points || (this.points = new Ib.List()), this.points.size() > 0) { var d = this.points.get(this.points.size() - 1); if (d.x === b.x && d.y === b.y) return } this.points.add(b) } else this.fromNode = this.currentNode, this.points = null, this.currentNode = null, this.currentPoint = null; this.repaint() } } }, paintLine: function(a) { if (this.currentPoint) { var b, c = new Ib.List(); if (b = this.convertPointFromView(this.getZoomNodeRectOrPoint(this.fromNode, !0)), c.add(b, 0), this.points && this.points.size() > 0) for (var d = this.points.size(), e = 0; d > e; e++)b = this.convertPointFromView(this.points.get(e)), c.add(b); b = this.currentPoint, c.add(b), a.lineWidth = this.network.getEditLineWidth(), a.strokeStyle = this.network.getEditLineColor(), a.beginPath(), Xb.drawLinePoints(a, c), a.stroke() } } }), Ib.vector.interaction.CreateShapeNodeInteraction = function(a, b) { b || (b = Ib.ShapeNode), this.shapeNodeFunction = Ib.Util.isTypeOf(b, Ib.ShapeNode) ? function(a) { var c = new b(); if (c instanceof Ib.ShapeNode) { var d = this.network.zoomManager, e = this.network.createElementUI(c); if (a) { var f = d._getShapeNodeZoomPoints(e, a, !0); e.invalidateZoom(), c.setPoints(f) } } return c } : b, Ib.vector.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this, a), this.timeStamp = -1 }, Jb.ext('twaver.vector.interaction.CreateShapeNodeInteraction', Ib.vector.interaction.BaseInteraction, { setUp: function() { this.addListener('mousedown', 'mousemove'), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousedown', 'mousemove'), this.clear(), this.network.removeMarker(this), this.network.setEditingElement(!1) }, clear: function() { this.points = null, this.currentPoint = null }, paint: function(a) { if (this.points && this.points.size() > 0 && this.currentPoint) { for (var b, c = new Ib.List(), d = this.points.size(), e = 0; d > e; e++)b = this.convertPointFromView(this.points.get(e)), c.add(b); b = this.convertPointFromView(this.currentPoint), c.add(b), a.lineWidth = this.network.getEditLineWidth(), a.strokeStyle = this.network.getEditLineColor(), a.beginPath(), Xb.drawLinePoints(a, c), a.stroke() } }, handle_mousedown: function(a) { if (a.button === 0) { var b = this.network.getLogicalPoint2(a); if (b) { if (a.detail === 2 || a.timeStamp - this.timeStamp < 300) { if (this.points) { var c = this.shapeNodeFunction(this.points); this.network.addElementByInteraction(c), this.clear(); var d = this; setTimeout(function() { d.network.setEditingElement(!1) }, 0) } } else { if (this.network.isEditingElement() || this.network.setEditingElement(!0), this.points || (this.points = new Ib.List()), this.points.size() > 0) { var e = this.points.get(this.points.size() - 1); if (e.x === b.x && e.y === b.y) return } this.points.add(b) } this.timeStamp = a.timeStamp, this.repaint() } } }, handle_mousemove: function(a) { this.points && (this.currentPoint = this.network.getLogicalPoint2(a), this.repaint()) } }), Ib.vector.interaction.MagnifyInteraction = function(a, b, c, d, e) { Ib.vector.interaction.MagnifyInteraction.superClass.constructor.call(this, a), this.scale = b || 2, this.xRadius = c || 100, this.yRadius = d || 100, this.shape = e || 'circle', this.borderColor = 'black', this.borderWidth = 1, this.backgroundColor = 'white', this.markCanvas = Wb.createCanvas() }, Jb.ext('twaver.vector.interaction.MagnifyInteraction', Ib.vector.interaction.BaseInteraction, { setUp: function() { this.addListener('mousemove'), this.addListener('mousewheel'), this.network.addMarker(this) }, tearDown: function() { this.removeListener('mousemove'), this.removeListener('mousewheel'), this.network.removeMarker(this) }, paint: function(a) { if (this.point) { var b = this.network.zoomManager, c = b.getLocationZoom(), d = b.getGraphicsZoom(), e = (b.getSizeZoom(), this.network.getZoom(), this.xRadius / this.scale / d), f = this.yRadius / this.scale / d; if (this.mouseFlag === 'mousewheel') { var g = { x: this.zoomPoint.x - e, y: this.zoomPoint.y - f, width: 2 * e, height: 2 * f }; this.network.toCanvasByRegion(g, this.scale * d, this.markCanvas, 'white'); var h = { x: this.zoomPoint.x - this.xRadius - this.network.viewRect.x, y: this.zoomPoint.y - this.yRadius - this.network.viewRect.y, width: this.markCanvas.width, height: this.markCanvas.height } } else { var g = { x: this.point.x * c - e, y: this.point.y * c - f, width: 2 * e, height: 2 * f }; this.network.toCanvasByRegion(g, this.scale * d, this.markCanvas, 'white'); var h = { x: this.point.x * c * d - this.xRadius - this.network.viewRect.x, y: this.point.y * c * d - this.yRadius - this.network.viewRect.y, width: this.markCanvas.width, height: this.markCanvas.height } }a.save(), a.beginPath(), Xb.drawVector(a, this.shape, null, h.x, h.y, 2 * g.width * d, 2 * g.height * d), a.clip(), a.fillStyle = this.backgroundColor, a.beginPath(), a.rect(h.x, h.y, h.width, h.height), a.fill(), a.drawImage(this.markCanvas, h.x, h.y), a.restore(), a.beginPath(), a.lineWidth = this.borderWidth, Xb.drawVector(a, this.shape, null, h.x + this.borderWidth / 2, h.y + this.borderWidth / 2, 2 * g.width * d - this.borderWidth, 2 * g.height * d - this.borderWidth), a.strokeStyle = this.borderColor, a.stroke(), this.mouseFlag = null } }, handle_mousemove: function(a) { this.point = this.network.getLogicalPoint(a), this.point && (this.mouseFlag = 'mousemove', this.repaint()) }, handle_mousewheel: function(a) { var b = this.network.zoomManager, c = b.getLocationZoom(); c !== 1 && (this.zoomPoint = this.network.getLogicalPoint2(a)), this.zoomPoint && (this.mouseFlag = 'mousewheel', this.repaint()) }, getScale: function() { return this.scale }, setScale: function(a) { this.scale = a, this.network.repaintTopCanvas() }, getShape: function() { return this.shape }, setShape: function(a) { this.shape = a, this.network.repaintTopCanvas() }, getXRadius: function() { return this.xRadius }, setXRadius: function(a) { this.xRadius = a, this.network.repaintTopCanvas() }, getYRadius: function() { return this.yRadius }, setYRadius: function(a) { this.yRadius = a, this.network.repaintTopCanvas() }, getBorderColor: function() { return this.borderColor }, setBorderColor: function(a) { this.borderColor = a, this.network.repaintTopCanvas() }, getBorderWidth: function() { return this.borderWidth }, setBorderWidth: function(a) { this.borderWidth = a, this.network.repaintTopCanvas() }, getBackgroundColor: function() { return this.backgroundColor }, setBackgroundColor: function(a) { this.backgroundColor = a, this.network.repaintTopCanvas() } }), Ib.vector.interaction.TouchInteraction = function(a) { Ib.vector.interaction.TouchInteraction.superClass.constructor.call(this, a) }, Jb.ext('twaver.vector.interaction.TouchInteraction', Ib.vector.interaction.BaseInteraction, { setUp: function() { var a = this.network.getView(); Wb.addEventListener('touchstart', 'handleTouchstart', a, this), Wb.addEventListener('touchmove', 'handleTouchmove', a, this), Wb.addEventListener('touchend', 'handleTouchend', a, this), Wb.addEventListener('touchcancel', 'handleTouchend', a, this) }, tearDown: function() { var a = this.network.getView(); Wb.removeEventListener('touchstart', a, this), Wb.removeEventListener('touchmove', a, this), Wb.removeEventListener('touchend', a, this), Wb.removeEventListener('touchcancel', a, this) }, handleTouchstart: function(a) { if (Wb.preventDefault(a), a.touches.length == 1) { var b = this.network.getLogicalPoint2(a), c = this._element = this.network.getElementAt(b); this._startTouchTime = new Date(), this._currentTouchPoint = b, this._startTouchClient = this._currentTouchClient = this.getMarkerPoint(a), c ? this.network.getSelectionModel().contains(c) || this.network.getSelectionModel().setSelection(c) : this.network.getSelectionModel().clearSelection(), Cc.handleClicked(this.network, a, c), this._endTouchTime && this._startTouchTime.getTime() - this._endTouchTime.getTime() <= 500 && Tb.getDistance(this._endTouchClient, this._startTouchClient) <= 20 ? (delete this._endTouchTime, delete this._endTouchClient, Cc.handleDoubleClicked(this.network, a, c)) : (this._endTouchTime = this._startTouchTime, this._endTouchClient = this._startTouchClient) } else this._distance = zc.getDistance(a), this._zoom = this.network.getZoom() }, handleTouchmove: function(a) { if (Wb.preventDefault(a), a.touches.length > 1) { var b = zc.getDistance(a); if (Math.abs(b - this._distance) < 20) return; var c = b / this._distance; this.network.setZoom(this._zoom * c, !1) } else if (this._zoom == null) { var d = this.getMarkerPoint(a); if (Tb.getDistance(this._startTouchClient, d) < 20) return; if (this._element) { var e = this.network.getLogicalPoint2(a), f = this.getOffset(e, this._currentTouchPoint), g = f.x, h = f.y; this._currentTouchPoint = e, this.network.moveSelectedElements(g, h), this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a })) } else { var g = this._currentTouchClient.x - d.x, h = this._currentTouchClient.y - d.y; this.network.panByOffset(g, h), this._currentTouchClient = d } } }, handleTouchend: function(a) { Wb.preventDefault(a), this.network.isMovingElement() && (this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: a })), a.touches.length === 0 && (this._distance = null, this._zoom = null, this._element = null, this._startTouchTime = null, this._currentTouchPoint = null, this._startTouchClient = this._currentTouchClient = null) } }), Ib.vector.interaction.MSTouchInteraction = function(a) { Ib.vector.interaction.MSTouchInteraction.superClass.constructor.call(this, a), this._pointerMap = {}, this._pointerIdArray = [] }, Jb.ext('twaver.vector.interaction.MSTouchInteraction', Ib.vector.interaction.BaseInteraction, { setUp: function() { var a = this.network.getView(); Wb.addEventListener('MSPointerDown', 'handleTouchstart', a, this), Wb.addEventListener('MSPointerMove', 'handleTouchmove', a, this), Wb.addEventListener('MSPointerUp', 'handleTouchend', a, this), Wb.addEventListener('MSPointerCancel', 'handleTouchend', a, this), this.network.addMarker(this) }, tearDown: function() { var a = this.network.getView(); Wb.removeEventListener('MSPointerDown', a, this), Wb.removeEventListener('MSPointerMove', a, this), Wb.removeEventListener('MSPointerUp', a, this), Wb.removeEventListener('MSPointerCancel', a, this), this.network.removeMarker(this) }, handleTouchstart: function(a) { if (this.network.isFocusOnClick() && Ib.Util.setFocus(this.network._view), !this.network.isSelectingElement() || a.pointerType != a.MSPOINTER_TYPE_MOUSE) { var b = this.network.getLogicalPoint2(a), c = new Date(); if (a.isPrimary && this._pointerIdArray.length > 0 && this.handle_mouseup(a), this._pointerMap[a.pointerId] || (this._pointerIdArray.push(a.pointerId), this._pointerMap[a.pointerId] = a), this._pointerIdArray.length == 1) { var d = this.network.getElementAt(b); this._startTouchElement = d, this._startClientPoint = { x: a.clientX, y: a.clientY }; var e = this.network.getSelectionModel(); d ? Jb.isCtrlDown(a) ? e.contains(d) ? e.removeSelection(d) : e.appendSelection(d) : e.contains(d) || e.setSelection(d) : Jb.isCtrlDown(a) || e.clearSelection(), Cc.handleClicked(this.network, a, d), this._startTouchTime && this._startTouchPoint && c.getTime() - this._startTouchTime.getTime() <= 500 && Tb.getDistance(this._startTouchPoint, b) <= 20 ? (Cc.handleDoubleClicked(this.network, a, d), this._doubleClick = !0) : (Wb.handle_mousedown(this, a), this._startTouchPoint = b, this._startTouchTime = c) } else this._pointerIdArray.length == 2 && (this._distance = this._getDistance(), this._zoom = this.network.getZoom()) } }, handleTouchmove: function(a) { if (this._startTouchPoint != null && this._pointerIdArray.length != 0 && this._pointerMap[a.pointerId] && !(Tb.getDistance({ x: this._pointerMap[a.pointerId].pageX, y: this._pointerMap[a.pointerId].pageY }, { x: a.pageX, y: a.pageY }) <= 10) && (this._pointerMap[a.pointerId] = a, this._pointerIdArray.length == 2)) { var b = this._getDistance() / this._distance; this.network.setZoom(this._zoom * b, !1) } }, handleTouchend: function(a) { if (this.network.isMovingElement() && (this.network.setMovingElement(!1), this.network.fireInteractionEvent({ kind: 'liveMoveEnd', event: a })), this.network.isSelectingElement()) { var b = Tb.getRect([this._startTouchPoint, this._moveTouchPoint]), c = this.network.getElementsAtRect(b, this.getIntersectMode(), this.network.getRectSelectFilter()); if (c && c.size() > 0) { var d = this.network.getSelectionModel(), e = d.toSelection(); c.forEach(function(a) { d.contains(a) ? e.remove(a) : e.add(a) }, this), d.setSelection(e) } this.network.fireInteractionEvent({ kind: 'selectEnd', event: a }), this._moveTouchPoint = null, this.network.setSelectingElement(!1), this.repaint() } this._doubleClick && (delete this._doubleClick, delete this._startTouchPoint, delete this._startTouchTime); for (var f = -1, g = 0; g < this._pointerIdArray.length; g++) if (this._pointerIdArray[g] == a.pointerId) { f = g; break }f >= 0 && this._pointerIdArray.splice(f, 1), delete this._pointerMap[a.pointerId], this._moveTouchPoint = null }, _getDistance: function() { return Tb.getDistance({ x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY }, { x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY }) }, getIntersectMode: function() { return this.network.getSelectMode() === 'intersect' ? !0 : this.network.getSelectMode() === 'contain' ? !1 : this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y }, handle_mousemove: function(a) { var b = { x: a.clientX, y: a.clientY }; if (!(Tb.getDistance(this._startClientPoint, b) < 3) && this._startTouchPoint && this._pointerIdArray.length == 1) if (this._moveTouchPoint = { x: this._startTouchPoint.x + (b.x - this._startClientPoint.x) / this.network.getZoom(), y: this._startTouchPoint.y + (b.y - this._startClientPoint.y) / this.network.getZoom() }, this._startTouchElement == null && this.network.isRectSelectEnabled()) { var c = this.network.getLogicalPoint2(a); if (!c) return; this.network.setSelectingElement(!0), this.network.fireInteractionEvent(this._moveTouchPoint ? { kind: 'selectBetween', event: a } : { kind: 'selectStart', event: a }), this.repaint() } else { var d = this.network.getElementAt(this._moveTouchPoint); if (this._startTouchElement != null || this.network.isRectSelectEnabled()) { if (this.network.isMovingElement() || this._startTouchElement != null && d == this._startTouchElement && this.network.getMovableSelectedElements().contains(d)) { var e = this._moveTouchPoint.x - this._startTouchPoint.x, f = this._moveTouchPoint.y - this._startTouchPoint.y; this.network.moveSelectedElements(e, f), this.network.isMovingElement() ? this.network.fireInteractionEvent({ kind: 'liveMoveBetween', event: a }) : (this.network.setMovingElement(!0), this.network.fireInteractionEvent({ kind: 'liveMoveStart', event: a })) } } else { var e = this._startClientPoint.x - b.x, f = this._startClientPoint.y - b.y; this.network.panByOffset(e, f) } this._startClientPoint = b } }, handle_mouseup: function(a) { this.handleTouchend(a), this._pointerIdArray = [], this._pointerMap = {} }, paint: function(a) { if (this._startTouchPoint && this._moveTouchPoint && !this._startTouchElement && this.network.isRectSelectEnabled()) { var b = this.convertPointFromView(this._startTouchPoint), c = this.convertPointFromView(this._moveTouchPoint), d = b.x, e = b.y, f = c.x, g = c.y, h = Tb.getRect([{ x: d, y: e }, { x: f, y: g }]); if (h != null) { a.beginPath(); var i = this.network.getSelectOutlineWidth(), j = this.getIntersectMode() ? this.network.getSelectFillColor() : null; a.strokeStyle = this.network.getSelectOutlineColor(), a.lineWidth = i, Od.rect(a, h.x, h.y, h.width, h.height, j, this.network.getSelectOutlineColor()), a.closePath() } } } }), Ib.XmlSerializer = function(a, b, c) { this.dataBox = a, this.settings = b || new Ib.SerializationSettings(), this.filterFunction = c, this.ref = 0, this.refMap = {}, this.idMap = {}, this.xmlString = '' }, Jb.ext('twaver.XmlSerializer', Object, { serialize: function() { return this.xmlString = "<twaver version='" + Ib.Util.getVersion() + "' platform='html5'>\n", this.serializeBody(), this.xmlString += '</twaver>\n', this.xmlString }, serializeBody: function() { this.ref = 0, this.dataBox.getRoots().forEach(this.initRefs, this), this.settings.isDataBoxSerializable && (this.xmlString += "<dataBox class='" + this.dataBox.getClassName() + "'>\n", this.dataBox.serializeXml(this, this.dataBox.newInstance()), this.xmlString += '</dataBox>\n'), this.dataBox.getRoots().forEach(this.serializeData, this) }, initRefs: function(a) { this.refMap[a.getId()] = this.ref++, a.getChildren().forEach(this.initRefs, this) }, isSerializable: function(a) { return this.dataBox.contains(a) ? this.filterFunction && !this.filterFunction(a) ? !1 : !0 : !1 }, serializeData: function(a) { if (this.isSerializable(a)) { var b = a.newInstance(), c = this.refMap[a.getId()]; this.xmlString += "<data class='" + a.getClassName() + "' ref='" + c + "'", this.settings.getPropertyType('id') != null && (this.xmlString += " id='" + a.getId() + "'"), this.xmlString += '>\n', a.serializeXml(this, b), this.xmlString += '</data>\n' }a.getChildren().forEach(this.serializeData, this) }, serializePropertyXml: function(a, b, c) { var d = this.settings.getPropertyType(b); if (d) { var e = Jb.getValue(a, b, d), f = Jb.getValue(c, b, d); e !== f && this.serializeValue('p', b, e, f, d) } }, serializeStyleXml: function(a, b, c) { var d = this.settings.getStyleType(b); if (d) { var e = a.getStyle(b), f = c.getStyle(b); e != f && this.serializeValue('s', b, e, f, d) } }, serializeClientXml: function(a, b, c) { var d = this.settings.getClientType(b); if (d != null) { var e = a.getClient(b), f = c.getClient(b); e != f && this.serializeValue('c', b, e, f, d) } }, serializeValue: function(a, b, c, d, e) { if (c == null) this.xmlString += '	<' + a + " n='" + b + "' none=''/>\n"; else if (e === 'cdata') this.xmlString += '	<' + a + " n='" + b + "'><![CDATA[" + c + ']]></' + a + '>\n'; else if (e === 'data') { var f = this.refMap[c.getId()]; f != null && (this.xmlString += '	<' + a + " n='" + b + "' ref='" + f + "'/>\n") } else e === 'point' ? d && c.x === d.x && c.y === d.y || (this.xmlString += '	<' + a + " n='" + b + "' x='" + c.x + "' y='" + c.y + "'/>\n") : e === 'list.point' ? (this.xmlString += '	<' + a + " n='" + b + "'>\n", c.forEach(function(a) { this.xmlString += "		<p x='" + a.x + "' y='" + a.y + "'/>\n" }, this), this.xmlString += '	</' + a + '>\n') : e === 'list.string' || e === 'list.number' ? (this.xmlString += '	<' + a + " n='" + b + "'>\n", c.forEach(function(a) { this.xmlString += '		<s>' + a + '</s>\n' }, this), this.xmlString += '	</' + a + '>\n') : this.xmlString += e === 'rectangle' ? '	<' + a + " n='" + b + "' x='" + c.x + "' y='" + c.y + "' w='" + c.width + "' h='" + c.height + "'/>\n" : '	<' + a + " n='" + b + "'>" + c + '</' + a + '>\n' }, deserialize: function(a, b) { Jb.isDeserializing = !0, this.xmlString = a; var c = Jb.xml(a).documentElement; this.refMap = {}, this.idMap = {}; var d, e, f, g = new nd(), h = new nd(), i = c.getElementsByTagName('data'), j = i.length; for (f = 0; j > f; f++) { e = i[f]; var k = e.getAttribute('class'), l = this.settings.getPropertyType('id'); if (l && e.hasAttribute('id')) { var m = null; if (l === 'string')m = e.getAttribute('id'); else if (l === 'int')m = parseInt(e.getAttribute('id')); else { if (l !== 'number') throw "Unsupported id type '" + l + "'"; m = parseFloat(e.getAttribute('id')) } if (e.getAttribute('action') === 'remove') { this.dataBox.removeById(m); continue }d = this.dataBox.getDataById(m), d || (d = Jb.newInstance(k, m)) } else d = Jb.newInstance(k); if (e.hasAttribute('ref')) { var n = e.getAttribute('ref'); this.refMap[n] = d }g.add(d), h.add(e), this.idMap[d.getId()] = d } for (this.dataBox.forEach(function(a) { this.idMap[a.getId()] = a }, this), j = g.size(), f = 0; j > f; f++)d = g.get(f), e = h.get(f), d.deserializeXml(this, e); for (f = 0; j > f; f++)d = g.get(f), this.dataBox.containsById(d.getId()) || (b && !d.getParent() && d.setParent(b), this.dataBox.add(d)); this.settings.isDataBoxSerializable && c.getElementsByTagName('dataBox').length === 1 && this.dataBox.deserializeXml(this, c.getElementsByTagName('dataBox')[0]), Jb.isDeserializing = !1 }, deserializePropertyXml: function(a, b, c) { var d = this.settings.getPropertyType(c); d && Jb.setValue(a, c, this.deserializeValue(b, d)) }, deserializeStyleXml: function(a, b, c) { var d = this.settings.getStyleType(c); d && a.setStyle(c, this.deserializeValue(b, d)) }, deserializeClientXml: function(a, b, c) { var d = this.settings.getClientType(c); d && a.setClient(c, this.deserializeValue(b, d)) }, deserializeValue: function(a, b) { if (a.hasAttribute('@none')) return null; if (b === 'string') return a.textContent; if (b === 'number') return parseFloat(a.textContent); if (b === 'boolean') return a.textContent === 'true'; if (b === 'int') return parseInt(a.textContent); if (b === 'point') return { x: parseFloat(a.getAttribute('x')), y: parseFloat(a.getAttribute('y')) }; if (b === 'data') { var c = a.getAttribute('ref'), d = this.refMap[c]; return d || this.idMap[c] } var e, f, g, h; if (b === 'list.point') { var i = new nd(), j = a.getElementsByTagName('p'); for (e = j.length, h = 0; e > h; h++) { var k = j[h]; i.add({ x: parseFloat(k.getAttribute('x')), y: parseFloat(k.getAttribute('y')) }) } return i } if (b === 'list.string') { var l = new nd(); for (g = a.getElementsByTagName('s'), e = g.length, h = 0; e > h; h++)l.add(g[h].textContent); return l } if (b === 'list.number') { for (f = new nd(), g = a.getElementsByTagName('s'), e = g.length, h = 0; e > h; h++)f.add(parseFloat(g[h].textContent)); return f } if (b === 'array.string') return a.textContent.split(','); if (b === 'array.number') { for (f = a.textContent.split(','), e = f.length, h = 0; e > h; h++)f[h] = parseFloat(f[h]); return f } return b === 'rectangle' ? { x: parseFloat(a.getAttribute('x')), y: parseFloat(a.getAttribute('y')), width: parseFloat(a.getAttribute('w')), height: parseFloat(a.getAttribute('h')) } : a.textContent } }), Jb.addMethod(Ib.Data, { serializeXml: function(a, b) { if (a.settings.isClientSerializable && this._clientMap) for (var c in this._clientMap) this.serializeClientXml(a, c, b); this.serializePropertyXml(a, 'name', b), this.serializePropertyXml(a, 'icon', b), this.serializePropertyXml(a, 'toolTip', b), this.serializePropertyXml(a, 'parent', b) }, serializePropertyXml: function(a, b, c) { a.serializePropertyXml(this, b, c) }, serializeClientXml: function(a, b, c) { a.serializeClientXml(this, b, c) }, deserializeXml: function(a, b) { var c, d, e, f, g = b.getElementsByTagName('p'), h = g.length; for (c = 0; h > c; c++)d = g[c], d.hasAttribute('n') && this.deserializePropertyXml(a, d, d.getAttribute('n')); if (a.settings.isClientSerializable) for (e = b.getElementsByTagName('c'), h = e.length, c = 0; h > c; c++)f = e[c], f.hasAttribute('n') && this.deserializeClientXml(a, f, f.getAttribute('n')) }, deserializePropertyXml: function(a, b, c) { a.deserializePropertyXml(this, b, c) }, deserializeClientXml: function(a, b, c) { a.deserializeClientXml(this, b, c) } }), Jb.addMethod(Ib.Element, { serializeXml: function(a, b) { if (a.settings.isStyleSerializable && this._styleMap) for (var c in this._styleMap) this.serializeStyleXml(a, c, b); Ib.Element.superClass.serializeXml.call(this, a, b), this.serializePropertyXml(a, 'layerId', b), this._alarmState.getHighestNativeAlarmSeverity() && a.settings.getPropertyType('alarmState') === 'alarmstate' && (a.xmlString += "	<p n='alarmState'>\n", Ib.AlarmSeverity.forEach(function(b) { var c = this.getNewAlarmCount(b); c > 0 && (a.xmlString += "		<n n='" + b.name + "' c='" + c + "'/>\n") }, this._alarmState), Ib.AlarmSeverity.forEach(function(b) { var c = this.getAcknowledgedAlarmCount(b); c > 0 && (a.xmlString += "		<a n='" + b.name + "' c='" + c + "'/>\n") }, this._alarmState), a.xmlString += '	</p>\n') }, serializeStyleXml: function(a, b, c) { a.serializeStyleXml(this, b, c) }, deserializeXml: function(a, b) { if (Ib.Element.superClass.deserializeXml.call(this, a, b), a.settings.isStyleSerializable) { var c, d, e = b.getElementsByTagName('s'), f = e.length; for (c = 0; f > c; c++)d = e[c], d.hasAttribute('n') && this.deserializeStyleXml(a, d, d.getAttribute('n')) } }, deserializeStyleXml: function(a, b, c) { a.deserializeStyleXml(this, b, c) }, deserializePropertyXml: function(a, b, c) { if (c === 'alarmState') { if (a.settings.getPropertyType('alarmState') === 'alarmstate') { var d, e, f, g = b.getElementsByTagName('n'); for (e = 0; e < g.length; e++)f = g[e], d = Ib.AlarmSeverity.getByName(f.getAttribute('n')), this._alarmState.setNewAlarmCount(d, parseInt(f.getAttribute('c'))); for (g = b.getElementsByTagName('a'), e = 0; e < g.length; e++)f = g[e], d = Ib.AlarmSeverity.getByName(f.getAttribute('n')), this._alarmState.setAcknowledgedAlarmCount(d, parseInt(f.getAttribute('c'))) } } else Ib.Element.superClass.deserializePropertyXml.call(this, a, b, c) } }), Jb.addMethod(Ld, { serializeXml: function(a, b) { Ld.superClass.serializeXml.call(this, a, b), this.serializePropertyXml(a, 'image', b), this.serializePropertyXml(a, 'location', b), Jb.num(this._width) && this._width >= 0 && this.serializePropertyXml(a, 'width', b), Jb.num(this._height) && this._height >= 0 && this.serializePropertyXml(a, 'height', b) } }), Jb.addMethod(Ib.Link, { serializeXml: function(a, b) { Ib.Link.superClass.serializeXml.call(this, a, b), this.serializePropertyXml(a, 'fromNode', b), this.serializePropertyXml(a, 'toNode', b) } }), Jb.addMethod(Ib.Follower, { serializeXml: function(a, b) { Ib.Follower.superClass.serializeXml.call(this, a, b), this.serializePropertyXml(a, 'host', b) } }), Jb.addMethod(Nd, { serializeXml: function(a, b) { Nd.superClass.serializeXml.call(this, a, b), this.serializePropertyXml(a, 'expanded', b) } }), Jb.addMethod(Ib.ShapeNode, { serializeXml: function(a, b) { Ib.ShapeNode.superClass.serializeXml.call(this, a, b), this.serializePropertyXml(a, 'points', b), this.serializePropertyXml(a, 'segments', b) } }), Jb.addMethod(Ib.ShapeLink, { serializeXml: function(a, b) { Ib.ShapeLink.superClass.serializeXml.call(this, a, b), this.serializePropertyXml(a, 'points', b) } }), Jb.addMethod(Ib.RotatableNode, { serializeXml: function(a, b) { Ib.RotatableNode.superClass.serializeXml.call(this, a, b), this.serializePropertyXml(a, 'angle', b) } }), Jb.addMethod(Ib.DataBox, { serializeXml: function(a, b) { if (a.settings.isClientSerializable && this._clientMap) for (var c in this._clientMap) this.serializeClientXml(a, c, b); this.serializePropertyXml(a, 'name', b), this.serializePropertyXml(a, 'icon', b), this.serializePropertyXml(a, 'toolTip', b) }, serializePropertyXml: function(a, b, c) { a.serializePropertyXml(this, b, c) }, serializeClientXml: function(a, b, c) { a.serializeClientXml(this, b, c) }, deserializeXml: function(a, b) { var c, d, e, f, g = b.getElementsByTagName('p'), h = g.length; for (c = 0; h > c; c++)d = g[c], d.hasAttribute('n') && this.deserializePropertyXml(a, d, d.getAttribute('n')); if (a.settings.isClientSerializable) for (e = b.getElementsByTagName('c'), h = e.length, c = 0; h > c; c++)f = e[c], f.hasAttribute('n') && this.deserializeClientXml(a, f, f.getAttribute('n')) }, deserializePropertyXml: function(a, b, c) { a.deserializePropertyXml(this, b, c) }, deserializeClientXml: function(a, b, c) { a.deserializeClientXml(this, b, c) } }), Jb.addMethod(Ib.ElementBox, { serializeXml: function(a, b) { if (a.settings.isLayerBoxSerializable && (a.xmlString += '	<layerBox>\n', this._layerBox.forEachByDepthFirst(function(b) { a.xmlString += this._layerBox.getDefaultLayer() === b ? '		<layer ' : "		<layer id='" + b.getId() + "' ", b.getName() && (a.xmlString += "name='" + b.getName() + "' "), a.xmlString += "visible='" + b.isVisible() + "' editable='" + b.isEditable() + "' movable='" + b.isMovable() + "'/>\n" }, null, this), a.xmlString += '	</layerBox>\n'), a.settings.isStyleSerializable && this._styleMap) for (var c in this._styleMap) this.serializeStyleXml(a, c, b); Ib.ElementBox.superClass.serializeXml.call(this, a, b) }, serializeStyleXml: function(a, b, c) { a.serializeStyleXml(this, b, c) }, deserializeStyleXml: function(a, b, c) { a.deserializeStyleXml(this, b, c) }, deserializeXml: function(a, b) { if (Ib.ElementBox.superClass.deserializeXml.call(this, a, b), a.settings.isLayerBoxSerializable && b.getElementsByTagName('layerBox').length == 1) for (var c = b.getElementsByTagName('layerBox')[0].getElementsByTagName('layer'), d = 0; d < c.length; d++) { var e, f = c[d]; if (f.hasAttribute('id')) { var g = a.settings.getPropertyType('layerId'); if (g === 'string')e = new Ib.Layer(f.getAttribute('id')); else if (g === 'int')e = new Ib.Layer(parseInt(f.getAttribute('id'))); else { if (g !== 'number') throw "Unsupported layer id type '" + g + "'"; e = new Ib.Layer(parseFloat(f.getAttribute('id'))) } this._layerBox.getDataById(e.getId()) ? e = this._layerBox.getDataById(e.getId()) : this._layerBox.add(e) } else e = this._layerBox.getDefaultLayer(), this._layerBox.moveToBottom(e); f.hasAttribute('name') && e.setName(f.getAttribute('name')), f.hasAttribute('visible') && e.setVisible(f.getAttribute('visible') === 'true'), f.hasAttribute('editable') && e.setEditable(f.getAttribute('editable') === 'true'), f.hasAttribute('movable') && e.setMovable(f.getAttribute('movable') === 'true') } if (a.settings.isStyleSerializable) for (var h = b.getElementsByTagName('s'), i = h.length, d = 0; i > d; d++) { var j = h[d]; j.hasAttribute('n') && this.deserializeStyleXml(a, j, j.getAttribute('n')) } } }), Ib.JsonSerializer = function(a, b, c) { this.dataBox = a, this.settings = b || new Ib.SerializationSettings(), this.filterFunction = c, this.ref = 0, this.refMap = {}, this.idMap = {}, this.jsonObject = {} }, Jb.ext('twaver.JsonSerializer', Object, { serialize: function() { return this.jsonObject = { version: Ib.Util.getVersion(), platform: 'html5' }, this.settings.isImageSerializable && (this.jsonObject.images = {}), this.serializeBody(), JSON.stringify(this.jsonObject) }, serializeBody: function() { if (this.ref = 0, this.dataBox.getRoots().forEach(this.initRefs, this), this.settings.isDataBoxSerializable) { var a = { 'class': this.dataBox.getClassName(), p: {}, s: {}, c: {}}; this.jsonObject.dataBox = a, this.dataBox.serializeJson(this, this.dataBox.newInstance(), a), Jb.isEmptyObject(a.p) && delete a.p, Jb.isEmptyObject(a.s) && delete a.s, Jb.isEmptyObject(a.c) && delete a.c } this.jsonObject.datas = [], this.dataBox.getRoots().forEach(this.serializeData, this) }, initRefs: function(a) { this.refMap[a.getId()] = this.ref++, a.getChildren().forEach(this.initRefs, this) }, isSerializable: function(a) { return this.dataBox.contains(a) ? this.filterFunction && !this.filterFunction(a) ? !1 : !0 : !1 }, serializeData: function(a) { if (this.isSerializable(a)) { var b = a.newInstance(), c = this.refMap[a.getId()], d = { 'class': a.getClassName(), ref: c, p: {}, s: {}, c: {}}; if (this.settings.getPropertyType('id') && (this.jsonObject.id = a.getId()), this.jsonObject.datas.push(d), a.serializeJson(this, b, d), Jb.isEmptyObject(d.p) && delete d.p, Jb.isEmptyObject(d.s) && delete d.s, Jb.isEmptyObject(d.c) && delete d.c, this.settings.isImageSerializable && a.getImage) { var e = a.getImage(); if (typeof e === 'string' && !Qd[e] && !this.jsonObject.images[e]) { var f = Jb.getImageAsset(e), g = f && f.getImage(); g && !cd(g) && (this.jsonObject.images[e] = g) } } }a.getChildren().forEach(this.serializeData, this) }, serializePropertyJson: function(a, b, c, d) { var e = this.settings.getPropertyType(b); if (e) { var f = Jb.getValue(a, b, e), g = Jb.getValue(c, b, e); f !== g && this.serializeValue(b, f, g, e, d.p) } }, serializeStyleJson: function(a, b, c, d) { var e = this.settings.getStyleType(b); if (e) { var f = a.getStyle(b), g = c.getStyle(b); f != g && this.serializeValue(b, f, g, e, d.s) } }, serializeClientJson: function(a, b, c, d) { var e = this.settings.getClientType(b); if (e != null) { var f = a.getClient(b), g = c.getClient(b); f != g && this.serializeValue(b, f, g, e, d.c) } }, serializeValue: function(a, b, c, d, e) { if (b == null)e[a] = null; else if (b instanceof nd)e[a] = b._as; else if (d === 'data') { var f = this.refMap[b.getId()]; f != null && (e[a] = f) } else e[a] = b }, deserialize: function(a, b) {
    Jb.isDeserializing = !0, this.jsonObject = JSON.parse(a); var c = this.jsonObject.images; this.settings.isImageSerializable && c && Object.keys(c).forEach(function(a) { Jb.registerImage(a, c[a]) }), this.refMap = {}, this.idMap = {}; for (var d, e = new nd(), f = new nd(), g = this.jsonObject.datas.length, h = 0; g > h; h++) { var i = this.jsonObject.datas[h], j = i['class'], k = this.settings.getPropertyType('id'); if (k && i.id != null) { if (i.action === 'remove') { this.dataBox.removeById(i.id); continue }d = this.dataBox.getDataById(i.id), d || (d = Jb.newInstance(j, i.id)) } else d = Jb.newInstance(j); i.ref != null && (this.refMap[i.ref] = d), e.add(d), f.add(i), this.idMap[d.getId()] = d } for (this.dataBox.forEach(function(a) { this.idMap[a.getId()] = a }, this), g = e.size(), h = 0; g > h; h++)d = e.get(h), d.deserializeJson(this, f.get(h)); for (h = 0; g > h; h++)d = e.get(h), this.dataBox.containsById(d.getId()) || (b && !d.getParent() && d.setParent(b), this.dataBox.add(d)); this.settings.isDataBoxSerializable && this.jsonObject.dataBox && this.dataBox.deserializeJson(this, this.jsonObject.dataBox),
    Jb.isDeserializing = !1
  }, deserializePropertyJson: function(a, b, c) { var d = this.settings.getPropertyType(c); d && Jb.setValue(a, c, this.deserializeValue(b, d)) }, deserializeStyleJson: function(a, b, c) { var d = this.settings.getStyleType(c); d && a.setStyle(c, this.deserializeValue(b, d)) }, deserializeClientJson: function(a, b, c) { var d = this.settings.getClientType(c); d && a.setClient(c, this.deserializeValue(b, d)) }, deserializeValue: function(a, b) { if (b === 'data') { var c = this.refMap[a]; return c || this.idMap[a] } return b === 'array.number' ? a : a instanceof Array ? new nd(a) : a } }), Jb.addMethod(Ib.Data, { serializeJson: function(a, b, c) { if (a.settings.isClientSerializable && this._clientMap) for (var d in this._clientMap) this.serializeClientJson(a, d, b, c); this.serializePropertyJson(a, 'name', b, c), this.serializePropertyJson(a, 'icon', b, c), this.serializePropertyJson(a, 'toolTip', b, c), this.serializePropertyJson(a, 'parent', b, c) }, serializePropertyJson: function(a, b, c, d) { a.serializePropertyJson(this, b, c, d) }, serializeClientJson: function(a, b, c, d) { a.serializeClientJson(this, b, c, d) }, deserializeJson: function(a, b) { var c; for (c in b.p) this.deserializePropertyJson(a, b.p[c], c); if (a.settings.isClientSerializable) for (c in b.c) this.deserializeClientJson(a, b.c[c], c) }, deserializePropertyJson: function(a, b, c) { a.deserializePropertyJson(this, b, c) }, deserializeClientJson: function(a, b, c) { a.deserializeClientJson(this, b, c) } }), Jb.addMethod(Ib.Element, { serializeJson: function(a, b, c) { if (a.settings.isStyleSerializable && this._styleMap) for (var d in this._styleMap) this.serializeStyleJson(a, d, b, c); if (Ib.Element.superClass.serializeJson.call(this, a, b, c), this.serializePropertyJson(a, 'layerId', b, c), this._alarmState.getHighestNativeAlarmSeverity() && a.settings.getPropertyType('alarmState') === 'alarmstate') { var e = { n: {}, a: {}}; c.p.alarmState = e, Ib.AlarmSeverity.forEach(function(a) { var b = this.getNewAlarmCount(a); b > 0 && (e.n[a.name] = b) }, this._alarmState), Ib.AlarmSeverity.forEach(function(a) { var b = this.getAcknowledgedAlarmCount(a); b > 0 && (e.a[a.name] = b) }, this._alarmState), Jb.isEmptyObject(e.n) && delete e.n, Jb.isEmptyObject(e.a) && delete e.a, Jb.isEmptyObject(e) && delete c.p.alarmState } }, serializeStyleJson: function(a, b, c, d) { a.serializeStyleJson(this, b, c, d) }, deserializeJson: function(a, b) { if (Ib.Element.superClass.deserializeJson.call(this, a, b), a.settings.isStyleSerializable) for (var c in b.s) this.deserializeStyleJson(a, b.s[c], c) }, deserializeStyleJson: function(a, b, c) { a.deserializeStyleJson(this, b, c) }, deserializePropertyJson: function(a, b, c) { if (c === 'alarmState') { if (a.settings.getPropertyType('alarmState') === 'alarmstate') { var d; for (d in b.n) this._alarmState.setNewAlarmCount(Ib.AlarmSeverity.getByName(d), b.n[d]); for (d in b.a) this._alarmState.setAcknowledgedAlarmCount(Ib.AlarmSeverity.getByName(d), b.a[d]) } } else Ib.Element.superClass.deserializePropertyJson.call(this, a, b, c) } }), Jb.addMethod(Ld, { serializeJson: function(a, b, c) { Ld.superClass.serializeJson.call(this, a, b, c), this.serializePropertyJson(a, 'image', b, c), this.serializePropertyJson(a, 'location', b, c), Jb.num(this._width) && this._width >= 0 && this.serializePropertyJson(a, 'width', b, c), Jb.num(this._height) && this._height >= 0 && this.serializePropertyJson(a, 'height', b, c) } }), Jb.addMethod(Ib.Link, { serializeJson: function(a, b, c) { Ib.Link.superClass.serializeJson.call(this, a, b, c), this.serializePropertyJson(a, 'fromNode', b, c), this.serializePropertyJson(a, 'toNode', b, c) } }), Jb.addMethod(Ib.Follower, { serializeJson: function(a, b, c) { Ib.Follower.superClass.serializeJson.call(this, a, b, c), this.serializePropertyJson(a, 'host', b, c) } }), Jb.addMethod(Nd, { serializeJson: function(a, b, c) { Nd.superClass.serializeJson.call(this, a, b, c), this.serializePropertyJson(a, 'expanded', b, c) } }), Jb.addMethod(Ib.ShapeNode, { serializeJson: function(a, b, c) { Ib.ShapeNode.superClass.serializeJson.call(this, a, b, c), this.serializePropertyJson(a, 'points', b, c), this.serializePropertyJson(a, 'segments', b, c) } }), Jb.addMethod(Ib.ShapeLink, { serializeJson: function(a, b, c) { Ib.ShapeLink.superClass.serializeJson.call(this, a, b, c), this.serializePropertyJson(a, 'points', b, c) } }), Jb.addMethod(Ib.RotatableNode, { serializeJson: function(a, b, c) { Ib.RotatableNode.superClass.serializeJson.call(this, a, b, c), this.serializePropertyJson(a, 'angle', b, c) } }), Jb.addMethod(Ib.DataBox, { serializeJson: function(a, b, c) { if (a.settings.isClientSerializable && this._clientMap) for (var d in this._clientMap) this.serializeClientJson(a, d, b, c); this.serializePropertyJson(a, 'name', b, c), this.serializePropertyJson(a, 'icon', b, c), this.serializePropertyJson(a, 'toolTip', b, c) }, serializePropertyJson: function(a, b, c, d) { a.serializePropertyJson(this, b, c, d) }, serializeClientJson: function(a, b, c, d) { a.serializeClientJson(this, b, c, d) }, deserializeJson: function(a, b) { var c; for (c in b.p) this.deserializePropertyJson(a, b.p[c], c); if (a.settings.isClientSerializable) for (c in b.c) this.deserializeClientJson(a, b.c[c], c) }, deserializePropertyJson: function(a, b, c) { a.deserializePropertyJson(this, b, c) }, deserializeClientJson: function(a, b, c) { a.deserializeClientJson(this, b, c) } }), Jb.addMethod(Ib.ElementBox, { serializeJson: function(a, b, c) { if (a.settings.isLayerBoxSerializable && (c.layers = [], this._layerBox.forEachByDepthFirst(function(a) { var b = {}; c.layers.push(b), this._layerBox.getDefaultLayer() !== a && (b.id = a.getId()), a.getName() && (b.name = a.getName()), b.visible = a.isVisible(), b.editable = a.isEditable(), b.movable = a.isMovable() }, null, this)), a.settings.isStyleSerializable && this._styleMap) for (var d in this._styleMap) this.serializeStyleJson(a, d, b, c); Ib.ElementBox.superClass.serializeJson.call(this, a, b, c) }, serializeStyleJson: function(a, b, c, d) { a.serializeStyleJson(this, b, c, d) }, deserializeStyleJson: function(a, b, c) { a.deserializeStyleJson(this, b, c) }, deserializeJson: function(a, b) { if (Ib.ElementBox.superClass.deserializeJson.call(this, a, b), a.settings.isLayerBoxSerializable && b.layers && b.layers) for (var c = b.layers.length, d = 0; c > d; d++) { var e, f = b.layers[d]; f.id != null ? (e = new Ib.Layer(f.id), this._layerBox.getDataById(e.getId()) ? e = this._layerBox.getDataById(e.getId()) : this._layerBox.add(e)) : (e = this._layerBox.getDefaultLayer(), this._layerBox.moveToBottom(e)), f.name && e.setName(f.name), f.visible != null && e.setVisible(f.visible), f.editable != null && e.setEditable(f.editable), f.movable != null && e.setMovable(f.movable) } if (a.settings.isStyleSerializable) for (var g in b.s) this.deserializeStyleJson(a, b.s[g], g) } }), Ib.layout.SpringLayouter = function(a) { this._network = a, this._damper = 1, this._maxMotion = 0, this._motionRatio = 0, this._isAdjusting = !1, this._timer = null, this._snodeMap = {}, this._snodes = new nd(), this._slinks = new nd(), this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange, this), this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange, this), this._network.addPropertyChangeListener(this._handleNetworkPropertyChange, this) }, Jb.ext('twaver.layout.SpringLayouter', Object, { _nodeRepulsionFactor: 0.6, _linkRepulsionFactor: 0.6, _limitBounds: null, _interval: 50, _stepCount: 10, _motionLimit: 0.01, start: function() { if (!this._timer) { var b = this, c = function() { b.relax.call(b) }; this._timer = a.setInterval(c, this._interval), this._damper = 1 } }, stop: function() { this._timer && (a.clearInterval(this._timer), this._timer = null) }, relax: function() { if (!(this._damper < 0.1 && this._maxMotion < this._motionLimit)) { this._rebuild(); for (var a = this._snodes.size(), b = 0; b < this._stepCount; b++) { this._slinks.forEach(this._relaxLink, this); for (var c = 0; a > c; c++) for (var d = 0; a > d; d++) { var e = this._snodes.get(c), f = this._snodes.get(d); e != f && this._relaxNodePair(e, f) } this._moveNodes() } this._isAdjusting = !0; for (var b = 0; a > b; b++) { var g = this._snodes.get(b); g.fix || g.element.setLocation(g.x, g.y) } this._isAdjusting = !1 } }, isRunning: function() { return !!this._timer }, getNetwork: function() { return this._network }, isVisible: function(a) { return this._network.isVisible(a) }, isMovable: function(a) { return this._network.isMovable(a) ? this._network.getSelectionModel().contains(a) ? !1 : a instanceof Nd ? !1 : !0 : !1 }, getNodeRepulsionFactor: function() { return this._nodeRepulsionFactor }, setNodeRepulsionFactor: function(a) { a < 0.02 && (a = 0.02), this._nodeRepulsionFactor = a, this._damper = 1 }, getLinkRepulsionFactor: function() { return this._linkRepulsionFactor }, setLinkRepulsionFactor: function(a) { a < 0.02 && (a = 0.02), this._linkRepulsionFactor = a, this._damper = 1 }, getStepCount: function() { return this._stepCount }, setStepCount: function(a) { this._stepCount = a, this._damper = 1 }, getInterval: function() { return this._interval }, setInterval: function(b) { if (this._interval !== b && (this._interval = b, this._timer)) { a.clearInterval(this._timer); var c = this, d = function() { c.relax.call(c) }; this._timer = a.setInterval(d, this._interval) } }, getLimitBounds: function() { return this._limitBounds }, setLimitBounds: function(a) { this._limitBounds = a, this._damper = 1 }, _handleDataPropertyChange: function(a) { this._isAdjusting || (this._damper = 1) }, _handleDataBoxChange: function(a) { this._damper = this._network.getElementBox().size() === 0 ? 0 : 1 }, _handleNetworkPropertyChange: function(a) { if (a.property === 'elementBox') { var b = a.oldValue; b != null && (b.removeDataBoxChangeListener(this._handleDataBoxChange, this), b.removeDataPropertyChangeListener(this._handleDataPropertyChange, this)), this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange, this), this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange, this) } }, _relaxLink: function(a) { var b = a.toNode.x - a.fromNode.x, c = a.toNode.y - a.fromNode.y, d = Math.sqrt(b * b + c * c), e = 0.25 * b, f = 0.25 * c; e /= 100 * a.length; var g = a.length, h = 100 * g, i = f; f /= h, i /= 100 * a.length, a.toNode.dx = a.toNode.dx - e * d, a.toNode.dy = a.toNode.dy - f * d, a.fromNode.dx = a.fromNode.dx + e * d, a.fromNode.dy = a.fromNode.dy + f * d }, _relaxNodePair: function(a, b) { var c = 0, d = 0, e = a.x - b.x, f = a.y - b.y, g = e * e + f * f; g === 0 ? (c = Ib.Util.random(), d = Ib.Util.random()) : g < 36e4 && (c = e / g, d = f / g); var h = a.repulsion * b.repulsion / 100, i = 0.25 * h; a.dx += c * i, a.dy += d * i, b.dx -= c * i, b.dy -= d * i }, _moveNodes: function() { for (var a = this._maxMotion, b = 0, c = 0, d = this._snodes.size(); d > c; c++) { var e = this._snodes.get(c), f = e.dx, g = e.dy; f *= this._damper, g *= this._damper, e.dx = f / 2, e.dy = g / 2; var h = Math.sqrt(f * f + g * g); if (!e.fix) if (e.x = e.x + Math.max(-30, Math.min(30, f)), e.y = e.y + Math.max(-30, Math.min(30, g)), this._limitBounds) { e.x < this._limitBounds.x && (e.x = this._limitBounds.x, this._adjustLocation(1, 0)), e.y < this._limitBounds.y && (e.y = this._limitBounds.y, this._adjustLocation(0, 1)); var i, j = this._network.getElementUI(e.element); i = j ? j._viewRect : e.element.getRect(), i && (e.x + i.width > this._limitBounds.x + this._limitBounds.width && (e.x = this._limitBounds.x + this._limitBounds.width - i.width, this._adjustLocation(-1, 0)), e.y + i.height > this._limitBounds.y + this._limitBounds.height && (e.y = this._limitBounds.y + this._limitBounds.height - i.height, this._adjustLocation(0, -1))) } else e.x < 1 && this._adjustLocation(1, 0), e.y < 1 && this._adjustLocation(0, 1); b = Math.max(h, b) } this._maxMotion = b, this._motionRatio = this._maxMotion > 0 ? a / this._maxMotion - 1 : 0, this._damp() }, _damp: function() { this._motionRatio <= 0.001 && ((this._maxMotion < 0.2 || this._maxMotion > 1 && this._damper < 0.9) && this._damper > 0.01 ? this._damper -= 0.01 : this._maxMotion < 0.4 && this._damper > 0.003 ? this._damper -= 0.003 : this._damper > 1e-4 && (this._damper -= 1e-4)), this._maxMotion < this._motionLimit && (this._damper = 0) }, _rebuild: function() { this._snodeMap = {}, this._snodes.clear(), this._slinks.clear(), this._network.getElementBox().forEach(function(a) { this.isVisible(a) && (a instanceof Ib.Link ? this._addLink(a) : a instanceof Ld && this._addNode(a)) }, this) }, _addNode: function(a) { var b = this._snodeMap[a.getId()]; return b || (b = {}, b.element = a, b.repulsion = this._getRepulsion(a), b.x = a.getX(), b.y = a.getY(), b.dx = 0, b.dy = 0, b.fix = !this.isMovable(a), this._snodeMap[a.getId()] = b, this._snodes.add(b), b) }, _addLink: function(a) { var b = {}; b.fromNode = this._addNode(a.getFromNode()), b.toNode = this._addNode(a.getToNode()), b.element = a; var c, d, e = this._network.getElementUI(a.getToNode()), f = this._network.getElementUI(a.getFromNode()); e && e._viewRect && f && f._viewRect ? (c = e._viewRect.width + f._viewRect.width, d = e._viewRect.height + f._viewRect.height) : (c = a.getToNode().getWidth() + a.getFromNode().getWidth(), d = a.getToNode().getHeight() + a.getFromNode().getHeight()), b.length = Math.floor(Math.sqrt(c * c + d * d) * this._linkRepulsionFactor), b.length <= 0 && (b.length = 100), this._slinks.add(b) }, _getRepulsion: function(a) { var b, c = this._network.getElementUI(a); if (c && c._viewRect) { var d = c._viewRect; b = Math.floor(Math.sqrt(d.width * d.width + d.height * d.height) * this._nodeRepulsionFactor) } else b = 100; return b <= 0 && (b = 100), b }, _adjustLocation: function(a, b) { for (var c = 0, d = this._snodes.size(); d > c; c++) { var e, f = this._snodes.get(c), g = this._network.getElementUI(f.element); if (e = g ? g._viewRect : f.element.getRect(), !e) return; a > 0 ? (!this._limitBounds || f.x + e.width + a < this._limitBounds.x + this._limitBounds.width) && (f.x += a) : (!this._limitBounds || f.x + a > this._limitBounds.x) && (f.x += a), b > 0 ? (!this._limitBounds || f.y + e.height + b < this._limitBounds.y + this._limitBounds.height) && (f.y += b) : (!this._limitBounds || f.y + b > this._limitBounds.y) && (f.y += b) } } }), Ib.layout.CloudLayouter = function(a) { Ib.layout.CloudLayouter.superClass.constructor.apply(this, arguments), this._network = a, this._centerX = 0, this._centerY = 0, this._radius = 1, this._rect = null, this._localPoint = null, this._lastWidth = -1e3, this._lastHeight = -1e3, this._nodes = new nd(), this._sa = 0, this._ca = 0, this._sb = 0, this._cb = 0, this._sc = 0, this._cc = 0, this._lasta = 0, this._lastb = 0, this._active = !1, this._horizontalElliptical = 1, this._verticalElliptical = 1, this._timer = null, this._centering = !1, this._centeringNode = null, this._freeze = !1, this._network.setInteractions(this._network.getClassName() === 'twaver.network.Network' ? [new Ib.network.interaction.SelectInteraction(this._network)] : [new Ib.canvas.interaction.SelectInteraction(this._network)]) }, Jb.ext('twaver.layout.CloudLayouter', Ib.PropertyChangeDispatcher, { __accessor: ['updateNodeFunction', 'mouseMoveFunction', 'mouseOverFunction', 'percentPadding', 'ceaseRate', 'ceaseLimit'], __bool: ['elliptical', 'active', 'updateLayoutRectOnResized', 'reloadOnDataBoxChanged'], _moveSpeed: 2, _ceaseRate: 0.9, _ceaseLimit: 0.01, _percentPadding: 0.2, _elliptical: !0, _interval: 50, _reloadOnDataBoxChanged: !0, _updateLayoutRectOnResized: !0, getNetwork: function() { return this._network }, isLayoutable: function(a) { return this._network.isVisible(a) && this._network.isMovable(a) }, start: function(b) { if (arguments.length === 0 && (b = !0), !this._timer) { this._installListeners(), b && this.updateLayoutRect(!0); var c = this, d = function() { c._update.call(c) }; this._timer = a.setInterval(d, this._interval), this._update() } }, stop: function() { this._timer && (a.clearInterval(this._timer), this._timer = null) }, isRunning: function() { return !!this._timer }, getInterval: function() { return this._interval }, setInterval: function(b) { if (this._interval !== b) { var c = this._interval; if (this._interval = b, this._timer) { a.clearInterval(this._timer); var d = this, e = function() { d._update.call(d) }; this._timer = a.setInterval(e, this._interval) } this.firePropertyChange('interval', c, b) } }, getMoveSpeed: function() { return this._moveSpeed }, setMoveSpeed: function(a) { var b = this._moveSpeed; this._moveSpeed = a, this.firePropertyChange('moveSpeed', b, a) }, getLayoutRect: function() { var a = this._network.getView().offsetWidth / this._network.getZoom(), b = this._network.getView().offsetHeight / this._network.getZoom(), c = a * this._percentPadding, d = b * this._percentPadding; return { x: c, y: d, width: a - 2 * c, height: b - 2 * d } }, getCount: function() { return this._nodes.size() }, updateLayoutRect: function(a) { var b = this._radius; if (this._rect = this.getLayoutRect(), this._rect.width <= 2 && (this._rect.width = 2), this._rect.height <= 2 && (this._rect.height = 2), this._radius = Math.min(this._rect.width / 2, this._rect.height / 2), this.isElliptical() ? (this._horizontalElliptical = this._rect.width / 2 / this._radius, this._verticalElliptical = this._rect.height / 2 / this._radius) : (this._horizontalElliptical = 1, this._verticalElliptical = 1), this._centerX = this._rect.x + this._rect.width / 2, this._centerY = this._rect.y + this._rect.height / 2, a) this.reload(); else { this._lasta = 1, this._lastb = 1; for (var c = this._nodes.size(), d = 0; c > d; d++) { var e = this._nodes.get(d); e.cx *= this._radius / b, e.cy *= this._radius / b, e.cz *= this._radius / b } this._freeze ? this._updateNodes(0, 0, 0) : this._update() } this._lastWidth = this._network.getView().offsetWidth, this._lastHeight = this._network.getView().offsetHeight }, reload: function() { this._freeze = !1, this._centeringNode = null, this._localPoint = null, this._centering = !1, this._nodes = new nd(), this._box.forEach(function(a) { if (a && this.isLayoutable(a)) { var b = {}; b.node = a, this._nodes.add(b) } }, this), this._sineCosine(0, 0, 0), this._active = !1, this._lasta = 1, this._lastb = 1; for (var a = 0, b = 0, c = this._nodes.size(), d = 0; c > d; d++) { a = Math.acos(-1 + (2 * (d + 1) - 1) / c), b = Math.sqrt(c * Math.PI) * a; var e = this._nodes.get(d); e.cx = this._radius * Math.cos(b) * Math.sin(a), e.cy = this._radius * Math.sin(b) * Math.sin(a), e.cz = this._radius * Math.cos(a) } }, _sineCosine: function(a, b, c) { var d = Math.PI / 180; this._sa = Math.sin(a * d), this._ca = Math.cos(a * d), this._sb = Math.sin(b * d), this._cb = Math.cos(b * d), this._sc = Math.sin(c * d), this._cc = Math.cos(c * d) }, handleSelectionChange: function(a) { this.centerNode(this._network.getSelectionModel().getLastData()) }, handleDataBoxChange: function(a) { (this._reloadOnDataBoxChanged || a.kind === 'clear') && this.reload() }, handleMouseMove: function(a) { this._centering || this._updateLogicalPoint(a), this._active = this._mouseMoveFunction ? this._mouseMoveFunction(a) : !0 }, handleMouseOver: function(a) { this._centering || this._updateLogicalPoint(a), this._active = this._mouseOverFunction ? this._mouseOverFunction(a) : !0 }, _updateLogicalPoint: function(a) { this._localPoint = this._network.getLogicalPoint(a) }, handleRollOut: function(a) { this._active = !1 }, handleResize: function(a) { if (a.kind === 'validateEnd') { if (!this._updateLayoutRectOnResized) return; if (Math.abs(this._network.getView().offsetWidth - this._lastWidth) <= 2 && Math.abs(this._network.getView().offsetHeight - this._lastHeight) <= 2) return; this.updateLayoutRect() } }, handleNetworkPropertyChange: function(a) { a.property === 'elementBox' && (this._box.removeDataBoxChangeListener(this.handleDataBoxChange, this), this._box = this._network.getElementBox(), this._box.addDataBoxChangeListener(this.handleDataBoxChange, this), this.reload()), a.property === 'zoom' && (this._localPoint = null, this.updateLayoutRect()) }, _adjustIndex: function() { this._nodes.sort(this._sortFunction); for (var a = this._nodes.size(), b = 0; a > b; b++) { var c = this._nodes.get(b).node, d = this._box.getDatas().indexOf(c); this._box.getDatas().removeAt(d), this._box.getDatas().add(c, b), this._box.fireIndexChange(c, d, b), this.updateNode(c, b, a, this._nodes.get(b).alpha) } }, _sortFunction: function(a, b) { return b.cz > a.cz ? 1 : b.cz < a.cz ? -1 : 0 }, updateNode: function(a, b, c, d) { this._updateNodeFunction && this._updateNodeFunction(a, b, c, d) }, _update: function() { if (!this._freeze) { var a, b; if (this._centering && this._centeringNode) { var c = this.isAtCenter(this._centeringNode.node, this._centeringNode.perspective, this._centeringNode.cx, this._centeringNode.cy, this._centeringNode.cz); if (c) return this._freeze = !0, this._centering = !1, void (this._centeringNode = null) } if (!this._freeze && (this._active || this._centering) && this._localPoint ? this.isElliptical() ? (a = (this._centerY - this._localPoint.y) / (this._rect.height / 2) * this._moveSpeed, b = (this._localPoint.x - this._centerX) / (this._rect.width / 2) * this._moveSpeed) : (a = (this._centerY - this._localPoint.y) / this._radius * this._moveSpeed, b = (this._localPoint.x - this._centerX) / this._radius * this._moveSpeed) : (a = this._lasta * this._ceaseRate, b = this._lastb * this._ceaseRate), this._lasta = a, this._lastb = b, Math.abs(a) > this._ceaseLimit || Math.abs(b) > this._ceaseLimit) { var d = 0; this._sineCosine(a, b, d); for (var e = 0, f = this._nodes.size(); f > e; e++) { var g = this._nodes.get(e), h = g.cx, i = g.cy * this._ca + g.cz * -this._sa, j = g.cy * this._sa + g.cz * this._ca, k = h * this._cb + j * this._sb, l = i, m = h * -this._sb + j * this._cb, n = k * this._cc + l * -this._sc, o = k * this._sc + l * this._cc, p = m; g.cx = n, g.cy = o, g.cz = p; var q = 2 * this._radius; q /= q + p, g.perspective = q, g.alpha = (this._radius - p) / (2 * this._radius); var r = this._horizontalElliptical * n * q - 2 * this._horizontalElliptical + this._centerX, s = o * q * this._verticalElliptical + this._centerY; g.node.setCenterLocation(r, s) } this._adjustIndex() } } }, centerNode: function(a) { if (a && this.isLayoutable(a)) { if (this._centeringNode && a === this._centeringNode.node && this._freeze) return; for (var b = 0, c = this._nodes.size(); c > b; b++) { var d = this._nodes.get(b); if (d && a === d.node) { this._centering = !0, this._freeze = !1, this._active = !0, this._centeringNode = d, this._localPoint = this.createControlPoint(this._centeringNode.node); break } } } else this._centering = !1, this._freeze = !1, this._active = !1, this._localPoint = null }, createControlPoint: function(a) { var b = a.getCenterLocation(), c = this.getLayoutRect(), d = c.x + c.width / 2, e = c.y + c.height / 2, f = Math.atan2(b.y - e, b.x - d), g = c.width + c.height; return { x: d + g * Math.cos(f), y: e + g * Math.sin(f) } }, isAtCenter: function(a, b, c, d, e) { if (this._moveSpeed <= 0) return !0; var f = 16 / this._moveSpeed; return f > 20 ? f = 20 : f < 2 && (f = 2), -e / Math.sqrt(c * c + d * d) > f }, _updateNodes: function(a, b, c) { this._sineCosine(a, b, c); for (var d = 0, e = this._nodes.size(); e > d; d++) { var f = this._nodes.get(d), g = f.cx, h = f.cy * this._ca + f.cz * -this._sa, i = f.cy * this._sa + f.cz * this._ca, j = g * this._cb + i * this._sb, k = h, l = g * -this._sb + i * this._cb, m = j * this._cc + k * -this._sc, n = j * this._sc + k * this._cc, o = l; f.cx = m, f.cy = n, f.cz = o; var p = 2 * this._radius; p /= p + o, f.perspective = p; var q = this._horizontalElliptical * m * p - 2 * this._horizontalElliptical + this._centerX, r = n * p * this._verticalElliptical + this._centerY; f.node.setCenterLocation(q, r) } this._adjustIndex() }, _installListeners: function() { this._box = this._network.getElementBox(), this._box.addDataBoxChangeListener(this.handleDataBoxChange, this), this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this), this._network.addViewListener(this.handleResize, this), Wb.addEventListener('mouseout', 'handleRollOut', this._network.getView(), this), Wb.addEventListener('mousemove', 'handleMouseMove', this._network.getView(), this), Wb.addEventListener('mouseover', 'handleMouseOver', this._network.getView(), this), this._network.addPropertyChangeListener(this.handleNetworkPropertyChange, this) }, _uninstallListeners: function() { this._box.removeDataBoxChangeListener(this.handleDataBoxChange, this), this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this), this._network.removeViewListener(this.handleResize, this), Wb.removeEventListener('mouseout', this._network.getView(), this), Wb.removeEventListener('mousemove', this._network.getView(), this), Wb.removeEventListener('mouseover', this._network.getView(), this), this._network.removePropertyChangeListener(this.handleNetworkPropertyChange, this) } }), Ib.layout.AutoLayouter = function(a) { this._box = a }, Jb.ext('twaver.layout.AutoLayouter', Object, { _expandGroup: !1, _repulsion: 1, _type: null, _animate: !0, _explicitXOffset: Number.NaN, _explicitYOffset: Number.NaN, _xOffset: 0, _yOffset: 0, isExpandGroup: function() { return this._expandGroup }, setExpandGroup: function(a) { this._expandGroup = a }, getRepulsion: function() { return this._repulsion }, setRepulsion: function(a) { this._repulsion = a }, getType: function() { return this._type }, isAnimate: function() { return this._animate }, setAnimate: function(a) { this._animate = a }, getElementBox: function() { return this._box }, getExplicitXOffset: function() { return this._explicitXOffset }, setExplicitXOffset: function(a) { this._explicitXOffset = a }, getExplicitYOffset: function() { return this._explicitYOffset }, setExplicitYOffset: function(a) { this._explicitYOffset = a }, getDimension: function(a) { if (a instanceof Nd && a.getChildrenSize() > 0) { for (var b = null, c = 0, d = a.getChildrenSize(); d > c; c++) { var e = a.getChildAt(c); e instanceof Ld && (b = b ? Tb.unionRect(b, e.getRect()) : e.getRect()) } return b ? { width: b.width, height: b.height } : null } return { width: a.getWidth(), height: a.getHeight() } }, isVisible: function(a) { return !0 }, isMovable: function(a) { return !0 }, getGroupLayoutType: function(a) { return this._type }, getElements: function() { var a, b = this._box, c = b.getSelectionModel().size() > 1; c ? a = b.getSelectionModel().getSelection() : (a = new nd(), b.forEachByBreadthFirst(a.add, null, a)), this._xOffset = -1, this._yOffset = -1; for (var d = new nd(), e = 0, f = a.size(); f > e; e++) { var g = a.get(e); this.isVisible(g) && (g instanceof Ib.Link ? d.add(g) : this.isMovable(g) && g instanceof Ld && (d.add(g), c && ((this._xOffset < 0 || g.getX() < this._xOffset) && (this._xOffset = g.getX()), (this._yOffset < 0 || g.getY() < this._yOffset) && (this._yOffset = g.getY())))) } return c || (this._xOffset = isNaN(this._explicitXOffset) ? 50 / this._repulsion : this._explicitXOffset, this._yOffset = isNaN(this._explicitYOffset) ? 50 / this._repulsion : this._explicitYOffset), d }, getLayoutResult: function(a) { var b = {}; return this.doLayoutImpl(a, null, b), b }, doLayout: function(a, b) { return this.doLayoutImpl(a, b) }, doLayoutImpl: function(a, b, c) { var d = this, e = b; b = function() { d._box._layoutMovingElements = !1, e && e() }, this._type = a; var f = null; if (a === 'round' ? f = new df() : a === 'symmetry' ? f = new sf() : a === 'hierarchic' ? f = new Cf() : (a === 'topbottom' || a === 'bottomtop' || a === 'rightleft' || a === 'leftright') && (f = new Re()), f == null) return !1; d._box._layoutMovingElements = !0; var g = {}, h = this.getElements(), i = new tf(this, h, !0, null); h = i.process(); var j = new nf(this, h, a, !0, null); try { f.i2(j) } catch (k) { return i.resetGroup(), b != null && b(), !1 } var l, m; for (l in j._a) { m = j._a[l]; var n = j.g4(m); g[l] = { x: n.x + this._xOffset, y: n.y + this._yOffset } } var o; if (a === 'rightleft' || a === 'leftright' || a === 'bottomtop') { var p = tf.createMatrix(a), q = Number.MAX_VALUE, r = Number.MAX_VALUE; for (l in g) { m = j._a[l], o = g[l]; var s = p.transform(o); o.x = s.x, o.y = s.y; var t; a === 'rightleft' || a === 'leftright' ? (t = s.x - j.g9(m) / 2 / this._repulsion, q > t && (q = t), t = s.y - j.gj(m) / 2 / this._repulsion, r > t && (r = t)) : (t = s.x - j.gj(m) / 2 / this._repulsion, q > t && (q = t), t = s.y - j.g9(m) / 2 / this._repulsion, r > t && (r = t)) } for (l in g)m = j._a[l], o = g[l], o.x = o.x - q + this._xOffset, o.y = o.y - r + this._yOffset } if (c == null && this._animate) { var u = new nd(), v = new nd(); for (l in g)u.add(j._a[l].node), v.add(g[l]); Ib.animate.AnimateManager.endAnimate(), Ib.animate.AnimateManager.start(new Ib.animate.AnimateCenterLocation(u, v, function() { i.resetGroup(), b != null && Jb.callLater(b) })) } else { for (l in g)m = j._a[l], o = g[l], c == null ? m.node.setCenterLocation(o.x, o.y) : c[m.node.getId()] = o; i.resetGroup(), b != null && Jb.callLater(b) } return !0 } }); var Sd = function(a, b) { this.x = a, this.y = b }; Jb.ext(Sd, Object, { equals: function(a) { return this === a ? !0 : a instanceof Sd ? a.x == this.x && a.y == this.y : !1 } }); var Td = function(a, b) { this.width = a, this.height = b }; Jb.ext(Td, Object, {}); var Ud = function(a, b) { this.x = a, this.y = b }; Jb.ext(Ud, Object, {}); var Vd = function() { arguments.length === 2 ? (Vd.superClass.constructor.call(this, arguments[1].width, arguments[1].height), this.x = arguments[0].x, this.y = arguments[0].y) : (Vd.superClass.constructor.call(this, arguments[2], arguments[3]), this.x = arguments[0], this.y = arguments[1]) }; Jb.ext(Vd, Td, {}); var Wd = function(a, b) { if (Wd.a2(a.x, b.x)) this._a = 1, this._b = 0, this._c = -a.x; else { this._b = -1; var c = (b.y - a.y) / (b.x - a.x), d = a.y - a.x * c; this._a = c, this._c = d } }; Jb.ext(Wd, Object, { a3: function() { return this._a }, a4: function() { return this._b }, a5: function() { return this._c } }), Wd.a6 = function(a, b) { if (Wd.a1(a.a3()) && Wd.a1(b.a3())) return null; if (Wd.a1(a.a4()) && Wd.a1(b.a4())) return null; if (Wd.a1(b.a4())) { var c = a; a = b, b = c } var d, e, f = a.a3(), g = a.a4(), h = -a.a5(); Wd.a1(a.a3()) ? (d = b.a4(), e = -b.a5()) : (d = b.a4() - b.a3() / a.a3() * a.a4(), e = -b.a5() - b.a3() / a.a3() * -a.a5()); var i = e / d, j = (h - i * g) / f; return new Sd(j, i) }, Wd.a1 = function(a) { return Wd.a2(a, 0) }, Wd.a2 = function(a, b) { return Math.abs(a - b) < 1e-5 }; var Xd = function(a) { if (this._a = new qe(), a) for (var b = 0; b < a.size(); b++) this._a.aa(a.get(b)) }; Jb.ext(Xd, Object, { c: function() { return this._a.ah() }, d: function() { return this._a.ah() }, a: function() { for (var a = new nd(), b = this.c(); b.i1(); b.i2())a.add(b.i6(), 0); return new Xd(a) }, b: function() { return this._a.ay() } }); var Yd = function(a, b) { this.x = a, this.y = b }; Jb.ext(Yd, Object, { a: function(a, b) { this.x = a, this.y = b } }); var Zd = function(a, b) { this.x = a || 0, this.y = b || 0 }; Jb.ext(Zd, Object, { b: function() { return new Zd(this.x, this.y) }, a: function(a) { this.z = a }, c: function() { return this.x }, d: function() { return this.y }, f: function(a, b) { this.x = a, this.y = b } }); var $d = function(a) { this._c = new qe(), a ? (this.ac(a.a8().b()), this.ad(a.a9().b())) : (this.ac(new Zd()), this.ad(new Zd())) }; Jb.ext($d, Object, { a6: function() { return this.a5(this) }, ac: function(a) { a.a(this), this._a = a }, ad: function(a) { a.a(this), this._b = a }, a8: function() { return this._a }, a9: function() { return this._b }, a1: function(a, b) { return this.a4(a, b, this.aa()) }, a2: function() { return this._c.ay() }, a7: function(a) { return this._c.ak(a) }, aa: function() { return this._c.ay() === 0 ? null : this._c.as() }, a3: function() { this._c.af() }, i2: function(a) { var b = this.a7(a); return b != null ? new Sd(b.x, b.y) : null }, i1: function() { return this.a2() }, i6: function() { var a = this.a8(); return new Sd(a.c(), a.d()) }, i7: function() { var a = this.a9(); return new Sd(a.c(), a.d()) }, i8: function(a) { this.a8().f(a.x, a.y) }, i9: function(a) { this.a9().f(a.x, a.y) }, i3: function(a, b, c) { var d = this.a7(a); d != null && d.a(b, c) }, i4: function(a, b) { this.a1(a, b) }, i5: function() { this.a3() } }); var _d = function(a) { _d.superClass.constructor.call(this, a) }; Jb.ext(_d, $d, { a5: function(a) { return new _d(a) }, a4: function(a, b, c) { var d = new Yd(a, b); return this.ab(d, c), d }, ab: function(a, b) { this._c.an(a, this._c.al(b)) } }); var ae = function() { if (arguments.length === 2) { var a = arguments[0], b = arguments[1]; this._s = !1, this._w = 30, this._h = 30, this._x = a - this._w / 2, this._y = b - this._h / 2 } else { var c = arguments[0]; this._s = c._s, this._w = c._w, this._h = c._h, this._x = c._x, this._y = c._y } }; Jb.ext(ae, Object, { m3: function() { return this.m2(this) }, m4: function() { return this._x + this._w / 2 }, m5: function() { return this._y + this._h / 2 }, m6: function(a, b) { this._x = a - this._w / 2, this._y = b - this._h / 2 }, i1: function() { return this._x }, i2: function() { return this._y }, i5: function(a, b) { this._x = a, this._y = b }, i3: function() { return this._w }, i4: function() { return this._h }, i6: function(a, b) { var c = (this._w - a) / 2, d = (this._h - b) / 2; this._x += c, this._y += d, this._w = a, this._h = b }, m1: function(a) { var b, c, d, e; a.width <= 0 ? (b = this._x, c = this._x + this._w, d = this._y, e = this._y + this._h) : (b = Math.min(this._x, a.x), c = Math.max(this._x + this._w, a.x + a.width), d = Math.min(this._y, a.y), e = Math.max(this._y + this._h, a.y + a.height)), a.x = b, a.y = d, a.width = c - b, a.height = e - d } }); var be = function(a) { a ? be.superClass.constructor.call(this, a) : be.superClass.constructor.call(this, 0, 0) }; Jb.ext(be, ae, { m2: function(a) { return new be(a) } }); var ce = {}; ce.a2 = function(a) { var b = Ne.a2(Hf.a(a.xa())); return ce.a4(a, b, ce.a3(a, b)) }, ce.a3 = function(a, b) { for (var c = a.x9(); c.i1(); c.i2())b.i7(c.i9(), -1); for (var d = 0, e = new we(a.xa()), f = a.x9(); f.i1(); f.i2()) { var g = f.i9(); b.i2(g) === -1 && ce.a(g, e, b, d++) } return d }, ce.a6 = function(a) { for (var b = new re(), c = ce.a2(a), d = 0; d < c.length - 1; d++) { var e = a.xo(c[d].x2(), c[d + 1].x3()); b.aa(e) } return b }, ce.a4 = function(a, b, c) { for (var d = [], e = 0; c > e; e++)d[e] = new Je(); for (var f = a.x9(); f.i1(); f.i2())d[b.i2(f.i9())].ae(f.i9()); return d }, ce.a = function(a, b, c, d) { for (b.c(a), c.i7(a, d); !b.a();) { a = b.b(); for (var e = a.ag(); e != null; e = e.a8()) { var f = e.a3(); c.i2(f) === -1 && (c.i7(f, d), b.c(f)) } for (var g = a.ae(); g != null; g = g.a7()) { var h = g.a2(); c.i2(h) === -1 && (c.i7(h, d), b.c(h)) } } }, ce.a1 = function(a, b, c) { var d = new le(b, c); return d.a8(a), d._i }, ce.a5 = function(a, b, c) { for (var d = [], e = 0; c > e; e++)d[e] = new re(); for (var f = a.xf(); f.i1(); f.i2())d[b.i2(f.i8())].aa(f.i8()); return d }, ce.a7 = function(a) { var b = new re(), c = Ne.a3(Hf.b(a.xa())), d = Ne.a4(Hf.a(a.xh())), e = ce.a1(a, d, c), f = ce.a5(a, d, e); if (f.length > 1) { for (var g = new Je(), h = 0; h < f.length; h++) { var i = f[h], j = null; if (i.ay() === 1) { var k = i.c2(); k.a2().ad() === 1 ? j = k.a2() : k.a3().ad() === 1 && (j = k.a3()) } else { for (var l = i.c1(); l.i1(); l.i2()) { var m = l.i8(); if (c.i4(m.a2())) if (j == null)j = m.a2(); else if (j !== m.a2()) { j = null; break } if (c.i4(m.a3())) if (j != null) { if (j !== m.a3()) { j = null; break } } else j = m.a3() } if (j != null) { var n = i.c2(); j = n.a2() !== j ? n.a2() : n.a3() } }j != null && g.aa(j) } for (var o, p = g.x4(); !g.ar(); p = o)o = g.x4(), b.ac(a.xo(p, o)) } return b }; var de = function() { this._c = 0, this._d = 0, this._e = 0, this._b = !0, this._f = !1 }; Jb.ext(de, Object, { a6: function(a) { this._f = a }, a7: function(a) { this._b = a }, a8: function(a) { a.x0() !== 0 && this.a9(a, a.x9().i9()) }, a9: function(a, b) { if (this._xx = a.xk(), this._c = a.xl(), this._d = 0, this._e = 0, this.a0(b), this._b) for (var c = a.x9(); c.i1(); c.i2()) { var d = c.i9(); this._xx.i1(d) == null && (this.a1(d), this.a0(d)) }a.xi(this._xx), a.xj(this._c) }, a0: function(a) { var b = ++this._d; this._xx.z1(a, de._B), this.a5(a, b); for (var c = this._f ? a.ap() : a.af(); c.i1(); c.i2()) { var d = c.i8(); if (!this._c.i4(d)) { this._c.i7(d, !0); var e = d.a1(a); this._xx.i1(e) == null ? (this.a3(d, e, !0), this.a0(e), this.a2(d, e)) : this.a3(d, e, !1) } } this.a4(a, b, ++this._e), this._xx.z1(a, de._C) }, a5: function(a, b) {}, a4: function(a, b, c) {}, a3: function(a, b, c) {},
    a2: function(a, b) {}, a1: function(a) {} }), de._B = {}, de._C = {}; var ee = function(a) { this._a = a }; Jb.ext(ee, de, { a5: function(a, b) { var c = this._a._ah.i2(a); this._a._ad[c].ae(a) } }); var fe = function(a) { this._a = a }; Jb.ext(fe, de, { a2: function(a, b) { var c = a.a1(b), d = this._a[c.al()], e = this._a[b.al()]; e._a + 1 > d._a ? (d._c = d._a, d._b = d._d, d._a = e._a + 1, d._d = a) : e._a + 1 > d._c && (d._c = e._a + 1, d._b = a) } }); var ge = function(a) { this._a = a }; Jb.ext(ge, de, { a3: function(a, b, c) { c && a.a2() === b && this._a.ac(a) } }); var he = function() { this._a = 0, this._c = 0 }; Jb.ext(he, Object, {}); var ie = function() { this._a = 0 }; Jb.ext(ie, Object, { a1: function(a, b) { this._a = 0; for (var c = b.length - 1; c >= 0; c--)b[c] = -1; for (var d = a.x9(); d.i1(); d.i2()) { var e = d.i9(); if (e.ak() === 0) { this.a2(e, e.al(), b); break } } for (var f = a.x9(); f.i1(); f.i2()) { var g = f.i9(), h = g.al(); b[h] === -1 && this.a2(g, h, b) } }, a2: function(a, b, c) { c[b] = -2; for (var d = a.ag(); d != null;) { var e = d.a3(), f = e.al(); switch (c[f]) { case -1:this.a2(e, f, c); case -2:default:d = d.a8() } }c[b] = this._a++ } }); var je = {}; je.a1 = function(a) { var b = new ke(); return b.a8(a), b._n }, je.a2 = function(a) { var b = a.x9(), c = null, d = 0; for (b.i4(); b.i1(); b.i2())b.i9().ak() === 0 && (c = b.i9(), d++); if (d === 1) return c; for (d = 0, b.i4(); b.i1(); b.i2())b.i9().ao() === 0 && (c = b.i9(), d++); return d === 1 ? c : je.a8(a) }, je.a8 = function(a) { var b = Hf.a(a.x0()), c = Ne.a2(b); return je.a6(a, c) }, je.a6 = function(a, b) { var c = a.xd(), d = Hf.d(1), e = Hf.a(a.x0(), -1), f = je.a4(a, c); je.a7(c, b, d, e, -1); for (var g = f.c1(); g.i1(); g.i2())a.x3(g.i8()); return d[0] }, je.a7 = function(a, b, c, d, e) { for (var f = 0, g = a.ag(); g != null; g = g.a8()) { var h = g.a3(), i = je.a7(h, b, c, d, e); i > e && (e = i), f += d[h.al()] } for (var j = f * (a._g.xa() - 1 - f), k = a.ag(); k != null; k = k.a8()) for (var l = k.a3(), m = k.a8(); m != null; m = m.a8()) { var n = m.a3(); j += d[l.al()] * d[n.al()] } return b.i7(a, j), d[a.al()] = f + 1, j > e && (e = j, c[0] = a), e }, je.a4 = function(a, b) { var c = new re(), d = new ge(c); d.a6(!1), d.a9(a, b); for (var e = c.c1(); e.i1(); e.i2())a.x3(e.i8()); return c }, je.a3 = function(a) { return je.a4(a, je.a2(a)) }; var ke = function() { this._n = !0, this.a6(!1) }; Jb.ext(ke, de, { a3: function(a, b, c) { c || (this._n = !1) }, a1: function(a) { this._n = !1 } }); var le = function(a, b) { this._i = 0, this._m = b, this._j = a, this._l = !1 }; Jb.ext(le, de, { a8: function(a) { this._h = Hf.a(a.x0()), this._k = Hf.a(a.x0()), this._g = new we(a.xh()), le.superClass.a8.call(this, a) }, a5: function(a, b) { this._k[a.al()] = this._h[a.al()] = b }, a3: function(a, b, c) { if (this._g.c(a), !c) { var d = a.a1(b); this._h[d.al()] = Math.min(this._h[d.al()], this._k[b.al()]) } }, a1: function(a) { this._l = !1 }, a2: function(a, b) { var c = a.a1(b); if (this._h[b.al()] >= this._k[c.al()]) { for (;this._g.d() !== a; this._j.i5(this._g.b(), this._i));this._j.i5(this._g.b(), this._i), this._i++, this._g.a() ? this._l ? this._m.i5(c, !0) : this._l = !0 : this._m.i5(c, !0) } this._h[c.al()] = Math.min(this._h[c.al()], this._h[b.al()]) } }); var me = function(a, b) { this._h = !1, this._i = a, this._g = b }; Jb.ext(me, Object, { z1: function(a, b) { a._c[this._i] = b }, i1: function(a) { return a._c[this._i] }, i5: function(a, b) { a._c[this._i] = b }, i4: function(a) { return a._c[this._i] }, i7: function(a, b) { a._c[this._i] = b }, i2: function(a) { var b = a._c[this._i]; return b == null ? 0 : b }, i6: function(a, b) { a._c[this._i] = b }, i3: function(a) { var b = a._c[this._i]; return b == null ? 0 : b }, c: function() { return this._h }, d: function() { this._h = !0 } }); var ne = function(a, b) { this._c = !1, this._d = a, this._b = b }; Jb.ext(ne, Object, { i8: function(a, b) { a._c[this._d] = b }, i1: function(a) { return a._c[this._d] }, i7: function(a, b) { a._c[this._d] = b }, i4: function(a) { var b = a._c[this._d]; return b == null ? !1 : b }, i5: function(a, b) { a._c[this._d] = b }, i2: function(a) { var b = a._c[this._d]; return b == null ? 0 : b }, i6: function(a, b) { a._c[this._d] = b }, i3: function(a) { var b = a._c[this._d]; return b == null ? 0 : b }, a: function() { return this._c }, b: function() { this._c = !0 } }); var oe = function(a) { this._bb = a, this.i4() }; Jb.ext(oe, Object, { i1: function() { return this._aa != null }, i2: function() { this._aa = this._aa._a }, i3: function() { this._aa = this._aa._b }, i4: function() { this._aa = this._bb._b }, i5: function() { this._aa = this._bb._c }, i7: function() { return this._bb.ay() }, i6: function() { return this._aa._c } }); var pe = function(a) { pe.superClass.constructor.call(this, a) }; Jb.ext(pe, oe, { i8: function() { return this.i6() } }); var qe = function(a) { if (this._id = Jb.id(), this._a = 0, a) for (a.i4(); a.i1(); a.i2()) this.ae(a.i6()) }; Jb.ext(qe, Object, { ac: function(a) { var b = this.ag(a); return this._b == null ? this._b = this._c = b : (this._b._b = b, b._a = this._b, this._b = b), this._a++, b }, ae: function(a) { var b = this.ag(a); return this._c == null ? this._b = this._c = b : (this._c._a = b, b._b = this._c, this._c = b), this._a++, b }, z1: function(a) { a._b = null, a._a = null, this._c == null ? this._b = this._c = a : (this._c._a = a, a._b = this._c, this._c = a), this._a++ }, ad: function(a) { a._b = null, a._a = null, this._b == null ? this._b = this._c = a : (this._b._b = a, a._a = this._b, this._b = a), this._a++ }, aa: function(a) { return this.ae(a), !0 }, ab: function(a) { for (;a.i1(); a.i2()) this.ae(a.i6()) }, ao: function(a, b) { if (b === this._b) return this.ac(a); if (b == null) return this.ae(a); var c = this.ag(a); return this.aq(c, b), c }, aq: function(a, b) { if (b == null) this.ad(a); else if (b === this._b) this.ad(a); else { if (this._c == null)a._b = null, a._a = null, this._b = this._c = a; else { var c = b._b; b._b = a, a._a = b, c._a = a, a._b = c } this._a++ } }, ap: function(a, b) { if (b == null) this.z1(a); else if (b === this._c) this.z1(a); else { if (this._b == null)a._b = null, a._a = null, this._b = this._c = a; else { var c = b._a; b._a = a, a._a = c, c._b = a, a._b = b } this._a++ } }, an: function(a, b) { if (b === this._c) return this.ae(a); if (b == null) return this.ac(a); var c = this.ag(a); return this.ap(c, b), c }, ay: function() { return this._a }, ar: function() { return this._a === 0 }, af: function() { this._b = this._c = null, this._a = 0 }, am: function() { return this._b._c }, at: function() { var a = this.am(); return this.aw(this._b), a }, as: function() { return this._c._c }, au: function() { return this.aw(this._c) }, ak: function(a) { for (var b = 0, c = this._b; c != null;) { if (a === b) return c._c; c = c._a, b++ } return null }, aj: function(a) { return a._a == null ? this._b : a._a }, ai: function(a) { return a._b == null ? this._c : a._b }, aw: function(a) { return a !== this._b ? a._b._a = a._a : this._b = a._a, a !== this._c ? a._a._b = a._b : this._c = a._b, this._a--, a._c }, av: function(a) { return this.aw(a._aa) }, ah: function() { return new oe(this) }, al: function(a) { for (var b = this._b; b != null;) { if (b._c == null && a == null) return b; if (b._c === a) return b; b = b._a } return null }, a0: function() { for (var a = Hf.d(this._a), b = 0, c = this._b; c != null;)a[b] = c._c, c = c._a, b++; return a }, ax: function() { for (var a = this._b; a != null; a = a._b) { var b = a._a; a._a = a._b, a._b = b } var c = this._b; this._b = this._c, this._c = c }, a1: function(a) { var b = this.a0(); b.sort(a); for (var c = 0, d = this._b; d != null;)d._c = b[c], d = d._a, c++ }, a2: function() { var a = this.a0(); a.sort(Hf.c); for (var b = 0, c = this._b; c != null;)c._c = a[b], c = c._a, b++ }, az: function(a) { this._b == null ? (this._b = a._b, this._c = a._c) : a._b != null && (this._c._a = a._b, a._b._b = this._c, this._c = a._c), this._a += a._a, a._b = a._c = null, a._a = 0 }, ag: function(a) { return new ue(a) } }); var re = function(a) { re.superClass.constructor.call(this, a) }; Jb.ext(re, qe, { c1: function() { return new pe(this) }, c2: function() { return this.am() }, c3: function() { return this.at() } }); var se = function() { this._c = 0 }; Jb.ext(se, Object, { a: function(a) { this._c++, a._b = this._b, a._a = null, this._b != null ? (this._b._a = a, this._b = a) : this._b = this._a = a }, b: function(a, b) { if (b == null) return void this.a(a); var c = b._b; c != null ? c._a = a : this._a = a, a._b = c, a._a = b, b._b = a, this._c++ }, c: function(a) { var b = a._a, c = a._b; this._c--, b != null ? b._b = c : this._b = c, c != null ? c._a = b : this._a = b } }); var te = function(a, b) { this._p = a, this._j = b, this._o = a._o[b] }; Jb.ext(te, Object, { i1: function() { return this._o != null }, i2: function() { this._o = this._o._k[this._j] }, i3: function() { this._o = this._o._f[this._j] }, i4: function() { this._o = this._p._o[this._j] }, i5: function() { this._o = this._p._q[this._j] }, i7: function() { return this._p._n[this._j] }, i6: function() { return this._o }, i8: function() { return this._o } }); var ue = function(a) { this._c = a }; Jb.ext(ue, Object, { a: function() { return this._a }, b: function() { return this._b }, c: function(a) { this._c = a }, d: function() { return this._c } }); var ve = function(a, b, c, d) { this._r = a, this._s = b, this._q = c, this._p = d }; Jb.ext(ve, Object, { i1: function(a) { return this._p[a.a5()] }, i3: function(a) { return this._r[a.a5()] }, i2: function(a) { return this._s[a.a5()] }, i4: function(a) { return this._q[a.a5()] }, i8: function(a, b) { this._p[a.a5()] = b }, i6: function(a, b) { this._r[a.a5()] = b }, i5: function(a, b) { this._s[a.a5()] = b }, i7: function(a, b) { this._q[a.a5()] = b } }); var we = function(a) { this._a = Hf.d(a), this._b = -1 }; Jb.ext(we, Object, { d: function() { return this._a[this._b] }, b: function() { return this._a[this._b--] }, c: function(a) { this._a[++this._b] = a }, a: function() { return this._b < 0 } }); var xe = function() {}; Jb.ext(xe, Object, { a0: function(a) { this._c = Hf.d(a) } }); var ye = function(a, b, c, d, e, f, g) { this._g = 0, a.xt(this, b, c, d, e, f, g) }; Jb.ext(ye, xe, { a5: function() { return this._h._u && this._h.b1(), this._g }, a2: function() { return this._d }, a3: function() { return this._e }, a1: function(a) { return this._d !== a ? this._d : this._e }, a4: function() { for (var a = 0; a <= 1; a++) this._k[a] = null, this._f[a] = null }, a8: function() { return this._k[0] }, a7: function() { return this._k[1] }, a6: function(a, b, c, d) { this.a0(d), this._h = a, this._k = Hf.d(2), this._f = Hf.d(2), this._d = b, this._e = c } }); var ze = function(a) { this._j = 0, this._h = a, this.i4() }; Jb.ext(ze, Object, { i2: function() { this._k = this._k._k[this._j], this._k == null && this._j === 0 && (this._k = this._h._o[1], this._j = 1) }, i3: function() { this._k = this._k._f[this._j], this._k == null && this._j === 1 && (this._k = this._h._q[0], this._j = 0) }, i4: function() { this._k = this._h._o[0], this._k == null ? (this._k = this._h._o[1], this._j = 1) : this._j = 0 }, i5: function() { this._k = this._h._q[1], this._k == null ? (this._k = this._h._q[0], this._j = 0) : this._j = 1 }, i1: function() { return this._k != null }, i6: function() { return this._k }, i8: function() { return this._k }, i7: function() { return this._h.ad() } }); var Ae = function() { this._a = ff._A, this._b = ff._A, this._c = new nd() }; Jb.ext(Ae, Object, { i1: function() { return this._c.size() }, i2: function(a) { return this._c.get(a) }, i3: function(a, b, c) { this._c.set(a, new Sd(b, c)) }, i4: function(a, b) { this._c.add(new Sd(a, b)) }, i5: function() { this._c.clear() }, i6: function() { return this._a }, i7: function() { return this._b }, i8: function(a) { this._a = a }, i9: function(a) { this._b = a } }); var Be = function() { this._x = 0, this._y = 0, this._w = 0, this._h = 0 }; Jb.ext(Be, Object, { i5: function(a, b) { this._x = a, this._y = b }, i6: function(a, b) { this._w = a, this._h = b }, i4: function() { return this._h }, i3: function() { return this._w }, i1: function() { return this._x }, i2: function() { return this._y } }); var Ce = function(a, b, c, d) { this._m = a, this._n = b, this._l = c, this._k = d }; Jb.ext(Ce, Object, { i1: function(a) { return this._k[a.al()] }, i3: function(a) { return this._m[a.al()] }, i2: function(a) { return this._n[a.al()] }, i4: function(a) { return this._l[a.al()] }, z1: function(a, b) { this._k[a.al()] = b }, i6: function(a, b) { this._m[a.al()] = b }, i7: function(a, b) { this._n[a.al()] = b }, i5: function(a, b) { this._l[a.al()] = b } }); var De = function(a, b) { this._b = a, this._r = b, this._a = []; for (var c = this._b - 1; c >= 0; c--) this._a.push(c); this._c = new nd() }; Jb.ext(De, Object, { a1: function(a) { var b; if (this._a.length === 0) { this.a2(a, this._b, this._b + this._r); for (var c = this._b + this._r - 1; c > this._b; c--) this._a.push(c); b = this._b, this._b += this._r } else b = this._a.pop(); return b }, b: function(a) { var b = this.a1(a), c = new me(b, this); return this._c.add(c), this.a4(a, b), c }, c: function(a) { var b = this.a1(a), c = new ne(b, this); return this._c.add(c), this.a4(a, b), c }, a2: function(a, b, c) { for (var d = a._a; d != null; d = d._a) { var e = Hf.d(c); Hf.f(d._c, e, b), d._c = e } }, a3: function(a, b, c) { var d = Hf.d(c); Hf.f(a._c, d, b), a._c = d }, a4: function(a, b) { for (var c = a._a; c != null; c = c._a)c._c[b] = null }, a5: function(a, b) { if (a instanceof me) { var c = a; if (c.c()) throw 'Error'; c.d(); var d = a._i; this._a.indexOf(d) < 0 && (this.a4(b, d), this._a.push(d), this._c.remove(a)) } }, a6: function(a, b) { if (a instanceof ne) { var c = a; if (c.a()) throw 'Error'; c.b(); var d = c._d; this._a.indexOf(d) < 0 && (this.a4(b, d), this._a.push(d), this._c.remove(a)) } } }); var Ee = function(a) { this._id = Jb.id(), this._p = 0, a.xs(this) }; Jb.ext(Ee, xe, { ad: function() { return this._n[0] + this._n[1] }, ak: function() { return this._n[1] }, ao: function() { return this._n[0] }, al: function() { return this._g._y && this._g.c(), this._p }, ag: function() { return this._o[0] }, ae: function() { return this._o[1] }, af: function() { return new ze(this) }, am: function() { return new te(this, 1) }, ap: function() { return new te(this, 0) }, an: function() { return new Ge(this) }, aq: function() { return new Fe(this, 1) }, aw: function() { return new Fe(this, 0) }, ah: function(a) { for (var b = this._o[0]; b != null; b = b._k[0]) if (b.a3() === a) return b; return null }, ai: function(a) { for (var b = this._o[1]; b != null; b = b._k[1]) if (b.a2() === a) return b; return null }, aj: function(a) { var b = this.ah(a); return b == null && (b = this.ai(a)), b }, au: function(a) { this.at(a, 1, Hf.d(this.ak())) }, av: function(a) { this.at(a, 0, Hf.d(this.ao())) }, as: function(a, b) { this.a0(b), this._g = a, this._o = Hf.d(2), this._q = Hf.d(2), this._n = Hf.a(2) }, ab: function(a, b, c, d, e) { if (b == null) return void this.aa(a, c, d); var f; if (f = b._d === b._e ? d : this !== b._d ? 1 : 0, e === 0) { var g = b._k[f]; a._f[d] = b, a._k[d] = g, b._k[f] = a, g == null ? this._q[c] = a : g._d === g._e ? g._f[d] = a : g._f[this !== g._d ? 1 : 0] = a } else { var h = b._f[f]; a._k[d] = b, a._f[d] = h, b._f[f] = a, h == null ? this._o[c] = a : h._d === h._e ? h._k[d] = a : h._k[this !== h._d ? 1 : 0] = a } this._n[c]++ }, aa: function(a, b, c) { var d = this._q[b]; a._k[c] = null, d == null ? (this._o[b] = a, a._f[c] = null) : (a._f[c] = d, d._d === d._e ? d._k[c] = a : d._k[this !== d._d ? 1 : 0] = a), this._q[b] = a, this._n[b]++ }, ar: function(a, b, c) { var d, e; d = a._k[c], e = a._f[c], d == null ? this._q[b] = e : d._f[d._d !== this ? 1 : 0] = e, e == null ? this._o[b] = d : e._k[e._d !== this ? 1 : 0] = d, this._n[b]-- }, ac: function() { for (var a = 0; a <= 1; a++) this._o[a] = null, this._q[a] = null, this._n[a] = 0 }, at: function(a, b, c) { if (!(this._n[b] < 2)) { var d, e = this._n[b], f = 0; for (d = this._o[b]; d != null; d = d._k[b])c[f] = d, f++; Hf.s(c, e, a); var g = this._o[b] = c[0]; g._f[b] = null; for (var h = 1; e > h;)d = c[h], d._f[b] = g, g._k[b] = d, h++, g = d; this._q[b] = d, d._k[b] = null } } }); var Fe = function(a, b) { Fe.superClass.constructor.call(this, a, b), this._h = b !== 1 ? 1 : 0 }; Jb.ext(Fe, te, { i6: function() { return this.i9() }, i9: function() { return this._h !== 0 ? this._o._e : this._o._d } }); var Ge = function(a) { Ge.superClass.constructor.call(this, a) }; Jb.ext(Ge, ze, { i6: function() { return this._k.a1(this._h) }, i9: function() { return this._k.a1(this._h) } }); var He = function(a) { He.superClass.constructor.call(this, a) }; Jb.ext(He, oe, { i9: function() { return this.i6() } }); var Ie = function(a) { this._o = a, this._c = a._a }; Jb.ext(Ie, Object, { i1: function() { return this._c != null }, i2: function() { this._c = this._c._a }, i3: function() { this._c = this._c._b }, i5: function() { this._c = this._o._b }, i4: function() { this._c = this._o._a }, i7: function() { return this._o._c }, i6: function() { return this._c }, i9: function() { return this._c }, i8: function() { return this._c } }); var Je = function(a) { if (a && a.length) { Je.superClass.constructor.call(this); for (var b = 0; b < a.length; b++) this.ae(a[b]) } else Je.superClass.constructor.call(this, a) }; Jb.ext(Je, qe, { x1: function() { return new He(this) }, x2: function() { return this.am() }, x3: function() { return this.as() }, x4: function() { return this.at() } }); var Ke = function(a) { this._d = a, Ke.superClass.constructor.call(this) }; Jb.ext(Ke, Je, {}); var Le = function(a) { this._a = a, this._b = new re(), this._c = new Je() }; Jb.ext(Le, Object, { a: function() { for (var a = this._a.x9(); a.i1(); a.i2()) this.e(a.i9()) }, b: function() { this.c(), this.d() }, c: function() { for (;!this._c.ar();) { var a = this._c.x4(); this._a.xq(a) || this.g(a) } }, d: function() { for (;!this._b.ar();) { var a = this._b.c3(); this._a.xp(a) || this.f(a) } }, e: function(a) { for (var b = a.af(); b.i1(); b.i2()) this._b.ac(b.i8()), this._a.h1(b.i8()); this._c.ac(a), this._a.h2(a) }, f: function(a) { this._a.u1(a) }, g: function(a) { this._a.h3(a) } }), Le.h = function(a, b) { for (b.i4(); b.i1(); b.i2()) { var c = b.i8(); a.xq(c.a2()) || a.h3(c.a2()), a.xq(c.a3()) || a.h3(c.a3()), a.xp(c) || a.u1(c) } }, Le.i = function(a, b) { for (b.i4(); b.i1(); b.i2()) { var c = b.i8(); a.xp(c) && a.h1(c), c.a2().ad() === 0 && a.h2(c.a2()), c.a3().ad() === 0 && a.h2(c.a3()) } }; var Me = function() { this._g = arguments[0], this._f = this._g.xk(), this._h = this._g.xk(), this._d = new qe(), this._e = 0, arguments.length !== 1 && this.a(arguments[1], arguments[2], arguments[3], arguments[4]) }; Jb.ext(Me, Object, { a: function(a, b, c, d) { for (var e = Hf.d(c - b + 1), f = b; c >= f; f++)e[f] = new Ke(f); for (var g = this._g.x9(); g.i1(); g.i2()) { var h = g.i9(); (d == null || d.i4(h)) && (this._f.z1(h, e[a.i2(h) - b].ac(h)), this._e++) } for (var i = 0; i < e.length; i++) for (var j = e[i], k = this._d.ae(j), l = j.x1(); l.i1(); l.i2()) this._h.z1(l.i9(), k) }, c: function() { this._g.xi(this._h), this._g.xi(this._f) }, e: function() { return this._e === 0 }, g: function() { for (;this._d.am().ar(); this._d.at());this._e--; var a = this._d.am().x4(); return this._h.z1(a, null), this._f.z1(a, null), a }, f: function() { for (;this._d.as().ar(); this._d.au());this._e--; var a = this._d.as().x4(); return this._h.z1(a, null), this._f.z1(a, null), a }, d: function(a) { var b = this._f.i1(a), c = this._h.i1(a), d = c.d(), e = null, f = c.a(); f != null ? (e = f.d(), this._h.z1(a, f)) : (e = new Ke(d._d + 1), this._h.z1(a, this._d.ae(e))), d.aw(b), this._f.z1(a, e.ac(a)) }, b: function(a) { var b = this._f.i1(a), c = this._h.i1(a), d = c.d(), e = null, f = c.b(); f != null ? (e = f.d(), this._h.z1(a, f)) : (e = new Ke(d._d - 1), this._h.z1(a, this._d.ac(e))), d.aw(b), this._f.z1(a, e.ac(a)) } }); var Ne = {}; Ne.a1 = function(a) { return new Ce(a, null, null, null) }, Ne.a2 = function(a) { return new Ce(null, a, null, null) }, Ne.a3 = function(a) { return new Ce(null, null, a, null) }, Ne.a4 = function(a) { return new ve(null, a, null, null) }, Ne.a5 = function(a) { return new ve(null, null, a, null) }, Ne.a6 = function(a) { return new ve(null, null, null, a) }; var Oe = function() { if (arguments.length === 2) { this._a = new qe(), this._b = new qe(), this._c = 0; var a = arguments[0], b = arguments[1], c = new Pe(a._j2.gj(b) / 2, 0); this._a.ac(c), c = new Pe(a._j2.gj(b) / 2, 0), this._b.ac(c) } else this._a = arguments[1], this._b = arguments[2], this._c = arguments[3] }; Jb.ext(Oe, Object, {}); var Pe = function(a, b) { this._b = a, this._a = b }; Jb.ext(Pe, Object, {}); var Qe = function() { this._cx = !0, this._cs = new af(), this._ct = new $e(), this._cw = new _e() }; Jb.ext(Qe, Object, { i5: function(a) { this._cx = a }, k: function() { var a = new bf(this); return this._cx && (this._cs.w1(a), a = this._cs), this._cw.w1(a), a = this._cw, this._ct.w1(a), a = this._ct }, i2: function(a) { this.k().i2(a) }, i1: function(a) { return this.k().i1(a) } }); var Re = function() { Re.superClass.constructor.call(this), this._jv = 20, this._jw = 40, this._jx = function(a, b) { var c = a.a3(), d = b.a3(), e = c._g; return Math.floor(100 * (e.g5(c) - e.g5(d))) } }; Jb.ext(Re, Qe, { i4: function(a) { return je.a1(a) }, i3: function(a) { if (!this.i4(a)) throw 'Error'; var b = je.a3(a); if (this._j2 = a, this._j3 = new Se(a), of.c(a), this._jy = a.xk(), !a.xb()) { this.bu(); var c = this._j3.c1(); this.f(c), this.b(this._j3), this.c(this._j3) } for (var d; !b.ar(); a.x3(d))d = b.c3(), of.b(a.g2(d)) }, bu: function() { if (this._jx != null) for (var a = this._j2.x9(); a.i1(); a.i2())a.i9().av(this._jx) }, c: function(a) { for (var b = this.a2(a), c = Hf.a(b.length), d = 0; d < b.length; d++) { for (var e = b[d], f = 0, g = e.ah(); g.i1(); g.i2()) { var h = g.i6(); f = Math.max(f, this._j2.g9(h)) }c[d] = f } for (var i = -this._jw, j = 0; j < b.length; j++) { i += this._jw + c[j]; for (var k = b[j], l = k.ah(); l.i1(); l.i2()) { var m = l.i6(); this._j2.s2(m, this._j2.g5(m), i - c[j] / 2) } } }, a2: function(a) { for (var b = Hf.d(a.b()), c = 0, d = a.b(); d > c; c++)b[c] = new qe(); return a.c1(), this.a1(a.c1(), 0, b), b }, a1: function(a, b, c) { c[b].ae(a); for (var d = a.aw(); d.i1(); d.i2()) this.a1(d.i9(), b + 1, c) }, b: function(a) { var b = a.c1(); this._j2.s2(b, 0, this._j2.g6(b)), this.g(b) }, g: function(a) { for (var b = a.aw(); b.i1(); b.i2()) { var c = b.i9(), d = this._jy.i1(c); this._j2.s2(c, this._j2.g5(a) + d._c, this._j2.g6(c)), this.g(c) } }, f: function(a) { if (this._j3.c2(a)) return void this._jy.z1(a, new Oe(this, a)); var b = a.aw(), c = b.i9(); b.i2(), this.f(c); var d = this._jy.i1(c), e = new Oe(this, d._a, d._b, 0); if (!b.i1()) return e._a.ac(new Pe(this._j2.gj(a) / 2, 0)), e._b.ac(new Pe(this._j2.gj(a) / 2, 0)), void this._jy.z1(a, e); for (;b.i1();) { c = b.i9(), b.i2(), this.f(c), d = this._jy.i1(c); for (var f = e._b.ah(), g = d._a.ah(), h = 2147483647, i = 0, j = 0; f.i1() && g.i1();) { var k = f.i6(); f.i2(); var l = g.i6(); g.i2(), j += k._a, i += l._a, h = Math.min(h, i - j - k._b - l._b) }d._c = this._jv - h, i += d._c; var m = d._b.am(); if (m._a = d._c, f.i1() && !g.i1()) for (var n = j - this.a3(d._b); f.i1(); n = 0) { var o = f.i6(); f.i2(), d._b.ae(new Pe(o._b, o._a + n)) } else if (!f.i1() && g.i1()) { var p = this.a3(e._a); for (p = i - p; g.i1(); p = 0) { var q = g.i6(); g.i2(), e._a.ae(new Pe(q._b, q._a + p)) } }e._b = d._b } this._jy.z1(a, e); for (var r = -d._c / 2, s = a.aw(); s.i1();) { var t = s.i9(); s.i2(); var u = this._jy.i1(t); u._c += r; var v = u._b.am(); v._a += r, v = u._a.am(), v._a += r }e._a.ac(new Pe(this._j2.gj(a) / 2, 0)), e._b.ac(new Pe(this._j2.gj(a) / 2, 0)) }, a3: function(a) { for (var b = 0, c = a.ah(); c.i1(); c.i2()) { var d = c.i6(); b += d._a } return b } }); var Se = function(a) { this._b = a, this.a() }; Jb.ext(Se, Object, { c1: function() { return this._a == null && this.a(), this._a }, b: function() { return this._a == null ? -1 : this.d(this._a) }, d: function(a) { for (var b = 0, c = a.aw(); c.i1(); c.i2())b = Math.max(b, this.d(c.i9())); return b + 1 }, c2: function(a) { return a.ao() === 0 }, a: function() { for (var a = this._b.x9(); a.i1(); a.i2()) if (a.i9().ak() === 0) return void (this._a = a.i9()) } }); var Te = function(a) { this._d = 0, this._e = 0, this._f = 0, this._a = 0, this._b = 0, this._g = a, this._c = new qe() }; Jb.ext(Te, Object, { a: function() { return this._d + this._e + this._f } }); var Ue = function() { Ue.superClass.constructor.call(this), this._kl = 340, this._km = 360, this._kk = 40, this._ko = 0.5 }; Jb.ext(Ue, Qe, { ic: function() { return this._km }, ia: function() { return this._kl }, i9: function() { return this._ko }, i3: function(a) { if (!je.a1(a)) throw 'Error'; this._a = a; var b = this.i8(), c = je.a4(a, b); of.c(a), this._kn = Hf.d(a.x0()); for (var d = a.x9(); d.i1(); d.i2()) { var e = d.i9(); e !== b ? this.aa(e, new Te(this._kk + this.q(e.aq().i9()))) : this.aa(e, new Te(this._kk)) } this.s(b), a.s2(b, 0, 0), this.t(b); for (var f; !c.ar(); a.x3(f))f = c.c3() }, i4: function(a) { return je.a1(a) }, i0: function(a) { return this._kn[a.al()] }, i8: function() { return je.a2(this._a) }, i7: function(a) { for (var b, c = this.ib(a); ;) { if (b = this.i6(a), c >= b) break; for (var d = a.aw(); d.i1(); d.i2()) { var e = d.i9(); this.i0(e)._g *= 1 + this._ko } } var f = (c - b) / (2 * a.ao()); b = 0; for (var g = a.aw(); g.i1(); g.i2()) { var h = this.i0(g.i9()); h._d += f, h._e += f, b += h._d + h._e } this.id(a) }, id: function(a) { for (var b = Hf.d(a.ao()), c = 0, d = a.ap(); d.i1();)b[c] = d.i8(), d.i2(), c++; var e = this; b.sort(function(a, b) { var c = a.a3(), d = b.a3(), f = e.i0(c).a() - e.i0(d).a(); return f > 0 ? 1 : f >= 0 ? 0 : -1 }); for (var f = 0; f < b.length; f++) this._a.h1(b[f]); for (var g = 0; g < b.length; g += 2) this._a.u1(b[g]); for (c = b.length - 1, c % 2 === 0 && c--; c > 0; c -= 2) this._a.u1(b[c]) }, ib: function(a) { return a.ak() === 0 ? this._km : a.ao() === 2 ? Math.min(180, this._kl) : this._kl }, i6: function(a) { for (var b = 0, c = a.ap(); c.i1(); c.i2()) { for (var d, e = c.i8(), f = e.a3(), g = this.i0(f), h = -g._g, i = g._b, j = g._c, k = 0, l = k + 1, m = j._b, n = m.d(); l > k; l = (d.y - i) / (d.x - h))d = n, m = j.ai(m), n = m.d(), k = (n.y - d.y) / (n.x - d.x); for (g._d = 180 * -Math.atan(l) / Math.PI, k = 0, l = k - 1, m = j._b, n = m.d(); m.a().d().x === n.x; n = m.d())m = m.a(); for (var o; k > l; l = (o.y - i) / (o.x - h))o = n, m = j.aj(m), n = m.d(), k = (n.y - o.y) / (n.x - o.x); g._e = 180 * Math.atan(l) / Math.PI, b += g._d + g._e } return b }, aa: function(a, b) { this._kn[a.al()] = b }, p: function(a) { var b = this.i0(a), c = new qe(), d = 2 * this.q(a); c.aa(new Sd(0, 0)), c.aa(new Sd(0, d)), c.aa(new Sd(d, d)), c.aa(new Sd(d, 0)), b._c = c, b._a = d / 2, b._b = d / 2 }, r: function(a) { if (a.ao() === 0) this.p(a); else { var b = this.i0(a), c = this.q(a), d = new qe(); d.aa(new Sd(-c, -c)), d.aa(new Sd(-c, c)), d.aa(new Sd(c, -c)), d.aa(new Sd(c, c)); for (var e = a.aw(); e.i1(); e.i2()) { var f = this.i0(e.i9()); d.az(f._c) } for (var g = ff.h(d), h = Number.MAX_VALUE, i = Number.MAX_VALUE, j = Number.MIN_VALUE, k = Number.MIN_VALUE, l = g.ah(); l.i1(); l.i2()) { var m = l.i6(); m.x < h && (h = m.x), m.x > j && (j = m.x), m.y < i && (i = m.y), m.y > k && (k = m.y) } for (var n = new qe(), o = g.ah(); o.i1(); o.i2()) { var p = o.i6(); n.aa(new Sd(p.x - h, p.y - i)) }b._c = n, b._a = -h, b._b = -i } }, s: function(a) { if (a.ao() === 0) this.r(a); else { for (var b = a.aw(); b.i1(); b.i2()) this.s(b.i9()); this.i7(a); for (var c = 0, d = a.aw(); d.i1(); d.i2()) { var e = d.i9(), f = this.i0(e), g = 180 - (360 - this.ib(a)) / 2 - c - (f._e + f._f); c += f.a(), g = g / 180 * Math.PI; for (var h = Math.sin(g), i = Math.cos(g), j = f._c._b; j != null; j = j.a()) { var k = j.d(), l = k.x + f._g, m = k.y - f._b, n = new Sd(l * i - h * m, l * h + i * m); j.c(n) } var o = f._a + f._g; f._a = o * i, f._b = o * h } this.r(a) } }, t: function(a) { var b = this._a.g4(a), c = 0; if (a.ak() > 0) { var d = a.aq().i9(), e = this._a.g4(d); c = Math.PI + Math.atan2(e.y - b.y, e.x - b.x) } for (var f = a.aw(); f.i1(); f.i2()) { var g = f.i9(), h = this.i0(g); if (c !== 0) { var i = Math.cos(c), j = Math.sin(c), k = h._a * i - j * h._b, l = h._a * j + i * h._b; h._a = k, h._b = l } this._a.s2(g, b.x + h._a, b.y + h._b), this.t(g) } }, q: function(a) { return 1.41 * (Math.max(this._a.gj(a), this._a.g9(a)) / 2) } }); var Ve = function() {}; Jb.ext(Ve, Object, { i2: function(a) { return a.ad() }, i1: function(a) { throw 'Error' }, i3: function(a) { throw 'Error' }, i4: function(a) { throw 'Error' } }); var We = function(a) { this._a = a }; Jb.ext(We, Object, { i2: function(a) { for (var b = 0, c = a.an(); c.i1(); c.i2()) this._a.i1(c.i9()) != null && b++; return b }, i4: function(a) { return this._a.i1(a) == null }, i1: function(a) { throw 'Error' }, i3: function(a) { throw 'Error' } }); var Xe = function() { Xe.superClass.constructor.call(this), this._kq = !1, this._kp = 90 }; Jb.ext(Xe, Ue, { a: function(a, b) { this._kr = b, this._ks = a, this._kq = !0 }, i7: function(a) { if (!this.u(a)) return void Xe.superClass.i7.call(this, a); for (var b = this.i9(), c = this.ib(a), d = (360 - c) / 2 + c, e = new re(a.ap()); ;) { var f = this.i6(a); f = (360 - c) / 2; for (var g = null, h = null, i = e._b; i != null; i = i.a()) { var j = i.d(), k = j.a3(), l = this.i0(k), m = this._ks.i3(j), n = m - (f + l._e); if (n >= 0 && m + l._d >= d && (n = f + l.a() <= d ? d - f - l.a() : 2 * (d - (m + l._d))), l._f = 0, n >= 0)l._f = n, g = i, h = l; else { for (-n > l._d + l._e ? n = (l._d + l._e) / 2 : n /= -2, f -= n, d >= f && f + l.a() > d && (f += n, n = f + l.a() - d, f -= n); g != null && n > h._f; h = this.i0(g.d().a3())) if (n -= h._f, h._f = 0, g = g.b(), g == null) { h = null; break }g != null ? h._f -= n : f += n }f += l.a() } if (d >= f) { for (var o = 0, p = (360 - c) / 2, q = a.ap(); q.i1(); q.i2()) { var r = q.i8(), s = r.a3(), t = this._ks.i3(r), u = this.i0(s), v = p + u._f + u._e; o < Math.abs(v - t) && (o = Math.abs(v - t)), p += u.a() } if (o <= this._kp) break } for (var w = a.aw(); w.i1(); w.i2()) { var x = w.i9(); this.i0(x)._g *= 1 + b } } }, ib: function(a) { return this.u(a) ? a.ak() === 0 ? this.ic() : this.ia() : Xe.superClass.ib.call(this, a) }, u: function(a) { return this._kq && a.ao() !== 0 ? this._ks.i1(a.ag()) != null : !1 } }); var Ye = function(a) { this._a = a }; Jb.ext(Ye, Object, { i1: function(a) { return this._a.i1(a) }, i2: function(a) { throw 'Error' }, i3: function(a) { throw 'Error' }, i4: function(a) { throw 'Error' } }); var Ze = function() {}; Jb.ext(Ze, Object, { w1: function(a) { this._bb = a }, w2: function() { return this._bb }, w4: function(a) { this._bb != null && this._bb.i2(a) }, w3: function(a) { return this._bb != null ? this._bb.i1(a) : !0 } }); var $e = function() { this._cg = 45, this._ce = 400, this._ch = 400, this._cf = 0 }; Jb.ext($e, Ze, { i1: function(a) { if (this.w2() != null) { for (var b = !0, c = a.xk(), d = ce.a3(a, c), e = Hf.d(d), f = Hf.d(d), g = 0; d > g; g++)e[g] = new Je(), f[g] = new re(); for (var h = a.xf(); h.i1(); h.i2()) { var i = h.i8(); f[c.i2(i.a2())].aa(i), a.h1(i) } for (var j = a.x9(); j.i1(); j.i2()) { var k = j.i9(); e[c.i2(k)].aa(k), a.h2(j.i9()) } for (var l = 0; d > l; l++) { for (var m = e[l].x1(); m.i1(); m.i2())a.h3(m.i9()); for (var n = f[l].c1(); n.i1(); n.i2())a.u1(n.i8()); b = this.w3(a); for (var o = f[l].c1(); o.i1(); o.i2())a.h1(o.i8()); for (var p = e[l].x1(); p.i1(); p.i2())a.h2(p.i9()); if (!b) break } for (var q = 0; d > q; q++) for (var r = e[q].x1(); r.i1(); r.i2())a.h3(r.i9()); for (var s = 0; d > s; s++) for (var t = f[s].c1(); t.i1(); t.i2())a.u1(t.i8()); return a.xi(c), b } return !0 }, i2: function(a) { if (!a.xb()) { for (var b = a.xk(), c = ce.a3(a, b), d = Hf.d(c), e = Hf.d(c), f = Hf.d(c), g = Hf.d(c), h = 0; c > h; h++)d[h] = new Je(), e[h] = new re(); for (var i = a.xf(); i.i1(); i.i2()) { var j = i.i8(); e[b.i2(j.a2())].aa(j), a.h1(j) } for (var k = a.x9(); k.i1(); k.i2()) { var l = k.i9(); d[b.i2(l)].aa(l), a.h2(k.i9()) } for (var m = 0; c > m; m++) { for (var n = d[m].x1(); n.i1(); n.i2())a.h3(n.i9()); for (var o = e[m].c1(); o.i1(); o.i2())a.u1(o.i8()); this.w4(a); var p = a.g3(); f[m] = new Vd(p.x, p.y, p.width, p.height); var q = {}; if (g[m] = q, this._cf > 0) { var r = this._cg + Math.ceil((p.width + 1) / this._cf) * this._cf, s = this._cg + Math.ceil((p.height + 1) / this._cf) * this._cf; q.x = p.x, q.y = p.y, q.width = r, q.height = s } else q.x = p.x, q.y = p.y, q.width = p.width + this._cg, q.height = p.height + this._cg; for (var t = e[m].c1(); t.i1(); t.i2())a.h1(t.i8()); for (var u = d[m].x1(); u.i1(); u.i2())a.h2(u.i9()) } for (var v = 0; c > v; v++) for (var w = d[v].x1(); w.i1(); w.i2())a.h3(w.i9()); for (var x = 0; c > x; x++) for (var y = e[x].c1(); y.i1(); y.i2())a.u1(y.i8()); if (of.a(g, null, this._ce / this._ch), this._cf <= 0) for (var z = 0; z < g.length; z++) this.w5(a, d[z], e[z], new Sd(g[z].x, g[z].y), f[z]); else for (var A = 0; A < g.length; A++) { var B = Math.floor((g[A].x - f[A].x) / this._cf) * this._cf, C = Math.floor((g[A].y - f[A].y) / this._cf) * this._cf, D = f[A].x + B, E = f[A].y + C; this.w5(a, d[A], e[A], new Sd(D, E), f[A]) }a.xi(b) } }, w5: function(a, b, c, d, e) { for (var f = -e.x + d.x, g = -e.y + d.y, h = b.x1(); h.i1(); h.i2()) { var i = a.ga(h.i9()); a.s4(h.i9(), new Sd(i.x + f, i.y + g)) } for (var j = c.c1(); j.i1(); j.i2()) { for (var k = j.i8(), l = new nd(), m = a.gp(k).c(); m.i1(); m.i2()) { var n = m.i6(); l.add(new Sd(n.x + f, n.y + g)) }a.s5(k, new Xd(l)) } } }); var _e = function() {}; Jb.ext(_e, Ze, { i1: function(a) { return this.w3(a) }, i2: function(a) { this.w7(a), this.w2() != null && this.w4(a), this.w6(a) }, w7: function(a) { this.e(a), this.k(a), this.i(a) }, e: function(a) { for (var b = a.x9(); b.i1(); b.i2()) { var c = a.g4(b.i9()); a.s1(b.i9(), c) } }, w6: function(a) { this.l(a), this.j(a), this.f(a) }, l: function(a) { for (var b = a.x9(); b.i1(); b.i2()) { var c = a.g4(b.i9()); a.s1(b.i9(), c) } }, j: function(a) { for (var b = a.xf(); b.i1(); b.i2()) { var c = a.g7(b.i8()), d = c.i6(); c.i8(d), d = c.i7(), c.i9(d); for (var e = 0; e < c.i1(); e++) { var f = c.i2(e); c.i3(e, f.x, f.y) } } }, k: function(a) { for (var b = a.xf(); b.i1(); b.i2()) { var c = a.g7(b.i8()), d = c.i6(); c.i8(d), d = c.i7(), c.i9(d); for (var e = 0; e < c.i1(); e++) { var f = c.i2(e); c.i3(e, f.x, f.y) } } }, f: function(a) { this._ca != null && (a.x1('A', this._ca), this._ca = null, this._b6 = null), this._b8 != null && (a.x1('B', this._b8), this._b8 = null, this._b9 = null) }, i: function(a) { this._ca = a.xc('A'), this._ca != null && (this._b6 = new Ye(this._ca), a.x1('A', this._b6)), this._b8 = a.xc('B'), this._b8 != null && (this._b9 = new Ye(this._b8), a.x1('B', this._b9)) } }); var af = function() { this._a = new re(), this._c = 10 }; Jb.ext(af, Ze, { i2: function(a) { this._b = a.xl(), this.w9(a), this.w4(a), this.c(a), this.w8(a, this._b), a.xj(this._b) }, i1: function(a) { if (this.w2() == null) return !0; this._b = a.xl(), this.w9(a); var b = this.w3(a); return this.c(a), a.xj(this._b), b }, w8: function(a, b) { for (var c = a.xf(); c.i1(); c.i2()) { var d = c.i8(); if (b.i1(d) != null) { var e = b.i1(d); of.g(a, d, e, this._c) } } }, w9: function(a) { for (var b = a.xk(), c = a.x9(); c.i1(); c.i2()) { for (var d = c.i9(), e = d.af(); e.i1(); e.i2()) { var f = e.i8(), g = f.a1(d), h = b.i1(g); if (h !== f) if (h == null)b.z1(g, f); else { this._b.i1(h) == null && this._b.i8(h, new re()); var i = this._b.i1(h); i.aa(f), this._a.ac(f), a.h1(f) } } for (var j = d.af(); j.i1(); j.i2()) { var k = j.i8(), l = k.a1(d); b.z1(l, null) } }a.xi(b) }, c: function(a) { for (;!this._a.ar(); a.u1(this._a.c3())); } }); var bf = function(a) { this._a = a }; Jb.ext(bf, Object, { i2: function(a) { this._a.i3(a) }, i1: function(a) { return this._a.i4(a) } }); var cf = function() { cf.superClass.constructor.call(this), this._jo = 30, this._jp = new gf(), this._jt = 5 }; Jb.ext(cf, Qe, { i4: function(a) { return !0 }, i3: function(a) { this._ju = a, of.c(a); for (var b = this._jp.i1(a), c = 0, d = a.x9(); d.i1(); d.i2())c = Math.max(c, this.e(d.i9())); c < this._jt && (c = this._jt), this.a(b, c) }, a: function(a, b) { var c = a.i7(), d = 2 * Math.PI / c, e = 0, f = Hf.a(c); a.i4(); for (var g = 0; c > g;)f[g] = this.e(a.i9()) + this._jo, e += f[g], g++, a.i2(); var h = e / c, i = e / (2 * Math.PI); b > i && (i = b), a.i4(); for (var j = 0, k = 0; c > k;) { var l = d / h * f[k]; j += l / 2; var m = Math.cos(j) * i, n = Math.sin(j) * i; j += l / 2, this._ju.s2(a.i9(), m, n), k++, a.i2() } return i }, e: function(a) { var b = this._ju.gj(a), c = this._ju.g9(a); return c >= b ? c : b } }); var df = function() { df.superClass.constructor.call(this), this._jm = new cf(), this._jk = new Xe() }; Jb.ext(df, Qe, { i4: function(a) { return !0 }, i3: function(a) { if (!(a.x0() < 2)) { this._jn = a, of.c(this._jn), of.e(this._jn); var b = new mf(this._jn); b.a1(), b.h(); var c = new Le(this._jn); c.a(); for (var d = b.x9(); d.i1(); d.i2()) { var e = d.i9(), f = b.c2(e); if (f.ay() > 1) { var g = b.d1(e); Le.h(this._jn, g.c1()), this._jm.i3(this._jn); var h = this._jn.g3(); b.s7(e, h.width, h.height) } else if (f.ay() === 1) { var i = f.x2(); b.s8(e, this._jn.gm(i)), this._jn.s2(i, 0, 0) } else b.s7(e, 1, 1); Le.i(this._jn, this._jn.xf()) }c.b(); var j = this.a7(b); je.a4(b, j); var k = b.xk(), l = b.xl(); this.a2(b, l, k), this.a1(b, l), this.a3(b, j, l), this._jk.a(l, k), this._jk.i3(b), this.a5(b, j, k); for (var m = b.x9(); m.i1(); m.i2()) for (var n = m.i9(), o = b.g4(n), p = b.c2(n).x1(); p.i1(); p.i2()) { var q = p.i9(); this._jn.s2(q, o.x + this._jn.g5(q), o.y + this._jn.g6(q)) } } }, a7: function(a) { for (var b = -1, c = null, d = a.x9(); d.i1(); d.i2()) { var e = d.i9(); a.c2(e).ay() > b && (c = e, b = a.c2(e).ay()) } return c }, a1: function(a, b) { for (var c = function(a, c) { var d = b.i3(a) - b.i3(c); return d > 0 ? 1 : d >= 0 ? 0 : -1 }, d = a.x9(); d.i1(); d.i2())d.i9().av(c) }, a2: function(a, b, c) { for (var d = Hf.a(this._jn.x0()), e = a.x9(); e.i1(); e.i2()) for (var f = e.i9(), g = a.c2(f), h = g.x1(); h.i1(); h.i2()) { var i = h.i9(); d[i.al()] = f.al() } var j = je.a2(a); this.a4(a, j, d, b, c) }, a3: function(a, b, c) {
    if (a.c2(b).ay() > 1) {
      for (var d = 0, e = 0, f = 0, g = b.ap(); g.i1(); g.i2()) {
        var h = g.i8(), i = c.i3(h); i - d > e && (e = i - d,
          f = (d + i) / 2), d = i
      }360 - d > e && (f = (360 + d) / 2), this.a6(a, b, f); for (var j = b.ap(); j.i1(); j.i2()) { var k = j.i8(), l = c.i3(k); for (l -= f; l < 0; l += 360);c.i6(k, l) }b.av(function(a, b) { var d = c.i3(a) - c.i3(b); return d > 0 ? 1 : d >= 0 ? 0 : -1 })
    }
  }, a4: function(a, b, c, d, e) { for (var f = b.al(), g = e.i3(b), h = b.ap(); h.i1(); h.i2()) { for (var i = h.i8(), j = a.b(i), k = 0, l = 0, m = 0, n = 0, o = j.c1(); o.i1(); o.i2()) { var p = o.i8(), q = null, r = null; c[p.a2().al()] === f ? (q = p.a2(), r = p.a3()) : (q = p.a3(), r = p.a2()), m -= this._jn.g5(q), n += this._jn.g6(q), k -= this._jn.g5(r), l += this._jn.g6(r) } if (m !== 0 || n !== 0) { var s; for (s = 180 * Math.atan2(n, m) / Math.PI - g; s < 0; s += 360);d.i6(i, s) } if (k !== 0 && l !== 0) { var t = 180 * Math.atan2(l, k) / Math.PI; t < 0 && (t += 360), e.i6(i.a3(), t) } this.a4(a, i.a3(), c, d, e) } }, a5: function(a, b, c) { for (var d = a.g4(b), e = b.ap(); e.i1(); e.i2()) { var f = e.i8(), g = f.a3(), h = a.g4(g), i = h.x - d.x, j = h.y - d.y, k = 180 * Math.atan2(j, i) / Math.PI; if (c.i1(g) != null) { var l = c.i3(g); k += l } this.a6(a, g, k), this.a5(a, g, c) } }, a6: function(a, b, c) { c = c / 180 * Math.PI; var d = a.c2(b); if (!(d.ay() <= 1)) for (var e = d.x1(); e.i1(); e.i2()) { var f = e.i9(), g = this._jn.g5(f), h = this._jn.g6(f), i = Math.cos(c), j = Math.sin(c), k = g * i - j * h, l = g * j + i * h; this._jn.s2(f, k, l) } } }); var ef = function() { this._a = (new Date()).getTime() }; Jb.ext(ef, Object, { b: function() { return (new Date()).getTime() - this._a } }); var ff = {}; ff._A = new Sd(0, 0), ff.b = function(a, b, c) { return ff.c(a.x, a.y, b.x, b.y, c.x, c.y) }, ff.c = function(a, b, c, d, e, f) { c -= a, d -= b, e -= a, f -= b; var g = e * d - f * c; return Math.abs(g) < 1e-5 ? 0 : g >= 0 ? g <= 0 ? 0 : -1 : 1 }, ff.d = function(a, b, c) { return ff.b(a, b, c) > 0 }, ff.f = function(a, b, c) { return ff.b(a, b, c) < 0 }, ff.g = function(a, b, c) { return ff.b(a, b, c) === 0 }, ff.h = function(a) { return ff.i(a) }, ff.i = function(a) { var b = new qe(a.ah()), c = new qe(); if (b.a2(), b.ar()) return c; var d = b.at(); for (c.ae(d); !b.ar() && d.equals(b.am()); b.at());if (b.ar()) return c; d = b.at(); for (var e = c.ae(d), f = b.ah(); f.i1(); f.i2()) { var g = f.i6(); if (!g.equals(d)) if (d = g, c.ay() === 2 && ff.g(c.am(), c.as(), g))e.c(g); else { var h; for (h = e; !ff.f(c.ai(h).d(), h.d(), g); h = c.ai(h));var i; for (i = e; !ff.d(c.aj(i).d(), i.d(), g); i = c.aj(i));for (;i !== c.aj(h); c.aw(c.aj(h)));e = c.an(g, h) } } return c }, ff.j = function() { return ff.k(Number.MAX_VALUE) }, ff.k = function(a) { return Math.floor(Ib.Util.random() * a) }, ff.l = function(a, b) { return Ib.Util.random() * (b - a) + a }; var gf = function() {}; Jb.ext(gf, Object, { i1: function(a) { this._b = a; var b = new re(); b = ce.a6(a), b.az(ce.a7(a)); for (var c = this.a1(); !b.ar(); a.x5(b.c3()));return c.x1() }, a1: function() { if (this._b.x0() < 3) return new Je(this._b.x9()); for (var a = this._b.xk(), b = this._b.xk(), c = this._b.xl(), d = new Me(this._b, new Ve(), 0, this.a3(this._b)), e = this._b.x0(), f = new re(), g = new re(), h = new Le(this._b); e > 3; e--) { for (var i = d.g(), j = i.an(); j.i1(); j.i2())a.z1(j.i9(), e), b.i5(j.i9(), !1); for (var k = i.an(); k.i1(); k.i2()) for (var l = k.i9(), m = l.ap(); m.i1(); m.i2()) { var n = m.i8(); a.i2(n.a3()) === e && (g.aa(n), b.i5(n.a2(), !0), b.i5(n.a3(), !0)) } if (g.ay() < i.ad() - 1) { for (var o = null, p = i.an(); p.i1(); p.i2()) { var q = p.i9(); if (a.i2(q) === e && !b.i4(q)) if (o == null)o = q; else { var r = this._b.xo(o, q); c.i7(r, !0), g.aa(r), o = null } } if (o != null) for (var s = i.an(); s.i1(); s.i2()) { var t = s.i9(); if (t !== o && t.aj(o) == null) { var u = this._b.xo(o, t); c.i7(u, !0), g.aa(u); break } } if (g.ay() < i.ad() - 1) { for (var v = 2147483647, w = null, x = i.an(); x.i1(); x.i2()) { var y = x.i9(); y.ad() < v && (w = y, v = y.ad()) } for (var z = i.an(); z.i1(); z.i2()) { var A = z.i9(); if (w.aj(A) == null && w !== A) { var B = this._b.xo(w, A); if (c.i7(B, !0), g.aa(B), g.ay() >= i.ad() - 1) break } } } } for (var C = i.an(); C.i1(); C.i2())d.b(C.i9()); for (var D = g.c1(); D.i1(); D.i2()) { var E = D.i8(); c.i4(E) && (d.d(E.a2()), d.d(E.a3())) }f.az(g), h.e(i) }h.b(), d.c(); for (var F = f.c1(); F.i1(); F.i2()) { var G = F.i8(); G._h != null && (c.i4(G) ? this._b.x5(G) : this._b.h1(G)) } var H = this.a4(this._b), I = new Je(), J = H.ak(0), K = H.ak(1), L = null; L = J.a2() === K.a2() || J.a2() === K.a3() ? J.a3() : J.a2(), I.aa(L); for (var M = H.c1(); M.i1(); M.i2()) { var N = M.i8(); L = N.a1(L), I.aa(L) } for (var O = f.c1(); O.i1(); O.i2()) { var P = O.i8(); c.i4(P) || P._h != null || this._b.u1(P) } return this._b.xi(b), this._b.xj(c), this._b.xi(a), this.a2(I), I }, a2: function(a) { if (a.ay() < this._b.x0()) { for (var b = this._b.xk(), c = a._b; c != null; c = c.a()) { var d = c.d(); b.z1(d, c) } var e; for (e = new Me(this._b, new We(b), 0, a.ay(), new We(b)); !e.e();) { for (var f = e.f(), g = f.an(); g.i1(); g.i2()) { var h = g.i9(); if (b.i1(h) != null) { var i = b.i1(h), j = a.ai(i).d(), k = null; k = f.aj(j) != null ? a.ao(f, i) : a.an(f, i), b.z1(f, k); break } } for (var l = f.an(); l.i1(); l.i2()) { var m = l.i9(); b.i1(m) == null && e.d(m) } } this._b.xi(b), e.c() } }, a3: function(a) { for (var b = 0, c = a.x9(); c.i1(); c.i2())b = Math.max(b, c.i9().ad()); return b }, a4: function(a) { for (var b = [], c = 0, d = a.x0(); d > c; c++)b[c] = new he(); var e = new fe(b); e.a6(!1), e.a8(a); for (var f = -1, g = null, h = a.x9(); h.i1(); h.i2()) { var i = h.i9(), j = b[i.al()]; j._a + j._c > f && (f = j._a + j._c, g = i) } for (var k = new re(), l = g, m = b[l.al()]._d; m != null; m = b[l.al()]._d)k.ac(m), l = m.a1(l); l = g; for (var n = b[l.al()]._b; n != null; n = b[l.al()]._d)k.ae(n), l = n.a1(l); return k } }); var hf = function() { this._v = new se(), this._x = new se(), this._z = new De(3, 5), this._w = new De(3, 5), this._y = !1, this._u = !1, this._t = {} }; Jb.ext(hf, Object, { xm: function() { var a = new Ee(this); return a }, xo: function(a, b) { return this.xn(a, null, b, null, 0, 0) }, xn: function(a, b, c, d, e, f) { return new ye(this, a, b, c, d, e, f) }, x4: function(a) { this.b3(a) }, b3: function(a) { for (var b; (b = a._o[0]) != null;) this.x5(b); for (;(b = a._o[1]) != null;) this.x5(b); this._v.c(a), a._g = null, this._y = !0 }, x5: function(a) { this.a11(a) }, a11: function(a) { if (a._h !== this) throw 'Error'; var b = a.a2(), c = a.a3(); this.a12(a, b, c), this._x.c(a), a._h = null, this._u = !0 }, x7: function(a) { a._p = this._v._c, a._g = this, a.ac(), a._c.length < this._z._b && this._z.a3(a, a._c.length, this._z._b), this._v.a(a), this._y = !0 }, x8: function(a) { if (a._h != null) throw 'Error'; a._c.length < this._w._b && this._w.a3(a, a._c.length, this._w._b), a._a == null || a._a._h !== this ? this._x.a(a) : this._x.b(a, a._a), a._h = this, a.a4(), this.b2(a, a.a2(), null, a.a3(), null, 0, 0), this._u = !0 }, xr: function(a, b, c) { var d = a.a2(), e = a.a3(); a._h == null ? (a._d = b, a._e = c) : (d !== b && (d.ar(a, 0, 0), a._d = b, b.ab(a, null, 0, 0, 0)), e !== c && (e.ar(a, 1, 1), a._e = c, c.ab(a, null, 1, 1, 0))) }, x3: function(a) { this.xr(a, a.a3(), a.a2()) }, h1: function(a) { this.a11(a) }, u1: function(a) { this.x8(a) }, h2: function(a) { this.x4(a) }, h3: function(a) { this.x7(a) }, xa: function() { return this._v._c }, x0: function() { return this._v._c }, xh: function() { return this._x._c }, xg: function() { return this._x._c }, xb: function() { return this._v._c === 0 }, xq: function(a) { return a._g === this }, xp: function(a) { return a._h === this }, xd: function() { return this._v._a }, x9: function() { return new Ie(this._v) }, xf: function() { return new Ie(this._x) }, x2: function(a, b) { var c = Hf.d(this.xh()); if (a != null && b != null) for (var d = this.x9(); d.i1(); d.i2())d.i9().at(a, 1, c), d.i9().at(b, 0, c); else if (b == null && a != null) for (var e = this.x9(); e.i1(); e.i2())e.i9().at(a, 1, c); else if (b != null && a == null) for (var f = this.x9(); f.i1(); f.i2())f.i9().at(b, 0, c) }, xk: function() { return this._z.b(this._v) }, xl: function() { return this._w.c(this._x) }, xi: function(a) { this._z.a5(a, this._v) }, xj: function(a) { this._w.a6(a, this._x) }, xc: function(a) { return this._t[a] }, x1: function(a, b) { this._t[a] = b }, x6: function(a) { delete this._t[a] }, b2: function(a, b, c, d, e, f, g) { b.ab(a, c, 0, 0, f), d.ab(a, e, 1, 1, g) }, a12: function(a, b, c) { b.ar(a, 0, 0), c.ar(a, 1, 1) }, c: function() { for (var a = 0, b = this.x9(); b.i1(); b.i2())b.i9()._p = a++; this._y = !1 }, b1: function() { for (var a = 0, b = this.xf(); b.i1(); b.i2())b.i8()._g = a++; this._u = !1 }, xs: function(a) { a.as(this, this._z._b), a._p = this._v._c, this._v.a(a) }, xt: function(a, b, c, d, e, f, g) { a.a6(this, b, d, this._w._b), a._g = this._x._c, this._x.a(a), this.b2(a, a.a2(), c, a.a3(), e, f, g) } }); var jf = function() { jf.superClass.constructor.call(this) }; Jb.ext(jf, hf, { gb: function(a) { return this.g1(a) }, g7: function(a) { return this.g2(a) }, g5: function(a) { var b = this.g1(a); return b.i1() + b.i3() / 2 }, g6: function(a) { var b = this.g1(a); return b.i2() + b.i4() / 2 }, g4: function(a) { return new Sd(this.g5(a), this.g6(a)) }, gi: function(a) { return this.g1(a).i1() }, gh: function(a) { return this.g1(a).i2() }, ga: function(a) { var b = this.g1(a); return new Sd(b.i1(), b.i2()) }, gj: function(a) { return this.g1(a).i3() }, g9: function(a) { return this.g1(a).i4() }, gm: function(a) { return new Td(this.gj(a), this.g9(a)) }, s1: function(a, b) { this.s2(a, b.x, b.y) }, s2: function(a, b, c) { var d = this.g1(a); d.i5(b - d.i3() / 2, c - d.i4() / 2) }, s7: function(a, b, c) { this.g1(a).i6(b, c) }, s8: function(a, b) { this.s7(a, b.width, b.height) }, s3: function(a, b, c) { this.g1(a).i5(b, c) }, s4: function(a, b) { this.s3(a, b.x, b.y) }, gp: function(a) { for (var b = this.g2(a), c = new nd(), d = 0; d < b.i1(); d++)c.add(b.i2(d)); return new Xd(c) }, gf: function(a) { for (var b = this.g2(a), c = new qe(), d = 0; d < b.i1(); d++)c.aa(b.i2(d)); return c }, gc: function(a) { var b = new nd(); b.add(this.gs(a)); for (var c = this.gp(a).d(); c.i1(); c.i2())b.add(c.i6()); return b.add(this.gl(a)), new Xd(b) }, gd: function(a) { var b = new qe(); b.aa(this.gs(a)); for (var c = this.gp(a).d(); c.i1(); c.i2())b.aa(c.i6()); return b.aa(this.gl(a)), b }, m1: function(a, b) { var c = this.g2(a); c.i5(); var d = b.ah(), e = d.i6(); this.gx(a, e); var f = b.as(); for (d.i2(); d.i6() !== f; d.i2()) { var g = d.i6(); c.i4(g.x, g.y) } this.gy(a, f) }, s5: function(a, b) { var c = this.g2(a); c.i5(); for (var d = b.d(); d.i1(); d.i2()) { var e = d.i6(); c.i4(e.x, e.y) } }, s6: function(a, b) { var c = this.g2(a); c.i5(); for (var d = b.ah(); d.i1(); d.i2()) { var e = d.i6(); c.i4(e.x, e.y) } }, m2: function(a, b, c) { this.gx(a, b), this.gy(a, c) }, gn: function(a) { return this.g2(a).i6() }, gk: function(a) { return this.g2(a).i7() }, gt: function(a, b) { this.g2(a).i8(b) }, gz: function(a, b) { this.g2(a).i9(b) }, gs: function(a) { var b = this.g2(a).i6(); if (b == null) return this.g4(a.a2()); var c = new Sd(this.g5(a.a2()) + b.x, this.g6(a.a2()) + b.y); return c }, gl: function(a) { var b = this.g2(a).i7(); if (b == null) return this.g4(a.a3()); var c = new Sd(this.g5(a.a3()) + b.x, this.g6(a.a3()) + b.y); return c }, gx: function(a, b) { var c = new Sd(b.x - this.g5(a.a2()), b.y - this.g6(a.a2())); this.g2(a).i8(c) }, gy: function(a, b) { var c = new Sd(b.x - this.g5(a.a3()), b.y - this.g6(a.a3())); this.g2(a).i9(c) }, g8: function() { for (var a = new re(), b = this.xf(); b.i1(); b.i2())a.aa(b.i8()); return a }, g3: function() { for (var a, b, c = a = Number.MAX_VALUE, d = b = Number.MIN_VALUE, e = this.x9(); e.i1(); e.i2()) { var f = this.ga(e.i9()), g = this.gm(e.i9()); c = Math.min(f.x, c), a = Math.min(f.y, a), d = Math.max(f.x + g.width, d), b = Math.max(f.y + g.height, b) } for (var h = this.xf(); h.i1(); h.i2()) for (var i = this.gp(h.i8()).c(); i.i1(); i.i2()) { var j = i.i6(); c = Math.min(j.x, c), a = Math.min(j.y, a), d = Math.max(j.x, d), b = Math.max(j.y, b) } return { x: Math.floor(c), y: Math.floor(a), width: Math.floor(d - c), height: Math.floor(b - a) } } }); var kf = function() { kf.superClass.constructor.call(this), this.a(new be(), new _d()) }; Jb.ext(kf, jf, { a: function(a, b) { this._a3 = a, this._a4 = b }, xo: function(a, b) { return this.l2(a, b, this._a4.a6()) }, l2: function(a, b, c) { return this.l1(a, null, b, null, 0, 0, c) }, xn: function(a, b, c, d, e, f) { return this.l1(a, b, c, d, e, f, this._a4.a6()) }, l1: function(a, b, c, d, e, f, g) { var h = new ye(this, a, b, c, d, e, f); return h._l = g, h }, xm: function() { var a = new Ee(this); return a._r = this._a3.m3(), a }, g3: function() { for (var a = { x: 0, y: 0, width: -1, height: -1 }, b = this.x9(); b.i1(); b.i2())b.i9()._r.m1(a); return a }, g1: function(a) { return a._r }, g2: function(a) { return a._l }, g5: function(a) { return a._r.m4() }, g6: function(a) { return a._r.m5() }, gi: function(a) { return a._r.i1() }, gh: function(a) { return a._r.i2() }, gj: function(a) { return a._r.i3() }, g9: function(a) { return a._r.i4() }, s2: function(a, b, c) { a._r.m6(b, c) }, s7: function(a, b, c) { a._r.i6(b, c) }, s3: function(a, b, c) { a._r.i5(b, c) } }); var lf = function() { lf.superClass.constructor.call(this), this._ap = this.xk(), this._as = this.xl() }; Jb.ext(lf, jf, { g1: function(a) { var b = this._ap.i1(a); return b == null && (b = new Be(), this._ap.z1(a, b)), b }, g2: function(a) { var b = this._as.i1(a); return b == null && (b = new Ae(), this._as.i8(a, b)), b } }); var mf = function(a) { mf.superClass.constructor.call(this), this._ay = a, this._a0 = this.xk(), this._au = this.xl() }; Jb.ext(mf, lf, { c2: function(a) { var b = this._a0.i1(a); return b }, a2: function(a, b) { this._a0.z1(a, b) }, h: function() { this._az == null && (this._az = this.xk()); for (var a = Hf.a(this._ay.x0() + 1), b = 1, c = this.x9(); c.i1();) { for (var d = this.c2(c.i9()), e = d.x1(); e.i1(); e.i2()) { var f = e.i9(); a[f.al()] = b } for (var g = new re(), h = d.x1(); h.i1(); h.i2()) for (var i = h.i9(), j = a[i.al()], k = i.ap(); k.i1(); k.i2()) { var l = k.i8(), m = l.a3(), n = a[m.al()]; n === j && g.ac(l) } this._az.z1(c.i9(), g), c.i2(), b++ } }, d1: function(a) { return this._az.i1(a) }, b: function(a) { return this._au.i1(a) }, a3: function(a, b) { this._au.i8(a, b) }, a1: function() { var a = this._ay.xk(), b = Ne.a4(Hf.a(this._ay.xh())), c = ce.a1(this._ay, b, a), d = ce.a5(this._ay, b, c); this.d2(a, d), this._ay.xi(a) }, c1: function(a) { for (var b = null, c = -1, d = 0, e = a.length; e > d; d++) { var f = a[d]; f.ay() > c && (b = f, c = f.ay()) } return b }, d2: function(a, b) { for (var c = this._ay.xl(), d = this._ay.xk(), e = b.length, f = 0; e > f; f++) for (var g = b[f], h = g.c1(); h.i1(); h.i2())c.i8(h.i8(), g); var i = this.c1(b); this.a4(i, a, c, new nd(), d); var j = {}; e = b.length; for (var k = 0; e > k; k++) { var l = b[k]; if (l.ay() > 1) { var m = this.xm(); j[l._id] = m } } for (var n = this._ay.x9(); n.i1(); n.i2()) { var o = n.i9(); if (a.i4(o) && d.i1(o) == null) { var p = this.xm(); j[o._id] = p; var q = new Je(); q.aa(o), this.a2(p, q) } } var r = Hf.d(2); e = b.length; for (var s = 0; e > s; s++) { var t = b[s]; if (t.ay() === 1) { var u = t.c2(); r[0] = u.a2(), r[1] = u.a3(); for (var v = 0; v < 2; v++) { var w = r[v]; if (w.ad() === 1) { var x = this.xm(); j[w._id] = x; var y = new Je(); y.aa(w), this.a2(x, y) } } } } for (var z = this._ay.x9(); z.i1(); z.i2()) { var A = z.i9(); if (d.i1(A) != null) for (var B = d.i1(A), C = j[B._id], D = A.af(); D.i1(); D.i2()) { var E = D.i8(); if (c.i1(E) !== B) { var F = j[c.i1(E)._id]; if (F == null) { var G = E.a1(A), H = d.i1(G); F = H != null ? j[H._id] : j[G._id] } var I = C.aj(F), J = null; I == null ? (I = this.xo(C, F), J = new re()) : J = this.b(I), J.aa(E), this.a3(I, J) } } else if (a.i4(A)) for (var K = j[A._id], L = A.af(); L.i1(); L.i2()) { var M = L.i8(), N = M.a1(A), O = j[N._id]; if (O != null) { var P = K.aj(O); if (P == null) { var Q = this.xo(K, O), R = new re(); R.aa(M), this.a3(Q, R) } } } } if (this._ay.x0() === 2 && this._ay.xg() === 1) { var S = this._ay.xf().i8(), T = j[S.a2()._id], U = j[S.a3()._id]; if (U != null && T != null && U.aj(T) == null) { var V = this.xo(T, U), W = new re(); W.aa(S), this.a3(V, W) } } var X = Hf.a(this._ay.x0()), Y = 1; e = b.length; for (var Z = 0; e > Z; Z++) { var $ = b[Z], _ = j[$._id]; if (_ != null) { var aa = this.c2(_); aa == null && (aa = new Je(), this.a2(_, aa)); for (var ba = $.c1(); ba.i1(); ba.i2()) { var ca = ba.i8(), da = ca.a2(); X[da.al()] === Y || a.i4(da) && d.i1(da) !== $ || (X[da.al()] = Y, aa.aa(da)), da = ca.a3(), X[da.al()] === Y || a.i4(da) && d.i1(da) !== $ || (X[da.al()] = Y, aa.aa(da)) } } } this._ay.xj(c), this._ay.xi(d) }, a4: function(a, b, c, d, e) { if (!d.contains(a)) { d.add(a); for (var f = [], g = a.c1(); g.i1(); g.i2()) { var h = g.i8(); f[0] = h.a2(), f[1] = h.a3(); for (var i = 0; i < 2; i++) { var j = f[i]; if (b.i4(j) && e.i1(j) == null) { a.ay() > 1 && e.z1(j, a); for (var k = j.af(); k.i1(); k.i2()) { var l = c.i1(k.i8()); this.a4(l, b, c, d, e) } } } } } } }); var nf = function(a, b, c, d, e) { this._a = {}, nf.superClass.constructor.call(this); var f, g, h = new nd(); for (f = 0, g = b.size(); g > f; f++) { var i = b.get(f); if (i instanceof Ib.Link)h.add(i); else { var j = d && e == null && i instanceof Nd; j && i.setExpanded(!0); var k = a.getDimension(i); if (j && i.setExpanded(!1), k == null) continue; var l = this.xm(), m = a._repulsion; c === 'rightleft' || c === 'leftright' ? this.s7(l, k.height * m, k.width * m) : this.s7(l, k.width * m, k.height * m), l.node = i, this._a[i.getId()] = l } } for (f = 0, g = h.size(); g > f; f++) { var n = h.get(f), o = n.getFromAgent(), p = n.getToAgent(), q = this._a[o.getId()], r = this._a[p.getId()]; q != null && r != null && q !== r && this.xo(q, r) } }; Jb.ext(nf, kf, {}); var of = {}; of._D = new Xd(), of._E = new Sd(0, 0), of.b = function(a) { if (a.i1() > 0) { for (var b = new nd(), c = a.i1() - 1; c >= 0; c--)b.add(a.i2(c)); a.i5(); for (var d = 0, e = b.size(); e > d; d++) { var f = b.get(d); a.i4(f.x, f.y) } } var g = a.i6(); a.i8(a.i7()), a.i9(g) }, of.c = function(a) { of.d(a, !0) }, of.d = function(a, b) { if (b) for (var c = a.xf(); c.i1(); c.i2()) { var d = c.i8(); a.gt(d, of._E), a.gz(d, of._E), a.s5(d, of._D) } else for (var e = a.xf(); e.i1(); e.i2())a.s5(e.i8(), of._D) }, of.e = function(a) { for (var b = new Sd(0, 0), c = a.xf(); c.i1(); c.i2()) { var d = c.i8(); a.gt(d, b), a.gz(d, b) } }, of.f = function(a, b, c, d) { for (var e = a.gc(b).b(), f = Hf.d(e), g = 0, h = a.gc(b).c(); h.i1(); h.i2()) { var i = h.i6(); (g <= 0 || !i.equals(f[g - 1])) && (f[g] = new Sd(i.x, i.y), g++) } if (e = g, !(e < 2)) { var j = new nd(), k = new Ud(f[1].x - f[0].x, f[1].y - f[0].y), l = of.i(k); l.x *= d, l.y *= d; for (var m = of.h(f[0], l), n = of.h(f[1], l), o = new Wd(m, n), p = 1; e - 1 > p; p++) { var q = o, r = of.i(new Ud(f[p + 1].x - f[p].x, f[p + 1].y - f[p].y)); r.x *= d, r.y *= d; var s = of.h(f[p], r), t = of.h(f[p + 1], r); o = new Wd(s, t); var u = Wd.a6(q, o); u != null && j.add(new Sd(u.x, u.y)) } var v = new Ud(f[e - 1].x - f[e - 2].x, f[e - 1].y - f[e - 2].y); v = of.i(v), v.x *= d, v.y *= d; var w = of.h(f[e - 1], v), x = new Xd(j); b.a2() === c.a2() ? (a.s5(c, x), a.m2(c, m, w)) : (a.s5(c, x.a()), a.m2(c, w, m)) } }, of.g = function(a, b, c, d) { for (var e = d, f = c.c1(); f.i1(); f.i2()) { var g = f.i8(); of.f(a, b, g, e), e < 0 && (e -= d), e = -e } }, of.a = function(a, b, c) { return of.j(a, b, c, 1) }, of.l = function(a, b, c) { if (a == null || a.length < 1) return b != null && (b.x = 0, b.y = 0, b.width = 0, b.height = 0), { width: 0, height: 0 }; for (var d = 0, e = 0, f = 0; f < a.length; f++) { var g = a[f]; d = Math.max(d, g.width), e = Math.max(e, g.height) } var h, i, j = d * e * a.length, k = Math.sqrt(j / c), l = j / k, m = Math.floor(l / d), n = Math.ceil(l / d), o = Math.ceil(a.length / m), p = Math.ceil(a.length / n); n * p > m * o ? (h = m, i = o) : (h = n, i = p); var q, r = 0, s = 0, t = 0, u = 0; if (d > e) for (var v = 0; v < a.length; v++)q = a[v], q.x = s * d, q.y = r * e, t = Math.max(t, q.x + q.width), u = Math.max(u, q.y + q.height), ++s >= h && (r++, s = 0); else for (var w = 0; w < a.length; w++)q = a[w], q.x = s * d, q.y = r * e, t = Math.max(t, q.x + q.width), u = Math.max(u, q.y + q.height), ++r >= i && (s++, r = 0); return b != null && (b.x = 0, b.y = 0, b.width = t, b.height = u), { width: i, height: h } }, of.j = function(a, b, c, d) { if (a == null || a.length < 1) return b != null && (b.x = 0, b.y = 0, b.width = 0, b.height = 0), 0; for (var e, f, g = e = a[0].width, h = f = a[0].height, i = a.length, j = 1; i > j; j++) { var k = a[j].width; g = Math.min(g, k), e = Math.max(e, k); var l = a[j].height; h = Math.min(h, l), f = Math.max(f, l) } if (h / f > 0.95 && g / e > 0.95) return of.l(a, b, c).width; for (var m = new qe(), n = 0, o = 0; i > o; o++) { var p = a[o]; m.aa(a[o]), n = Math.floor(n + p.width * p.height) }m.a1(function(a, b) { var c = Math.floor(b.height) - Math.floor(a.height); return c === 0 ? Math.floor(b.width) - Math.floor(a.width) : c }); var q = 0, r = 0, s = Math.floor(c * Math.sqrt(n / c)), t = s, u = 0, v = new qe(); do { var w = new qe(); v.aa(w); for (var x, y, z = x = y = 0, A = m.ah(); A.i1(); A.i2()) { var B = A.i6(); z + B.width > t && w.ay() > 0 ? (y = Math.max(y, z), w = new qe(), w.aa(B), v.aa(w), z = Math.floor(B.width)) : (w.aa(B), z = Math.floor(z + B.width)), w.ay() === 1 && (x = Math.floor(x + w.am().height)) }y = Math.max(y, z), c * x > y && u !== y && (v.af(), t = Math.floor(1.1 * t), u = y) } while (v.ar());for (var C = 0, D = v.ah(); D.i1(); D.i2()) { for (var E = 0, F = D.i6(), G = F.ah(); G.i1(); G.i2()) { var H = G.i6(); H.x = E, H.y = C, E += H.width }q = Math.max(q, E), C += of.k(F), r = Math.max(r, C) } return b != null && (b.x = 0, b.y = 0, b.width = q, b.height = r), v.ay() }, of.k = function(a) { for (var b = 0, c = a.ah(); c.i1(); c.i2())b = Math.max(c.i6().height, b); return b }, of.h = function(a, b) { return new Sd(a.x + b.x, a.y + b.y) }, of.i = function(a) { var b = Math.sqrt(a.x * a.x + a.y * a.y); return new Ud(-a.y / b, a.x / b) }; var pf = function(a) { this._a = a, this._b = !1 }; Jb.ext(pf, Object, { a: function() { return this._b }, b: function() { return this._a }, c: function() { return this._a === 1 }, d: function() { return this._a === 2 }, e: function() { return this._a === 4 }, f: function() { return this._a === 8 }, g: function() { return this._a === 0 } }), pf.h = function(a, b) { var c = a.xc('A'); return c == null ? null : c.i1(b) }, pf.i = function(a, b) { var c = a.xc('B'); return c == null ? null : c.i1(b) }, pf.j = function(a) { switch (a) { case 1:return pf.k; case 2:return pf.l } return null }, pf.k = new pf(1), pf.l = new pf(2); var qf = function(a, b, c, d, e) { this._o = 0, this._l = 0, this._i = 0, this._d = 0, this._f = 0, this._b = a, this._a = 1e-4, this._r = b, this._p = 1, this._e = (e.gj(a) + e.g9(a)) / 4; var f = 0.45 * c * Math.sqrt(d); this._k = ff.l(-f, f), this._h = ff.l(-f, f), this._g = ff.l(-f, f) }; Jb.ext(qf, Object, {}); var rf = function() { this._a = 0, this._c = 0, this._b = 0 }; Jb.ext(rf, Object, {}); var sf = function() { sf.superClass.constructor.call(this), this._dj = 0, this._dh = 0, this._dq = 0, this._dp = 0, this._dt = 0, this._de = 0, this._d3 = 0, this._dr = 0, this._ed = 0, this._dw = 0.65, this._ea = 1, this._dl = 80, this._dx = 3, this._d8 = !0, this._eb = 3e5, this._ee = 2, this._di = 2, this._df = 1e3 }; Jb.ext(sf, Qe, { i4: function(a) { return !0 }, i3: function(a) { if (a != null && (this._d5 = a, this.s(a))) { var b = new rf(), c = 0, d = Math.floor(this._dx * this._dz.length * this._dz.length + 20 * this._dz.length); d = Math.max(d, 1e4); var e = this._ea * this._ea * this._dz.length, f = this._df; try { for (;this._dj > e && d > c; c++) { var g = this.b(2147483647 & c); f-- === 0 && (this._dy.b() > this._eb && (c = d), f = this._df), this.h(g, b), this.d(g, b), this.i(g, b), this._d8 ? (this.g(g, b), this.j(g, b)) : (this.f(g, b), this.c(g, b)); var h = Math.sqrt(b._a * b._a + b._c * b._c + b._b * b._b); this.ac(g, b, h), this.aa(g, b, h) } } catch (i) {} finally { this.r() } } }, s: function(a) { if (a == null || a.xa() < 1) return !1; this._d5 = a, this._dp = 1, this._dy = new ef(), this._dt = a.x0(), this._d2 = Hf.d(this._dt), this._df = 1 + 1e5 / this._dt, this._ed = 1 / (2 * this._di), this._de = this._ed * this._ee / (0.05 * this._dl), this._d3 = Math.pow(this._dl, -1) * this._ed, this._dr = Math.pow(this._dl, 3) * this._ed, this._dj = 0, this._du = new rf(), this._dq = Math.max(20 * this._dl, 10); var b = Math.max(0.1, Math.min(this._dw * this._dl, this._dq)), c = this._dt; of.c(a), this._dz = Hf.d(c); for (var d = a.x9(); d.i1(); d.i2()) { var e = d.i9(), f = new qf(e, b, this._dl, this._dt, a); this._dz[--c] = f, this._dj += f._r, this._dh += f._r * f._r, this._du._a += f._k, this._du._c += f._h, this._du._b += f._g, this._d2[e.al()] = f } return this._d8 = !1, this._dz.length > 0 }, b: function(a) { var b = this._dz.length, c = b - a % b - 1, d = ff.k(c + 1), e = this._dz[d]; return this._dz[d] = this._dz[c], this._dz[c] = e, e }, f: function(a, b) { for (var c, d, e = c = d = 0, f = a._b.ae(); f != null; f = f.a7()) { var g, h = this._d2[f.a2().al()], i = h._k - a._k, j = h._h - a._h, k = h._g - a._g, l = i * i + j * j + k * k, m = Math.sqrt(l), n = m - (h._e + a._e); n <= 0 || (g = n * n * this._d3 / m, e += i * g, c += j * g, d += k * g) } for (var o = a._b.ag(); o != null; o = o.a8()) { var p, q = this._d2[o.a3().al()], r = q._k - a._k, s = q._h - a._h, t = q._g - a._g, u = r * r + s * s + t * t, v = Math.sqrt(u), w = v - (q._e + a._e); w <= 0 || (p = w * w * this._d3 / v, e += r * p, c += s * p, d += t * p) }b._a += e, b._c += c, b._b += d }, g: function(a, b) { var c, d, e = c = d = 0; this._dp++, a._f = this._dp; for (var f = a._b.ae(); f != null; f = f.a7()) { var g = this._d2[f.a2().al()]; g._f = this._dp; var h = g._k - a._k, i = g._h - a._h, j = g._g - a._g, k = h * h + i * i + j * j, l = Math.sqrt(k); if (l !== 0) { var m = Math.max(1e-6, l - (a._e + g._e)), n = -this._ef[f.a5()] / (m * m); n += m * m * this._d1[f.a5()], n /= l, e += h * n, c += i * n, d += j * n } } for (var o = a._b.ag(); o != null; o = o.a8()) { var p = this._d2[o.a3().al()]; p._f = this._dp; var q = p._k - a._k, r = p._h - a._h, s = p._g - a._g, t = q * q + r * r + s * s, u = Math.sqrt(t); if (u !== 0) { var v = Math.max(1e-6, u - (a._e + p._e)), w = -this._ef[o.a5()] / (v * v); w += v * v * this._d1[o.a5()], w /= u, e += q * w, c += r * w, d += s * w } }b._a += e, b._c += c, b._b += d }, j: function(a, b) { for (var c, d, e = c = d = 0, f = this._dt - 1; f >= 0; f--) { var g = this._d2[f]; if (g._f !== a._f) { var h = a._k - g._k, i = a._h - g._h, j = a._g - g._g, k = h * h + i * i + j * j; if (k !== 0) { var l = Math.sqrt(k), m = Math.max(1e-6, l - (a._e + g._e)), n = this._dr / (m * m * l); e += h * n, c += i * n, d += j * n } } }b._a += e, b._c += c, b._b += d }, c: function(a, b) { for (var c, d, e = c = d = 0, f = this._dt - 1; f >= 0; f--) { var g = this._d2[f], h = a._k - g._k, i = a._h - g._h, j = a._g - g._g, k = h * h + i * i + j * j; if (k !== 0) { var l, m = Math.sqrt(k), n = m - (a._e + g._e); l = n <= 0 ? this._dr / (1e-8 * m) : this._dr / (n * n * m), e += h * l, c += i * l, d += j * l } }b._a += e, b._c += c, b._b += d }, i: function(a, b) { var c = this._du._b / this._dt - a._g; b._b += c * this._dl * this._dt / this._dh }, d: function(a, b) { if (this._de !== 0) { var c = this._du._a / this._dt - a._k, d = this._du._c / this._dt - a._h, e = this._du._b / this._dt - a._g; b._a += c * this._de, b._c += d * this._de, b._b += e * this._de } }, h: function(a, b) { var c = 0.05 * (a._r + 2); c > 0 && (b._a = ff.l(-c, c), b._c = ff.l(-c, c), b._b = ff.l(-c, c)) }, ac: function(a, b, c) { if (c !== 0 && a._a !== 0) { var d = b._a * a._o + b._c * a._l + b._b * a._i, e = d / (c * a._a); this._dh -= a._r * a._r, this._dj -= a._r, a._r += a._p * e > 0 ? 0.45 * e : 0.15 * e, a._r > this._dq ? a._r = this._dq : a._r < 0.1 && (a._r = 0.1), this._dj += a._r, this._dh += a._r * a._r, a._p = e } }, aa: function(a, b, c) { if (c > 0) { var d = a._r / c, e = b._a * d, f = b._c * d, g = b._b * d; a._k += e, a._h += f, a._g += g, this._du._a += e, this._du._c += f, this._du._b += g, a._a = c, a._o = b._a, a._l = b._c, a._i = b._b } }, r: function() { for (var a = this._d2.length - 1; a >= 0; a--) { var b = this._d2[a]; this._d5.s2(b._b, b._k, b._h) } } }); var tf = function(a, b, c, d) { this._e = a, this._f = b, this._a = c, this._b = d, this._c = {} }; Jb.ext(tf, Object, { resetGroup: function() { if (this._a && this._b == null) for (var a in this._c) { var b = this._c[a]; b.group.setExpanded(this._e.isExpandGroup() ? !0 : b.b) } }, process: function() { for (var a = new nd(), b = 0, c = this._f.size(); c > b; b++) { var d = this._f.get(b); if (d instanceof Ib.Link)d.isLooped() || a.add(d); else { if (this._b == null && d.getParent() instanceof Nd) continue; (this._b == null || this._b != null && this._b !== d) && a.add(d), this._b == null && d instanceof Nd && this.layoutGroup(d) } } return a }, layoutGroup: function(a) { if (this._a && this._c[a.getId()] == null && this._b == null) { this._c[a.getId()] = { group: a, b: a.isExpanded() }; var b = this._e.getGroupLayoutType(a); if (b) { a.setExpanded(!0); for (var c, d = new nd(), e = a.getChildren(), f = 0, g = e.size(); g > f; f++) if (c = e.get(f), c instanceof Nd && (this.layoutGroup(c), c.setExpanded(!1)), c instanceof Ib.Link || d.contains(c) || d.add(c), c instanceof Ld) { var h = c.getLinks(); if (h != null) for (var i = 0, j = h.size(); j > i; i++) { var k = h.get(i); d.contains(k) || d.add(k) } } var l = new nf(this._e, d, b, this._a, this._b); try { var m = null; if (b === 'round' ? m = new df() : b === 'symmetry' ? m = new sf() : b === 'hierarchic' ? m = new Cf() : (b === 'topbottom' || b === 'bottomtop' || b === 'rightleft' || b === 'leftright') && (m = new Re()), m != null) { m.i2(l); var n = tf.createMatrix(b), o = {}, p = {}; for (var q in l._a) { var r = l._a[q], s = r.node, t = l.g4(r); if (o[q] = s.getCenterLocation(), n != null) { var u = n.transform(t); s.setCenterLocation(u.x, u.y) } else s.setCenterLocation(t.x, t.y); p[q] = s.getCenterLocation() } } } catch (v) {} for (e = a.getChildren(), f = 0, g = e.size(); g > f; f++)c = e.get(f), c instanceof Nd && c.setExpanded(!0) } } } }), tf.createMatrix = function(a) { return a === 'rightleft' ? Tb.createMatrix(Math.PI / 2, 0, 0) : a === 'leftright' ? Tb.createMatrix(-Math.PI / 2, 0, 0) : a === 'bottomtop' ? Tb.createMatrix(Math.PI, 0, 0) : null }; var uf = function() {}; Jb.ext(uf, Object, { i1: function(a, b, c) { var d = this.a1(a, b); return this.a2(a, b, c), d }, a1: function(a, b) { var c = uf.i4(a); c.ax(); for (var d = 0, e = c.x1(); e.i1(); e.i2())b.i7(e.i9(), -1); for (var f = c.x1(); f.i1(); f.i2()) { for (var g = f.i9(), h = -1, i = g.aq(); i.i1(); i.i2())h = Math.max(h, b.i2(i.i9())); b.i7(g, h + 1), d = Math.max(d, h + 1) } return d + 1 }, a2: function(a, b, c) { c.az(uf.i3(a, b)) } }), uf.i3 = function(a, b) { for (var c = new re(), d = a.xf(); d.i1(); d.i2()) { var e = d.i8(); b.i2(e.a2()) > b.i2(e.a3()) && (a.x3(e), c.ac(e)) } return c }, uf.i4 = function(a) { var b = Hf.a(a.xa()); return (new ie()).a1(a, b), uf.i2(a, b) }, uf.i2 = function(a, b) { for (var c = Hf.d(a.x0()), d = a.x9(); d.i1(); d.i2()) { var e = d.i9(), f = e.al(); c[b[f]] = e } return new Je(c) }; var vf = function() { vf.superClass.constructor.call(this), this.c0() }; Jb.ext(vf, re, { c0: function() { this._bc = 1, this._bd = 0 } }); var wf = function() { this._m1 = 20, this._m2 = 60, this._m3 = 5, this._m4 = 0 }; Jb.ext(wf, Object, { i4: function(a) { this._m3 = a }, i5: function(a) { this._m4 = a }, i3: function(a) { this._m1 = a }, i6: function(a) { this._m2 = a }, i2: function(a) { this._m5 = a }, t1: function() { return this._m2 }, a1: function(a, b) { for (var c = Hf.d(b.length), d = 0; d < b.length; d++)c[d] = b[d].x1(); this.a2(a, c) }, a2: function(a, b) { for (var c = Hf.a(b.length), d = 0, e = 0; e < b.length; e++) { var f = 0, g = b[e]; for (g.i4(); g.i1(); g.i2())f = Math.max(f, a.g9(g.i9())); for (c[e] = f, g.i4(); g.i1(); g.i2()) { var h = (c[e] - a.g9(g.i9())) / 2; a.s4(g.i9(), new Sd(a.gi(g.i9()), d + h)) } var i = this.t1(); d += c[e] + i, g.i4() } }, i1: function(a, b, c) { this._m6 = a, this.t2(b, c) } }); var xf = function(a, b) { xf.superClass.constructor.call(this) }; Jb.ext(xf, wf, { t2: function(a, b) { var c = this._m6; this._a = c.xc('D'), this._h = c.xc('C'), this.a1(c, a), this.tg(c, a), this.tf(a, Ne.a5(this._e), this._m5, this._l), this.tb(c, this._f[0]), this.ta(a), this.th(c, this._f[0], a), this.b(a), this.tb(c, this._f[1]), this.ta(a), this.th(c, this._f[1], a), this.b(a), this.a11(this._f[1]), this.a12(a), this.tb(c, this._f[2]), this.ta(a), this.th(c, this._f[2], a), this.b(a), this.tb(c, this._f[3]), this.ta(a), this.th(c, this._f[3], a), this.b(a), this.a11(this._f[3]), this.a12(a), this.tc(c), this.tj() }, a11: function(a) { for (var b = 0; b < a.length; b++)a[b] = -a[b] }, b: function(a) { for (var b = 0; b < a.length; b++) { var c = a[b]; c.ax() } for (var d = 0; d < a.length; d++) for (var e = 0, f = null, g = a[d].x1(); g.i1(); g.i2()) { var h = g.i9(), i = h.al(); this._l[i] = e++, this._b[i] = f, this._k[i] = null, f != null && (this._k[f.al()] = h), f = h } var j = this._a; this._a = this._h, this._h = j; for (var k = this._m6.xf(); k.i1(); k.i2()) { var l = k.i8(), m = this._m6.gn(l); this._m6.gt(l, new Sd(-m.x, m.y)); var n = this._m6.gk(l); this._m6.gz(l, new Sd(-n.x, n.y)) } var o = this._l, p = function(a, b) { return a == null && b != null ? 1 : a != null && b == null ? -1 : a == null && b == null ? 0 : o[a.a2().al()] - o[b.a2().al()] }, q = function(a, b) { return a == null && b != null ? 1 : a != null && b == null ? -1 : a == null && b == null ? 0 : o[a.a3().al()] - o[b.a3().al()] }; this._m6.x2(p, q) }, a12: function(a) { for (var b = this._m6.xf(); b.i1(); b.i2()) { var c = b.i8(); this._m6.x3(c); var d = this._m6.gn(c), e = this._m6.gk(c); this._m6.gz(c, d), this._m6.gt(c, e) } for (var f = new qe(), g = 0; g < a.length; g++)f.ae(a[g]); for (var h = 0; h < a.length; h++)a[h] = f.au(); var i = this._l, j = function(a, b) { return a == null && b != null ? 1 : a != null && b == null ? -1 : a == null && b == null ? 0 : i[a.a2().al()] - i[b.a2().al()] }, k = function(a, b) { return a == null && b != null ? 1 : a != null && b == null ? -1 : a == null && b == null ? 0 : i[a.a3().al()] - i[b.a3().al()] }; this._m6.x2(j, k) }, tg: function(a, b) { var c = a.x0(), d = a.xg(); this._l = Hf.a(c), this._b = Hf.d(c), this._k = Hf.d(c), this._m = Hf.d(c), this._i = Hf.d(c), this._o = Hf.d(c), this._f = Hf.e(4, c), this._c = Hf.a(c), this._g = Hf.a(c), this._j = Hf.a(c), this._d = Hf.b(c), this._e = Hf.b(d); for (var e = 0; e < b.length; e++) for (var f = 0, g = null, h = b[e].x1(); h.i1(); h.i2()) { var i = h.i9(), j = i.al(); this._l[j] = f++, this._b[j] = g, this._k[j] = null, g != null && (this._k[g.al()] = i), g = i } var k = this._l, l = function(a, b) { return a == null && b != null ? 1 : a != null && b == null ? -1 : a == null && b == null ? 0 : k[a.a2().al()] - k[b.a2().al()] }, m = function(a, b) { return a == null && b != null ? 1 : a != null && b == null ? -1 : a == null && b == null ? 0 : k[a.a3().al()] - k[b.a3().al()] }; a.x2(l, m) }, tb: function(a, b) { for (var c = a.x9(); c.i1(); c.i2()) { var d = c.i9(), e = d.al(); this._m[e] = d, this._i[e] = d, b[e] = Number.MAX_VALUE, this._o[e] = d, this._c[e] = Number.MAX_VALUE, this._d[e] = !1, this._j[e] = this._g[e] = 0 } }, ta: function(a) { for (var b = 1; b < a.length; b++) for (var c = -1, d = a[b]._b; d != null; d = d.a()) { var e = d.d(), f = e.al(), g = e.ak(); if (g !== 0) { var h, i = Math.floor((g + 1) / 2), j = Math.ceil((g + 1) / 2), k = 1; for (h = e.ae(); i > k; h = h.a7())k++; for (var l = !1; j >= k && !l; k++) { var m = this._m6.g2(h), n = h.a2(), o = n.al(); this._i[f] === e && !this._e[h.a5()] && c < this._l[o] && (c = this._l[o], this._i[o] = e, this._m[f] = this._m[o], this._i[f] = this._m[f], l = !0, this._j[o] = m.i6().x, this._g[f] = m.i7().x), h = h.a7() } } } }, th: function(a, b, c) { for (var d = a.x9(); d.i1(); d.i2()) { var e = d.i9(), f = e.al(); this._m[f] === e && this.td(a, e, b) } for (var g = 0; g < c.length; g++) { var h = c[g].x1(); if (h.i1()) { var i = c[g].x1().i9(), j = i.al(); this._o[this._m[j].al()] === i && this.tk(a, i, b) } } for (var k = a.x9(); k.i1(); k.i2()) { var l = k.i9(), m = l.al(), n = this._c[this._o[this._m[m].al()].al()]; n < Number.MAX_VALUE && (b[m] += n) } }, td: function(a, b, c) { var d = b.al(); if (c[d] === Number.MAX_VALUE) { c[d] = 0; var e = b, f = 0; do { var g = e.al(); if (g !== d && (f -= this._g[g]), this._l[g] > 0) { var h = this._b[g], i = this._m[this._b[g].al()], j = i.al(); this.td(a, i, c), this._o[d] === b && (this._o[d] = this._o[j]), this._o[d] === this._o[j] && (c[d] = Math.max(c[d], c[h.al()] + this.ti(a, h, e) - f)) }f += this._j[g], e = this._i[g] } while (e !== b);f = 0, e = b; do { var k = e.al(); k !== d && (f -= this._g[k]), c[k] = c[d] + f, f += this._j[k], e = this._i[k] } while (e !== b) } }, tk: function(a, b, c) { var d = b.al(); if (!this._d[d]) { this._d[d] = !0; var e = b; do { var f = e.al(), g = this._k[f]; if (g != null) { var h = g.al(), i = this._o[this._m[h].al()]; if (i !== this._o[d]) { var j = c[h] - c[d] - this.ti(a, e, g); this._c[i.al()] !== Number.MAX_VALUE && (j += this._c[i.al()]), this._c[this._o[d].al()] = Math.min(this._c[this._o[d].al()], j) } else this.tk(a, this._m[h], c) }e = this._i[f] } while (e !== b) } }, tc: function(a) { for (var b = Hf.a(4), c = Hf.a(4), d = a.x9(); d.i1(); d.i2()) { var e = d.i9(), f = e.al(); c[0] += this._f[0][f], c[1] += this._f[1][f], c[2] += this._f[2][f], c[3] += this._f[3][f] }c[0] /= a.xa(), c[1] /= a.xa(), c[2] /= a.xa(), c[3] /= a.xa(); for (var g = a.x9(); g.i1(); g.i2()) { var h = g.i9(), i = h.al(), j = a.g4(h); b[0] = this._f[0][i] - c[0], b[1] = this._f[1][i] - c[1], b[2] = this._f[2][i] - c[2], b[3] = this._f[3][i] - c[3], b.sort(Hf.n); var k = (b[1] + b[2]) / 2; a.s1(h, new Sd(k, j.y)) } }, ti: function(a, b, c) { var d, e = a.gj(b), f = a.gj(c); return d = e > 1 && f > 1 ? this._m1 + (e + f) / 2 : this._m3 + (e + f) / 2, this._l[b.al()] < this._l[c.al()] ? (this._a != null && (d += this._a.i3(c)), this._h != null && (d += this._h.i3(b))) : (this._a != null && (d += this._a.i3(b)), this._h != null && (d += this._h.i3(c))), d }, tj: function() { this._l = null, this._b = null, this._k = null, this._e = null, this._m = null, this._i = null, this._f = null, this._c = null, this._o = null, this._d = null, this._j = null, this._g = null }, tf: function(a, b, c, d) {
    for (var e = a.length, f = 2; e - 1 > f; f++) {
      for (var g = -1, h = 0, i = 0, j = a[f].x1(), k = a[f].x1(); k.i1(); k.i2()) {
        var l = k.i9(), m = null, n = !1; if (l.ak() === 1 && (m = l.ae().a2(), c.i1(m) != null && c.i1(l) != null && (n = !0)), i === a[f].ay() - 1 || n) {
          for (var o = n ? d[m.al()] : a[f - 1].ay(); i >= h; h++) {
            for (var p = j.i9(), q = p.am(); q.i1(); q.i2()) {
              var r = q.i8(), s = d[r.a2().al()]; (g > s || s > o) && b.i7(q.i8(), !0)
            }j.i2()
          }g = o
        }i++
      }
    }
  } }); var yf = function(a, b) { this._b = 20, this._a = b, this._d = a, this._f = {} }; Jb.ext(yf, Object, { a3: function(a) { this._b = a }, a4: function(a, b, c, d, e) { if (this.a2(a)) { var f = this.b2(a); f._o = b, f._m = e, f._n = d, f._f = c } }, b2: function(a) { var b = this._f[a._id]; return b == null && (b = new zf(), this._f[a._id] = b), b }, a2: function(a) { return this._f[a._id] != null }, c: function() { for (var a = Ne.a1(Hf.a(this._d.xa())), b = Ne.a1(Hf.a(this._d.xa())), c = this._d.x9(); c.i1(); c.i2()) { var d = c.i9(); if (this.a2(d)) { var e = this.b2(d); a.i6(d, this._b * (e.c() - 1)), b.i6(d, this._b * (e.b() - 1)) } } this._d.x1('D', a), this._d.x1('C', b) }, g: function() { this._d.x6('D'), this._d.x6('C') }, f: function() { for (var a = this._d.x9(); a.i1(); a.i2()) { var b = a.i9(); if (this.a2(b)) { var c = this._d.gi(b), d = this._d.gh(b), e = this._d.gj(b), f = this._d.g9(b), g = this.b2(b), h = g._q.ay() + g._b.ay() + g._f, i = g._d.ay() + g._g.ay() + g._o, j = g._i.ay() + g._l.ay() + g._n, k = g._h.ay() + g._k.ay() + g._m, l = this._a.a7(e, h), m = this._a.a7(e, i), n = this._a.a7(f, k), o = this._a.a7(f, j); g.a2(this._a.a8(e, h, l), this._a.a8(e, i, m), this._a.a8(f, k, n), this._a.a8(f, j, o)); for (var p = g._j.c1(); p.i1(); p.i2()) { var q = p.i8(), r = this.a1(q), s = this.b1(q), t = new qe(); r.b() === s.b() ? (r.c() ? (t.aa(new Sd(c + g._g._bd * m + g._c, d)), t.aa(new Sd(c + g._g._bd * m + g._c, d - this._b)), g._g._bd++, t.aa(new Sd(c + g._g._bd * m + g._c, d - this._b)), t.aa(new Sd(c + g._g._bd * m + g._c, d)), g._g._bd++, g._g._bc = Math.max(g._g._bc, 2)) : r.d() ? (t.aa(new Sd(c + g._b._bd * l + g._p, d + f)), t.aa(new Sd(c + g._b._bd * l + g._p, d + f + this._b)), g._b._bd++, t.aa(new Sd(c + g._b._bd * l + g._p, d + f + this._b)), t.aa(new Sd(c + g._b._bd * l + g._p, d + f)), g._b._bd++, g._b._bc = Math.max(g._b._bc, 2)) : r.f() ? (t.aa(new Sd(c, d + g._i._bd * o + g._a)), t.aa(new Sd(c - this._b, d + g._i._bd * o + g._a)), g._i._bd++, t.aa(new Sd(c - this._b, d + g._i._bd * o + g._a)), t.aa(new Sd(c, d + g._i._bd * o + g._a)), g._i._bd++, g._i._bc = Math.max(g._i._bc, 2)) : r.e() && (t.aa(new Sd(c + e, d + g._h._bd * n + g._e)), t.aa(new Sd(c + e + this._b, d + g._h._bd * n + g._e)), g._h._bd++, t.aa(new Sd(c + e + this._b, d + g._h._bd * n + g._e)), t.aa(new Sd(c + e, d + g._h._bd * n + g._e)), g._h._bd++, g._h._bc = Math.max(g._h._bc, 2)), this._d.m1(q, t)) : r.c() || s.c() ? r.e() || s.e() ? (t.aa(new Sd(c + e - g._d._bd * m - g._c, d)), t.aa(new Sd(c + e - g._d._bd * m - g._c, d - this._b * g._d._bc)), t.aa(new Sd(c + e + this._b * g._h._bc, d - this._b * g._d._bc)), t.aa(new Sd(c + e + this._b * g._h._bc, d + g._h._bd * n + g._e)), t.aa(new Sd(c + e, d + g._h._bd * n + g._e)), g._d._bd++, g._d._bc++, g._h._bd++, g._h._bc++, s.c() && t.ax(), this._d.m1(q, t)) : r.f() || s.f() ? (t.aa(new Sd(c + g._g._bd * m + g._c, d)), t.aa(new Sd(c + g._g._bd * m + g._c, d - this._b * g._g._bc)), t.aa(new Sd(c - this._b * g._i._bc, d - this._b * g._g._bc)), t.aa(new Sd(c - this._b * g._i._bc, d + g._i._bd * o + g._a)), t.aa(new Sd(c, d + g._i._bd * o + g._a)), g._g._bd++, g._g._bc++, g._i._bd++, g._i._bc++, s.c() && t.ax(), this._d.m1(q, t)) : (r.d() || s.d()) && (t.aa(new Sd(c + e - g._d._bd * m - g._c, d)), t.aa(new Sd(c + e - g._d._bd * m - g._c, d - this._b * g._d._bc)), t.aa(new Sd(c + e + this._b * g.b(), d - this._b * g._d._bc)), t.aa(new Sd(c + e + this._b * g.b(), d + f + this._b * g._q._bc)), t.aa(new Sd(c + e - g._q._bd * l - g._p, d + f + this._b * g._q._bc)), t.aa(new Sd(c + e - g._q._bd * l - g._p, d + f)), g._d._bd++, g._d._bc++, g._k._bc++, g._h._bc++, g._q._bc++, g._q._bd++, s.c() && t.ax(), this._d.m1(q, t)) : r.d() || s.d() ? r.e() || s.e() ? (t.aa(new Sd(c + e - g._q._bd * l - g._p, d + f)), t.aa(new Sd(c + e - g._q._bd * l - g._p, d + f + this._b * g._q._bc)), t.aa(new Sd(c + e + this._b * g._k._bc, d + f + this._b * g._q._bc)), t.aa(new Sd(c + e + this._b * g._k._bc, d + f - g._k._bd * n - g._e)), t.aa(new Sd(c + e, d + f - g._k._bd * n - g._e)), g._q._bd++, g._q._bc++, g._k._bd++, g._k._bc++, s.d() && t.ax(), this._d.m1(q, t)) : (r.f() || s.f()) && (t.aa(new Sd(c + g._b._bd * l + g._p, d + f)), t.aa(new Sd(c + g._b._bd * l + g._p, d + f + this._b * g._b._bc)), t.aa(new Sd(c - this._b * g._l._bc, d + f + this._b * g._b._bc)), t.aa(new Sd(c - this._b * g._l._bc, d + f - g._l._bd * o - g._a)), t.aa(new Sd(c, d + f - g._l._bd * o - g._a)), g._b._bd++, g._b._bc++, g._l._bd++, g._l._bc++, s.d() && t.ax(), this._d.m1(q, t)) : (t.aa(new Sd(c, d + f - g._l._bd * o - g._a)), t.aa(new Sd(c - this._b * g._l._bc, d + f - g._l._bd * o - g._a)), t.aa(new Sd(c - this._b * g._l._bc, d + f + this._b * g.a1())), t.aa(new Sd(c + e + this._b * g._k._bc, d + f + this._b * g.a1())), t.aa(new Sd(c + e + this._b * g._k._bc, d + f - g._k._bd * n - g._e)), t.aa(new Sd(c + e, d + f - g._k._bd * n - g._e)), g._l._bd++, g._l._bc++, g._b._bc++, g._q._bc++, g._k._bc++, g._k._bd++, s.f() && t.ax(), this._d.m1(q, t)) } } } }, a5: function(a, b) { for (var c = 0; c < a.length; c++) for (var d = a[c], e = b[c], f = d.x1(); f.i1(); f.i2()) { var g = f.i9(); if (this.a2(g)) { var h = this.b2(g); e._g = Math.max(e._g, this._b * (h.d() - 1)), e._j = Math.max(e._j, this._b * (h.a1() - 1)) } } }, a1: function(a) { var b = this._d.xc('A'), c = null; if (b != null && (c = b.i1(a)), c == null || c.g()) { var d = this._d.xc('B'); if (d == null) return pf.j(1); var e = d.i1(a); if (e == null || e.g()) return pf.j(1); if (e.c()) return pf.j(8); if (e.f()) return pf.j(1); if (e.d()) return pf.j(4); if (e.e()) return pf.j(2) } return c }, b1: function(a) { var b = this._d.xc('B'), c = null; if (b != null && (c = b.i1(a)), c == null || c.g()) { var d = this._d.xc('A'); if (d == null) return pf.j(8); var e = d.i1(a); if (e == null || e.g()) return pf.j(8); if (e.c()) return pf.j(8); if (e.f()) return pf.j(1); if (e.d()) return pf.j(4); if (e.e()) return pf.j(2) } return c } }); var zf = function() { this._o = 0, this._f = 0, this._n = 0, this._m = 0, this._c = 0, this._p = 0, this._e = 0, this._a = 0, this._j = new re(), this._g = new vf(), this._d = new vf(), this._b = new vf(), this._q = new vf(), this._h = new vf(), this._k = new vf(), this._i = new vf(), this._l = new vf() }; Jb.ext(zf, Object, { a1: function() { return Math.max(this._q._bc, this._b._bc) }, d: function() { return Math.max(this._d._bc, this._g._bc) }, b: function() { return Math.max(this._k._bc, this._h._bc) }, c: function() { return Math.max(this._l._bc, this._i._bc) }, a2: function(a, b, c, d) { this._c = b, this._a = d, this._p = a, this._e = c, this._g.c0(), this._d.c0(), this._b.c0(), this._q.c0(), this._k.c0(), this._h.c0(), this._l.c0(), this._i.c0() } }); var Af = function(a, b, c, d) { this._k = 20, this._r = 0.5, this._d = a, this._c = b, this._j = c, this._m = d, this._i = a.xc('A') != null || a.xc('B') != null, this._t = new Df(a, b, c, d), this._b = new yf(a, this) }; Jb.ext(Af, Object, { a6: function(a) { this._k = a, this._t.a1(a), this._b.a3(a) }, g1: function() { return this._k }, a9: function(a) { return this.c1(), a }, a5: function(a) { return this.a1(), a }, b3: function(a) { return this.c1(), a = this.c4(a), this._b.c(), a }, g2: function(a) { return this._b.g(), a }, e2: function(a) { a = this.f(a), this._b.f() }, e1: function() { this._t.d(), this._n != null && this._d.xi(this._n), this.a1(), this._d = null }, a1: function() { this._i && (this._q != null && (this._d.x1('A', this._q), this._q = null), this._p != null && (this._d.x1('B', this._p), this._p = null), this._h != null && (this._d.xj(this._h), this._h = null), this._l != null && (this._d.xj(this._l), this._l = null)) }, c1: function() { if (this._i) { this._h == null && (this._h = this._d.xl()), this._l == null && (this._l = this._d.xl()); for (var a = this._d.xf(); a.i1(); a.i2()) { var b = a.i8(), c = this._j.i1(b.a2()) != null, d = this._j.i1(b.a3()) != null; if (c && !d) { var e = this._j.i1(b.a2()); this._m.i4(e) ? this._l.i8(b, pf.h(this._d, e)) : this._l.i8(b, pf.i(this._d, e)) } else if (!c && d) { var f = this._j.i1(b.a3()); this._m.i4(f) ? this._h.i8(b, pf.i(this._d, f)) : this._h.i8(b, pf.h(this._d, f)) } else c || d || (this._m.i4(b) ? (this._h.i8(b, pf.i(this._d, b)), this._l.i8(b, pf.h(this._d, b))) : (this._h.i8(b, pf.h(this._d, b)), this._l.i8(b, pf.i(this._d, b)))) } this._q = this._d.xc('A'), this._p = this._d.xc('B'), this._d.x1('A', this._h), this._d.x1('B', this._l) } }, c4: function(a) { this._n = this._d.xk(), this._a = this._d.xl(), this._g = this._d.xl(); for (var b = new re(), c = new re(), d = new re(), e = new re(), f = new re(), g = new re(), h = new re(), i = new re(), j = new re(), k = this._d.xk(), l = 0; l < a.length; l++) for (var m = 0, n = a[l].x1(); n.i1();)k.i6(n.i9(), m), n.i2(), m++; for (var o = function(a, b) { var c = k.i3(a.a3()) - k.i3(b.a3()); return c <= 0 ? c >= 0 ? 0 : -1 : 1 }, p = function(a, b) { var c = k.i3(a.a2()) - k.i3(b.a2()); return c <= 0 ? c >= 0 ? 0 : -1 : 1 }, q = 0; q < a.length; q++) for (var r = a[q], s = r._b; s != null; s = s.a()) { var t = s.d(); t.av(o), t.au(p); var u = 0; b.af(), c.af(), d.af(), e.af(), f.af(), g.af(), h.af(), i.af(), j.af(); for (var v = t.ap(); v.i1();) { var w = v.i8(), x = this.b1(w); x == null || x.d() || x.g() ? d.aa(w) : x.e() ? b.aa(w) : x.f() ? (c.aa(w), j.aa(w)) : x.c() && (i.aa(w), j.aa(w)), v.i2(), u++ }u = 0; for (var y = t.am(); y.i1();) { var z = y.i8(), A = this.a2(z); A == null || A.c() || A.g() ? e.aa(z) : A.e() ? b.aa(z) : A.f() ? (c.aa(z), j.aa(z)) : A.d() && (g.aa(z), j.aa(z)), y.i2(), u++ } var B = k.i3(t); if (!j.ar()) for (var C = 0.1 / j.ay(), D = B - 0.4; !j.ar(); D += C) { var E = j.c3(); if (E.a2() === t) { var F = this._d.xm(); this._n.z1(F, E.a2()), this._d.s7(F, 1, 1), this._c.z1(F, this._c.i1(t)), k.i6(F, D), this._a.i8(E, this._d.gn(E)), this._d.gt(E, ff._A), this._d.xr(E, F, E.a3()), r.ao(F, s) } else { var G = this._d.xm(); this._n.z1(G, E.a3()), this._d.s7(G, 1, 1), this._c.z1(G, this._c.i1(t)), k.i6(G, D), this._g.i8(E, this._d.gk(E)), this._d.gz(E, ff._A), this._d.xr(E, E.a2(), G), r.ao(G, s) } } if (!b.ar()) for (var H = 0.1 / b.ay(), I = B + 0.1; !b.ar(); I += H) { var J = b.c3(); if (J.a2() === t) { var K = this._d.xm(); this._n.z1(K, J.a2()), this._d.s7(K, 1, 1), this._c.z1(K, this._c.i1(t)), k.i6(K, I), this._a.i8(J, this._d.gn(J)), this._d.gt(J, ff._A), this._d.xr(J, K, J.a3()), s = r.an(K, s) } else { var L = this._d.xm(); this._n.z1(L, J.a3()), this._d.s7(L, 1, 1), this._c.z1(L, this._c.i1(t)), k.i6(L, I), this._g.i8(J, this._d.gk(J)), this._d.gz(J, ff._A), this._d.xr(J, J.a2(), L), s = r.an(L, s) } } var M = Af._z; this._b.a2(t) && (M = this._b.b2(t)); var N = M._b.ay() + g.ay() + t.ao() + f.ay() + M._q.ay(); if (N > 0) for (var O = this._d.g9(t) / 2, P = this._d.gj(t), Q = this.a7(P, N), R = -0.5 * P + this.a8(this._d.gj(t), N, Q) + Q * (M._b.ay() + g.ay()), S = t.ap(); S.i1(); S.i2()) { var T = S.i8(); this.c2(T) || this._j.i1(T.a2()) != null || (this._d.g2(T).i8(new Sd(R, O)), R += Q) } var U = this._t.a3(t), V = 0, W = 0, X = 0, Y = 0; if (U != null && (V = U._e.ay(), W = U._c.ay(), X = U._b.ay(), Y = U._d.ay()), N = M._g.ay() + V + i.ay() + t.ak() + h.ay() + W + M._d.ay(), N > 0) { for (var Z = this._d.gj(t), $ = this.a7(Z, N), _ = this.a8(Z, N, $), aa = -0.5 * Z + _ + $ * (M._g.ay() + V + i.ay()), ba = -this._d.g9(t) / 2, ca = t.am(); ca.i1(); ca.i2()) { var da = ca.i8(); this.d1(da) || this._j.i1(da.a3()) != null || (this._d.g2(da).i9(new Sd(aa, ba)), aa += $) } if (U != null) { for (var ea = -0.5 * Z + _ + $ * (M._g.ay() + i.ay() + U._e.ay() - 1), fa = U._e.c1(); fa.i1(); fa.i2()) { var ga = fa.i8(); this._d.u1(ga), ga.a2() !== t || this.c2(ga) ? this.d1(ga) || (this._d.g2(fa.i8()).i9(new Sd(ea, ba)), ea -= $) : (this._d.g2(fa.i8()).i8(new Sd(ea, ba)), ea -= $), this._d.h1(ga) }ea = 0.5 * Z - _ - $ * (M._d.ay() + h.ay()); for (var ha = U._c.c1(); ha.i1(); ha.i2()) { var ia = ha.i8(); this._d.u1(ia), ia.a2() !== t || this.c2(ia) ? this.d1(ia) || (this._d.g2(ha.i8()).i9(new Sd(ea, ba)), ea -= $) : (this._d.g2(ha.i8()).i8(new Sd(ea, ba)), ea -= $), this._d.h1(ia) } } } this._b.a2(t) && this._b.a4(t, V + i.ay() + t.ak() + h.ay() + W, g.ay() + t.ao() + f.ay(), X + c.ay(), Y + b.ay()) } return this._d.xi(k), a }, a7: function(a, b) { return b <= 1 ? 0 : a / (b - 1 + 2 * this._r) }, a8: function(a, b, c) { return b <= 1 ? 0.5 * a : 0.5 * (a - c * (b - 1)) }, f: function(a) { var b = this.g1(); this._f = this._d.xk(); for (var c = 0; c < a.length; c++) for (var d = a[c], e = d._b; e != null;) { var f = e.d(), g = this._n.i1(f); if (g != null || this._t.b2(f))e = e.a(); else { var h = new Je(), i = new Je(), j = new Je(), k = new Je(), l = new Je(), m = new Je(), n = new re(), o = new re(), p = new Gf(h, i, j, k, l, m, n, o); this._f.z1(f, p), n.ab(f.am()), o.ab(f.ap()); for (var q = e.b(); q != null && this._n.i1(q.d()) === f; q = q.b()) { var r = q.d(), s = this.c3(r); s.f() ? i.ac(r) : s.c() ? k.ac(r) : s.d() && m.ac(r) } var t; for (t = e.a(); t != null && this._n.i1(t.d()) === f; t = t.a()) { var u = t.d(), v = this.c3(u); v.e() ? h.aa(u) : v.c() ? j.aa(u) : v.d() && l.aa(u) }e = t } } for (var w = this.d2(a), x = 0, y = 0; y < a.length; y++) { var z = w[y]; y > 0 && (x += w[y - 1]._j + w[y - 1]._h + w[y - 1]._b), x += z._g + z._f + z._a + z._d; for (var A = a[y].x1(); A.i1(); A.i2()) { var B = A.i9(); this._d.s3(B, this._d.gi(B), this._d.gh(B) + x) }z._c += x, z._i += x } for (var C = 0; C < a.length; C++) for (var D = a[C], E = D.x1(); E.i1(); E.i2()) { var F = E.i9(); this._n.i1(F) != null && D.av(E) } for (var G = this, H = function(a, b) { return G.a3(a) ? G.a3(b) && G._d.gi(a) >= G._d.gi(b) ? -1 : 1 : G.a3(b) ? -1 : G._d.gi(a) >= G._d.gi(b) ? 1 : -1 }, I = function(a, b) { return G.a3(a) ? G.a3(b) ? G._d.gi(a) >= G._d.gi(b) ? 1 : -1 : 1 : G.a3(b) ? -1 : G._d.gi(a) >= G._d.gi(b) ? -1 : 1 }, J = 0; J < a.length; J++) for (var K = w[J], L = a[J].x1(); L.i1(); L.i2()) { var M = L.i9(); if (!this._t.b2(M)) { var N = this._f.i1(M), O = N._d, P = N._a, Q = N._b, R = N._h, S = N._f, T = N._c, U = N._g, V = N._e, W = 0, X = 0, Y = 0, Z = 0, $ = M.ao(), _ = M.ak(), aa = this._d.gi(M), ba = this._d.gh(M), ca = this._d.gj(M), da = this._d.g9(M), ea = this._t.a3(M), fa = Af._z; if (this._b.a2(M) && (fa = this._b.b2(M)), ea != null) { if (W = ea._d.ay(), X = ea._b.ay(), Y = ea._e.ay(), Z = ea._c.ay(), W > 0) for (var ga = fa._h.ay() + O.ay() + W + fa._k.ay(), ha = this.a7(da, ga), ia = this.a8(da, ga, ha), ja = ba + ia + ha * (fa._h.ay() + this.a4(O)), ka = ea._d.c1(); ka.i1(); ka.i2()) { var la = ka.i8(); this._d.u1(la), la.a2() === M ? this.c2(la) || this._d.gx(la, new Sd(aa + ca, ja)) : (this.d1(la), this._d.gy(la, new Sd(aa + ca, ja))), ja += ha, this._d.h1(la) } if (X > 0) for (var ma = fa._i.ay() + P.ay() + X + fa._l.ay(), na = this.a7(da, ma), oa = this.a8(da, ma, na), pa = ba + oa + na * (fa._i.ay() + this.a4(P)), qa = ea._b.c1(); qa.i1(); qa.i2()) { var ra = qa.i8(); this._d.u1(ra), ra.a2() === M ? this.c2(ra) || this._d.gx(ra, new Sd(aa, pa)) : this.d1(ra) || this._d.gy(ra, new Sd(aa, pa)), pa += na, this._d.h1(ra) } } if (O.ay() > 0) { O.a1(H); for (var sa = fa._h.ay() + O.ay() + W + fa._k.ay(), ta = this.a7(da, sa), ua = this.a8(da, sa, ta), va = ba + ua + ta * fa._h.ay(), wa = !0; !O.ar();) { var xa = O.x4(); if (this.a3(xa)) { wa && (wa = !1, va += ta * W); var ya = xa.ag(), za = this._d.gd(ya), Aa = za.at(); if (za.ac(new Sd(Aa.x, K.b())), this.c2(ya)) { var Ba = this._a.i1(ya); za.ac(new Sd(Aa.x, Ba.y + this._d.g6(M))), za.ac(new Sd(Ba.x + this._d.g5(M), Ba.y + this._d.g6(M))) } else za.ac(new Sd(Aa.x, va)), za.ac(new Sd(aa + ca, va)); this._d.xr(ya, M, ya.a3()), this._d.m1(ya, za) } else { var Ca = xa.ae(), Da = this._d.gd(Ca), Ea = Da.au(); if (Da.ae(new Sd(Ea.x, K.a())), this.d1(Ca)) { var Fa = this._g.i1(Ca); Da.ae(new Sd(Ea.x, Fa.y + this._d.g6(M))), Da.ae(new Sd(Fa.x + this._d.g5(M), Fa.y + this._d.g6(M))) } else Da.ae(new Sd(Ea.x, va)), Da.ae(new Sd(aa + ca, va)); this._d.xr(Ca, Ca.a2(), M), this._d.m1(Ca, Da) } this._d.x4(xa), va += ta } } if (P.ay() > 0) { P.a1(I); for (var Ga = fa._i.ay() + P.ay() + X + fa._l.ay(), Ha = this.a7(da, Ga), Ia = this.a8(da, Ga, Ha), Ja = ba + Ia + Ha * fa._i.ay(), Ka = !0; !P.ar();) { var La = P.x4(); if (this.a3(La)) { Ka && (Ka = !1, Ja += Ha * X); var Ma = La.ag(), Na = this._d.gd(Ma), Oa = Na.at(); if (Na.ac(new Sd(Oa.x, K.b())), this.c2(Ma)) { var Pa = this._a.i1(Ma); Na.ac(new Sd(Oa.x, Pa.y + this._d.g6(M))), Na.ac(new Sd(Pa.x + this._d.g5(M), Pa.y + this._d.g6(M))) } else Na.ac(new Sd(Oa.x, Ja)), Na.ac(new Sd(aa, Ja)); this._d.xr(Ma, M, Ma.a3()), this._d.m1(Ma, Na) } else { var Qa = La.ae(), Ra = this._d.gd(Qa), Sa = Ra.au(); if (Ra.ae(new Sd(Sa.x, K.a())), this.d1(Qa)) { var Ta = this._g.i1(Qa); Ra.ae(new Sd(Sa.x, Ta.y + this._d.g6(M))), Ra.ae(new Sd(Ta.x + this._d.g5(M), Ta.y + this._d.g6(M))) } else Ra.ae(new Sd(Sa.x, Ja)), Ra.ae(new Sd(aa, Ja)); this._d.xr(Qa, Qa.a2(), M), this._d.m1(Qa, Ra) } this._d.x4(La), Ja += Ha } } var Ua = fa._g.ay() + fa._d.ay() + _ + R.ay() + Q.ay() + Y + Z; ca = this._d.gj(M); var Va = this.a7(ca, Ua), Wa = this.a8(ca, Ua, Va); Ua = fa._b.ay() + fa._q.ay() + $ + T.ay() + S.ay(); var Xa = this.a7(ca, Ua), Ya = this.a8(ca, Ua, Xa); if (R.ay() > 0) for (var Za, $a = Va, _a = b, ab = this._d.gi(M) + Wa + $a * (fa._g.ay() + R.ay() - 1), bb = this._d.gh(M), cb = K._c - K._g - R.ay() * _a; !R.ar(); this._d.x4(Za)) { Za = R.x4(); var db = Za.ag(), eb = this._d.gd(db), fb = eb.at(); if (eb.ac(new Sd(fb.x, K.b())), eb.ac(new Sd(fb.x, cb)), this.c2(db)) { var gb = this._a.i1(db); eb.ac(new Sd(gb.x + this._d.g5(M), cb)), eb.ac(new Sd(gb.x + this._d.g5(M), gb.y + this._d.g6(M))) } else eb.ac(new Sd(ab, cb)), eb.ac(new Sd(ab, bb)), ab -= $a; cb += _a, this._d.xr(db, M, db.a3()), this._d.m1(db, eb) } if (Q.ay() > 0) for (var hb, ib = Va, jb = b, kb = this._d.gi(M) + this._d.gj(M) - Wa - ib * fa._d.ay(), lb = this._d.gh(M), mb = K._c - K._g - jb; !Q.ar(); this._d.x4(hb)) { hb = Q.x4(); var nb = hb.ag(), ob = this._d.gd(nb), pb = ob.at(); if (ob.ac(new Sd(pb.x, K.b())), ob.ac(new Sd(pb.x, mb)), this.c2(nb)) { var qb = this._a.i1(nb); ob.ac(new Sd(qb.x + this._d.g5(M), mb)), ob.ac(new Sd(qb.x + this._d.g5(M), qb.y + this._d.g6(M))) } else ob.ac(new Sd(kb, mb)), ob.ac(new Sd(kb, lb)), kb -= ib; mb -= jb, this._d.xr(nb, M, nb.a3()), this._d.m1(nb, ob) } if (T.ay() > 0) for (var rb, sb = Xa, tb = b, ub = this._d.gi(M) + Ya + sb * (fa._b.ay() + T.ay() - 1), vb = this._d.gh(M) + this._d.g9(M), wb = vb + T.ay() * tb; !T.ar(); this._d.x4(rb)) { rb = T.x4(); var xb = rb.ae(), yb = this._d.gd(xb), zb = yb.au(); if (yb.ae(new Sd(zb.x, K.a())), yb.ae(new Sd(zb.x, wb)), this.d1(xb)) { var Ab = this._g.i1(xb); yb.ae(new Sd(Ab.x + this._d.g5(M), wb)), yb.ae(new Sd(Ab.x + this._d.g5(M), Ab.y + this._d.g6(M))) } else yb.ae(new Sd(ub, wb)), yb.ae(new Sd(ub, vb)), ub -= sb; wb -= tb, this._d.xr(xb, xb.a2(), M), this._d.m1(xb, yb) } if (S.ay() > 0) for (var Bb, Cb = Xa, Db = b, Eb = this._d.gi(M) + this._d.gj(M) - Ya - Xa * fa._q.ay(), Fb = this._d.gh(M) + this._d.g9(M), Gb = Fb + Db; !S.ar(); this._d.x4(Bb)) { Bb = S.x4(); var Hb = Bb.ae(), Ib = this._d.gd(Hb), Jb = Ib.au(); if (Ib.ae(new Sd(Jb.x, K.a())), Ib.ae(new Sd(Jb.x, Gb)), this.d1(Hb)) { var Kb = this._g.i1(Hb); Ib.ae(new Sd(Kb.x + this._d.g5(M), Gb)), Ib.ae(new Sd(Kb.x + this._d.g5(M), Kb.y + this._d.g6(M))) } else Ib.ae(new Sd(Eb, Gb)), Ib.ae(new Sd(Eb, Fb)), Eb -= Cb; Gb += Db, this._d.xr(Hb, Hb.a2(), M), this._d.m1(Hb, Ib) } for (;!V.ar();) { var Lb = V.c3(), Mb = this._d.gl(Lb); K.a() + 12 < Mb.y && this._d.g7(Lb).i4(Mb.x, K.a()) } for (;!U.ar();) { var Nb = U.c3(), Ob = this._d.gs(Nb); if (K.b() - 12 > Ob.y) { var Pb = this._d.gf(Nb); Pb.ac(new Sd(Ob.x, K.b())), this._d.s6(Nb, Pb) } } } } for (var Qb = 0; Qb < a.length; Qb++) for (var Rb = a[Qb], Sb = Rb._b; Sb != null; Sb = Sb.a()) { var Tb = Sb.d(), Ub = this._t.a3(Tb); Ub != null && Ub._a != null && (this._d.x4(Ub._a), Rb.aw(Sb.b())) } return this._d.xi(this._f), this._d.xj(this._a), this._d.xj(this._g), a }, c3: function(a) { return this.a3(a) ? this.b1(a.ag()) : this.a2(a.ae()) }, b1: function(a) { return this._h == null ? Af.s : this._h.i1(a) }, a2: function(a) { return this._l == null ? Af.u : this._l.i1(a) }, c2: function(a) { if (a == null) return !1; var b = this.b1(a); return b != null && b.a() }, d1: function(a) { if (a == null) return !1; var b = this.a2(a); return b != null && b.a() }, a3: function(a) { return a.ao() === 1 }, b2: function(a) { return a.ak() === 1 }, a4: function(a) { for (var b = 0, c = a._b; c != null; c = c.a()) this.b2(c.d()) && b++; return b }, d2: function(a) { for (var b = this._k, c = Hf.d(a.length + 1), d = 0; d < a.length; d++) { var e = a[d], f = new Ef(); c[d] = f, f._c = Number.MAX_VALUE, f._i = Number.MIN_VALUE; for (var g = e.x1(); g.i1(); g.i2()) { var h = g.i9(), i = this._d.gb(h); f._c = Math.min(f._c, i.i2()), f._i = Math.max(f._i, i.i2() + i.i4()) } } this._b.a5(a, c); for (var j = 0; j < a.length; j++) for (var k = c[j], l = a[j].x1(); l.i1(); l.i2()) { var m = l.i9(), n = this._f.i1(m); n != null && (k._h = Math.max(k._h, Math.max(n._f.ay() * b, n._c.ay() * b)), k._f = Math.max(k._f, Math.max(n._b.ay() * b, n._h.ay() * b))) } return c } }), Af.s = pf.j(2), Af.u = pf.j(1), Af._z = new zf(); var Bf = function() { this._af = 0, this._b = 0 }; Jb.ext(Bf, Object, { ib: function(a) { this._af = a }, ia: function(a, b, c) { this.a6(a, b, c), this.b2(!1); var d = this.g(); if (this.o() && d > 0) { for (var e = this.r(), f = 0; f < 20 && d > 0 && this.o(); f++) { this.b2(!0); var g = this.g(); d > g && (this.a7(e), d = g) } this.b3(e), this.b1() } return this.c() }, a6: function(a, b, c) { this._b = (new Date()).getTime(), this._ac = a, this._ah = b; var d = this; this._p = function(a, b) { var c = d._n[a.al()] - d._n[b.al()]; return c > 0 ? 1 : c >= 0 ? 0 : -1 }, this._ad = Hf.d(c); for (var e = 0; e < this._ad.length; e++) this._ad[e] = new Je(); this._ab = Hf.a(this._ac.x0()), this._f = Hf.d(this._ac.x0()), this._n = Hf.a(this._ac.x0() + 1); var f = this._ab; this._o = function(a, b) { if (a == null && b != null) return 1; if (a != null && b == null) return -1; if (a == null && b == null) return 0; var c = a, d = b, e = c._h, g = c.a2(), h = d.a2(), i = f[g.al()] - f[h.al()]; if (i === 0) { var j = Bf.b(pf.h(e, c), e.gn(c)), k = Bf.b(pf.h(e, d), e.gn(d)), l = j - k; if (l === 0) { var m = f[c.a3().al()] - f[d.a3().al()]; if (m === 0) { var n = Bf.a(pf.i(e, c), e.gk(c)), o = Bf.a(pf.i(e, d), e.gk(d)); return n - o } return m } return l } return i }, this._l = function(a, b) { if (a == null && b != null) return 1; if (a != null && b == null) return -1; if (a == null && b == null) return 0; var c = a, d = b, e = c._h, g = c.a3(), h = d.a3(), i = f[g.al()] - f[h.al()]; if (i === 0) { var j = Bf.a(pf.i(e, c), e.gk(c)), k = Bf.a(pf.i(e, d), e.gk(d)), l = j - k; if (l === 0) { var m = f[c.a2().al()] - f[d.a2().al()]; if (m === 0) { var n = Bf.b(pf.h(e, c), e.gn(c)), o = Bf.b(pf.h(e, d), e.gn(d)); return n - o } return m } return l } return i }, this._z = function(a, b) { if (a == null && b != null) return 1; if (a != null && b == null) return -1; if (a == null && b == null) return 0; var c = a, d = b, e = c._h, f = Bf.b(pf.h(e, c), e.gn(c)), g = Bf.b(pf.h(e, d), e.gn(d)); return f - g }, this._e = function(a, b) { if (a == null && b != null) return 1; if (a != null && b == null) return -1; if (a == null && b == null) return 0; var c = a, d = b, e = c._h, f = Bf.a(pf.i(e, c), e.gk(c)), g = Bf.a(pf.i(e, d), e.gk(d)); return f - g }, this._ac.x2(this._e, this._z) }, c: function() { this._ah = null, this._aa = null, this._f = null, this._n = null, this._p = null, this._o = null, this._l = null, this._ac = null; var a = this._ad; return this._ad = null, a }, o: function() { var a = (new Date()).getTime() - this._b; return a <= this._af }, m: function() { for (var a = this, b = function(b, c) { return Math.ceil(a._n[b.a3().al()]) - Math.ceil(a._n[c.a3().al()]) }, c = this._ac.x9(); c.i1(); c.i2()) { for (var d = c.i9().aw(); d.i1(); d.i2()) this._n[d.i9().al()] = ff.j(); c.i9().av(b) } }, b2: function(a) { for (var b = 0; b < this._ad.length; b++) this._ad[b].af(); if (a) { this.m(); for (var c = 0, d = this._ab.length; d > c; c++) this._ab[c] = 0; this._ac.x2(null, this._z) } var e = this._ac.xm(); this._ah.i7(e, 0); for (var f = this._ac.x9(); f.i1(); f.i2())f.i9().ak() === 0 && f.i9() !== e && this._ac.xo(e, f.i9()); var g = new ee(this); g.a6(!0), g.a9(this._ac, e), this._ad[0].at(), this._ac.x4(e), this.d() }, a1: function() { this._ac.x2(this._o, this._l); for (var a = 0, b = 1; b < this._ad.length; b++) { var c = this.a2(this._ad[b - 1], this._ad[b]); a += c } var d = 0; return a += d }, a2: function(a, b) { var c = a.ah(), d = b.ah(), e = new qe(), f = new qe(); this._aa = Hf.d(this._ac.x0()); for (var g = 0; c.i1() && d.i1(); d.i2())g += this.a8(c.i6(), e, f, !0), g += this.a8(d.i6(), f, e, !1), c.i2(); for (;c.i1(); c.i2())g += this.a8(c.i6(), e, f, !0); for (;d.i1(); d.i2())g += this.a8(d.i6(), f, e, !1); return g }, a8: function(a, b, c, d) { var e = 0, f = 0, g = 0; if (this._aa[a.al()] != null) for (var h = this._aa[a.al()].a(), i = b._b; i !== h; i = i.a()) { var j = i._c; j === a ? (e++, g += f, b.aw(i)) : f++ } var k = e * c.ay() + g; if (d) for (var l = a.ag(); l != null; l = l.a8()) { var m = l.a3(); this._ab[m.al()] >= this._ab[a.al()] && (this._aa[m.al()] = c.ae(m)) } else for (var n = a.ae(); n != null; n = n.a7()) { var o = n.a2(); this._ab[o.al()] > this._ab[a.al()] && (this._aa[o.al()] = c.ae(o)) } return k }, g: function() { for (var a = this.r(), b = this.a1(), c = !0, d = 0; d < 3 && this.o() && b > 0;) { var e = this.k(); b > e ? (this.a7(a), b = e) : d++, c = !c } if (this.b3(a), this.b1(), b > 0) { for (var f = 1, g = 0; f === 1 && b > 0; g++) { this.e(), this.i(); var h = this.a1(); b > h ? (f = 1, this.a7(a)) : f = -1, b = h } this.b3(a), this.b1() } return b }, e: function() { for (var a = this.l(), b = this.r(), c = Hf.d(this._ac.x0()), d = this._ad.length - 1; d >= 0; d--) for (var e = this._ad[d].ah(); e.i1(); e.i2()) { var f = e.i6(); if (f.ak() === 1 && f.ao() === 1) { var g = a.i1(f.ag()); if (g != null && c[g.al()] == null) for (var h = this.a4(f, g), i = g.al(), j = c[i] = Hf.d(h + 1), k = j.length - 1; k >= 0; k--)j[k] = new qe() } } for (var l = 0; l < this._ad.length; l++) for (var m = this._ad[l].ah(); m.i1(); m.i2()) { var n = m.i6(); if (n.ak() === 1 && n.ao() === 1) { var o = a.i1(n.ag()); if (o != null) { var p = o.al(), q = this.a4(n, o) - 1; c[p][q].ae(n.ae()) } } else for (var r = n.ae(); r != null; r = r.a7()) { var s = a.i1(r); if (s != null) { var t = s.al(), u = this.a4(n, s) - 1; c[t][u].ae(r) } } } for (var v = this._ac.x9(); v.i1(); v.i2()) { var w = v.i9(); if (c[w.al()] != null) for (var x = w.ag(); x != null; x = x.a8()) { var y = a.i1(x); if (y != null) for (var z = c[y.al()]; z[0].ay() > 0;) { for (var A, B = 0; ;) { A = z[B].am(); var C = A.a3(); if (C.ak() !== 1 || C.ao() !== 1) break; B++ } var D = z[B].at().a3(); B--, D = A.a2(), A = z[B].at(); for (var E = A.a3(); B >= 0;) if (b[D.al()] !== b[E.al()] && (this._ab[D.al()] = b[E.al()]), D = D.ae().a2(), --B >= 0) { var F = z[B].at(); E = F.a3() } } } } this.b1(), this._ac.xj(a) }, i: function() { for (var a = this.f(), b = this.r(), c = Hf.d(this._ac.x0()), d = 0; d < this._ad.length; d++) for (var e = this._ad[d].ah(); e.i1(); e.i2()) { var f = e.i6(); if (f.ak() === 1 && f.ao() === 1) { var g = a.i1(f.ae()); if (g != null && c[g.al()] == null) for (var h = this.a4(g, f), i = g.al(), j = c[i] = Hf.d(h + 1), k = j.length - 1; k >= 0; k--)j[k] = new qe() } } for (var l = this._ad.length - 1; l >= 0; l--) for (var m = this._ad[l].ah(); m.i1(); m.i2()) { var n = m.i6(); if (n.ak() === 1 && n.ao() === 1) { var o = a.i1(n.ae()); if (o != null) { var p = o.al(), q = this.a4(o, n) - 1; c[p][q].ae(n.ag()) } } else for (var r = n.ag(); r != null; r = r.a8()) { var s = a.i1(r); if (s != null) { var t = s.al(), u = this.a4(s, n) - 1; c[t][u].ae(r) } } } for (var v = this._ac.x9(); v.i1(); v.i2()) { var w = v.i9(); if (c[w.al()] != null) for (var x = w.ae(); x != null; x = x.a7()) { var y = a.i1(x); if (y != null) for (var z = c[y.al()]; z[0].ay() > 0;) { for (var A, B = 0; ;) { A = z[B].am(); var C = A.a2(); if (C.ak() !== 1 || C.ao() !== 1) break; B++ } var D = z[B].at().a2(); B--, D = A.a3(), A = z[B].at(); for (var E = A.a2(); B >= 0;) if (b[D.al()] !== b[E.al()] && (this._ab[D.al()] = b[E.al()]), D = D.ag().a3(), --B >= 0) { var F = z[B].at(); E = F.a2() } } } } this.b1(), this._ac.xj(a) }, a4: function(a, b) { return this._ah.i2(a) - this._ah.i2(b) }, l: function() { for (var a = Ne.a6(Hf.d(this._ac.xg())), b = this._ac.x9(); b.i1(); b.i2()) { var c = b.i9(); if (c.ao() > 1) { for (var d = 0, e = c.ag(); e != null; e = e.a8()) { var f = e.a3(); f.ak() === 1 && f.ao() === 1 && d++ } if (d > 1) for (var g = c.ag(); g != null; g = g.a8()) { var h = g, i = h.a3(); if (i.ak() === 1 && i.ao() === 1) { for (;i.ak() === 1 && i.ao() === 1; i = h.a3())a.i8(h, c), h = i.ag(); a.i8(h, c) } } } } return a }, f: function() { for (var a = Ne.a6(Hf.d(this._ac.xg())), b = this._ac.x9(); b.i1(); b.i2()) { var c = b.i9(); if (c.ak() > 1) { for (var d = 0, e = c.ae(); e != null; e = e.a7()) { var f = e.a2(); f.ak() === 1 && f.ao() === 1 && d++ } if (d > 1) for (var g = c.ae(); g != null; g = g.a7()) { var h = g, i = h.a2(); if (i.ak() === 1 && i.ao() === 1) { for (;i.ak() === 1 && i.ao() === 1; i = h.a2())a.i8(h, c), h = i.ae(); a.i8(h, c) } } } } return a }, k: function() { for (var a = 1; a < this._ad.length; a++) { for (var b = this._ad[a], c = b.ah(); c.i1(); c.i2()) { var d = c.i6(); this._n[d.al()] = this.a5(d, b.ay(), d.am(), this._ad[a - 1].ay()), this._n[d.al()] += this._ab[d.al()] / (3 * this._ad[a - 1].ay()) } this.a3(b, this._p) } return this.a1() }, a5: function(a, b, c, d) { var e = 0; if (c.i7() === 0)e = d * this._ab[a.al()] / b; else { for (;c.i1(); c.i2()) { var f = c.i8(); e += f.a2() === a ? this._ab[f.a3().al()] : this._ab[f.a2().al()] }e /= c.i7() } return e }, a7: function(a) { Hf.f(this._ab, a, a.length) }, b3: function(a) { Hf.f(a, this._ab, a.length) }, r: function() { var a = Hf.a(this._ab.length); return this.a7(a), a }, d: function() { for (var a = 0; a < this._ad.length; a++) for (var b = 0, c = this._ad[a].ah(); c.i1();) this._ab[c.i6().al()] = b, c.i2(), b++ }, b1: function() { for (var a = 0; a < this._ad.length; a++) { for (var b = this._ad[a], c = b._b; c != null; c = c.a()) { var d = c.d(); this._f[this._ab[d.al()]] = d } for (var e = 0, f = b._b; f != null;)f.c(this._f[e]), f = f.a(), e++ } }, a3: function(a, b) { for (var c = a.ah(), d = 0; d < a.ay(); c.i2()) this._f[d] = c.i6(), d++; Hf.s(this._f, a.ay(), b); for (var e = 0, f = a._b; f != null;)f.c(this._f[e]), this._ab[this._f[e].al()] = e, f = f.a(), e++ } }), Bf.b = function(a, b) { if (a == null) return 0; var c = a.a() ? Math.floor(b.x) : 0, d = a.a() ? Math.floor(b.y) : 0; return a.e() ? 1e4 - d : a.f() ? -1e4 + d : a.c() ? -2e4 - c : c }, Bf.a = function(a, b) { if (a == null) return 0; var c = a.a() ? Math.floor(b.x) : 0, d = a.a() ? Math.floor(b.y) : 0; return a.e() ? 1e4 + d : a.f() ? -1e4 - d : a.d() ? -2e4 - c : c }; var Cf = function() { Cf.superClass.constructor.call(this), this._i6 = 0, this._i3 = 2147483647, this._i0 = 60, this._iz = 20, this._i2 = 20, this._i4 = 20, this.i5(!1), this._i7 = new uf(), this._i1 = new Bf(), this._i8 = new xf() }; Jb.ext(Cf, Qe, { j2: function() { return this._i2 }, i4: function(a) { return !0 }, i3: function(a) { this._i6 = (new Date()).getTime(), of.d(a, !1); var b = a.xk(), c = a.xk(), d = a.xl(), e = new re(), f = new Af(a, b, c, d); f.a6(this.j2()), this._i8.i3(this._iz), this._i8.i6(this._i0), this._i8.i4(this._i2), this._i8.i5(this._i4), this._i8.i2(c); for (var g = this._i7.i1(a, b, e), h = e.c1(); h.i1(); h.i2()) { var i = h.i8(); d.i7(i, !0); var j = a.gn(i); a.gt(i, a.gk(i)), a.gz(i, j) } this.a2(a, b, c), g = f.a9(g); var k = this.j1(a, b, g); k = f.a5(k), k = f.b3(k), this._i8.i1(a, k, b), k = f.g2(k), f.e2(k), this.b(a, c), this.w(a), this.a1(a, e), f.e1(), a.xj(d), a.xi(c), a.xi(b) }, j1: function(a, b, c) { if (this._i1 instanceof Bf) { var d = this._i1, e = (new Date()).getTime() - this._i6; d.ib(this._i3 - e) } var f = this._i1.ia(a, b, c); return f }, a1: function(a, b) { for (var c = b.c1(); c.i1(); c.i2()) { var d = c.i8(), e = a.gs(d), f = a.gl(d); a.x3(d); var g = a.gp(d); a.s5(d, g.a()), a.gy(d, e), a.gx(d, f) } }, b: function(a, b) { for (var c = a.x9(); c.i1(); c.i2()) { var d = c.i9(), e = b.i1(d); if (e != null && !a.xp(e)) { for (var f = d.am().i8().a2(); b.i1(f) != null; f = d.am().i8().a2())d = f; a.u1(e); for (var g = d.ae(), h = new qe(); b.i1(g.a3()) != null; g = g.a3().ag()) { var i = a.gs(g); h.aa(i), h.az(a.gf(g)); var j = a.gl(g); j.equals(i) || h.aa(j) } var k = a.gs(g); h.aa(k), h.az(a.gf(g)); var l = a.gl(g); l.equals(k) || h.aa(l), a.m1(e, h) } } for (var m = a.x9(); m.i1(); m.i2())b.i1(m.i9()) != null && a.x4(m.i9()) }, w: function(a) { for (var b = a.xf(); b.i1(); b.i2()) { var c = b.i8(), d = a.g2(c); if (d.i1() > 0) { var e = new nd(), f = a.gc(c), g = f.c(), h = g.i6(); g.i2(); var i = h.x, j = h.y; if (g.i1()) { var k = g.i6(), l = k.x, m = k.y; for (g.i2(); g.i1(); g.i2()) { var n = g.i6(), o = n.x, p = n.y, q = (i - o) * (m - p) / (j - p) + o; Math.abs(q - l) >= 1 && (e.add(k), i = l, j = m), k = n, l = o, m = p } }e.size() < d.i1() && a.s5(c, new Xd(e)) } } }, a2: function(a, b, c) { var d = a.g8().c1(); for (d.i5(); d.i1(); d.i3()) { var e = d.i8().a2(), f = d.i8().a3(), g = b.i2(f) - b.i2(e); if (g > 1) { for (var h = null, i = null, j = e; g > 1; g--)h = a.xm(), a.s7(h, 1, 1), a.s4(h, ff._A), i = a.xo(j, h), j === e && a.gt(i, a.gn(d.i8())), b.i7(h, b.i2(j) + 1), c.z1(h, d.i8()), j = h; i = a.xo(h, f), a.gz(i, a.gk(d.i8())), a.h1(d.i8()) } } } }); var Df = function(a, b, c, d) { this._i = 20, this._j = a, this._g = b, this._a = c, this._h = d }; Jb.ext(Df, Object, { a1: function(a) { this._i = a }, b2: function(a) { return this._e == null ? !1 : this._e.i4(a) }, a3: function(a) { return this._f == null ? null : this._f.i1(a) }, d: function() { this._j.xi(this._f), this._j.xi(this._e) } }); var Ef = function() { this._c = 0, this._i = 0, this._g = 0, this._j = 0, this._f = 0, this._h = 0, this._d = 0, this._e = 0, this._a = 0, this._b = 0 }; Jb.ext(Ef, Object, { a: function() { return this._c - this._g - this._f - this._a }, b: function() { return this._i + this._j + this._h + this._b } }); var Ff = function() { this._d = new re(), this._b = new re(), this._c = new re(), this._e = new re() }; Jb.ext(Ff, Object, {}); var Gf = function(a, b, c, d, e, f, g, h) { this._d = a, this._a = b, this._b = c, this._h = d, this._f = e, this._c = f, this._e = g, this._g = h }; Jb.ext(Gf, Object, {}); var Hf = {}; Hf.a = function(a, b) { for (var c = [], d = 0; a > d; d++)c[d] = b || 0; return c }, Hf.b = function(a) { for (var b = [], c = 0; a > c; c++)b[c] = !1; return b }, Hf.c = function(a, b) { if (a instanceof Sd) return a.x < b.x ? -1 : a.x > b.x ? 1 : a.y < b.y ? -1 : a.y <= b.y ? 0 : 1; if (a instanceof Td) return b.width > a.width ? -1 : b.width < a.width ? 1 : b.height > a.height ? -1 : b.height >= a.height ? 0 : 1; if (a instanceof Vd) return a.x < b.x ? -1 : a.x > b.x ? 1 : a.y < b.y ? -1 : a.y > b.y ? 1 : b.width > a.width ? -1 : b.width < a.width ? 1 : b.height > a.height ? -1 : b.height >= a.height ? 0 : 1; throw 'Unkown Type: ' + a }, Hf.d = function(a) { for (var b = [], c = 0; a > c; c++)b[c] = null; return b }, Hf.e = function(a, b) { for (var c = [], d = 0; a > d; d++)c[d] = Hf.a(b); return c }, Hf.f = function(a, b, c) { for (var d = 0; c > d; d++)b[d] = a[d] }, Hf.s = function(a, b, c) { var d = []; Hf.f(a, d, b), d.sort(c), Hf.f(d, a, b) }, Hf.n = function(a, b) { return a - b }
}(this))
